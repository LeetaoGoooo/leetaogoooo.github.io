<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Leetao&#39;s Blog</title>
  
  <subtitle>Talk is cheap, show me the code</subtitle>
  <link href="https://leetaogoooo.github.io/atom.xml" rel="self"/>
  
  <link href="https://leetaogoooo.github.io/"/>
  <updated>2022-04-12T07:10:22.037Z</updated>
  <id>https://leetaogoooo.github.io/</id>
  
  <author>
    <name>Leetao</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Python åˆ—è¡¨å†…å­˜é¢„åˆ†é…é—®é¢˜</title>
    <link href="https://leetaogoooo.github.io/2022/04/12/Python%20%E5%88%97%E8%A1%A8%E5%86%85%E5%AD%98%E9%A2%84%E5%88%86%E9%85%8D%E9%97%AE%E9%A2%98/"/>
    <id>https://leetaogoooo.github.io/2022/04/12/Python%20%E5%88%97%E8%A1%A8%E5%86%85%E5%AD%98%E9%A2%84%E5%88%86%E9%85%8D%E9%97%AE%E9%A2%98/</id>
    <published>2022-04-11T16:00:00.000Z</published>
    <updated>2022-04-12T07:10:22.037Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»¥ä¸‹ä¾‹å­å‡çš„è¿è¡Œç¯å¢ƒä¸º Python 3.9.5ï¼Œä¸åŒç‰ˆæœ¬çš„å®é™…è¿è¡Œç»“æœå¯èƒ½æœ‰æ‰€ä¸åŒ</p></blockquote><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰ç«¯æ—¶é—´çœ‹äº† Golang çš„ å­¦ä¹ äº†ä¸€ä¸‹ æ•°ç»„ å’Œ Sliceï¼Œå…¶ä¸­ Slice ç›¸å½“äºåŠ¨æ€æ•°ç»„ï¼Œå…¶ä¸­æ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè€Œ Slice åˆ™æ˜¯ä¸å®šé•¿çš„ã€‚åœ¨ Python ä¸­æ˜¯æ²¡æœ‰æ•°ç»„å’Œ Slice çš„æ¦‚å¿µï¼Œå®ƒä»¬å¯ä»¥é€šé€šå½’ç±»ä¸º Listï¼ˆåˆ—è¡¨ï¼‰ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå®šé•¿çš„ List å’Œ ä¸å®šé•¿çš„ List åœ¨è¡¨ç°ä¸Šä¼šæœ‰åŒºåˆ«å—ï¼Ÿï¼ˆè¿™é‡Œçš„å®šé•¿çš„ List æ˜¯æŒ‡å¯¹ List è¿›è¡Œåˆå§‹åŒ–,ä¹Ÿå°±æ˜¯æ‰€è°“çš„é¢„åˆ†é…ï¼‰<br>æ¥ä¸‹æ¥é€šè¿‡å‡ ä¸ªä¾‹å­å»éªŒè¯è¿™ä¸ªé—®é¢˜ã€‚</p><span id="more"></span><h1 id="å®éªŒè¿‡ç¨‹"><a href="#å®éªŒè¿‡ç¨‹" class="headerlink" title="å®éªŒè¿‡ç¨‹"></a>å®éªŒè¿‡ç¨‹</h1><p>é¦–å…ˆéªŒè¯ä¸€ä¸‹ ç©ºåˆ—è¡¨ ä»¥åŠåœ¨ä¸æ–­æ–°å¢å…ƒç´ çš„æƒ…å†µä¸‹ List çš„ size çš„å˜åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> getsizeof</span><br><span class="line"></span><br><span class="line">l = []</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;ç©ºåˆ—è¡¨:<span class="subst">&#123;getsizeof(l)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    l.append(l)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;å­˜åœ¨<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>å…ƒç´ çš„åˆ—è¡¨:<span class="subst">&#123;getsizeof(l)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç©ºåˆ—è¡¨:56</span><br><span class="line">å­˜åœ¨1å…ƒç´ çš„åˆ—è¡¨:88</span><br><span class="line">å­˜åœ¨2å…ƒç´ çš„åˆ—è¡¨:88</span><br><span class="line">å­˜åœ¨3å…ƒç´ çš„åˆ—è¡¨:88</span><br><span class="line">å­˜åœ¨4å…ƒç´ çš„åˆ—è¡¨:88</span><br><span class="line">å­˜åœ¨5å…ƒç´ çš„åˆ—è¡¨:120</span><br><span class="line">å­˜åœ¨6å…ƒç´ çš„åˆ—è¡¨:120</span><br><span class="line">å­˜åœ¨7å…ƒç´ çš„åˆ—è¡¨:120</span><br><span class="line">å­˜åœ¨8å…ƒç´ çš„åˆ—è¡¨:120</span><br><span class="line">å­˜åœ¨9å…ƒç´ çš„åˆ—è¡¨:184</span><br><span class="line">å­˜åœ¨10å…ƒç´ çš„åˆ—è¡¨:184</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/image_1649729308457_0.png"></p><p>ä»ä¸Šé¢çš„è¿è¡Œç»“æœå¯ä»¥å‘ç°ï¼Œå…¶å® List ä¹Ÿå­˜åœ¨ä¸€å®šçš„æ‰©å®¹æœºåˆ¶çš„ï¼Œåˆ—è¡¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­å°†ä¼šç”³è¯·ä¸€ä¸ªå­˜å‚¨å››ä¸ªå…ƒç´ çš„å­˜å‚¨åŒºï¼Œå½“å­˜å‚¨åŒºå¡«æ»¡æ—¶ï¼Œåˆ—è¡¨ä¼šå†æ¬¡ç”³è¯·å››ä¸ªå­˜å‚¨ç©ºé—´å­˜å‚¨å…ƒç´ ã€‚å½“å…ƒç´ é‡è¾¾åˆ°åŸå­˜å‚¨ç©ºé—´çš„ä¸¤å€æ—¶ï¼Œåˆ—è¡¨ä¼šå†æ¬¡ç”³è¯·åŸæ¥æ—§çš„å­˜å‚¨ç©ºé—´çš„ä¸¤å€çš„å®¹é‡å­˜å‚¨å…ƒç´ ã€‚</p><p>ä¸ç®¡ä»»ä½•è¯­è¨€åœ¨ä¸€æ—¦è¿›è¡Œæ‰©å®¹æ“ä½œå¿…ç„¶ä¼šå­˜åœ¨ï¼š<br>      1. é‡æ–°ç”³è¯·å†…å­˜<br>        2. å¤åˆ¶è€æ•°ç»„åˆ°æ–°çš„å†…å­˜<br>        3. å›æ”¶è€æ•°ç»„çš„å†…å­˜</p><p>ä¸Šé¢çš„è¿‡ç¨‹å¦‚æœå‡ºç°çš„æ¬¡æ•°æ¯”è¾ƒé¢‘ç¹å¿…ç„¶ä¼šå¯¼è‡´è¿è¡Œé€Ÿåº¦çš„é™ä½ï¼Œé‚£ä¹ˆç©¶ç«Ÿä¼šé™ä½å¤šå°‘å‘¢ï¼Ÿ</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>ä»¥ä¸‹ä¾‹å­è¿è¡Œç¯å¢ƒä¸º ipython</p><h3 id="æ²¡æœ‰ä»»ä½•å¤„ç†çš„ä¾‹å­"><a href="#æ²¡æœ‰ä»»ä½•å¤„ç†çš„ä¾‹å­" class="headerlink" title="æ²¡æœ‰ä»»ä½•å¤„ç†çš„ä¾‹å­"></a>æ²¡æœ‰ä»»ä½•å¤„ç†çš„ä¾‹å­</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%%timeit</span><br><span class="line">l=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    l.append(i)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-04-12_%E4%B8%8B%E5%8D%882.42.23_1649745745624_0.png"></p><h3 id="é¢„åˆ†é…åçš„åˆ—è¡¨"><a href="#é¢„åˆ†é…åçš„åˆ—è¡¨" class="headerlink" title="é¢„åˆ†é…åçš„åˆ—è¡¨"></a>é¢„åˆ†é…åçš„åˆ—è¡¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%%timeit</span><br><span class="line">size = <span class="number">1000</span></span><br><span class="line">l = [<span class="literal">None</span>] * size</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">    l[i] = i</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨éå†ä¹‹å‰ï¼Œç»™åˆ—è¡¨ l é¢„å…ˆåˆ†é…äº†ä¸€ä¸ªé•¿åº¦ä¸º 1000 çš„ None çš„ç©ºæ•°ç»„ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-04-12_%E4%B8%8B%E5%8D%882.45.50_1649745952420_0.png"></p><p>ä»è¿™ä¸¤ä¸ªä¾‹å­ä¸éš¾çœ‹å‡ºï¼Œå¦‚æœé¢„å…ˆçŸ¥é“è¦ä½¿ç”¨æ•°ç»„çš„å¤§å°ï¼Œå¹¶ä¸”å¯¹åˆ—è¡¨è¿›è¡Œåˆå§‹åŒ–çš„è¯ï¼Œæ˜¯å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜è¿è¡Œæ•ˆç‡çš„ã€‚</p><h1 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h1><p>ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼é€Ÿåº¦ä¼šæ›´å¿«ã€‚</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-04-12_%E4%B8%8B%E5%8D%882.50.30_1649746232891_0.png"></p><p>åˆ—è¡¨é¢„å…ˆé…å¯èƒ½å¹¶ä¸é€‚åˆå¤æ‚åœºæ™¯ï¼Œä½†æ˜¯ä¸€æ—¦æœ‰ç¬¦åˆè¿™ä¸ªç‰¹æ®Šåœºæ™¯çš„æƒ…å†µä¸‹æ•ˆæœåº”è¯¥æ˜¯è›®ä¸é”™çš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ä¾‹å­å‡çš„è¿è¡Œç¯å¢ƒä¸º Python 3.9.5ï¼Œä¸åŒç‰ˆæœ¬çš„å®é™…è¿è¡Œç»“æœå¯èƒ½æœ‰æ‰€ä¸åŒ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‰ç«¯æ—¶é—´çœ‹äº† Golang çš„ å­¦ä¹ äº†ä¸€ä¸‹ æ•°ç»„ å’Œ Sliceï¼Œå…¶ä¸­ Slice ç›¸å½“äºåŠ¨æ€æ•°ç»„ï¼Œå…¶ä¸­æ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè€Œ Slice åˆ™æ˜¯ä¸å®šé•¿çš„ã€‚åœ¨ Python ä¸­æ˜¯æ²¡æœ‰æ•°ç»„å’Œ Slice çš„æ¦‚å¿µï¼Œå®ƒä»¬å¯ä»¥é€šé€šå½’ç±»ä¸º Listï¼ˆåˆ—è¡¨ï¼‰ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå®šé•¿çš„ List å’Œ ä¸å®šé•¿çš„ List åœ¨è¡¨ç°ä¸Šä¼šæœ‰åŒºåˆ«å—ï¼Ÿï¼ˆè¿™é‡Œçš„å®šé•¿çš„ List æ˜¯æŒ‡å¯¹ List è¿›è¡Œåˆå§‹åŒ–,ä¹Ÿå°±æ˜¯æ‰€è°“çš„é¢„åˆ†é…ï¼‰&lt;br&gt;æ¥ä¸‹æ¥é€šè¿‡å‡ ä¸ªä¾‹å­å»éªŒè¯è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ä¼˜åŒ–" scheme="https://leetaogoooo.github.io/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Pythonè§£æJSONå¤§æ–‡ä»¶</title>
    <link href="https://leetaogoooo.github.io/2022/03/30/Python%E8%A7%A3%E6%9E%90JSON%E5%A4%A7%E6%96%87%E4%BB%B6/"/>
    <id>https://leetaogoooo.github.io/2022/03/30/Python%E8%A7%A3%E6%9E%90JSON%E5%A4%A7%E6%96%87%E4%BB%B6/</id>
    <published>2022-03-29T16:00:00.000Z</published>
    <updated>2022-04-12T07:10:22.037Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦ç”¨ Python å»å¤„ç†ä¸€äº› JSON æ–‡ä»¶ï¼Œä¸€æ—¦ JSON æ–‡ä»¶è¿‡å¤§ï¼Œå°±æœ‰å¯èƒ½å‡ºç°åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œå†…å­˜æ¶ˆè€—è¿‡å¤§çš„é—®é¢˜ï¼Œç”šè‡³ä¼šå¯¼è‡´å†…å­˜è€—å°½ã€‚æ‰€ä»¥å¦‚æœæ­£ç¡®åœ°å¤„ç†å¤§çš„ JSON æ–‡ä»¶å‘¢ï¼Ÿ</p><span id="more"></span><h1 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h1><p>é¦–å…ˆæ„é€ ä¸€ä¸ªå¤§çš„ JSON æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåœ¨ githubä¸Šå¼€æºçš„ä¸€ä¸ª json æ–‡ä»¶ <a href="https://github.com/json-iterator/test-data/blob/master/large-file.json">large-file.json</a>ï¼Œæ–‡ä»¶å¤§å°ä¸º 24.9 M</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-03-30_14.30.06_1648621812730_0.png"></p><p>æ–‡ä»¶å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;<span class="attr">&quot;id&quot;</span>:<span class="string">&quot;2489651045&quot;</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;CreateEvent&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;actor&quot;</span>:&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">665991</span>,<span class="attr">&quot;login&quot;</span>:<span class="string">&quot;petroav&quot;</span>,<span class="attr">&quot;gravatar_id&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="attr">&quot;url&quot;</span>:<span class="string">&quot;https://api.github.com/users/petroav&quot;</span>,<span class="attr">&quot;avatar_url&quot;</span>:<span class="string">&quot;https://avatars.githubusercontent.com/u/665991?&quot;</span>&#125;,</span><br><span class="line">   <span class="attr">&quot;repo&quot;</span>:&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">28688495</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;petroav/6.828&quot;</span>,<span class="attr">&quot;url&quot;</span>:<span class="string">&quot;https://api.github.com/repos/petroav/6.828&quot;</span>&#125;,</span><br><span class="line">   <span class="attr">&quot;payload&quot;</span>:&#123;<span class="attr">&quot;ref&quot;</span>:<span class="string">&quot;master&quot;</span>,<span class="attr">&quot;ref_type&quot;</span>:<span class="string">&quot;branch&quot;</span>,<span class="attr">&quot;master_branch&quot;</span>:<span class="string">&quot;master&quot;</span>,<span class="attr">&quot;description&quot;</span>:<span class="string">&quot;Solution to homework and assignments from MIT&#x27;s 6.828 (Operating Systems Engineering). Done in my spare time.&quot;</span>,<span class="attr">&quot;pusher_type&quot;</span>:<span class="string">&quot;user&quot;</span>&#125;,</span><br><span class="line">   <span class="attr">&quot;public&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;created_at&quot;</span>:<span class="string">&quot;2015-01-01T15:00:00Z&quot;</span>&#125;,</span><br><span class="line">...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¼šé€šè¿‡ä¸åŒçš„æ–¹æ¡ˆå»è§£æè¿™ä¸ªjsonæ–‡ä»¶ï¼Œç„¶åæå–å¯¹åº”çš„ actor.id å’Œ repo.id çš„å†…å®¹ï¼Œå€ŸåŠ© fileprofiler å»éªŒè¯ä¸åŒæ–¹æ¡ˆä¸­å†…å­˜çš„æ¶ˆè€—æƒ…å†µã€‚</p><h2 id="ä½¿ç”¨å†…ç½®æ ‡å‡†åº“-json"><a href="#ä½¿ç”¨å†…ç½®æ ‡å‡†åº“-json" class="headerlink" title="ä½¿ç”¨å†…ç½®æ ‡å‡†åº“-json"></a>ä½¿ç”¨å†…ç½®æ ‡å‡†åº“-json</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;large-file.json&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br><span class="line"></span><br><span class="line">user_to_repos = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> record <span class="keyword">in</span> data:</span><br><span class="line">    user = record[<span class="string">&quot;actor&quot;</span>][<span class="string">&quot;login&quot;</span>]</span><br><span class="line">    repo = record[<span class="string">&quot;repo&quot;</span>][<span class="string">&quot;name&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">not</span> <span class="keyword">in</span> user_to_repos:</span><br><span class="line">        user_to_repos[user] = <span class="built_in">set</span>()</span><br><span class="line">    user_to_repos[user].add(repo)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ fileprofiler çœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-03-30_%E4%B8%8B%E5%8D%885.08.57_1648631340541_0.png"></p><p>ä»ä¸Šé¢çš„å›¾ï¼Œä¸éš¾çœ‹å‡ºï¼Œå†…å­˜é‡ç¾åŒºä¸ºä¸¤å¤„ï¼š<br>    1. è¯»å–æ–‡ä»¶<br>    2. ç»“æœè¿›è¡Œ decode</p><p>çœ‹ä¸€ä¸‹ <code>json</code> æ¨¡å—çš„<a href="https://github.com/python/cpython/blob/15da2a2723245710f1bd2c7cbd5b450532ae7728/Lib/json/__init__.py#L293">å®ç°æºç </a>ï¼Œä¸éš¾å‘ç°ï¼Œåœ¨è§£æä¹‹å‰ï¼Œ<code>json.load()</code> å°†æ•´ä¸ªæ–‡ä»¶éƒ½åŠ è½½åˆ°å†…å­˜å½“ä¸­å»äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span>(<span class="params">fp, *, cls=<span class="literal">None</span>, object_hook=<span class="literal">None</span>, parse_float=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        parse_int=<span class="literal">None</span>, parse_constant=<span class="literal">None</span>, object_pairs_hook=<span class="literal">None</span>, **kw</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Deserialize ``fp`` (a ``.read()``-supporting file-like object containing</span></span><br><span class="line"><span class="string">    a JSON document) to a Python object.</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> loads(fp.read(),...)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ˜¾ç„¶æ˜“è§ï¼Œå¦‚æœç›´æ¥åŠ è½½æ–‡ä»¶å°†ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ€è€ƒçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ–‡ä»¶å¤§å°åªæœ‰ 24.9 Mï¼Œè€Œä½¿ç”¨çš„å†…å­˜ç«Ÿç„¶é«˜è¾¾ 124 M å‘¢ï¼Ÿè¿™ä¸ªä¸»è¦æ˜¯å’Œ Python å­—ç¬¦ä¸²çš„å†…å­˜è¡¨ç¤º æœ‰å…³ï¼Œç®€å•çœ‹ä¸€ä¸‹ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&quot;a&quot;</span> * <span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getsizeof(s)</span><br><span class="line"><span class="number">1049</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = <span class="string">&quot;â„&quot;</span> + <span class="string">&quot;a&quot;</span> * <span class="number">999</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s2)</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getsizeof(s2)</span><br><span class="line"><span class="number">2074</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3 = <span class="string">&quot;ğŸš©&quot;</span> + <span class="string">&quot;a&quot;</span> * <span class="number">999</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s3)</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getsizeof(s3)</span><br><span class="line"><span class="number">4076</span></span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦éƒ½æ˜¯ 1000ï¼Œä½†æ˜¯å®ƒä»¬å ç”¨çš„å†…å­˜å´æ˜¯å„ä¸ç›¸åŒï¼Œæ‰€ä»¥ JSON æ–‡ä»¶å ç”¨å†…å­˜çš„å¤§å°å¹¶ä¸æ˜¯å–å†³äºå®ƒä»¬åŒ…å«çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œæ˜¯å­—ç¬¦ä¸²é‡ŒåŒ…å«ä»€ä¹ˆç±»ä¼¼çš„å­—ç¬¦ã€‚<br>å›å½’æ­£é¢˜ï¼Œæ˜¾ç„¶ä½¿ç”¨å†…ç½®çš„æ ‡å‡†åº“ <code>json</code> çš„æ•ˆæœå¹¶ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ‰€ä»¥æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆå‘¢ï¼Ÿå¯¹äºå¤§çš„ JSON æ–‡ä»¶å¹¶ä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜å½“ä¸­å»ï¼Œè€Œæ˜¯æŒ‰éœ€åŠ è½½ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæœ‰ä¸€ä¸ªåç§°å«åš - æµï¼ˆstreamï¼‰<br>æœ‰å¾ˆå¤šä¸‰æ–¹åº“æ”¯æŒè¿™ä¸ªç‰¹æ€§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªåº“ <a href="https://github.com/ICRAR/ijson">ijson</a></p><h1 id="ä¸‰æ–¹åº“-ijson"><a href="#ä¸‰æ–¹åº“-ijson" class="headerlink" title="ä¸‰æ–¹åº“ - ijson"></a>ä¸‰æ–¹åº“ - ijson</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ijson</span><br><span class="line"></span><br><span class="line">user_to_repos = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;large-file.json&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> record <span class="keyword">in</span> ijson.items(f, <span class="string">&quot;item&quot;</span>):</span><br><span class="line">        user = record[<span class="string">&quot;actor&quot;</span>][<span class="string">&quot;login&quot;</span>]</span><br><span class="line">        repo = record[<span class="string">&quot;repo&quot;</span>][<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">not</span> <span class="keyword">in</span> user_to_repos:</span><br><span class="line">            user_to_repos[user] = <span class="built_in">set</span>()</span><br><span class="line">        user_to_repos[user].add(repo)</span><br></pre></td></tr></table></figure><p>åŒæ ·ä½¿ç”¨ fileprofiler çœ‹ä¸€ä¸‹è¿è¡Œç»“æœ</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-03-30_%E4%B8%8B%E5%8D%886.21.59_1648635722250_0.png"></p><p>ä»å›¾ç‰‡ä¸éš¾çœ‹å‡ºæ¥ï¼Œå†…å­˜æ¶ˆè€—ä¸€ä¸‹å­å°±é™ä½äº†ä¸‹æ¥ã€‚æ‰€ä»¥ä¸‹æ¬¡æœ‰å¤§çš„ JSON æ–‡ä»¶ï¼Œå¯ä»¥å°è¯•ç”¨ <code>ijson</code> åº“</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p> <a href="https://github.com/ICRAR/ijson">ijson</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦ç”¨ Python å»å¤„ç†ä¸€äº› JSON æ–‡ä»¶ï¼Œä¸€æ—¦ JSON æ–‡ä»¶è¿‡å¤§ï¼Œå°±æœ‰å¯èƒ½å‡ºç°åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œå†…å­˜æ¶ˆè€—è¿‡å¤§çš„é—®é¢˜ï¼Œç”šè‡³ä¼šå¯¼è‡´å†…å­˜è€—å°½ã€‚æ‰€ä»¥å¦‚æœæ­£ç¡®åœ°å¤„ç†å¤§çš„ JSON æ–‡ä»¶å‘¢ï¼Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="ä¼˜åŒ–" scheme="https://leetaogoooo.github.io/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
    <category term="JSON" scheme="https://leetaogoooo.github.io/tags/JSON/"/>
    
  </entry>
  
  <entry>
    <title>python ä¸­å®ç°ç±»æ–¹æ³•é‡è½½</title>
    <link href="https://leetaogoooo.github.io/2022/02/14/python%20%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%B1%BB%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/"/>
    <id>https://leetaogoooo.github.io/2022/02/14/python%20%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%B1%BB%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/</id>
    <published>2022-02-13T16:00:00.000Z</published>
    <updated>2022-04-12T07:10:22.051Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ Java ä¸­æœ‰ [[é‡è½½]] çš„æ¦‚å¿µï¼š</p><blockquote><p>é‡è½½(overloading) æ˜¯åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œæ–¹æ³•åå­—ç›¸åŒï¼Œè€Œå‚æ•°ä¸åŒã€‚è¿”å›ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚æ¯ä¸ªé‡è½½çš„æ–¹æ³•ï¼ˆæˆ–è€…æ„é€ å‡½æ•°ï¼‰éƒ½å¿…é¡»æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å‚æ•°ç±»å‹åˆ—è¡¨ã€‚</p></blockquote><p>Python æœ¬èº«ä¸æ”¯æŒ <code>é‡è½½</code> è¿™ä¸ªç‰¹æ€§ï¼Œä½†æ˜¯é€šè¿‡ <code>functools.singledispatch</code>  å¯ä»¥å®ç°å‡½æ•°çš„é‡è½½ã€‚æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œç®€å•åœ°æ¼”ç¤ºä¸€ä¸‹ Python çš„å‡½æ•°é‡è½½ã€‚</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch</span><br><span class="line"></span><br><span class="line"><span class="meta">@singledispatch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>(<span class="params">arg</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@fun.register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">arg: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;arg is int: <span class="subst">&#123;arg&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@fun.register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">arg: <span class="built_in">list</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;arg is list: <span class="subst">&#123;arg&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@fun.register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">arg: <span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;arg is str: <span class="subst">&#123;arg&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    fun([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">    fun(<span class="number">1</span>)</span><br><span class="line">    fun(<span class="string">&#x27;str&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºæŸ¥çœ‹ä¸€ä¸‹ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arg is list: [1, 2, 3]</span><br><span class="line">arg is int: 1</span><br><span class="line">arg is str: str</span><br></pre></td></tr></table></figure><p>æ ¹æ®å‚æ•°çš„ä¸åŒçš„ç±»å‹ï¼ŒæˆåŠŸäº†æ‰§è¡Œäº†å¯¹åº”çš„å‡½æ•°ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å®Œæˆäº† Python ä¸­å¯¹å‡½æ•°çš„<code>é‡è½½</code>ã€‚Java ä¸­ <code>é‡è½½</code> ä¸ä»…ä»…é’ˆå¯¹æ™®é€šå‡½æ•°ï¼Œå…¶ç±»æ–¹æ³•ä¹Ÿæ”¯æŒè¿™ä¸ªç‰¹æ€§ï¼Œé‚£ä¹ˆ Python å¦‚ä½•å®ç°ç±»æ–¹æ³•çš„<code>é‡è½½</code>å‘¢ï¼Ÿ</p><h1 id="ç±»æ–¹æ³•é‡è½½"><a href="#ç±»æ–¹æ³•é‡è½½" class="headerlink" title="ç±»æ–¹æ³•é‡è½½"></a>ç±»æ–¹æ³•é‡è½½</h1><h2 id="Python-gt-3-8"><a href="#Python-gt-3-8" class="headerlink" title="Python &gt;= 3.8"></a>Python &gt;= 3.8</h2><p>å½“ Python ç‰ˆæœ¬ä¸ä½äº 3.8 çš„æ—¶å€™ï¼Œ<code>functools</code> æ–°å¢äº†ä¸€ä¸ª <code>singledispatchmethod</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è®© Python çš„ç±»æ–¹æ³•æ”¯æŒ <code>é‡è½½</code>ï¼Œä½¿ç”¨æ–¹æ³•å’Œ <code>singledispatch</code> ç±»ä¼¼ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‡è½½çš„ç±»å‹æ˜¯ç”±ç±»å‡½æ•°ä¸­ç¬¬ä¸€ä¸ªé <code>self</code> å’Œ <code>cls</code> çš„å‚æ•°ç±»å‹å†³å®šçš„ã€‚</p><p>çœ‹ä¸€ä¸‹å®˜æ–¹å®ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Negator</span>:</span></span><br><span class="line"><span class="meta">    @singledispatchmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">neg</span>(<span class="params">self, arg</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;Cannot negate a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">self, arg: <span class="built_in">int</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> -arg</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">self, arg: <span class="built_in">bool</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> arg</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>singledispatchmethod</code> è¿˜æ”¯æŒåµŒå¥—çš„è£…é¥°å™¨ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>dispatcher.register</code> å’Œ <code>singledispatchmethod</code> éœ€è¦åœ¨ç»å¤§å¤šæ•°è£…é¥°å™¨çš„æœ€ä¸Šå±‚ï¼ŒåŸºäºä¸Šé¢çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Negator</span>:</span></span><br><span class="line"><span class="meta">    @singledispatchmethod</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">neg</span>(<span class="params">cls, arg</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;Cannot negate a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">cls, arg: <span class="built_in">int</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> -arg</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">cls, arg: <span class="built_in">bool</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> arg</span><br></pre></td></tr></table></figure><h2 id="Python-lt-3-8"><a href="#Python-lt-3-8" class="headerlink" title="Python &lt; 3.8"></a>Python &lt; 3.8</h2><p>å½“ Python ç‰ˆæœ¬å°äº 3.8 çš„æ—¶å€™ï¼Œç”±äº Python æœ¬èº«ä¸æ”¯æŒç±»æ–¹æ³•çš„<code>é‡è½½</code>ï¼Œåˆ™éœ€è¦æˆ‘ä»¬è‡ªè¡Œå®ç°ã€‚åœ¨å®ç°ä¹‹å‰ï¼Œå¯ä»¥å…ˆå€Ÿé‰´ä¸€ä¸‹ [<code>singledispatch</code> çš„æºç ](<a href="https://hg.python.org/cpython/file/f6f691ff27b9/Lib/functools.py#l706">cpython: f6f691ff27b9 Lib/functools.py</a>)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">    <span class="keyword">return</span> dispatch(args[<span class="number">0</span>].__class__)(*args, **kw)</span><br></pre></td></tr></table></figure><p>ä»æºç ä¸­ä¸éš¾çœ‹å¾—å‡º <code>singledispatch</code> æœ€ç»ˆè¿”å›çš„å°±æ˜¯ä¸Šè¿°çš„ <code>wrapper</code> å‡½æ•°ï¼Œå¹¶ä¸”å‡½æ•°æ˜¯æ ¹æ®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼ˆ<code>args[0].__class__</code>ï¼‰æœ€ç»ˆæ¥å®ç°å‡½æ•°çš„<code>é‡è½½</code>çš„ï¼Œå¯¹äºå‡½æ•°è¿™ç§å®ç°æ–¹å¼æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç±»æ–¹æ³•çš„è¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å§‹ç»ˆæ˜¯ <code>self</code>ï¼Œåˆ™æ— æ³•è¿›è¡ŒåŒºåˆ†äº†ï¼Œ<code>é‡è½½</code>å°±æ›´æ— ä»è°ˆèµ·äº†ã€‚</p><p>æ‰€ä»¥å®ç°ç±»æ–¹æ³•çš„é‡è½½éš¾ç‚¹åœ¨äºé‡å†™ <code>wrapper</code> å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ <code>singledispatch</code> åŸºç¡€ä¸Šæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°å¯¹<code>wrapper</code> è¿›è¡Œé‡å†™ï¼ŒæŠŠ wrapper ä¸­çš„å‚æ•° <code>args[0]</code> è°ƒæ•´ä¸º <code>args[1]</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch, update_wrapper</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">methdispatch</span>(<span class="params">func</span>):</span></span><br><span class="line">    dispatcher = singledispatch(func)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">        <span class="keyword">return</span> dispatcher.dispatch(args[<span class="number">1</span>].__class__)(*args, **kw)</span><br><span class="line">    wrapper.register = dispatcher.register</span><br><span class="line">    update_wrapper(wrapper, func)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Negator</span>:</span></span><br><span class="line"><span class="meta">    @methdispatch</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">neg</span>(<span class="params">self, arg</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;Cannot negate a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">self, arg: <span class="built_in">int</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> -arg</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">self, arg: <span class="built_in">bool</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> arg</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    neg = Negator()</span><br><span class="line">    neg.neg(<span class="number">1</span>)</span><br><span class="line">    neg.neg(<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-1</span><br><span class="line">True</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤æ‰‹åŠ¨å®ç°ç±»æ–¹æ³•çš„é‡è½½æˆåŠŸã€‚</p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>åœ¨ pypi ä¸Šä¹Ÿæœ‰å¯¹åº”çš„ <a href="https://pypi.org/project/singledispatchmethod/">singledispatchmethod Â· PyPI</a> åº“ï¼Œå¯ä»¥é€šè¿‡ pip å®‰è£…åç›´æ¥ä½¿ç”¨ï¼Œç”¨æ³•å’Œ 3.8 ä¹‹åç‰ˆæœ¬ç”¨æ³•ä¸€è‡´ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol><li><a href="https://stackoverflow.com/questions/24601722/how-can-i-use-functools-singledispatch-with-instance-methods?utm_source=pocket_mylist">python - How can I use functools.singledispatch with instance methods? - Stack Overflow</a></li><li><a href="https://hg.python.org/cpython/file/f6f691ff27b9/Lib/functools.py#l706">cpython: f6f691ff27b9 Lib/functools.py</a></li><li><a href="https://legacy.python.org/dev/peps/pep-3124/">PEP 3124 â€“ Overloading, Generic Functions, Interfaces, and Adaptation (python.org)</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ Java ä¸­æœ‰ [[é‡è½½]] çš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é‡è½½(overloading) æ˜¯åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œæ–¹æ³•åå­—ç›¸åŒï¼Œè€Œå‚æ•°ä¸åŒã€‚è¿”å›ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚æ¯ä¸ªé‡è½½çš„æ–¹æ³•ï¼ˆæˆ–è€…æ„é€ å‡½æ•°ï¼‰éƒ½å¿…é¡»æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å‚æ•°ç±»å‹åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Python æœ¬èº«ä¸æ”¯æŒ &lt;code&gt;é‡è½½&lt;/code&gt; è¿™ä¸ªç‰¹æ€§ï¼Œä½†æ˜¯é€šè¿‡ &lt;code&gt;functools.singledispatch&lt;/code&gt;  å¯ä»¥å®ç°å‡½æ•°çš„é‡è½½ã€‚æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œç®€å•åœ°æ¼”ç¤ºä¸€ä¸‹ Python çš„å‡½æ•°é‡è½½ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="singledispatch" scheme="https://leetaogoooo.github.io/tags/singledispatch/"/>
    
  </entry>
  
  <entry>
    <title>django bulk_create support post_save signal</title>
    <link href="https://leetaogoooo.github.io/2022/02/05/django-bulk-create-support-post-save-signal/"/>
    <id>https://leetaogoooo.github.io/2022/02/05/django-bulk-create-support-post-save-signal/</id>
    <published>2022-02-04T16:00:00.000Z</published>
    <updated>2022-04-12T07:10:22.048Z</updated>
    
    <content type="html"><![CDATA[<p>django é»˜è®¤ <code>bulk_create</code> ä¸æ”¯æŒ <code>signal</code>ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ <code>models.Manager</code> æ”¯æŒè¿™ä¸ªç‰¹æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomManager</span>(<span class="params">models.Manager</span>):</span>  </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">bulk_create</span>(<span class="params">self, items, **kwargs</span>):</span>  </span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> items:  </span><br><span class="line"> post_save.send(i.__class__, instance=i, created=<span class="literal">True</span>)  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().bulk_create(items, **kwargs)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bulk_update</span>(<span class="params">self, items, fields, **kwargs</span>):</span>  </span><br><span class="line"> <span class="built_in">super</span>().bulk_update(items, fields, **kwargs)  </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> items:  </span><br><span class="line"> post_save.send(i.__class__, instance=i, created=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å®ä¾‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>(<span class="params">db.models</span>):</span></span><br><span class="line">objects = CustomManager()</span><br><span class="line">...</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;django é»˜è®¤ &lt;code&gt;bulk_create&lt;/code&gt; ä¸æ”¯æŒ &lt;code&gt;signal&lt;/code&gt;ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ &lt;code&gt;models.Manager&lt;/code&gt; æ”¯æŒè¿™ä¸ªç‰¹æ€§&lt;/p&gt;
&lt;figure class=&quot;highlight python</summary>
      
    
    
    
    
    <category term="django" scheme="https://leetaogoooo.github.io/tags/django/"/>
    
    <category term="orm" scheme="https://leetaogoooo.github.io/tags/orm/"/>
    
  </entry>
  
  <entry>
    <title>django orm custom mysql round function</title>
    <link href="https://leetaogoooo.github.io/2022/01/30/django-orm-custom-mysql-round-function/"/>
    <id>https://leetaogoooo.github.io/2022/01/30/django-orm-custom-mysql-round-function/</id>
    <published>2022-01-29T16:00:00.000Z</published>
    <updated>2022-04-12T07:10:22.048Z</updated>
    
    <content type="html"><![CDATA[<p><code>Django.db.models</code> è‡ªå¸¦çš„ <code>Round</code> çš„å‡½æ•°æ²¡æœ‰ä¸æ”¯æŒå°æ•°ç‚¹ä½æ•°çš„ä¿ç•™ï¼Œé»˜è®¤ä¿ç•™2ä½ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„ <code>Func</code> å¯ä»¥å®ç°è°ƒç”¨ <code>MySQL</code> çš„ <code>ROUND</code> å‡½æ•°</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoundPlus</span>(<span class="params">Func</span>):</span>  </span><br><span class="line"> function = <span class="string">&#x27;ROUND&#x27;</span>  </span><br><span class="line"> template = <span class="string">&#x27;%(function)s(%(expressions)s, %(precision)s)&#x27;</span>  </span><br><span class="line">  </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *expressions, precision=<span class="number">2</span></span>):</span>  </span><br><span class="line"> <span class="built_in">super</span>().__init__(*expressions, precision=precision)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;Django.db.models&lt;/code&gt; è‡ªå¸¦çš„ &lt;code&gt;Round&lt;/code&gt; çš„å‡½æ•°æ²¡æœ‰ä¸æ”¯æŒå°æ•°ç‚¹ä½æ•°çš„ä¿ç•™ï¼Œé»˜è®¤ä¿ç•™2ä½ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„ &lt;code&gt;Func&lt;/code&gt; å¯ä»¥å®ç°è°ƒç”¨ &lt;code&gt;MySQL&lt;/code&gt; çš„ &lt;code&gt;ROUND&lt;/code&gt; å‡½æ•°&lt;/p&gt;</summary>
    
    
    
    
    <category term="django" scheme="https://leetaogoooo.github.io/tags/django/"/>
    
    <category term="orm" scheme="https://leetaogoooo.github.io/tags/orm/"/>
    
  </entry>
  
  <entry>
    <title>Automated deployment of hexo via github action</title>
    <link href="https://leetaogoooo.github.io/2022/01/30/%E4%BD%BF%E7%94%A8%20github%20actions%20%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%20hexo%20%E5%8D%9A%E5%AE%A2/"/>
    <id>https://leetaogoooo.github.io/2022/01/30/%E4%BD%BF%E7%94%A8%20github%20actions%20%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%20hexo%20%E5%8D%9A%E5%AE%A2/</id>
    <published>2022-01-29T16:00:00.000Z</published>
    <updated>2022-04-12T07:10:22.056Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ¯å¹´éƒ½è¦æŠ˜è…¾ä¸€ä¸‹è‡ªå·±çš„åšå®¢ï¼Œä»Šå¹´å‡†å¤‡æŠŠæ‰€æœ‰çš„åšå®¢å†æ¬¡è¿ç§»åˆ°é™æ€åšå®¢ Hexo ä¸­ï¼Œé…åˆ Github Action å®ç°ï¼Œåªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²åšå®¢ã€‚</p><span id="more"></span><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>æ•´ä½“æ€è·¯å¾ˆç®€å•ï¼Œåœ¨ä½ çš„ github-pages çš„é¡¹ç›®å»ºç«‹ä¸¤ä¸ª åˆ†æ”¯ <code>master</code> å’Œ <code>gh-pages</code>ï¼Œåœ¨ <code>gh-pages</code> åˆ†æ”¯ä¸Šå®Œæˆ <code>hexo</code> çš„æ„å»ºï¼Œç„¶åå°†æ„å»ºåçš„é™æ€ç½‘é¡µæ¨é€åˆ° <code>master</code> åˆ†æ”¯ä¸Š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B.png"></p><p>å…¶ä¸­åœ¨ github actions æ¶‰åŠçš„ä¸»è¦ action ä¸º <a href="https://github.com/JamesIves/github-pages-deploy-action">github-pages-deploy-action</a>ï¼Œå‚è€ƒè¯´æ˜æ–‡æ¡£ï¼Œéœ€è¦ä½¿ç”¨åˆ° <code>token</code> æˆ–è€… <code>ssh-key</code>ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨åˆ°æ˜¯å‰è€…ï¼Œè·å– token çš„æ–¹æ³•å¯ä»¥å‚è€ƒ <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">encrypted-secrets</a>ï¼Œç„¶ååœ¨ä½ çš„ github-pages ä»“åº“ <code>secrets</code> è®¾ç½®ä¸€ä¸‹ <code>token</code>ï¼Œå‘½åä¸º <code>ACCESS_TOKEN</code></p><h1 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Blog</span> <span class="string">CI/CD</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§¦å‘æ¡ä»¶ï¼šåœ¨ push åˆ° gh-pages åˆ†æ”¯åè§¦å‘</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">gh-pages</span></span><br><span class="line"></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">blog-cicd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">blog</span> <span class="string">build</span> <span class="string">&amp;</span> <span class="string">deploy</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">macos-latest</span> <span class="comment"># ç³»ç»Ÿç¯å¢ƒï¼Œå¯ä»¥è‡ªç”±è®¾ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">codes</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">node</span></span><br><span class="line">      <span class="comment"># è®¾ç½® node.js ç¯å¢ƒ</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">&#x27;12.x&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">node</span> <span class="string">modules</span></span><br><span class="line">      <span class="comment"># è®¾ç½®åŒ…ç¼“å­˜ç›®å½•ï¼Œé¿å…æ¯æ¬¡ä¸‹è½½</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/cache@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">~/.npm</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-node-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/package-lock.json&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">hexo</span> <span class="string">dependencies</span></span><br><span class="line">      <span class="comment"># ä¸‹è½½ hexo-cli è„šæ‰‹æ¶åŠç›¸å…³å®‰è£…åŒ…</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        npm install -g hexo-cli</span></span><br><span class="line"><span class="string">        npm install</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">files</span></span><br><span class="line">      <span class="comment"># ç¼–è¯‘ markdown æ–‡ä»¶</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        hexo clean</span></span><br><span class="line"><span class="string">        hexo generate</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">hexo</span> <span class="string">blog</span></span><br><span class="line">      <span class="comment"># éƒ¨ç½²åˆ° GitHub Pages</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@releases/v3</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">ACCESS_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ACCESS_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">BRANCH:</span> <span class="string">master</span></span><br><span class="line">        <span class="attr">FOLDER:</span> <span class="string">public</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç•¥è¿‡äº†å…³äº hexo çš„é…ç½®ï¼Œå¦‚æœå¯¹ hexo çš„é…ç½®ä¸å¤ªäº†è§£å¯ä»¥å‚è€ƒ <a href="https://hexo.io/zh-cn/">hexoå®˜ç½‘</a>,åˆ°æ­¤ï¼Œåªè¦æ¯æ¬¡ç›´æ¥æ›´æ–° gh-pages å°±å¯ä»¥è§¦å‘è‡ªåŠ¨æ„å»ºæµç¨‹äº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ¯å¹´éƒ½è¦æŠ˜è…¾ä¸€ä¸‹è‡ªå·±çš„åšå®¢ï¼Œä»Šå¹´å‡†å¤‡æŠŠæ‰€æœ‰çš„åšå®¢å†æ¬¡è¿ç§»åˆ°é™æ€åšå®¢ Hexo ä¸­ï¼Œé…åˆ Github Action å®ç°ï¼Œåªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²åšå®¢ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="github-action" scheme="https://leetaogoooo.github.io/tags/github-action/"/>
    
    <category term="hexo" scheme="https://leetaogoooo.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>functools.lru_cache çš„æ­£ç¡®ç”¨æ³•</title>
    <link href="https://leetaogoooo.github.io/2022/01/26/functools.lru_cache%20%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%94%A8%E6%B3%95/"/>
    <id>https://leetaogoooo.github.io/2022/01/26/functools.lru_cache%20%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%94%A8%E6%B3%95/</id>
    <published>2022-01-26T09:29:53.000Z</published>
    <updated>2022-04-12T07:10:22.049Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote><p>lru_cache æ˜¯ functools åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸ºå‡½æ•°æä¾›ç¼“å­˜åŠŸèƒ½çš„è£…é¥°å™¨ï¼Œç¼“å­˜ maxsize ç»„ä¼ å…¥å‚æ•°ï¼Œåœ¨ä¸‹æ¬¡ä»¥ç›¸åŒå‚æ•°è°ƒç”¨æ—¶ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡çš„ç»“æœã€‚</p></blockquote><p>ä»å®ƒçš„åŠŸèƒ½æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜å‡½æ•°çš„è¿è¡Œé€Ÿåº¦ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>å½“ä½ ç”¨functools.lru_cacheè£…é¥°å™¨æ¥è£…é¥°ä¸€ä¸ªå®ä¾‹æ–¹æ³•æ—¶ï¼Œå°è£…è¯¥æ–¹æ³•çš„ç±»çš„å®ä¾‹åœ¨æŒæœ‰å®ƒä»¬çš„è¿›ç¨‹ä¸­æ°¸è¿œä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</strong></p><span id="more"></span><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å»è®ºè¯ä¸Šè¿°çš„è§‚ç‚¹ã€‚ï¼ˆä»¥ä¸‹ä»£ç è¿è¡Œäº python3.6.8ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Number = TypeVar(<span class="string">&quot;Number&quot;</span>, <span class="built_in">int</span>, <span class="built_in">float</span>, <span class="built_in">complex</span>)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestLruCache</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, delay: <span class="built_in">int</span> = <span class="number">1</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"></span><br><span class="line">self.delay = delay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="number">128</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate</span>(<span class="params">self, *args: Number</span>) -&gt; Number:</span></span><br><span class="line"></span><br><span class="line">time.sleep(self.delay)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">sum</span>(args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Deleting instance ...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"></span><br><span class="line">test = TestLruCache(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡è¿è¡Œæ—¶é•¿</span></span><br><span class="line"></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">result = test.calculate(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">end_time = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—è€—æ—¶ <span class="subst">&#123;end_time-start_time&#125;</span> s, result: <span class="subst">&#123;result&#125;</span>.&quot;</span>)</span><br><span class="line"></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">result = test.calculate(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">end_time = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—è€—æ—¶ <span class="subst">&#123;end_time-start_time&#125;</span> s, result: <span class="subst">&#123;result&#125;</span>.&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»æœ‰ä¸ª <code>calculate</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä½¿ç”¨ <code>lru_cache</code> è£…é¥°ï¼Œä¸ºäº†æ›´å¥½çš„ä½“ç° <code>lru_cache</code>çš„ä½œç”¨ï¼ŒåŠ ä¸Šäº†ä¸€ä¸ª <code>delay</code> çš„å‚æ•°ï¼Œå…¶ä¸­ <code>__del__</code> çš„é­”æœ¯æ–¹æ³•ä½œç”¨å°±æ˜¯å½“å¼€å§‹åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œ<code>__del__</code> æ–¹æ³•å°±ä¼šè¢«æ‰§è¡Œã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•è¿è¡Œè¯¥ç¨‹åºï¼Œçœ‹ä¸€ä¸‹è¾“å‡ºç»“æœ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è®¡ç®—è€—æ—¶ 2.0021407306194305 s, result: 3.</span><br><span class="line">è®¡ç®—è€—æ—¶ 4.209578037261963e-06 s, result: 3.</span><br><span class="line">Deleting instance ...</span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºç»“æœä¸éš¾çœ‹çš„å‡ºï¼Œä½¿ç”¨ <code>lru_cache</code> åï¼Œç¬¬äºŒæ¬¡è°ƒç”¨ <code>calculate</code> æ–¹æ³•ï¼Œè¿è¡Œçš„æ—¶é—´é™ä½äº†å¾ˆå¤šï¼Œä¸éš¾ç†è§£ï¼Œç¬¬äºŒæ¬¡æˆ‘ä»¬è¯·æ±‚çš„å‚æ•°å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥ç»“æœç›´æ¥ä»å­—å…¸ä¸­å°±è·å–åˆ°äº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„åˆ°ä¸€ç‚¹ï¼Œåœ¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œ<code>TestLruCache</code> çš„å®ä¾‹è¢«æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­å¯èƒ½è¯´æœåŠ›è¿˜ä¸å¤Ÿï¼Œæ²¡å…³ç³»ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹å‡ ä¸ªä¾‹å­ã€‚</p><h2 id="åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆ"><a href="#åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆ" class="headerlink" title="åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆ"></a>åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆ</h2><p>å¦‚æœæˆ‘ä»¬é€šè¿‡ <code>python -i</code> çš„æ–¹å¼æ‰§è¡Œä¸Šè¿°çš„è„šæœ¬ï¼Œä½ å°±æ¸…æ™°åœ°å‘ç°åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ python3 -i test.py</span><br><span class="line">è®¡ç®—è€—æ—¶ <span class="number">2.004133677983191</span> s, result: <span class="number">3.</span></span><br><span class="line">è®¡ç®—è€—æ—¶ <span class="number">3.143970388919115e-06</span> s, result: <span class="number">3.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> gc</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test = <span class="literal">None</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gc.collect()</span><br><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure><p>åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œæˆ‘å°† <code>test</code> èµ‹å€¼ä¸º <code>None</code>ï¼Œå¹¶ä¸”ä¸»åŠ¨è°ƒç”¨åƒåœ¾å›æ”¶å™¨ï¼Œèƒ½çœ‹åˆ° <code>gc.collect()</code> çš„è¾“å‡ºç»“æœä¸º <code>22</code>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰çœ‹åˆ° <code>__del__</code> æ–¹æ³•çš„è¾“å‡ºï¼Œè¿™è¯´æ˜ç¨‹åºé‡Œä¾ç„¶å­˜åœ¨ <code>TestLruCache</code> çš„å®ä¾‹å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶å™¨å¹¶ä¸èƒ½å°†å¯¹è±¡æˆåŠŸçš„å›æ”¶ã€‚</p><p>è®©æˆ‘ä»¬æ’æŸ¥ä¸€ä¸‹ç©¶ç«Ÿæ˜¯è°è¿˜åœ¨å¼•ç”¨å®ä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -i test.py</span><br><span class="line"></span><br><span class="line">è®¡ç®—è€—æ—¶ <span class="number">2.004039512015879</span> s, result: <span class="number">3.</span></span><br><span class="line"></span><br><span class="line">è®¡ç®—è€—æ—¶ <span class="number">3.3050309866666794e-06</span> s, result: <span class="number">3.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate.cache_info()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">CacheInfo(hits=<span class="number">1</span>, misses=<span class="number">1</span>, maxsize=<span class="number">128</span>, currsize=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate.cache_info()</span><br><span class="line">CacheInfo(hits=<span class="number">2</span>, misses=<span class="number">1</span>, maxsize=<span class="number">128</span>, currsize=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate.cache_clear()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test = <span class="literal">None</span></span><br><span class="line">Deleting instance ...</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ <code>cache_info</code> è¾“å‡ºç»“æœè¡¨æ˜ï¼Œè¿™ä¸ªç¼“å­˜ä¿å­˜ç€å®ä¾‹çš„å¼•ç”¨ï¼Œé™¤éæ‰‹åŠ¨æ¸…é™¤ã€‚å½“æˆ‘ä»¬æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜å¹¶å°†å˜é‡ <code>test</code> é‡æ–°åˆ†é…ä¸º <code>None</code> æ—¶ï¼Œåƒåœ¾æ”¶é›†å™¨æ‰ä¼šåˆ é™¤è¯¥å®ä¾‹ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬è®¾ç½®çš„ <code>maxsize</code> æ˜¯ <code>128</code>ï¼Œè¡¨æ˜æœ€å¤§ç¼“å­˜çš„ç»“æœä¸ªæ•°æ˜¯ <code>128</code> ä¸ªï¼Œä¸€æ—¦æˆ‘ä»¬å°† <code>maxsize</code> ç½®ä¸º <code>None</code> çš„è¯ï¼ŒLRU ç‰¹æ€§å°†è¢«ç¦ç”¨ä¸”ç¼“å­˜å¯æ— é™å¢é•¿ã€‚åœ¨è¿™æƒ…å†µä¸‹å°†ä¼šå¾ˆå±é™©ï¼Œä¸€æ—¦æˆ‘ä»¬åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­åˆ›å»ºå¾ˆå¤šå®ä¾‹ï¼Œè¿™äº›å®ä¾‹ä¸èƒ½ä¸ºåƒåœ¾å›æ”¶ï¼Œä¸€æ—¦è¾¾åˆ°ä¸€å®šç¨‹åºï¼Œå¿…ç„¶ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä»è€Œé€ æˆç¨‹åºå´©æºƒã€‚</p><p>é‚£ä¹ˆèƒ½ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿåˆ«ç€æ€¥ï¼Œå¾€ä¸‹çœ‹</p><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€ç­”ï¼Œæˆ‘ä»¬åªéœ€è¦è®©ç¼“å­˜æˆä¸ºå®ä¾‹çš„æœ¬åœ°å˜é‡å°±è¡Œäº†ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä»ç¼“å­˜åˆ°å®ä¾‹çš„å¼•ç”¨å°±ä¼šéšç€å®ä¾‹ä¸€èµ·è¢«åˆ é™¤ã€‚çœ‹ä¸€ä¸‹æ”¹é€ åçš„ä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar</span><br><span class="line"></span><br><span class="line">Number = TypeVar(<span class="string">&quot;Number&quot;</span>, <span class="built_in">int</span>, <span class="built_in">float</span>, <span class="built_in">complex</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestLruCache</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, delay: <span class="built_in">int</span> = <span class="number">1</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">self.delay = delay</span><br><span class="line">self.calculate = lru_cache(maxsize=<span class="number">128</span>)(self._calculate)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_calculate</span>(<span class="params">self, *args: Number</span>) -&gt; Number:</span></span><br><span class="line">time.sleep(self.delay)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">sum</span>(args)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Deleting instance ...&quot;</span>)</span><br></pre></td></tr></table></figure><p>å¥½äº†è®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹æ”¹é€ åçš„ç¨‹åºæ˜¯å¦å¯ä»¥:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -i test.py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test = TestLruCache(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate.cache_info()</span><br><span class="line">CacheInfo(hits=<span class="number">0</span>, misses=<span class="number">1</span>, maxsize=<span class="number">128</span>, currsize=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> gc</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test = <span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gc.collect()</span><br><span class="line">Deleting instance ...</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°è¿™æ¬¡ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸»åŠ¨å»æ¸…é™¤ç¼“å­˜ï¼Œä½†æ˜¯éœ€è¦æ˜¾ç¤ºçš„è°ƒç”¨ <code>gc.collect()</code> å»æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚è¿™æ˜¯å› ä¸ºè¿™ç§è¯¡è®¡åˆ›é€ äº†å¾ªç¯å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶éœ€è¦åšä¸€äº›ç‰¹æ®Šçš„é­”æœ¯æ¥æ¸…é™¤å†…å­˜ã€‚åœ¨çœŸæ­£çš„ä»£ç ä¸­ï¼ŒPython è§£é‡Šå™¨ä¼šåœ¨åå°ä¸ºæˆ‘ä»¬æ¸…ç†è¿™äº›ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬è°ƒç”¨åƒåœ¾å›æ”¶ã€‚</p><h1 id="ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•"><a href="#ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•" class="headerlink" title="ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•"></a>ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•</h1><p>ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œä¼šå¯¹ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•äº§ç”Ÿå½±å“å—ï¼Ÿ<strong>ç­”æ¡ˆæ˜¯å¦å®šçš„</strong>ï¼Œè®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*coding: utf-8 -* # test1.py</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="number">128</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">cls, delay: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line"></span><br><span class="line">cls.delay = delay</span><br><span class="line">time.sleep(delay)</span><br><span class="line"><span class="keyword">return</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Deleting instance ...&quot;</span>)</span><br><span class="line"></span><br><span class="line">test_1 = Test()</span><br><span class="line">test_2 = Test()</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">result = test_1.test(<span class="number">2</span>)</span><br><span class="line">end_time = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è€—æ—¶ <span class="subst">&#123;end_time start_time&#125;</span> s, result: <span class="subst">&#123;result&#125;</span>.&quot;</span>)</span><br><span class="line"></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">result = test_2.test(<span class="number">2</span>)</span><br><span class="line">end_time = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è€—æ—¶ <span class="subst">&#123;end_time start_time&#125;</span> s, result: <span class="subst">&#123;result&#125;</span>.&quot;</span>)</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬åœ¨äº¤äº’æ¨¡å¼ä¸‹éªŒè¯ç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ python -i test1.py</span><br><span class="line">è€—æ—¶ <span class="number">2.003696349042002</span> s, result: <span class="number">42.</span></span><br><span class="line">è€—æ—¶ <span class="number">4.3199979700148106e-06</span> s, result: <span class="number">42.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test_1 = <span class="literal">None</span></span><br><span class="line">Deleting instance ...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test_2 = <span class="literal">None</span></span><br><span class="line">Deleting instance ...</span><br></pre></td></tr></table></figure><p>åŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥éªŒè¯ä¸€ä¸‹é™æ€æ–¹æ³•ï¼ŒåŸºæœ¬ä¸Šä¸€æ ·ï¼Œè¿™é‡Œå°±æä¾›ä¸€ä¸‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="number">128</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">cls, delay: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">cls.delay = delay</span><br><span class="line">time.sleep(delay)</span><br><span class="line"><span class="keyword">return</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Deleting instance ...&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://docs.python.org/3.6/library/functools.html#functools.lru_cache">functools.lru_cache</a><br><a href="https://stackoverflow.com/questions/70409673/python-lru-cache-in-a-class-disregards-maxsize-limit-when-decorated-with-a-stati">Python LRU cache in a class disregards maxsize limit when decorated with a staticmethod or classmethod decorator</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;lru_cache æ˜¯ functools åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸ºå‡½æ•°æä¾›ç¼“å­˜åŠŸèƒ½çš„è£…é¥°å™¨ï¼Œç¼“å­˜ maxsize ç»„ä¼ å…¥å‚æ•°ï¼Œåœ¨ä¸‹æ¬¡ä»¥ç›¸åŒå‚æ•°è°ƒç”¨æ—¶ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡çš„ç»“æœã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»å®ƒçš„åŠŸèƒ½æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜å‡½æ•°çš„è¿è¡Œé€Ÿåº¦ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ&lt;strong&gt;å½“ä½ ç”¨functools.lru_cacheè£…é¥°å™¨æ¥è£…é¥°ä¸€ä¸ªå®ä¾‹æ–¹æ³•æ—¶ï¼Œå°è£…è¯¥æ–¹æ³•çš„ç±»çš„å®ä¾‹åœ¨æŒæœ‰å®ƒä»¬çš„è¿›ç¨‹ä¸­æ°¸è¿œä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ pre-commit é…åˆ blackã€isort è‡ªåŠ¨æ ¼å¼åŒ– Python æ–‡ä»¶</title>
    <link href="https://leetaogoooo.github.io/2021/12/30/lwp55SOlQ/"/>
    <id>https://leetaogoooo.github.io/2021/12/30/lwp55SOlQ/</id>
    <published>2021-12-30T00:18:00.000Z</published>
    <updated>2022-04-12T07:10:22.050Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸ºäº†ä¿è¯ Python çš„ä»£ç è§„èŒƒï¼Œåœ¨ä½¿ç”¨ <code>git commit</code> æäº¤ä»£ç ä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨ blakeã€isort å·¥å…·å¯¹æäº¤çš„æ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¦‚æœæäº¤çš„ä»£ç ç¬¦åˆè§„æ³•åˆ™ commit æˆåŠŸï¼Œå¦åˆ™è‡ªåŠ¨æ ¼å¼åŒ–æ–‡ä»¶ï¼Œç„¶åé‡æ–° commit</p></blockquote><p>æ•´ä¸ªå·¥ä½œæµå¤§æ¦‚æ˜¯è¿™æ ·å­ï¼š</p><p><img src="https://www.leetao94.cn/post-images/1640823506631.png"></p><p>å…¶ä¸­ <code>black</code> æ˜¯ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ <code>pip install black</code> åç›´æ¥ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">black &#123;source_file_or_directory&#125;...</span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¹Ÿæ”¯æŒé…ç½®æ–‡ä»¶è‡ªå®šä¹‰è§„åˆ™ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://black.readthedocs.io/en/stable/">The uncompromising code formatter â€” Black</a></p><p><code>isort</code>  åˆ™æ˜¯ç”¨æ¥è§„èŒƒ python åº“çš„å¼•å…¥çš„ï¼ŒæŒ‰å­—æ¯é¡ºåºå¯¹ packages è¿›è¡Œæ’åºï¼Œå¹¶è‡ªåŠ¨åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†å’Œç±»å‹ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡ <code>pip install isort</code> åç›´æ¥ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isort mypythonfile.py mypython file2.py</span><br></pre></td></tr></table></figure><p>å’Œ <code>black</code> ä¸€æ ·ä¹Ÿæ”¯æŒé…ç½®æ–‡ä»¶è‡ªå®šä¹‰è§„åˆ™ï¼Œå…·ä½“å†…å®¹å‚è€ƒå®˜ç½‘ <a href="https://pycqa.github.io/isort/">isort (pycqa.github.io)</a></p><p><code>pre-commit</code> æ˜¯æ•´ä¸ªå·¥ä½œæµæœ€é‡è¦çš„ä¸€ç¯ï¼Œ<code>pre-commit</code> æ˜¯ <code>git-hooks</code> ä¸­çš„ä¸€ä¸ªé‡è¦çš„é’©å­ï¼Œå®ƒåœ¨é”®å…¥æäº¤ä¿¡æ¯å‰è¿è¡Œã€‚<strong>å¯ä»¥ç”¨äºæ£€æŸ¥å³å°†æäº¤çš„å¿«ç…§ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ‰€é—æ¼ï¼Œç¡®ä¿æµ‹è¯•è¿è¡Œï¼Œä»¥åŠæ ¸æŸ¥ä»£ç ã€‚ å¦‚æœè¯¥é’©å­ä»¥éé›¶å€¼é€€å‡ºï¼ŒGit å°†æ”¾å¼ƒæ­¤æ¬¡æäº¤ã€‚</strong> ä¸Šé¢æåˆ°çš„æœºåˆ¶æ˜¯æ•´ä¸ªå·¥ä½œæµå¯ä»¥è¿›è¡Œçš„å…³é”®ã€‚</p><p>å®Œå…¨å¯ä»¥è‡ªå®šä¹‰ <code>pre-commit</code> é’©å­çš„ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯ä¸ºäº†æ£€éªŒçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ç°æˆçš„æ–¹æ¡ˆ <a href="https://github.com/pre-commit/pre-commit">pre-commit/pre-commit</a>,ç”¨ Python æ„å»ºï¼Œæ”¯æŒå¤šè¯­è¨€çš„ç®¡ç†å™¨ã€‚é€šè¿‡ <code>pre-commit</code> è¿™ä¸ªåº“ï¼Œç®€å•åœ°å‡ æ­¥å°±å¯ä»¥å®ç°è‡ªåŠ¨åŒ–å·¥ä½œæµã€‚</p><ol><li>å®‰è£… pre-commit</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pre-commit</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡ <code>pre-commit --version</code> ç¡®å®šæ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pre-commit --version</span><br><span class="line">pre-commit 2.16.0</span><br></pre></td></tr></table></figure><ol start="2"><li>æ·»åŠ  <code>.pre-commit-config.yaml</code> çš„é…ç½®æ–‡ä»¶</li></ol><p>å¯ä»¥é€šè¿‡ <code>pre-commit sample-config</code> ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„é…ç½®æ–‡ä»¶,è¿™é‡Œè´´ä¸€ä¸‹å…³äº <code>black</code> å’Œ <code>isort</code> çš„é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">repos:</span>  </span><br><span class="line"><span class="bullet">-</span>   <span class="attr">repo:</span> <span class="string">https://github.com/psf/black</span>  </span><br><span class="line"> <span class="attr">rev:</span> <span class="number">21.</span><span class="string">12b0</span>  </span><br><span class="line"> <span class="attr">hooks:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">black</span>  </span><br><span class="line">  </span><br><span class="line"><span class="bullet">-</span>   <span class="attr">repo:</span> <span class="string">https://github.com/PyCQA/isort</span>  </span><br><span class="line"> <span class="attr">rev:</span> <span class="number">5.10</span><span class="number">.1</span>  </span><br><span class="line"> <span class="attr">hooks:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">isort</span></span><br></pre></td></tr></table></figure><p>æ”¯æŒçš„é…ç½®é¡¹å¾ˆå¤šï¼Œå…·ä½“å‚è€ƒ <a href="https://pre-commit.com/#plugins">plugins</a></p><ol start="3"><li> å®‰è£… git hooks è„šæœ¬</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pre-commit install</span><br><span class="line">pre-commit installed at .git/hooks/pre-commit</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å°±å¤§åŠŸå‘Šæˆäº†</p><p><img src="https://www.leetao94.cn/post-images/1640823519964.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯ Python çš„ä»£ç è§„èŒƒï¼Œåœ¨ä½¿ç”¨ &lt;code&gt;git commit&lt;/code&gt; æäº¤ä»£ç ä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨ blakeã€isort å·¥å…·å¯¹æäº¤çš„æ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¦‚æœæäº¤çš„ä»£ç ç¬¦åˆè§„æ³•åˆ™ commit æˆåŠŸï¼Œå¦åˆ™è‡ªåŠ¨æ ¼å¼åŒ–æ–‡ä»¶ï¼Œç„¶åé‡æ–° co</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ç±»çš„è‡ªå®šæ³¨å†Œä»¥åŠåº”ç”¨åœºæ™¯</title>
    <link href="https://leetaogoooo.github.io/2021/12/25/3K1fxgdEp/"/>
    <id>https://leetaogoooo.github.io/2021/12/25/3K1fxgdEp/</id>
    <published>2021-12-25T02:38:21.000Z</published>
    <updated>2022-04-12T07:10:22.019Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ 3.6 ä¹‹å‰å¯ä»¥é€šè¿‡ <code>meta class</code> å»å®ç°ï¼Œ3.6 ä¹‹åå¯ä»¥é€šè¿‡ <code>__init_subclass__</code> å®ç°</p></blockquote><h2 id="meta-class"><a href="#meta-class" class="headerlink" title="meta class"></a><code>meta class</code></h2><p>é€šè¿‡ <code>meta class</code> çš„ <code>__new__</code> æ–¹æ³•å¯ä»¥å®ç°è‡ªåŠ¨æ³¨å†Œ <code>class</code> çš„åŠŸèƒ½ï¼ŒåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡å…ƒç±»å»æ§åˆ¶ç±»çš„åˆ›å»ºï¼Œåœ¨è°ƒç”¨ <code>__new__</code>  æ–¹æ³•çš„æ—¶å€™è‡ªåŠ¨å°† <code>class</code> æ³¨å†Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetaClass</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, clsname, bases, attrs</span>):</span></span><br><span class="line">        newclass = <span class="built_in">super</span>(MetaClass, cls).__new__(cls, clsname, bases, attrs)</span><br><span class="line">        register(newclass)  <span class="comment"># æ³¨å†Œå‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> newclass</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params">metaclass=MetaClass</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="init-subclass"><a href="#init-subclass" class="headerlink" title="__init_subclass__"></a><code>__init_subclass__</code></h2><p><code>__init_subclass__</code> æ˜¯ 3.6 åå¼•å…¥çš„ä¸€ä¸ªæ–°çš„ç‰¹æ€§ï¼Œä¸€ä¸ª hookï¼Œå¯ä»¥è®©æ‰€æœ‰çš„å­ç±»åœ¨åˆ›å»ºä¹‹åæ‰§è¡Œä¸€äº›åˆå§‹åŒ–çš„æ“ä½œï¼Œé€šè¿‡è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬å°±å¯ä»¥æ›´ç®€å•åœ°å®ç°ä¸Šè¿°é€šè¿‡å…ƒç±»å®ç°çš„åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentClass</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init_subclass_</span>(<span class="params">cls, **kwargs</span>):</span></span><br><span class="line"><span class="built_in">super</span>().__init_subclass(**kwargs)</span><br><span class="line">register(cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildClass</span>(<span class="params">ParentClass</span>):</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>__init_subclass__</code>  <strong>æ²¡æœ‰éå…³é”®å­—å‚æ•°</strong>ã€‚</p><h1 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h1><p>ä»£ç å­˜åœ¨å¦‚ä¸‹çš„é€»è¾‘:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> category == <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">handle_a()</span><br><span class="line"><span class="keyword">elif</span> cateogory == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">handle_b()</span><br><span class="line"><span class="keyword">elif</span> category == <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">handle_c()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">handle_else()</span><br></pre></td></tr></table></figure><p>å­˜åœ¨å¾ˆå¤šéƒ½å¤„ç†é€»è¾‘ï¼Œæ¯ä¸ªé€»è¾‘å¯èƒ½ç”±ä¸åŒçš„å¼€å‘äººå‘˜ç¼–å†™ï¼Œå…¨éƒ¨æ”¾åˆ°ä¸€ä¸ªä»£ç å—ä¸­ï¼Œå¯ä»¥é¢„è§éšç€åˆ†æ”¯çš„å¢å¤šï¼Œè¿™éƒ¨åˆ†ä»£ç ä¼šå˜å¾—è¶Šæ¥è¶Šåºå¤§ï¼Œä¸åˆ©äºåæœŸç»´æŠ¤ï¼Œæ‰€ä»¥æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œå­˜åœ¨ä¸€ä¸ª dict ä¿å­˜ <code>category</code> å’Œ å¤„ç†æ–¹æ³•çš„æ˜ å°„å…³ç³»:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">category_to_func = &#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: handle_a</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å°†æœ€åˆçš„ä»£ç ç®€åŒ–ä¸º:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> category_to_func.get(category)()</span><br></pre></td></tr></table></figure><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>åŸºäºä¸Šé¢çš„æ€è·¯ï¼Œå¯ä»¥å†™å‡ºæœ€ç®€å•çš„æ–¹æ³•ï¼Œè®©å¤§å®¶è‡ªè¡Œç¼–å†™è‡ªå·±çš„å¤„ç†æ–¹æ³•ï¼Œç„¶ååœ¨ <code>category_to_func</code> ä¸­ç»Ÿä¸€æ³¨å†Œè‡ªå·±çš„æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">category_to_func = &#123;</span><br><span class="line"><span class="string">&#x27;a&#x27;</span>: handle_a <span class="comment"># A æ’°å†™æ³¨å†Œ</span></span><br><span class="line"><span class="string">&#x27;b&#x27;</span>: handle_b <span class="comment"># B æ’°å†™æ³¨å†Œ</span></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å­æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯ä¸å¤Ÿä¼˜é›…ï¼Œå¼€å‘äººå‘˜æ’°å†™äº†è‡ªå·±çš„å¤„ç†æ–¹æ³•ä¹‹åï¼Œè¿˜è¦å»æŒ‡å®šçš„åœ°æ–¹æ³¨å†Œè‡ªå·±çš„æ–¹æ³•ï¼Œå¼€å‘ä½“éªŒä¸å¤ªå¥½ã€‚<br>å¦‚æœå­˜åœ¨ä¸€ç§æ–¹å¼ï¼Œå¼€å‘äººå‘˜åªéœ€è¦æ’°å†™å¤„ç†æ–¹æ³•ï¼Œä»£ç å¯ä»¥è‡ªå®šæ³¨å†Œå°±æ›´å¥½äº†ã€‚</p><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>é€šè¿‡ä¸Šé¢çš„è‡ªæ³¨å†Œçš„æ–¹æ³•ï¼Œè®©å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œç„¶åå°†å…¶è‡ªåŠ¨æ³¨å†Œåˆ°å…¨å±€å½“ä¸­ï¼Œè¿™æ ·å­å¼€å‘äººå‘˜åªéœ€è¦å…³æ³¨è‡ªå·±çš„ä¸šåŠ¡å®ç°å°±å¯ä»¥äº†ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.python.org/dev/peps/pep-0487/">PEP 487 â€“ Simpler customisation of class creation</a><br><a href="https://stackoverflow.com/questions/5189232/how-to-auto-register-a-class-when-its-defined">python - How to auto register a class when itâ€™s defined - Stack Overflow</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åœ¨ 3.6 ä¹‹å‰å¯ä»¥é€šè¿‡ &lt;code&gt;meta class&lt;/code&gt; å»å®ç°ï¼Œ3.6 ä¹‹åå¯ä»¥é€šè¿‡ &lt;code&gt;__init_subclass__&lt;/code&gt; å®ç°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;meta-class&quot;&gt;</summary>
      
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="pep" scheme="https://leetaogoooo.github.io/tags/pep/"/>
    
  </entry>
  
  <entry>
    <title>Django è‡ªå®šä¹‰ SearchFilterå…¼å®¹ç©ºæ ¼æœç´¢</title>
    <link href="https://leetaogoooo.github.io/2021/12/09/GLNcAwN1I/"/>
    <id>https://leetaogoooo.github.io/2021/12/09/GLNcAwN1I/</id>
    <published>2021-12-09T00:29:49.000Z</published>
    <updated>2022-04-12T07:10:22.025Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Django è‡ªå¸¦çš„ SearchFilter æ˜¯ä¸æ”¯æŒç©ºæ ¼æœç´¢çš„ï¼Œå¦‚æœéœ€è¦æ”¯æŒç©ºæ ¼æœç´¢å¹¶ä¸”ä¿ç•™ä¹‹å‰çš„æœç´¢åŠŸèƒ½åˆ™éœ€è¦è‡ªå®šä¹‰ SearchFilterã€‚</p><h1 id="è‡ªå®šä¹‰-SearchFilter"><a href="#è‡ªå®šä¹‰-SearchFilter" class="headerlink" title="è‡ªå®šä¹‰ SearchFilter"></a>è‡ªå®šä¹‰ SearchFilter</h1><p>ç»§æ‰¿ SeachFilter ç„¶åå®ç° <code>get_search_terms</code> æ–¹æ³•ï¼Œå¦‚æœåŒæ—¶æ”¯æŒ space ç„¶ååˆå¯ä»¥ä¿æŒä¹‹å‰çš„æœç´¢ç‰¹æ€§å‘¢ï¼Ÿ</p><p>ç®€å•çš„åšæ³•å°±æ˜¯ï¼Œå¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœåªæœ‰å«æœ‰ç©ºæ ¼å°±è¿”å›ç©ºæ ¼ï¼Œå¦åˆ™å°±æ‰§è¡Œä¹‹å‰çš„æœç´¢é€»è¾‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CanSerachBothCharFilter</span>(<span class="params">SearchFilter</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_search_terms</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        params = request.query_params.get(self.search_param, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="comment"># åˆ¤æ–­åŸæ¥çš„å‚æ•°æ˜¯å¦æœ‰åªæœ‰ç©ºæ ¼</span></span><br><span class="line">        only_space = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(params) != <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(params.strip()) == <span class="number">0</span>:</span><br><span class="line">            only_space = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        params = params.replace(<span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># strip null characters</span></span><br><span class="line">        params = params.replace(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> only_space:</span><br><span class="line">            <span class="keyword">return</span> [params]</span><br><span class="line">        <span class="keyword">return</span> params.split()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;Django è‡ªå¸¦çš„ SearchFilter æ˜¯ä¸æ”¯æŒç©ºæ ¼æœç´¢çš„ï¼Œå¦‚æœéœ€è¦æ”¯æŒç©ºæ ¼æœç´¢å¹¶ä¸”ä¿ç•™ä¹‹å‰çš„æœç´¢åŠŸèƒ½åˆ™éœ€è¦è‡ªå®šä¹‰ SearchFi</summary>
      
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="django" scheme="https://leetaogoooo.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>pep 544 Protocols: Structural subtyping (static duck typing)</title>
    <link href="https://leetaogoooo.github.io/2021/11/29/HwmFtxua0/"/>
    <id>https://leetaogoooo.github.io/2021/11/29/HwmFtxua0/</id>
    <published>2021-11-29T00:17:04.000Z</published>
    <updated>2022-04-12T07:10:22.027Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ <a href="https://www.python.org/dev/peps/pep-0484">PEP 484</a>  ä¸­å¼•å…¥çš„ Typing hints (ç±»å‹æç¤º) å¯ä»¥ç”¨æ¥ä¸ºé™æ€ç±»å‹æ£€æŸ¥å™¨å’Œå…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·æŒ‡å®šç±»å‹å…ƒæ•°æ®ã€‚ä½†æ˜¯åœ¨ï¼Œ<a href="https://www.python.org/dev/peps/pep-0484">PEP 484</a>  åªæŒ‡å®šäº†åä¹‰å­ç±»å‹çš„è¯­ä¹‰ã€‚åœ¨è¿™ä¸ª <a href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a> ä¸­ï¼ŒæŒ‡å®šäº†åè®®ç±»çš„é™æ€å’Œè¿è¡Œæ—¶è¯­ä¹‰ï¼Œè¿™å°†ä¸ºç»“æ„æ€§å­ç±»å‹ï¼ˆé™æ€é¸­å­ç±»å‹ï¼‰æä¾›ä¸€ä¸ªæ”¯æŒã€‚</p><h2 id="ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹-Duck-Typing-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹-Duck-Typing-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹(Duck Typing)ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹(Duck Typing)ï¼Ÿ</h2><blockquote><p>If it walks like a duck and it quacks like a duck, then it must be a duckã€‚</p></blockquote><p>ç®€å•åœ°è¯´ï¼Œâ€å¦‚æœå®ƒèµ°è·¯åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£å®ƒä¸€å®šæ˜¯é¸­å­â€œã€‚</p><p>åœ¨ç¼–ç¨‹ä¸­è¿™å°±æ„å‘³ç€å½“æˆ‘ä»¬ç¼–å†™æ¥æ”¶ç‰¹å®šè¾“å…¥çš„å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒè¯¥å‡½æ•°è¾“å…¥çš„è¡Œä¸ºã€å±æ€§ï¼Œè€Œä¸æ˜¯è¯¥å‡½æ•°è¾“å…¥çš„æ˜¾å¼ç±»å‹ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œåœ¨ä¸ä½¿ç”¨é¸­å­ç±»å‹çš„è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªç±»å‹ä¸ºâ€é¸­å­â€çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„â€èµ°â€å’Œâ€å«â€æ–¹æ³•ã€‚åœ¨ä½¿ç”¨é¸­å­ç±»å‹çš„è¯­è¨€ä¸­ï¼Œè¿™æ ·çš„ä¸€ä¸ªå‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„â€èµ°â€å’Œâ€å«â€æ–¹æ³•ã€‚â€” ç™¾åº¦ç™¾ç§‘</p></blockquote><p>é‚£ä¹ˆå¦‚ä½•åœ¨ Python ä¸­å®ç°â€œé¸­å­ç±»å‹â€å‘¢ï¼Ÿ</p><h1 id="é¸­å­ç±»å‹"><a href="#é¸­å­ç±»å‹" class="headerlink" title="é¸­å­ç±»å‹"></a>é¸­å­ç±»å‹</h1><p>ç°åœ¨æœ‰è¿™æ ·å­åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªå‡½æ•°å»è®¡ç®—ä¸€ä¸ªæ‹¥æœ‰è¾¹é•¿(len_side)çš„ç‰©ä½“çš„å‘¨é•¿ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> calcute_circumference(shape):</span><br><span class="line">circumference <span class="operator">=</span> <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> side <span class="keyword">in</span> shape.len_side: <span class="operator">/</span><span class="operator">/</span><span class="operator">/</span> éå†è¾¹é•¿</span><br><span class="line">circumference <span class="operator">+</span><span class="operator">=</span> side</span><br><span class="line"><span class="keyword">return</span> circumference <span class="operator">/</span><span class="operator">/</span><span class="operator">/</span> å‘¨é•¿</span><br></pre></td></tr></table></figure><p>ä»ä¼ªä»£ç ä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬ä¸å…³å¿ƒæ˜¯ä»€ä¹ˆçš„ç‰©ä½“ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯è¿™ä¸ªç‰©ä½“å¯ä»¥æœ‰ä¸€ä¸ª len_sideï¼ˆåˆ—è¡¨ï¼‰ å­—æ®µå°±å¯ä»¥äº†ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å€Ÿç”± <code>Protocol</code> å»å®ç°å®ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Protocol</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjWithSideLen</span>(<span class="params">Protocol</span>):</span></span><br><span class="line">side_len: <span class="built_in">list</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcute_circumference</span>(<span class="params">shape: ObjWithSideLen</span>):</span></span><br><span class="line">circumference = <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> side <span class="keyword">in</span> shape.side_len:</span><br><span class="line">circumference += side</span><br><span class="line"><span class="keyword">return</span> circumference</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸éš¾çœ‹å‡º <code>Protocol</code> æœ‰ç‚¹ç±»ä¼¼ Java ä¸­çš„æ¥å£ï¼Œåªéœ€è¦åœ¨å‡½æ•°ä¸Šä½¿ç”¨å®ƒï¼Œå¹¶ä¸éœ€è¦å»å…³æ³¨è¾“å…¥çš„å‚æ•°çš„å…·ä½“ç±»å‹ã€‚</p><h1 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h1><p>æˆ‘ä»¬è¿˜å¯ä»¥é…åˆä½¿ç”¨ <code>typing</code> ä¸­çš„ <code>TypeVar</code> å®ç°æ³›å‹å‚æ•°åŒ–ï¼Œè®©æˆ‘ä»¬çš„å‡½æ•°æ›´åŠ æŠ½è±¡åŒ–ï¼Œåªè¦ç¬¦åˆåè®®ï¼Œæ— è®ºä»€ä¹ˆç±»å‹çš„è¾“å…¥éƒ½å¯ä»¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Protocol</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjWithSideLen</span>(<span class="params">Protocol</span>):</span></span><br><span class="line">side_len: <span class="built_in">list</span></span><br><span class="line"></span><br><span class="line">T = TypeVar(<span class="string">&#x27;T&#x27;</span>, bound=ObjWithSideLen)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcute_circumference</span>(<span class="params">shape: T</span>) -&gt; T:</span></span><br><span class="line">circumference = <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> side <span class="keyword">in</span> shape.side_len:</span><br><span class="line">circumference += side</span><br><span class="line">shape.circumference = circumference</span><br><span class="line"><span class="keyword">return</span> shape</span><br></pre></td></tr></table></figure><h1 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h1><p>ä¸Šè¿°çš„ä¾‹å­éƒ½å¯ä»¥å€Ÿç”± Python ä¸­çš„ ABCs å»å®ç°çš„ï¼Œä½†æ˜¯ä¸¤è€…çš„ä¾§é‡ç‚¹æœ‰æ‰€ä¸åŒï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œè®©æˆ‘ä»¬ä»”ç»†å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„çš„åŒºåˆ«ã€‚</p><ul><li>å‚è€ƒæ–‡ç«   <a href="https://docs.python.org/zh-cn/3/library/typing.html">python-typing</a>  <a href="https://www.daan.fyi/writings/python-protocols">Static Duck Typing in Python with Protocols</a>  <a href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ &lt;a href=&quot;https://www.python.org/dev/peps/pep-0484&quot;&gt;PEP 484&lt;/a&gt;  ä¸­å¼•å…¥çš„</summary>
      
    
    
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>git commit è§„èŒƒä»¥åŠæ ¡éªŒæ–¹æ¡ˆ</title>
    <link href="https://leetaogoooo.github.io/2021/11/19/KS62tWWwN/"/>
    <id>https://leetaogoooo.github.io/2021/11/19/KS62tWWwN/</id>
    <published>2021-11-18T23:55:16.000Z</published>
    <updated>2022-04-12T07:10:22.029Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·æ—¶ï¼Œæ¯æ¬¡æ–‡ä»¶å‘ç”Ÿä¿®æ”¹çš„æ—¶å€™æäº¤éƒ½éœ€è¦ <code>git commit</code> å‘½ä»¤å»è®°å½•æœ¬æ¬¡çš„ä¿®æ”¹ï¼Œå¦åˆ™å°±ä¸å…è®¸æäº¤ï¼Œæ˜¾ç„¶ <code>git commit</code>  æ˜¯ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚ï¼Œå› æ­¤åˆ¶å®šä¸€ä¸ª Git Commit è§„èŒƒæ˜¯æœ‰å¿…è¦çš„ï¼Œå¦åˆ™å°±ä¼šå‡ºç°æ··ä¹±çš„æäº¤ä¿¡æ¯ï¼Œè¿™é‡Œè…¾è®¯æŸå›¢é˜Ÿçš„è§„èŒƒä½œä¸ºä¾‹å­ï¼Œç„¶åé€šè¿‡ä¸€å®šçš„æ‰‹æ®µå»å¸®åŠ©æˆ‘ä»¬æŠŠè¿™ä¸ªè§„èŒƒè½åˆ°å®å¤„ã€‚</p><p>ç›®çš„ï¼š</p><ul><li>ç»Ÿä¸€å›¢é˜ŸÂ <code>Git commit</code>Â æ—¥å¿—æ ‡å‡†ï¼Œä¾¿äºåç»­ä»£ç  reviewï¼Œç‰ˆæœ¬å‘å¸ƒä»¥åŠæ—¥å¿—è‡ªåŠ¨åŒ–ç”Ÿæˆç­‰ç­‰ã€‚</li><li>ç»Ÿä¸€å›¢é˜Ÿçš„ Git å·¥ä½œæµï¼ŒåŒ…æ‹¬åˆ†æ”¯ä½¿ç”¨ã€tag è§„èŒƒã€issue ç­‰</li></ul><h1 id="Git-commit-æ—¥å¿—å‚è€ƒæ¡ˆä¾‹"><a href="#Git-commit-æ—¥å¿—å‚è€ƒæ¡ˆä¾‹" class="headerlink" title="Git commit æ—¥å¿—å‚è€ƒæ¡ˆä¾‹"></a><strong>Git commit æ—¥å¿—å‚è€ƒæ¡ˆä¾‹</strong></h1><ul><li><a href="https://github.com/angular/angular">angular</a></li><li><a href="https://github.com/cpselvis/commit-message-test-project">commit-message-test-project</a></li><li><a href="https://github.com/istanbuljs/babel-plugin-istanbul">babel-plugin-istanbul</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog">conventional-changelog</a></li></ul><h1 id="æ€»ä½“æ–¹æ¡ˆ"><a href="#æ€»ä½“æ–¹æ¡ˆ" class="headerlink" title="æ€»ä½“æ–¹æ¡ˆ"></a><strong>æ€»ä½“æ–¹æ¡ˆ</strong></h1><p><img src="https://www.leetao94.cn/post-images/1637279828697.png" alt="æ¥è‡ª feflow çš„ git commit è§„èŒƒ"></p><h1 id="Git-commitæ—¥å¿—åŸºæœ¬è§„èŒƒ"><a href="#Git-commitæ—¥å¿—åŸºæœ¬è§„èŒƒ" class="headerlink" title="Git commitæ—¥å¿—åŸºæœ¬è§„èŒƒ"></a><strong>Git commitæ—¥å¿—åŸºæœ¬è§„èŒƒ</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">type</span>&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure><h2 id="type-ç±»å‹"><a href="#type-ç±»å‹" class="headerlink" title="type ç±»å‹"></a><strong>type ç±»å‹</strong></h2><blockquote><p>typeä»£è¡¨æŸæ¬¡æäº¤çš„ç±»å‹ï¼Œæ¯”å¦‚æ˜¯ä¿®å¤ä¸€ä¸ªbugè¿˜æ˜¯å¢åŠ ä¸€ä¸ªæ–°çš„feature</p></blockquote><ul><li>featï¼š æ–°å¢ feature</li><li>fix: ä¿®å¤ bug</li><li>docs: ä»…ä»…ä¿®æ”¹äº†æ–‡æ¡£ï¼Œæ¯”å¦‚ README, CHANGELOG, CONTRIBUTEç­‰ç­‰</li><li>style: ä»…ä»…ä¿®æ”¹äº†ç©ºæ ¼ã€æ ¼å¼ç¼©è¿›ã€é€—å·ç­‰ç­‰ï¼Œä¸æ”¹å˜ä»£ç é€»è¾‘</li><li>refactor: ä»£ç é‡æ„ï¼Œæ²¡æœ‰åŠ æ–°åŠŸèƒ½æˆ–è€…ä¿®å¤ bug</li><li>perf: ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ</li><li>test: æµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰</li><li>chore: æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰</li><li>revert: å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</li></ul><h2 id="æ ¼å¼è¦æ±‚"><a href="#æ ¼å¼è¦æ±‚" class="headerlink" title="æ ¼å¼è¦æ±‚"></a><strong>æ ¼å¼è¦æ±‚</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ‡é¢˜è¡Œï¼š50ä¸ªå­—ç¬¦ä»¥å†…ï¼Œæè¿°ä¸»è¦å˜æ›´å†…å®¹</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ä¸»ä½“å†…å®¹ï¼šæ›´è¯¦ç»†çš„è¯´æ˜æ–‡æœ¬ï¼Œå»ºè®®72ä¸ªå­—ç¬¦ä»¥å†…ã€‚ éœ€è¦æè¿°çš„ä¿¡æ¯åŒ…æ‹¬:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * ä¸ºä»€ä¹ˆè¿™ä¸ªå˜æ›´æ˜¯å¿…é¡»çš„? å®ƒå¯èƒ½æ˜¯ç”¨æ¥ä¿®å¤ä¸€ä¸ªbugï¼Œå¢åŠ ä¸€ä¸ªfeatureï¼Œæå‡æ€§èƒ½ã€å¯é æ€§ã€ç¨³å®šæ€§ç­‰ç­‰</span></span><br><span class="line"><span class="comment"># * ä»–å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜? å…·ä½“æè¿°è§£å†³é—®é¢˜çš„æ­¥éª¤</span></span><br><span class="line"><span class="comment"># * æ˜¯å¦å­˜åœ¨å‰¯ä½œç”¨ã€é£é™©?</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># å°¾éƒ¨ï¼šå¦‚æœéœ€è¦çš„åŒ–å¯ä»¥æ·»åŠ ä¸€ä¸ªé“¾æ¥åˆ°issueåœ°å€æˆ–è€…å…¶å®ƒæ–‡æ¡£ï¼Œæˆ–è€…å…³é—­æŸä¸ªissueã€‚</span></span><br></pre></td></tr></table></figure><h1 id="æ ¡éªŒæ–¹æ¡ˆ"><a href="#æ ¡éªŒæ–¹æ¡ˆ" class="headerlink" title="æ ¡éªŒæ–¹æ¡ˆ"></a>æ ¡éªŒæ–¹æ¡ˆ</h1><p>node é¡¹ç›®å·²ç»æœ‰æ¯”è¾ƒæˆç†Ÿçš„æ–¹æ¡ˆï¼Œè¿™é‡Œä»¥ Python é¡¹ç›®ä¸ºä¾‹ï¼Œè€ƒè™‘å®é™…ä½¿ç”¨çš„ä¾¿åˆ©æ€§ï¼Œå¸Œæœ›å¯ä»¥å¯ä»¥å®ç°ä»¥ä¸‹çš„ç›®çš„ï¼š</p><ol><li>æˆå‘˜åœ¨<strong>æœ¬åœ°æ‰§è¡Œ git commit çš„å‘½ä»¤æ—¶å°±å®Œæˆæ ¡éªŒ</strong>ï¼Œé€šè¿‡åˆ™å…è®¸æ‰§è¡Œ <code>git push</code> å¦åˆ™åˆ™éœ€è¦é‡æ–°æäº¤ commit çš„ä¿¡æ¯ã€‚</li><li>æäº¤åˆ° gitlabï¼Œç”±æœåŠ¡ç«¯å®Œæˆå†æ¬¡æ ¡éªŒ</li></ol><h2 id="æœ¬åœ°æ ¡éªŒ"><a href="#æœ¬åœ°æ ¡éªŒ" class="headerlink" title="æœ¬åœ°æ ¡éªŒ"></a>æœ¬åœ°æ ¡éªŒ</h2><h3 id="git-hooks"><a href="#git-hooks" class="headerlink" title="git hooks"></a>git hooks</h3><p>Git åœ¨æ‰§è¡Œ <code>git init</code> è¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåœ¨ <code>.git/hooks</code> ç›®å½•ä¸‹ç”Ÿæˆä¸€ç³»åˆ— hooks è„šæœ¬:</p><p><img src="https://www.leetao94.cn/post-images/1637279929295.png" alt="git-hooks"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ¯ä¸ªè„šæœ¬çš„åç¼€éƒ½æ˜¯ä»¥Â <code>.sample</code>Â ç»“å°¾çš„ï¼Œåœ¨è¿™ä¸ªæ—¶å€™ï¼Œè„šæœ¬æ˜¯ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œçš„ã€‚æˆ‘ä»¬éœ€è¦æŠŠåç¼€å»æ‰ä¹‹åæ‰ä¼šç”Ÿæ•ˆï¼Œå³å°†Â <code>pre-commit.sample</code>Â å˜æˆÂ <code>pre-commit</code>Â æ‰ä¼šèµ·ä½œç”¨ã€‚ç”±äºåªæ˜¯å¯¹ commit msg åšæ ¡éªŒï¼Œæ‰€ä»¥åªéœ€è¦ä½¿ç”¨ <code>commit-msg</code> è„šæœ¬å³å¯ã€‚</p><h3 id="commit-msg-è„šæœ¬"><a href="#commit-msg-è„šæœ¬" class="headerlink" title="commit-msg è„šæœ¬"></a>commit-msg è„šæœ¬</h3><p>åœ¨ <code>commit-msg</code> hooks ä¸­å®Œæˆå¯¹ commit æ¶ˆæ¯æ ¡éªŒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰æäº¤çš„ commit msg</span></span><br><span class="line">commit_msg=`cat $<span class="number">1</span>`</span><br><span class="line"></span><br><span class="line">msg_re=<span class="string">&quot;^(feat|fix|docs|style|refactor|perf|test|workflow|build|ci|chore|release|workflow)(\(.+\))?: .&#123;1,100&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ ! $commit_msg =~ $msg_re ]]</span><br><span class="line">then</span><br><span class="line">    echo <span class="string">&quot;\nä¸åˆæ³•çš„ commit æ¶ˆæ¯æäº¤æ ¼å¼ï¼Œè¯·ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼\n &lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;&quot;</span></span><br><span class="line">    <span class="comment"># å¼‚å¸¸é€€å‡º</span></span><br><span class="line">    exit <span class="number">1</span></span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>å°†ä¸Šè¿°è„šæœ¬ä¿æŒåœ¨é¡¹ç›®æ‰€åœ¨å¯¹ <code>.git/hooks</code> ç›®å½•ä¸‹å‘½åä¸º <code>commit-msg</code>,ç„¶åæ‰§è¡Œ <code>chmod</code> å‘½ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x .git/hooks/commit-msg</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯ç»“æœ"><a href="#éªŒè¯ç»“æœ" class="headerlink" title="éªŒè¯ç»“æœ"></a>éªŒè¯ç»“æœ</h3><ol><li>ä¸ç¬¦åˆè§„æ³•çš„ commit msg</li></ol><p><img src="https://www.leetao94.cn/post-images/1637280036579.png" alt="ä¸åˆè§„çš„git-commit-msg"></p><ol start="2"><li>ç¬¦åˆè§„èŒƒçš„ commit-msg</li></ol><p><img src="https://www.leetao94.cn/post-images/1637280050146.png" alt="åˆè§„çš„git-commit-msg"></p><h1 id="æœåŠ¡ç«¯æ ¡éªŒ"><a href="#æœåŠ¡ç«¯æ ¡éªŒ" class="headerlink" title="æœåŠ¡ç«¯æ ¡éªŒ"></a>æœåŠ¡ç«¯æ ¡éªŒ</h1><p>Git åœ¨æœåŠ¡ç«¯ä¹ŸåŒæ ·æœ‰ä¸€äº› hooks:</p><ul><li><code>pre-receive</code></li><li><code>update</code></li><li><code>post-receive</code></li></ul><p>æ¯ä¸ª hooks çš„å…·ä½“åŠŸèƒ½å¯ä»¥å‚è€ƒ <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks#_server_side_hooks">Server-Side Hooks</a> ï¼Œå…¶ä¸­ <code>pre-receive</code> å’Œ <code>update</code> å‡ç¬¦åˆä½¿ç”¨åœºæ™¯ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯<strong>ç”¨æˆ·åŒæ—¶æ¨é€åˆ°å¤šä¸ªåˆ†æ”¯æ—¶ï¼Œ update é’ˆå¯¹æ¯ä¸ªåˆ†æ”¯éƒ½ä¼šè¢«è§¦å‘æ‰§è¡Œï¼Œè€Œ <code>pre-receive</code> åªæ‰§è¡Œä¸€æ¬¡ã€‚</strong></p><h2 id="pre-receive"><a href="#pre-receive" class="headerlink" title="pre-receive"></a>pre-receive</h2><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>åœ¨ä»»ä½•æ–‡ä»¶è¢«æ›´æ–°æ—¶ï¼Œå¦‚æœ<code>$GIT_DIR/hooks/pre-receive</code> å­˜åœ¨å¹¶ä¸”æ˜¯å¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œåˆ™ pre-receive ä¼šè¢«æ— å‚æ•°è§¦å‘æ‰§è¡Œä¸€æ¬¡ï¼Œæ­£å¸¸ pre-receive è§¦å‘æ‰§è¡Œçš„æ—¶å€™ä¼šæ¥æ”¶å¦‚ä¸‹çš„å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sha1-old SP sha1-new SP refname LF</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ sha1-old ä¸ºå¤šæ¬¡ commit çš„æœ€æ—©ä¸€æ¬¡çš„ commit çš„ idï¼Œè€Œ sha1-new åˆ™æ˜¯æœ€æ–°ä¸€æ¬¡çš„ idã€‚é™¤æ­¤ä¹‹å¤–ï¼Œgit push çš„æ—¶å€™è¿˜ä¼šä¼ é€’å…¶ä»–çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ <a href="https://git-scm.com/docs/git-receive-pack#_pre_receive_hook">pre-receive-hooks</a> ã€‚</p><h3 id="æ ¡éªŒæ–¹æ³•"><a href="#æ ¡éªŒæ–¹æ³•" class="headerlink" title="æ ¡éªŒæ–¹æ³•"></a>æ ¡éªŒæ–¹æ³•</h3><p>é€šè¿‡ <code>git log old-commit-ID new-commit-ID -pretty=format:%s</code> æå–å‡ºä¿©ä¸ª commit ä¹‹é—´çš„æ‰€æœ‰ commit-msg ç„¶åé€ä¸€æ ¡éªŒã€‚</p><p><img src="https://www.leetao94.cn/post-images/1637280064019.png"></p><p>è€ƒè™‘æ˜“ç”¨æ€§ï¼Œç”¨ golang æ„å»ºæ ¡éªŒè„šæœ¬</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line"><span class="string">&quot;regexp&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CommitTypeConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">commitTypeList []<span class="keyword">string</span></span><br><span class="line">strictMode     <span class="keyword">bool</span> <span class="comment">// ä¸¥æ ¼æ¨¡å¼ä¸‹å°†æ ¡éªŒæ‰€æœ‰çš„æäº¤ä¿¡æ¯æ ¼å¼(å¤š commit ä¸‹)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkFailedMeassge = <span class="string">`</span></span><br><span class="line"><span class="string">Commit message æ ¼å¼æ ¡éªŒå¤±è´¥âŒ</span></span><br><span class="line"><span class="string">Commit message æ ¼å¼å¿…é¡»ç¬¦åˆä¸‹è¿°è§„åˆ™:</span></span><br><span class="line"><span class="string">    ^(\w+)(\(\w+\))*: (.+)|^Merge\ branch(.*)|^Merge\ remote-tracking branch(.*)</span></span><br><span class="line"><span class="string">Example:</span></span><br><span class="line"><span class="string">    feat(test): test commit style check.`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ZERO_COMMIT = <span class="string">&quot;0000000000000000000000000000000000000000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">config := CommitTypeConfig&#123;</span><br><span class="line">commitTypeList: []<span class="keyword">string</span>&#123;<span class="string">&quot;feat&quot;</span>, <span class="string">&quot;fix&quot;</span>, <span class="string">&quot;docs&quot;</span>, <span class="string">&quot;style&quot;</span>, <span class="string">&quot;refactor&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;chore&quot;</span>, <span class="string">&quot;perf&quot;</span>, <span class="string">&quot;hotfix&quot;</span>&#125;,</span><br><span class="line">strictMode:     <span class="literal">true</span>&#125;</span><br><span class="line">input, _ := ioutil.ReadAll(os.Stdin)</span><br><span class="line">param := strings.Fields(<span class="keyword">string</span>(input))</span><br><span class="line"><span class="comment">// allow branch/tag delete</span></span><br><span class="line"><span class="keyword">if</span> param[<span class="number">1</span>] == ZERO_COMMIT &#123;</span><br><span class="line">os.Exit(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> isExists(<span class="string">&quot;pre-receive.json&quot;</span>) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ£€æµ‹åˆ°å­˜åœ¨é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶è§„åˆ™ğŸ’ª&quot;</span>)</span><br><span class="line">file, _ := ioutil.ReadFile(<span class="string">&quot;pre-receive.json&quot;</span>)</span><br><span class="line">tmpConfig := CommitTypeConfig&#123;&#125;</span><br><span class="line">err := json.Unmarshal([]<span class="keyword">byte</span>(file), &amp;tmpConfig)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æˆåŠŸåŠ è½½é…ç½®æ–‡ä»¶è§„åˆ™ğŸ˜Š&quot;</span>)</span><br><span class="line">config = tmpConfig</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;åŠ è½½é…ç½®æ–‡ä»¶è§„åˆ™å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è§„åˆ™æ–‡ä»¶ğŸ˜­&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;å¼€å§‹åŠ è½½é»˜è®¤é…ç½®æ–‡ä»¶è§„åˆ™ğŸ’ª&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">commitMsg := getCommitMsg(param[<span class="number">0</span>], param[<span class="number">1</span>])</span><br><span class="line">checkCommitMsg(commitMsg, config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getCommitMsg</span><span class="params">(oldCommitID <span class="keyword">string</span>, commitID <span class="keyword">string</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">s := fmt.Sprintf(<span class="string">&quot;git log %s..%s --pretty=format:%%s&quot;</span>, oldCommitID, commitID)</span><br><span class="line"><span class="keyword">if</span> oldCommitID == ZERO_COMMIT &#123;</span><br><span class="line">s = fmt.Sprintf(<span class="string">&quot;git rev-list --pretty=format:%%s $(git for-each-ref --format=&#x27;%%(refname)&#x27; refs/heads/* | sed &#x27;s/^/\\^/g&#x27;) %s | grep -v ^commit&quot;</span>, commitID)</span><br><span class="line">&#125;</span><br><span class="line">commitMsg := strings.Split(runCmd(s), <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> commitMsg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkFailed</span><span class="params">(tmpStr <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Fprintln(os.Stderr, <span class="string">&quot;===================================&quot;</span>)</span><br><span class="line">fmt.Fprintln(os.Stderr, tmpStr)</span><br><span class="line">fmt.Fprintln(os.Stderr, <span class="string">&quot;===================================&quot;</span>)</span><br><span class="line">fmt.Fprintln(os.Stderr, checkFailedMeassge)</span><br><span class="line">os.Exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isExists</span><span class="params">(path <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">_, err := os.Stat(path)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> os.IsNotExist(err) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è§„åˆ™æ ¡éªŒ</span></span><br><span class="line"><span class="comment">/// @commitMsg []string æäº¤çš„ä¿¡æ¯æ•°ç»„</span></span><br><span class="line"><span class="comment">/// @config è§„åˆ™é…ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkCommitMsg</span><span class="params">(commitMsg []<span class="keyword">string</span>, config CommitTypeConfig)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> CommitMessagePattern = <span class="string">`^(\w+)(\(\w+\))*: (.+)|^Merge\ branch(.*)|^Merge\ remote-tracking branch(.*)`</span></span><br><span class="line"><span class="keyword">var</span> commitMsgReg = regexp.MustCompile(CommitMessagePattern)</span><br><span class="line"><span class="keyword">for</span> _, tmpStr := <span class="keyword">range</span> commitMsg &#123;</span><br><span class="line"><span class="keyword">if</span> strings.Trim(tmpStr, <span class="string">&quot; &quot;</span>) == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">commitTypes := commitMsgReg.FindAllStringSubmatch(tmpStr, <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(commitTypes) != <span class="number">1</span> &#123;</span><br><span class="line">checkFailed(tmpStr)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> !strings.HasPrefix(tmpStr, <span class="string">&quot;Merge&quot;</span>) &amp;&amp; !stringInSlice(commitTypes[<span class="number">0</span>][<span class="number">1</span>], config.commitTypeList) &#123;</span><br><span class="line">checkFailed(tmpStr)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !config.strictMode &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ­å–œğŸ‰ï¼Œcommit message æ ¡éªŒé€šè¿‡âœ…&quot;</span>)</span><br><span class="line">os.Exit(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ­å–œğŸ‰ï¼Œcommit message æ ¡éªŒé€šè¿‡âœ…&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stringInSlice</span><span class="params">(a <span class="keyword">string</span>, list []<span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, b := <span class="keyword">range</span> list &#123;</span><br><span class="line"><span class="keyword">if</span> b == a &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runCmd</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, s)</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line">r, err := cmd.Output()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Run command failed, [%s]\nerr: %s&quot;</span>, s, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶æ”¯æŒæ·»åŠ é…ç½®æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;commitTypeList&quot;</span>:[ <span class="comment">// æ”¯æŒçš„ commitType</span></span><br><span class="line">        <span class="string">&quot;feat&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fix&quot;</span>,</span><br><span class="line">        <span class="string">&quot;docs&quot;</span>,</span><br><span class="line">        <span class="string">&quot;style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;refactor&quot;</span>,</span><br><span class="line">        <span class="string">&quot;test&quot;</span>,</span><br><span class="line">        <span class="string">&quot;chore&quot;</span>,</span><br><span class="line">        <span class="string">&quot;perf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hotfix&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;strictMode&quot;</span>: <span class="literal">true</span> <span class="comment">// ä¸¥æ ¼æ¨¡å¼ä¼šæ ¡éªŒå¤šæ¬¡ commit çš„æ‰€æœ‰ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡å™¨é…ç½®-pre-receive"><a href="#æœåŠ¡å™¨é…ç½®-pre-receive" class="headerlink" title="æœåŠ¡å™¨é…ç½® pre-receive"></a>æœåŠ¡å™¨é…ç½® pre-receive</h2><p>å‚è€ƒ <a href="https://docs.gitlab.com/ee/administration/server_hooks.html">Server Hooks</a> éœ€è¦å°†ç¼–è¯‘å <code>pre-receive</code> æ”¾åˆ°åˆ¶å®šçš„ repository çš„é’©å­ç›®å½•å³å¯ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹:</p><ol><li>æ‰¾åˆ°å¯¹åº” repository çš„ <code>.git</code> ç›®å½•</li><li>åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º <code>custom_hooks</code> çš„ç›®å½•</li><li>å°†ç¼–è¯‘åçš„ <code>pre-receive</code> æ”¾åˆ°è¯¥ç›®å½•ä¸‹(å¦‚æœæœ‰é…ç½®æ–‡ä»¶ä¹Ÿä¸Šä¼ åˆ°è¯¥ç›®å½•ä¸‹)</li><li>é€šè¿‡ <code>chmod +x pre-receive</code> è®©è¯¥æ–‡ä»¶å¯æ‰§è¡Œï¼ŒåŒæ—¶å°†è¯¥æ–‡ä»¶çš„ç”¨æˆ·ç»„åˆ‡æ¢ä¸º <code>git:git</code></li><li>æ¨é€ä»£ç éªŒè¯ç»“æœ</li></ol><p><img src="https://www.leetao94.cn/post-images/1637280076441.png" alt="pre-receive-æ ¡éªŒé€šè¿‡ç»“æœ"></p><ul><li>å‚è€ƒé“¾æ¥<ul><li><a href="https://git-scm.com/docs/git-receive-pack#_pre_receive_hook">pre-receive-hooks</a></li><li><a href="https://docs.gitlab.com/ee/administration/server_hooks.html">Server Hooks</a></li><li><a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks#_server_side_hooks">Server-Side Hooks</a></li><li><a href="https://feflowjs.com/zh/guide/rule-git-commit.html">Git Commit è§„èŒƒ</a></li><li><a href="https://segmentfault.com/a/1190000009048911">git commit è§„èŒƒæŒ‡å—</a></li><li><a href="https://git-scm.com/docs/git-commit">git-commit</a></li><li><a href="https://zhuanlan.zhihu.com/p/182553920">å¦‚ä½•è§„èŒƒä½ çš„Git commitï¼Ÿ</a></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·æ—¶ï¼Œæ¯æ¬¡æ–‡ä»¶å‘ç”Ÿä¿®æ”¹çš„æ—¶å€™æäº¤éƒ½éœ€è¦ &lt;code&gt;git commit&lt;/code&gt; å‘½ä»¤å»è®°å½•æœ¬æ¬¡çš„ä¿®æ”¹ï¼Œ</summary>
      
    
    
    
    
    <category term="gitflow" scheme="https://leetaogoooo.github.io/tags/gitflow/"/>
    
  </entry>
  
  <entry>
    <title>æ»´æ»´è¡Œç¨‹åˆ†äº« Api</title>
    <link href="https://leetaogoooo.github.io/2021/09/25/8p6b-bIBf/"/>
    <id>https://leetaogoooo.github.io/2021/09/25/8p6b-bIBf/</id>
    <published>2021-09-25T08:38:40.000Z</published>
    <updated>2022-04-12T07:10:22.019Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†äº«ä¸€ä¸ªå¾ˆä¹…ä¹‹å‰å†™çš„ä¸€ä¸ªå…³äºæ»´æ»´è¡Œç¨‹çš„è„šæœ¬ï¼Œè„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®æ»´æ»´è¡Œç¨‹åˆ†äº«çš„ url è·å–è®¢å•æƒ…å†µï¼Œé€šè¿‡å®šæ—¶è½®è¯¢è¿˜å¯ä»¥è·å–ä¹˜å®¢åˆ°ç›®çš„åœ°çš„è·ç¦»å’Œæ—¶é—´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">@File    :   didi.py    </span></span><br><span class="line"><span class="string">@Descriptionï¼šæ»´æ»´è¡Œç¨‹åˆ†äº« Api</span></span><br><span class="line"><span class="string">@Modify Time      @Author    @Version    @Description</span></span><br><span class="line"><span class="string">------------      -------    --------    -----------</span></span><br><span class="line"><span class="string">2021/5/29 8:47 ä¸Šåˆ   leetao      1.0         None</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse <span class="keyword">as</span> urlparse</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> parse_qs</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, asdict</span><br><span class="line"></span><br><span class="line">_header = &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json, text/plain, */*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.77 Safari/537.36&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DidiOrderParams</span>:</span></span><br><span class="line">    uid: <span class="built_in">str</span></span><br><span class="line">    oid: <span class="built_in">str</span></span><br><span class="line">    sign: <span class="built_in">str</span></span><br><span class="line">    productType: <span class="built_in">str</span></span><br><span class="line">    carProductid: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_didi</span>(<span class="params">url: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">    <span class="keyword">return</span> url.startswith(<span class="string">&quot;https://z.didi.cn&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_order_params</span>(<span class="params">url: <span class="built_in">str</span></span>) -&gt; DidiOrderParams:</span></span><br><span class="line">    resp = requests.get(url, allow_redirects=<span class="literal">False</span>, headers=_header)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code == <span class="number">302</span>:</span><br><span class="line">        redirect_url = resp.headers[<span class="string">&#x27;location&#x27;</span>]</span><br><span class="line">        parsed = urlparse.urlparse(redirect_url)</span><br><span class="line">        params = parse_qs(parsed.query)</span><br><span class="line">        <span class="keyword">return</span> DidiOrderParams(uid=params[<span class="string">&#x27;uid&#x27;</span>], oid=params[<span class="string">&#x27;oid&#x27;</span>], sign=params[<span class="string">&#x27;sign&#x27;</span>],</span><br><span class="line">                               productType=params[<span class="string">&#x27;productType&#x27;</span>], carProductid=params[<span class="string">&#x27;carProductid&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_order_info</span>(<span class="params">order_param: DidiOrderParams</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">    resp = requests.get(<span class="string">&#x27;https://common.diditaxi.com.cn/webapp/sharetrips/page/getOrderStatus&#x27;</span>,</span><br><span class="line">                        params=asdict(order_param), headers=_header)</span><br><span class="line">    <span class="keyword">assert</span> resp.status_code == <span class="number">200</span></span><br><span class="line">    resp_json = resp.json()</span><br><span class="line">    <span class="keyword">assert</span> resp_json[<span class="string">&#x27;errno&#x27;</span>] == <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;æœ¬æ¬¡è¡Œç¨‹ \n èµ·ç‚¹ï¼š<span class="subst">&#123;resp_json[<span class="string">&quot;fromAddress&quot;</span>]&#125;</span> \n ç»ˆç‚¹: <span class="subst">&#123;resp_json[<span class="string">&quot;toAddress&quot;</span>]&#125;</span> \n æ‚¨çš„è¡Œç¨‹ç®¡å®¶å°†å®šæ—¶ä¸ºæ‚¨æ’­æŠ¥è¡Œç¨‹æƒ…å†µ&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_driver_loc</span>(<span class="params">order_param: DidiOrderParams</span>):</span></span><br><span class="line">    resp = requests.get(<span class="string">&#x27;https://common.diditaxi.com.cn/webapp/sharetrips/page/getDriverLoc&#x27;</span>,params=asdict(order_param),</span><br><span class="line">                        headers=_header)</span><br><span class="line">    <span class="keyword">assert</span> resp.status_code == <span class="number">200</span></span><br><span class="line">    resp_json = resp.json()</span><br><span class="line">    <span class="keyword">assert</span> resp_json[<span class="string">&#x27;errno&#x27;</span>] == <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;etaDistance&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> resp_json:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;æœ¬æ¬¡è¡Œç¨‹å·²ç»ç»“æŸ&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;è·ç¦»ç›®çš„åœ°è¿˜æœ‰ï¼š<span class="subst">&#123;resp_json[<span class="string">&quot;etaDistance&quot;</span>]&#125;</span> å…¬é‡Œï¼Œé¢„è®¡è¿˜æœ‰ï¼š<span class="subst">&#123;resp_json[<span class="string">&quot;etaTime&quot;</span>]&#125;</span> åˆ†é’Ÿ&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åˆ†äº«ä¸€ä¸ªå¾ˆä¹…ä¹‹å‰å†™çš„ä¸€ä¸ªå…³äºæ»´æ»´è¡Œç¨‹çš„è„šæœ¬ï¼Œè„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ˜¯æ ¹æ®æ»´æ»´è¡Œç¨‹åˆ†äº«çš„ url è·å–è®¢å•æƒ…å†µï¼Œé€šè¿‡å®šæ—¶è½®è¯¢è¿˜å¯ä»¥è·å–ä¹˜å®¢åˆ°ç›®çš„åœ°çš„è·ç¦»å’Œæ—¶é—´&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gut</summary>
      
    
    
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
    <category term="çˆ¬è™«" scheme="https://leetaogoooo.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>å¼€å¯äººç”Ÿçš„æ–°çš„é˜¶æ®µ</title>
    <link href="https://leetaogoooo.github.io/2021/09/23/jVldsA6pc/"/>
    <id>https://leetaogoooo.github.io/2021/09/23/jVldsA6pc/</id>
    <published>2021-09-23T10:55:35.000Z</published>
    <updated>2022-04-12T07:10:22.050Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è¦ä¸è¦æ¢ä¸ªæ–°çš„åŸå¸‚å¼€å§‹æ–°çš„ç”Ÿæ´»ï¼Ÿ</p></blockquote><p>è¿™æ˜¯ä»Šå¹´ä¸€ç›´ç›˜æ—‹åœ¨æˆ‘è„‘æµ·é‡Œçš„æƒ³æ³•ã€‚æƒ³æ³•åˆ°è½åœ°ä¸­é—´å¹¶ä¸æ˜¯ç®€å•çš„ 1 + 1 çš„é—®é¢˜ï¼Œä¿©è€…ä¹‹é—´éš”ç€å·¨å¤§çš„é¸¿æ²Ÿï¼Œå› ä¸ºè¿™æ„å‘³ç€å¯èƒ½ä¸€åˆ‡éƒ½éœ€è¦é‡æ–°å¼€å§‹ã€‚</p><p>ä»é›¶å¼€å§‹å¹¶ä¸æ˜¯æƒ³è±¡çš„é‚£ä¹ˆç®€å•ï¼Œéœ€è¦ç¦»å¼€ä»å¤§å­¦å¼€å§‹å°±ä¸€ç›´ç”Ÿæ´»çš„åŸå¸‚ï¼Œä¸€ä¸ªå¯¹æˆ‘æ¥è¯´ç”Ÿæ´»äº†å…«å¹´å¤šçš„åœ°æ–¹ï¼Œç¦»å¼€ç†Ÿæ‚‰çš„å¤©ç©ºã€ç†Ÿæ‚‰çš„è¡—é“ã€ç†Ÿæ‚‰çš„äººå’Œç†Ÿæ‚‰çš„å·¥ä½œç¯å¢ƒã€‚è®°å¾—ä¸Šæ¬¡æœ‰è¿™ç§æƒ³æ³•çš„æ—¶å€™ï¼Œæ˜¯åˆšæ¯•ä¸šä¸€å¹´å¤šçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯å››å¹´å‰ï¼Œå¾ˆé—æ†¾ï¼Œé‚£ä¸ªæ—¶å€™ä¸€ä¸ªäººçš„å‹‡æ°”å¹¶ä¸èƒ½å¤Ÿæ”¯æ’‘ç€æˆ‘èƒŒèµ·è¡Œå›Šæ½‡æ´’åœ°ç¦»å¼€è¿™é‡Œã€‚</p><p>æ˜¯çš„ï¼Œæ²¡é”™ï¼Œè¿™æ¬¡ç¦»å¼€ï¼Œæ˜¯ä¸¤ä¸ªäººä¸€èµ·ã€‚ä¸¤ä¸ªäººèƒ½å¤Ÿåœ¨è¿™ç§äº‹æƒ…ä¸Šè¾¾æˆä¸€è‡´çš„æƒ³æ³•ï¼Œæ˜¯ä½•å…¶å¹¸è¿çš„äº‹æƒ…ã€‚åœ¨è¿™é‡Œè¿™äº›å¹´æœ€å¤§çš„æ”¶è·ï¼Œå°±æ˜¯æ”¶è·äº†çˆ±æƒ…ï¼Œåœ¨å¼€å§‹æ–°çš„é˜¶æ®µçš„æ—¶å€™ï¼Œæœ‰äººä¸æˆ‘åŒè¡Œã€‚</p><p>å‹‡æ°”æ˜¯æ‰“å¼€æ–°çš„é˜¶æ®µçš„é’¥åŒ™çš„è¯ï¼Œé‚£ä¹ˆæ‰¾å·¥ä½œå°±æ˜¯åˆ°è¾¾ç»ˆç‚¹å‰çš„â€œæ‹¦è·¯è™â€äº†ã€‚</p><p>ç”±äºè‡ªå·±è¿˜å¤„äºåœ¨èŒçŠ¶æ€ï¼Œæ‰€ä»¥æ‰€æœ‰çš„é¢è¯•åŸºæœ¬ä¸Šéƒ½åªèƒ½çº¦åœ¨ä¸‹ç­ä¹‹åäº†ï¼Œè‡ªç„¶é¢è¯•å‰éƒ½å‡†å¤‡å·¥ä½œä¹ŸåŒæ ·åªèƒ½æ”¾åœ¨ä¸‹ç­ä¹‹åäº†ã€‚äººç”Ÿæœ€è®©äººè§‰å¾—ï¼ˆæœ‰è¶£ï¼‰æ— å¥ˆçš„äº‹æƒ…å°±æ˜¯ï¼Œä½ è¶Šä¸æƒ³äº‹æƒ…å¤šçš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šä½ çš„äº‹æƒ…å°±ä¼šè¶Šæ¥è¶Šå¤šã€‚æ°å·§å¼€å§‹å‡†å¤‡å¤ä¹ çš„æ—¶å€™ï¼Œè´Ÿè´£çš„é¡¹ç›®éœ€è¦æ¼”ç¤ºæ±‡æŠ¥ï¼Œè€Œè¿™ä¸ªæ—¶å€™éƒ‘å·åˆèµ¶ä¸Šäº†æš´é›¨åŠ ç–«æƒ…ï¼Œæ‰€è°“çš„â€œæ¶ç–«ç»“æ ¸â€ï¼Œä¸€ä¸ªå¤šæœˆçš„è¶³ä¸å‡ºæˆ·çš„ç”Ÿæ´»ï¼Œè¿˜æœ‰çˆ·çˆ·çš„ç¦»å¼€ã€‚</p><p>å› ä¸ºç–«æƒ…çš„åŸå› ï¼Œæœ‰ä¸€ä¸¤å¹´æ²¡æœ‰å›è€å®¶äº†ï¼Œæ²¡æƒ³åˆ°å†æ¬¡å›å»å°±æ˜¯æ”¶åˆ°çˆ·çˆ·ç—…é‡çš„æ¶ˆæ¯ï¼Œç´§æ¥ç€å°±æ˜¯åœ¨æš´é›¨å’Œç–«æƒ…æœŸé—´è¢«å‘ŠçŸ¥çˆ·çˆ·ç¦»å¼€çš„æ¶ˆæ¯ï¼Œæˆ‘è®°å¾—é‚£å¤©çš„æ²¡æœ‰ä¸‹é›¨ï¼Œå¤©æ¯”è¾ƒé˜´æ²‰ï¼Œæˆ‘ååœ¨æ²™å‘ä¸Šæ¥åˆ°è€çˆ¸æ‰“æ¥çš„ç”µè¯ï¼Œè¯´çš„ä»€ä¹ˆæˆ‘å·²ç»è®°ä¸æ¸…äº†ï¼Œæˆ‘åªè®°å¾—æŒ‚æ–­ç”µè¯ä¹‹åï¼Œçœ¼æ³ªä¸ç”±è‡ªä¸»åœ°æµäº†ä¸‹æ¥ã€‚</p><p>é‚£ä¸ªæ—¶å€™ï¼Œæˆ‘æ‰åˆ‡èº«ä½“ä¼šé“ä»€ä¹ˆå«åšç´§ç»·ç€çš„å¼¦ï¼Œæ‰€æœ‰çš„äº‹æƒ…éƒ½åœ¨ä¸åœåœ°æ‹‰æ‰¯ç€ç¥ç»ã€‚æ•´ä¸ªäººå˜å¾—æœ‰ç‚¹ç„¦è™‘ï¼Œç„¦è™‘åˆ°å¤œé‡Œç¡ä¸ç€ï¼Œç„¦è™‘åˆ°ä¸€ä¸ªå¤šæœˆç˜¦äº†6-7æ–¤ï¼Œç„¦è™‘åˆ°èŒ¶é¥­ä¸æ€ã€‚å¾ˆéš¾æƒ³è±¡å¦‚æœè¿™ä¸ªæ—¶å€™æ²¡æœ‰æˆ‘çš„å¦ä¸€åŠä¸€ç›´é™ªç€æˆ‘ï¼Œæˆ‘è¯¥å¦‚ä½•åº¦è¿‡è¿™ä¸€é˜¶æ®µã€‚</p><p>æ½®èµ·æ—¥è½ï¼Œæ—¥å­æ€»æ˜¯ä¸€å¤©ä¸€å¤©åœ¨æŒ‡å°–åˆ’è¿‡ã€‚åº¦è¿‡æœ€éš¾è¿‡çš„ä¸€æ®µæ—¶å…‰ï¼Œåé¢çš„é¢è¯•é™¤äº†æ—¶é—´ä¸Šæ¯”è¾ƒç´§å‡‘ï¼Œé¢è¯•åé¢è¿˜æ˜¯æ¯”è¾ƒé¡ºåˆ©çš„ã€‚å·¥ä½œäº†äº”å¹´ä¹‹åï¼Œå†æ¬¡æ”¶è·äº†ä¸€ä»½æ»¡æ„çš„ offerï¼Œå¾ˆå¿«å°±è¦å»æ–°çš„åŸå¸‚å¼€å§‹æ–°çš„ç”Ÿæ´»äº†ã€‚ä½ è¯´æˆ‘ç°åœ¨çš„å¿ƒæƒ…æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæœ‰å‘å¾€ï¼Œä¹Ÿæœ‰ç´§å¼ ï¼Œå‘å¾€å…¨æ–°çš„ç”Ÿæ´»ï¼Œå¯¹æ–°çš„å¼€å§‹éš¾å…æœ‰ç‚¹å½·å¾¨å’Œç´§å¼ ã€‚</p><p>æœ€è¿‘å¤„äºç¦»èŒçš„é˜¶æ®µï¼Œä¹Ÿç®—æ˜¯é—²äº†ä¸‹æ¥ï¼Œå¯ä»¥å¶å°”è·‘è·‘æ­¥ã€çœ‹çœ‹ä¹¦ï¼Œå‰å‡ å¤©æ™šä¸Šè¿˜æŠŠè—åœ¨æŸœå­é‡Œæ·±å¤„çš„å°¤å…‹é‡Œé‡Œç¿»äº†å‡ºæ¥ï¼Œä¹…è¿çš„è½»æ¾æƒ¬æ„ï¼Œå¸Œæœ› 2021 å¹´æ¥ä¸‹æ¥çš„æ—¥å­éƒ½é¡ºé¡ºåˆ©åˆ©çš„ã€‚</p><p><img src="https://www.leetao94.cn/post-images/1632399527176.jpg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è¦ä¸è¦æ¢ä¸ªæ–°çš„åŸå¸‚å¼€å§‹æ–°çš„ç”Ÿæ´»ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ä»Šå¹´ä¸€ç›´ç›˜æ—‹åœ¨æˆ‘è„‘æµ·é‡Œçš„æƒ³æ³•ã€‚æƒ³æ³•åˆ°è½åœ°ä¸­é—´å¹¶ä¸æ˜¯ç®€å•çš„ 1 + 1 çš„é—®é¢˜ï¼Œä¿©è€…ä¹‹é—´éš”ç€å·¨å¤§çš„é¸¿æ²Ÿï¼Œå› ä¸ºè¿™æ„å‘³ç€å¯èƒ½ä¸€åˆ‡éƒ½éœ€è¦é‡æ–°å¼€å§‹ã€‚&lt;/p&gt;
&lt;p&gt;ä»é›¶å¼€å§‹å¹¶ä¸æ˜¯</summary>
      
    
    
    
    
    <category term="æœèŠ±å¤•æ‹¾" scheme="https://leetaogoooo.github.io/tags/%E6%9C%9D%E8%8A%B1%E5%A4%95%E6%8B%BE/"/>
    
  </entry>
  
  <entry>
    <title>Python ä¸­ assert çš„æœ€ä½³å®è·µ</title>
    <link href="https://leetaogoooo.github.io/2021/09/16/VXzqfuZ3G/"/>
    <id>https://leetaogoooo.github.io/2021/09/16/VXzqfuZ3G/</id>
    <published>2021-09-16T12:12:21.000Z</published>
    <updated>2022-04-12T07:10:22.043Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åŸæ–‡è¿æ¥ï¼š <a href="https://archive.is/5GfiG">When to use assert</a></p></blockquote><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>assert</code> åˆç§°ä¸ºæ–­è¨€ï¼Œåœ¨ Python ä»£ç ä¸­ç»å¸¸è¢«ä½¿ç”¨ï¼Œä½†æ˜¯æ˜¾ç„¶ä¹Ÿå­˜åœ¨æ»¥ç”¨çš„æƒ…å†µã€‚é‚£ä¹ˆåœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ <code>assert</code> å‘¢ï¼Ÿåˆæˆ–è€… <code>assert</code> çš„æœ€ä½³å®è·µæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><h1 id="assert-çš„ä½¿ç”¨"><a href="#assert-çš„ä½¿ç”¨" class="headerlink" title="assert çš„ä½¿ç”¨"></a>assert çš„ä½¿ç”¨</h1><p>Python çš„ <code>assert</code> é€šå¸¸ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªæ¡ä»¶ï¼Œå¦‚æœå®ƒæ˜¯çœŸçš„ï¼Œåˆ™ä¸åšä»»ä½•äº‹æƒ…ï¼Œå¦‚æœå®ƒæ˜¯å‡çš„ï¼Œåˆ™å¼•å‘ä¸€ä¸ª AssertionErrorï¼Œå¹¶ç»™å‡ºä¸€ä¸ªå¯é€‰çš„é”™è¯¯ä¿¡æ¯:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">py&gt; x = <span class="number">23</span></span><br><span class="line">py&gt; <span class="keyword">assert</span> x &gt; <span class="number">0</span>, <span class="string">&quot;x is not zero or negative&quot;</span></span><br><span class="line">py&gt; <span class="keyword">assert</span> x%<span class="number">2</span> == <span class="number">0</span>, <span class="string">&quot;x is not an even number&quot;</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AssertionError: x <span class="keyword">is</span> <span class="keyword">not</span> an even number</span><br></pre></td></tr></table></figure><p>è®¸å¤šäººå–œæ¬¢é€šè¿‡ <code>assert</code> æ¥ç®€å•åœ°å¿«é€Ÿåœ°è§¦å‘å¼‚å¸¸ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(x, <span class="built_in">int</span>):</span><br><span class="line">    <span class="keyword">raise</span> AssertionError(<span class="string">&quot;not an int&quot;</span>)</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ£€éªŒå‚æ•°ï¼Œå¹¶æŠ›å‡º <code>AssertionError</code> ï¼Œå®é™…ä¸Šï¼Œè¿™ç§åšæ³•æ˜¯é”™è¯¯çš„ï¼Œå¹¶ä¸”è¿˜å¾ˆå±é™©ã€‚æ­£ç¡®çš„åšæ³•æ˜¯åº”è¯¥æŠ›å‡ºä¸€ä¸ª <code>TypeError</code> ã€‚</p><p>ä¹‹æ‰€ä»¥å±é™©æ˜¯è‹±æ–‡ï¼Œ<code>assert</code>  æœ‰ä¸€ä¸ªç‰¹æ€§ï¼š<strong>ä½¿ç”¨ <code>-O</code> æˆ– <code>-OO</code> ä¼˜åŒ–æŒ‡ä»¤å»è¿è¡Œ Python çš„è¯ï¼Œå®ƒä¼šè¢«è¢«ç¼–è¯‘æ‰ï¼Œè€Œæ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œã€‚</strong>å½“ä½ èƒ½å¤Ÿæ­£ç¡®ä½¿ç”¨ <code>assert</code> æ—¶ï¼Œè¿™æ˜¯ä¼šæ˜¯ä¸€ä¸ª featureï¼Œä½†å½“ä½¿ç”¨ä¸å½“çš„è¯ï¼Œåˆ™ä¼šå¯¼è‡´ä»£ç åœ¨ä½¿ç”¨ <code>-O</code> æ ‡å¿—è¿è¡Œæ—¶å‡ºé—®é¢˜ã€‚</p><p>æ‰€ä»¥åº”è¯¥åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ assert å‘¢</p><h1 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-assert"><a href="#ä»€ä¹ˆæ—¶å€™ä½¿ç”¨-assert" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ assert"></a>ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ assert</h1><p>åœ¨ä¸‹é¢è¿™å››ç§æƒ…å†µä¸‹éƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>assert</code>:</p><ul><li>é˜²å¾¡æ€§ç¼–ç¨‹ã€‚</li><li>å¯¹ç¨‹åºé€»è¾‘è¿›è¡Œè¿è¡Œæ—¶æ£€æŸ¥ã€‚</li><li>å¥‘çº¦æ£€æŸ¥ï¼ˆå¦‚å‰æ¡ä»¶å’Œåæ¡ä»¶ï¼‰ã€‚</li><li>ç¨‹åºä¸å˜æ€§</li><li>æ£€æŸ¥æ–‡ä»¶</li></ul><p>å¯¹æ–­è¨€çš„çœ‹æ³•å„ä¸ç›¸åŒï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§å¯¹ä»£ç æ­£ç¡®æ€§çš„ä¿¡å¿ƒçš„è¡¨ç°å½¢å¼å§ã€‚å¦‚æœä½ ç¡®å®šä½ çš„ä»£ç æ¯«æ— é—®é¢˜çš„è¯ï¼Œæ˜¾ç„¶æ–­è¨€ï¼ˆ<code>assert</code>ï¼‰æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼Œå®Œå…¨å¯ä»¥æŠŠè¿™äº›æ–­è¨€ç§»é™¤ï¼›å¦‚æœä½ ç¡®å®šæ–­è¨€å¯èƒ½ä¼šè¢«è§¦å‘ï¼Œé‚£ä½ ä¹Ÿå®Œå…¨å¯ä»¥ä¸ç”¨æ–­è¨€ï¼ˆ<code>assert</code>ï¼‰ï¼Œæ¯•ç«Ÿå®ƒåœ¨æŸäº›æƒ…å†µä¸‹è‚¯å®šä¼šç¼–è¯‘æ‰ï¼Œå¯¼è‡´ä½ çš„æ£€æŸ¥è¢«è·³è¿‡ã€‚</p><p>ä»‹äºè¿™ä¸¤ç§æƒ…å†µä¹‹é—´çš„æƒ…å†µæ‰æ˜¯æœ‰è¶£çš„ï¼Œå½“ä½ ç¡®å®šä»£ç æ˜¯æ­£ç¡®çš„ï¼Œä½†åˆä¸å®Œå…¨ç¡®å®šçš„æ—¶å€™ã€‚<br>ä½ ç¡®å®šä»£ç æ˜¯æ­£ç¡®çš„ï¼Œä½†åˆä¸æ˜¯<strong>ç»å¯¹ç¡®å®š</strong>ã€‚æœ‰å¯èƒ½æ¼æ‰ä¸€äº›åœºæ™¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡æ–­è¨€ï¼ˆassertï¼‰è¿›è¡Œè¿è¡Œæ—¶æ£€æŸ¥æœ‰åŠ©äºæˆ‘ä»¬å°½æ—©çš„å‘ç°é”™è¯¯ã€‚</p><p><strong>æ–­è¨€çš„å¦ä¸€ä¸ªç”¨é€”æ˜¯æ£€æŸ¥ç¨‹åºçš„ä¸å˜é‡</strong>ã€‚æ‰€è°“çš„ä¸å˜é‡å°±æ˜¯ä¸€äº›ä½ å¯ä»¥ä¾èµ–çš„çœŸå®æ¡ä»¶ï¼Œé™¤éä¸€ä¸ªé”™è¯¯å¯¼è‡´å®ƒå˜æˆå‡çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªbugï¼Œæœ€å¥½èƒ½å°½æ—©å‘ç°æ‰€ä»¥æˆ‘ä»¬è¦å¯¹å®ƒè¿›è¡Œæµ‹è¯•ï¼Œä½†æˆ‘ä»¬ä¸æƒ³å› ä¸ºè¿™æ ·çš„æµ‹è¯•è€Œé™ä½ä»£ç çš„é€Ÿåº¦ã€‚ä½†æˆ‘ä»¬ä¸æƒ³å› ä¸ºè¿™äº›æµ‹è¯•è€Œä½¿ä»£ç å˜æ…¢ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åœ¨å¼€å‘ä¸­æ‰“å¼€è€Œåœ¨ç”Ÿäº§ä¸­å…³é—­æ–­è¨€ï¼ˆassertï¼‰ã€‚</p><p>ä¸å˜é‡çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œå¦‚æœä½ çš„å‡½æ•°é¢„æœŸä¸€ä¸ªæ•°æ®åº“è¿æ¥æ˜¯ openï¼Œå¹¶æ‰¿è¯ºå®ƒåœ¨è¿”å›æ—¶ä»ç„¶æ˜¯openï¼Œè¿™å°±æ˜¯å‡½æ•°çš„ä¸€ä¸ªä¸å˜å¼ã€‚open å°±æ˜¯è¯¥å‡½æ•°çš„ä¸€ä¸ªä¸å˜é‡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">some_function</span>(<span class="params">arg</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> DB.closed()</span><br><span class="line">    ... <span class="comment"># code goes here</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> DB.closed()</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>æ–­è¨€ä¹Ÿæ˜¯å¾ˆå¥½çš„æ£€æŸ¥æ€§è¯„è®ºï¼Œè€Œä¸æ˜¯å†™ä¸€ä¸ªè¯„è®ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># when we reach here, we know that n &gt; 2</span></span><br><span class="line"><span class="comment"># æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶è½¬æ¢ä¸ºæ–­è¨€æ¥ç¡®ä¿åœ¨è¿è¡Œæ—¶å¯¹å…¶è¿›è¡Œæ£€æŸ¥</span></span><br><span class="line"><span class="keyword">assert</span> n &gt; <span class="number">2</span></span><br></pre></td></tr></table></figure><p><strong>æ–­è¨€ä¹Ÿæ˜¯é˜²å¾¡æ€§ç¼–ç¨‹çš„ä¸€ç§å½¢å¼</strong>ã€‚ä½ ä¸æ˜¯åœ¨ä¿æŠ¤ç°åœ¨çš„ä»£ç ä¸­çš„é”™è¯¯ï¼Œè€Œæ˜¯åœ¨ä¿æŠ¤ä»¥åå¼•å…¥é”™è¯¯çš„å˜åŒ–ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå•å…ƒæµ‹è¯•ä¼šå‘ç°è¿™äº›é”™è¯¯ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œå³ä½¿å­˜åœ¨æµ‹è¯•ï¼Œå®ƒä»¬ä¹Ÿæ˜¯å¾€å¾€æ˜¯ä¸å®Œæ•´çš„ã€‚æœ‰å¯èƒ½åœ¨å‡ å‘¨å†…éƒ½æ²¡æœ‰äººæ³¨æ„åˆ°æ„å»ºæœºå™¨äººï¼Œæˆ–è€…æœ‰çš„æ—¶å€™åœ¨æäº¤ä»£ç å‰å¿˜è®°è¿è¡Œæµ‹è¯•ã€‚æœ‰ä¸€ä¸ªå†…éƒ¨æ£€æŸ¥æ˜¯é˜²æ­¢é”™è¯¯æ½œå…¥çš„å¦ä¸€é“é˜²çº¿ï¼Œç‰¹åˆ«æ˜¯é˜»æ­¢é‚£äº›ä¼šå¯¼è‡´ä»£ç æ•…éšœå’Œè¿”å›é”™è¯¯ç»“æœçš„é™é»˜é”™è¯¯ã€‚</p><p>å‡è®¾ä½ æœ‰ä¸ªä»£ç ä¸­æœ‰ ifâ€¦elif ä»£ç å—ï¼Œè¿™ä¸ªæ—¶å€™ä½ æ˜¯çŸ¥é“è¿™äº›åˆ†æ”¯å¯¹åº”äº†å“ªäº›å˜é‡ï¼Œå¹¶ä¸”äº†è§£é€»è¾‘æ˜¯ä»€ä¹ˆ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># target is expected to be one of x, y, or z, and nothing else.</span></span><br><span class="line"><span class="keyword">if</span> target == x:</span><br><span class="line">    run_x_code()</span><br><span class="line"><span class="keyword">elif</span> target == y:</span><br><span class="line">    run_y_code()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    run_z_code()</span><br></pre></td></tr></table></figure><p>å‡è®¾è¿™ä¸ªä»£ç ç°åœ¨æ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚ä½†å®ƒä¼šä¸€ç›´æ­£ç¡®å—ï¼Ÿéœ€æ±‚æ”¹å˜äº†,ä»£ç ä¹Ÿä¼šæ”¹å˜ã€‚ç°åœ¨è¦æ±‚æ”¹å˜ä¸ºå½“ target == wï¼Œæ‰§è¡Œ run_w_codeã€‚å¦‚æœæˆ‘ä»¬æ”¹å˜äº†è®¾ç½®ç›®æ ‡çš„ä»£ç ï¼Œä½†å¿½ç•¥äº†æ”¹å˜è¿™ä¸ªä»£ç å—ï¼Œå®ƒå°†é”™è¯¯åœ°è°ƒç”¨ run_z_code()ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">target = w</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="keyword">if</span> target == x:</span><br><span class="line">    run_x_code()</span><br><span class="line"><span class="keyword">elif</span> target == y:</span><br><span class="line">    run_y_code()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    run_z_code()</span><br></pre></td></tr></table></figure><p>æœ€å¥½æ˜¯æŠŠè¿™æ®µä»£ç å†™æˆé˜²å¾¡æ€§çš„ï¼Œå“ªæ€•ä¹‹åæœ‰å˜åŒ–ï¼Œå®ƒä¹Ÿæ˜¯è¦ä¹ˆæ˜¯æ­£ç¡®çš„ï¼Œè¦ä¹ˆç«‹å³å¤±è´¥ã€‚</p><p>å†™ä»£ç å—ä¸€å¼€å§‹åŠ æ³¨é‡Šæ˜¯å¾ˆå¥½çš„ä¹ æƒ¯ï¼Œä½†æ˜¯é€šå¸¸æ—¶é—´ä¹…äº†ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰é˜…è¯»å’Œæ›´æ–°æ³¨é‡Šçš„ä¹ æƒ¯ã€‚æœ‰å¯èƒ½æ³¨é‡Šå¾ˆå¿«å°±ä¼šè¢«æ·˜æ±°ã€‚ä½†é€šè¿‡ä¸€ä¸ªæ–­è¨€ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥è®°å½•è¿™ä¸ªå—çš„å‡è®¾ï¼Œä¹Ÿå¯ä»¥åœ¨æ–­è¨€æ£€éªŒæ²¡é€šè¿‡çš„æ—¶å€™ç›´æ¥æŠ›å‡ºé”™è¯¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> target <span class="keyword">in</span> (x, y, z)</span><br><span class="line"><span class="keyword">if</span> target == x:</span><br><span class="line">    run_x_code()</span><br><span class="line"><span class="keyword">elif</span> target == y:</span><br><span class="line">    run_y_code()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">assert</span> target == z</span><br><span class="line">    run_z_code()</span><br></pre></td></tr></table></figure><p>æ–­è¨€æ—¢æ˜¯é˜²å¾¡æ€§ç¼–ç¨‹ï¼Œä¹Ÿæ˜¯ç»è¿‡æ£€æŸ¥çš„æ–‡æ¡£ï¼Œä¸‹é¢è¿™ä¸ªä»£ç ä¼šæ›´å¥½ä¸€ç‚¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> target == x:</span><br><span class="line">    run_x_code()</span><br><span class="line"><span class="keyword">elif</span> target == y:</span><br><span class="line">    run_y_code()</span><br><span class="line"><span class="keyword">elif</span> target == z:</span><br><span class="line">    run_z_code()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># This can never happen. But just in case it does...</span></span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;an unexpected error occurred&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>å¥‘çº¦è®¾è®¡æ˜¯å¦ä¸€ç§å¯¹æ–­è¨€çš„ä¸é”™çš„åº”ç”¨</strong>ã€‚åœ¨æŒ‰å¥‘çº¦è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬è®¤ä¸ºå‡½æ•°ä¸å®ƒä»¬çš„è°ƒç”¨è€…ç­¾è®¢äº† â€œå¥‘çº¦â€ã€‚<br>ä¾‹å¦‚,â€å¦‚æœä½ ä¼ é€’ç»™æˆ‘ä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä¿è¯è¿”å›è¯¥å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªçš„ç¬¬ä¸€ä¸ªå­—ç¬¦è½¬æ¢æˆå¤§å†™å­—æ¯â€ã€‚</p><p>å¦‚æœè¿™ä¸ªå¥‘çº¦è¢«å‡½æ•°æˆ–è°ƒç”¨å®ƒçš„ä»£ç æ‰€ç ´å,ä»£ç å°±æ˜¯æœ‰é—®é¢˜çš„ã€‚æˆ‘ä»¬è¯´ï¼Œå‡½æ•°æœ‰é¢„è®¾æ¡ä»¶ï¼ˆå³<br>å‚æ•°çš„çº¦æŸï¼‰å’Œåç½®æ¡ä»¶ï¼ˆè¿”å›ç»“æœçš„çº¦æŸï¼‰ å› æ­¤ï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½è¢«ä»£ç ä¸ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">first_upper</span>(<span class="params">astring</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(astring, <span class="built_in">str</span>) <span class="keyword">and</span> <span class="built_in">len</span>(astring) &gt; <span class="number">0</span></span><br><span class="line">    result = astring[<span class="number">0</span>].upper()</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(result, <span class="built_in">str</span>) <span class="keyword">and</span> <span class="built_in">len</span>(result) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> result == result.upper()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¥‘çº¦è®¾è®¡çš„ç›®çš„æ˜¯ï¼Œåœ¨ä¸€ä¸ªæ­£ç¡®çš„ç¨‹åºä¸­ï¼Œå‰æ¡ä»¶å’Œåæ¡ä»¶æ€»æ˜¯æˆç«‹çš„ã€‚å½“æˆ‘ä»¬å‘å¸ƒæ— é”™è¯¯çš„ç¨‹åºå¹¶å°†å…¶æŠ•å…¥ç”Ÿäº§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°åˆ é™¤è¿™äº›æ–­è¨€ã€‚</p><h1 id="ä»€ä¹ˆæ—¶å€™ä¸ä½¿ç”¨assert"><a href="#ä»€ä¹ˆæ—¶å€™ä¸ä½¿ç”¨assert" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¸ä½¿ç”¨assert"></a>ä»€ä¹ˆæ—¶å€™ä¸ä½¿ç”¨assert</h1><ul><li>æ°¸è¿œä¸è¦ç”¨å®ƒä»¬æ¥æµ‹è¯•ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œæˆ–è€…ç”¨äºåœ¨ä»»ä½•æƒ…å†µä¸‹å¿…é¡»è¿›è¡Œæ£€æŸ¥çš„åœ°æ–¹ã€‚</li><li>ä¸è¦ç”¨æ–­è¨€æ¥æ£€æŸ¥ä»»ä½•ä½ è®¤ä¸ºåœ¨ä½ çš„ç¨‹åºçš„æ­£å¸¸ä½¿ç”¨ä¸­å¯èƒ½å¤±è´¥çš„ä¸œè¥¿ã€‚æ–­è¨€æ˜¯ä¸ºç‰¹æ®Šå¤±è´¥æ¡ä»¶ã€‚ä½ çš„ç”¨æˆ·ä¸åº”è¯¥çœ‹åˆ° <code>AssertionError</code>ã€‚å¦‚æœä»–ä»¬çœ‹åˆ°äº†ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªéœ€è¦ä¿®å¤çš„é”™è¯¯ã€‚</li><li>ç‰¹åˆ«æ˜¯ï¼Œä¸è¦å› ä¸º <code>assert</code> æ¯”ä¸€ä¸ªæµ‹è¯•å’Œ raise çŸ­å°±ä½¿ç”¨å®ƒã€‚</li><li>ä¸è¦ç”¨å®ƒä»¬æ¥æ£€æŸ¥å…¬å…±åº“çš„è¾“å…¥å‚æ•°å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼Œå› ä¸ºä½ æ— æ³•æ§åˆ¶è°ƒç”¨è€…ï¼Œä¹Ÿä¸èƒ½ä¿è¯å®ƒä¸ä¼šç ´åå‡½æ•°çš„å¥‘çº¦ã€‚</li><li>ä¸è¦å°† <code>assert</code> ç”¨äºä»»ä½•ä½ æœŸæœ›æ¢å¤çš„é”™è¯¯ã€‚ æ¢å¥è¯è¯´ï¼Œä½ æ²¡æœ‰ç†ç”±åœ¨ç”Ÿäº§ä»£ç ä¸­æ•æ‰ä¸€ä¸ª<code>AssertionError</code> å¼‚å¸¸ã€‚</li><li>ä¸è¦ä½¿ç”¨å¤ªå¤šçš„æ–­è¨€ï¼Œä»¥è‡³äºå®ƒä»¬æ©ç›–äº†ä»£ç ã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åŸæ–‡è¿æ¥ï¼š &lt;a href=&quot;https://archive.is/5GfiG&quot;&gt;When to use assert&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlin</summary>
      
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Dataclasses ã€ Attrs å’Œ Pydantic</title>
    <link href="https://leetaogoooo.github.io/2021/09/13/KGYoGNer0/"/>
    <id>https://leetaogoooo.github.io/2021/09/13/KGYoGNer0/</id>
    <published>2021-09-13T10:14:35.000Z</published>
    <updated>2022-04-12T07:10:22.029Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Python3.7 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¨¡å—é‚£å°±æ˜¯ <code>dataclasses</code>ï¼Œæ—©åœ¨ 3.6 ç‰ˆæœ¬çš„æ—¶å€™æˆ‘å°±é€šè¿‡å®‰è£… <code>dataclasses</code> ä¸‰æ–¹åº“ä½“éªŒäº†ä¸€æ³¢ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦ç”¨ <code>dataclasses</code> å‘¢ï¼Ÿ</p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-dataclasses"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-dataclasses" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ dataclasses"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ dataclasses</h2><p>ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼Œå½“ä½ æƒ³å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„å±æ€§çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸€æœ¬ä¹¦ï¼Œé€šå¸¸ä½ ä¼šè¿™æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name: <span class="built_in">str</span>, price: <span class="built_in">float</span>, author:<span class="built_in">str</span> = <span class="string">&quot;ä½šå&quot;</span></span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.price = price</span><br><span class="line">        self.author = author</span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨ä¸å®šä¹‰ <code>__repr__</code> çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡ï¼Œå¹¶è¾“å‡ºçš„è¯:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>book = Book(<span class="string">&#x27;æ¡ƒå­&#x27;</span>,<span class="number">10.0</span>,author=<span class="string">&#x27;æ¡ƒå­&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>book</span><br><span class="line">&lt;__main__.Book <span class="built_in">object</span> at <span class="number">0x10b69cbb0</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span>(book)</span><br><span class="line"><span class="string">&#x27;&lt;__main__.Book object at 0x10b69cbb0&gt;&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">repr</span>(book)</span><br><span class="line"><span class="string">&#x27;&lt;__main__.Book object at 0x10b69cbb0&gt;&#x27;</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶è¾“å‡ºä¸å¤Ÿå‹å¥½ï¼Œå¯¹äºå±æ€§æ¯”è¾ƒå°‘çš„å¯¹è±¡ï¼Œå®šä¹‰ä¸€ä¸ª <code>__repr__</code> å¹¶ä¸å¤ªéº»çƒ¦ï¼Œä½†æ˜¯ä¸€æ—¦éœ€è¦å®šä¹‰çš„å¯¹è±¡å¾ˆå¤šæˆ–è€…å±æ€§å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œè¿™æ ·å­åšå°±æ˜¾å¾—ç•¥å¾®éº»çƒ¦äº†ä¸€ç‚¹ã€‚è¿™ä¸ªæ—¶å€™ <code>dataclasses</code> å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><h1 id="dataclasses"><a href="#dataclasses" class="headerlink" title="dataclasses"></a>dataclasses</h1><p>æˆ‘ä»¬ç”¨ <code>dataclasses</code> æŠŠ <code>Book</code> æ”¹é€ ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>:</span></span><br><span class="line">name:<span class="built_in">str</span></span><br><span class="line">price:<span class="built_in">float</span></span><br><span class="line">author:<span class="built_in">str</span> = <span class="string">&#x27;æ¡ƒå­&#x27;</span></span><br></pre></td></tr></table></figure><p>ç„¶åç®€å•éªŒè¯ä¸€ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass,asdict,astuple</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@dataclass</span><br><span class="line"><span class="meta">... </span><span class="class"><span class="keyword">class</span> <span class="title">Book</span>:</span></span><br><span class="line"><span class="meta">... </span>    name:<span class="built_in">str</span></span><br><span class="line"><span class="meta">... </span>    price:<span class="built_in">float</span></span><br><span class="line"><span class="meta">... </span>    author:<span class="built_in">str</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>book1 = Book(name=<span class="string">&#x27;æ¡ƒå­1&#x27;</span>,price=<span class="number">10.0</span>,author=<span class="string">&#x27;æ¡ƒå­1&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>book1</span><br><span class="line">Book(name=<span class="string">&#x27;æ¡ƒå­1&#x27;</span>, price=<span class="number">10.0</span>, author=<span class="string">&#x27;æ¡ƒå­1&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>asdict(book1)</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;æ¡ƒå­1&#x27;</span>, <span class="string">&#x27;price&#x27;</span>: <span class="number">10.0</span>, <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;æ¡ƒå­1&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>astuple(b1)</span><br><span class="line">(<span class="string">&#x27;æ¡ƒå­1&#x27;</span>, <span class="number">12.0</span>, <span class="string">&#x27;æ¡ƒå­&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>dataclasses</code> ç”šè‡³è¿˜å…·å¤‡ <code>asdict</code> å‡½æ•°å¯ä»¥å°†å¯¹è±¡è½¬æˆ <code>dict</code>ï¼Œä¹Ÿå­˜åœ¨ <code>astuple</code> å¯ä»¥å°†å¯¹è±¡è½¬æˆ<code>tupple</code> ,æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿,ä½†æ˜¯è¿˜ä¸å¤Ÿï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯¹ä¸åŒå¯¹å‚æ•°è¿›è¡Œä¸€å®šå¯¹æ ¡éªŒï¼Œå¾ˆé—æ†¾ <code>dataclasses</code> å¹¶ä¸èƒ½åšåˆ°ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦çœ‹ <code>attrs</code> å’Œ <code>pydantic</code> äº†ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>attrs</code> å’Œ <code>pydantic</code> è¿˜æœ‰å…¶ä»–çš„ <code>dataclasses</code> ä¸å…·å¤‡çš„ç‰¹æ€§ï¼Œè§ä¸‹è¡¨ï¼š</p><p><img src="https://www.leetao94.cn/post-images/1631528189775.png"></p><h1 id="attrs-vs-pydantic"><a href="#attrs-vs-pydantic" class="headerlink" title="attrs vs pydantic"></a>attrs vs pydantic</h1><p>attrs å’Œ pydantic éƒ½éœ€è¦é€šè¿‡ pip å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install attrs</span><br><span class="line">pip install pydantic</span><br></pre></td></tr></table></figure><h2 id="validator"><a href="#validator" class="headerlink" title="validator"></a>validator</h2><h3 id="attrs-ä¸­çš„-validators"><a href="#attrs-ä¸­çš„-validators" class="headerlink" title="attrs ä¸­çš„ validators"></a>attrs ä¸­çš„ validators</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import attr</span><br><span class="line"></span><br><span class="line">@attr.s</span><br><span class="line">class Book:</span><br><span class="line">    name: str = attr.ib(default=None)</span><br><span class="line">    price:<span class="built_in">float</span> = attr.ib(default=None,validator=attr.validators.instance_of(<span class="built_in">float</span>))</span><br><span class="line">    author: str = attr.ib(default=<span class="string">&#x27;æ¡ƒå­&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    @price.validator</span><br><span class="line">    def more_than_zero(self, attribute, value):</span><br><span class="line">        <span class="keyword">if</span> not value &gt; 0:</span><br><span class="line">            raise ValueError(<span class="string">&quot;ä»·æ ¼ä¸èƒ½å°‘äº 0 å…ƒ!&quot;</span>)</span><br><span class="line"></span><br><span class="line">book = Book(name=<span class="string">&#x27;attrs&#x27;</span>,price=-1.0,author=<span class="string">&#x27;hynek Hynek Schlawack&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼ŒéªŒè¯ä¸€ä¸‹ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;test_attrs.py&quot;</span>, line 14, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    book = Book(name=<span class="string">&#x27;attrs&#x27;</span>,price=-1.0,author=<span class="string">&#x27;hynek Hynek Schlawack&#x27;</span>)</span><br><span class="line">  File <span class="string">&quot;&lt;attrs generated init __main__.Book&gt;&quot;</span>, line 6, <span class="keyword">in</span> __init__</span><br><span class="line">  File <span class="string">&quot;D:\workspace\python\test\venv\lib\site-packages\attr\_make.py&quot;</span>, line 2975, <span class="keyword">in</span> __call__</span><br><span class="line">    v(inst, attr, value)</span><br><span class="line">  File <span class="string">&quot;test_attrs.py&quot;</span>, line 12, <span class="keyword">in</span> more_than_zero</span><br><span class="line">    raise ValueError(<span class="string">&quot;ä»·æ ¼ä¸èƒ½å°‘äº 0 å…ƒ!&quot;</span>)</span><br><span class="line">ValueError: ä»·æ ¼ä¸èƒ½å°‘äº 0 å…ƒ!</span><br></pre></td></tr></table></figure><h3 id="pydantic-ä¸­çš„-validators"><a href="#pydantic-ä¸­çš„-validators" class="headerlink" title="pydantic ä¸­çš„ validators"></a>pydantic ä¸­çš„ validators</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel,validator, ValidationError</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line">    name:<span class="built_in">str</span></span><br><span class="line">    price:<span class="built_in">float</span></span><br><span class="line">    author:<span class="built_in">str</span> = <span class="string">&#x27;æ¡ƒå­&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&quot;price&quot;</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">more_than_zero</span>(<span class="params">cls, v</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">isinstance</span>(v,<span class="built_in">float</span>)</span><br><span class="line">        <span class="keyword">if</span> v &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;ä»·æ ¼ä¸èƒ½å°‘äº 0 å…ƒ!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">book = Book(name=<span class="string">&#x27;attrs&#x27;</span>,price=-<span class="number">1.0</span>,author=<span class="string">&#x27;hynek Hynek Schlawack&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„éªŒè¯ä¸€ä¸‹ç»“æœ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;test_pydantic.py&quot;</span>, line <span class="number">15</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    book = Book(name=<span class="string">&#x27;attrs&#x27;</span>,price=-<span class="number">1.0</span>,author=<span class="string">&#x27;hynek Hynek Schlawack&#x27;</span>)</span><br><span class="line">  File <span class="string">&quot;pydantic\main.py&quot;</span>, line <span class="number">406</span>, <span class="keyword">in</span> pydantic.main.BaseModel.__init__</span><br><span class="line">pydantic.error_wrappers.ValidationError: <span class="number">1</span> validation error <span class="keyword">for</span> Book</span><br><span class="line">price</span><br><span class="line">  ä»·æ ¼ä¸èƒ½å°‘äº <span class="number">0</span> å…ƒ! (<span class="built_in">type</span>=value_error)</span><br></pre></td></tr></table></figure><p>é™¤äº† validators ï¼Œattrs å’Œ pydantic è¿˜åŒæ—¶å…·æœ‰  convertersï¼ˆè½¬æ¢å™¨ï¼‰ åŠŸèƒ½ã€‚</p><h2 id="converters"><a href="#converters" class="headerlink" title="converters"></a>converters</h2><p>è½¬æ¢å™¨ä¹Ÿæ˜¯ä¸€ä¸ªååˆ†å®ç”¨çš„åŠŸèƒ½ï¼Œæ‰€è°“çš„è½¬æ¢å™¨å°±æ˜¯åœ¨å°†å‚æ•°åœ¨ä¼ é€’åˆ° <code>__init__</code>  ä¹‹å‰ï¼Œå°†å®ƒæŒ‰ç…§éœ€æ±‚è½¬æ¢æˆæ‰€éœ€æ ¼å¼çš„æ•°æ®ã€‚</p><p>æœ€å¸¸è§çš„å°±æ˜¯å°† str è½¬æˆ datetime æ ¼å¼ï¼Œattrs å’Œ pydantic åœ¨è½¬æ¢å™¨çš„å®ç°ä¸Šæœ‰æ‰€åŒºåˆ«ï¼š</p><h3 id="attrs-ä¸­-çš„è½¬æ¢å™¨"><a href="#attrs-ä¸­-çš„è½¬æ¢å™¨" class="headerlink" title="attrs ä¸­ çš„è½¬æ¢å™¨"></a>attrs ä¸­ çš„è½¬æ¢å™¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> attr</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conver_to_datetime</span>(<span class="params">user_input</span>) -&gt;  datetime:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(user_input,<span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> datetime.strptime(user_input, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(user_input,datetime):</span><br><span class="line">        <span class="keyword">return</span> user_input</span><br><span class="line">    <span class="keyword">raise</span> TypeError(<span class="string">&quot;ä¸æ”¯æŒçš„å‚æ•°ç±»å‹ï¼Œä»…æ”¯æŒ:str å’Œ datetime&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@attr.s</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>:</span></span><br><span class="line">    <span class="comment"># ... çœç•¥</span></span><br><span class="line">    publish_date: datetime = attr.ib(default=<span class="literal">None</span>, converter=conver_to_datetime)</span><br><span class="line"></span><br><span class="line">book = Book(name=<span class="string">&#x27;attrs&#x27;</span>,price=<span class="number">1.0</span>,author=<span class="string">&#x27;hynek Hynek Schlawack&#x27;</span>,publish_date=<span class="string">&#x27;2021-09-13 00:00:00&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(book)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Book(name=<span class="string">&#x27;attrs&#x27;</span>, price=<span class="number">1.0</span>, author=<span class="string">&#x27;hynek Hynek Schlawack&#x27;</span>, publish_date=datetime.datetime(<span class="number">2021</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure><p>ä¸éš¾çœ‹å‡ºï¼Œstr ç±»å‹çš„å­—ç¬¦ä¸²è¢«æˆåŠŸè½¬åŒ–äº†ã€‚</p><h3 id="pydantic-ä¸­çš„è½¬æ¢å™¨"><a href="#pydantic-ä¸­çš„è½¬æ¢å™¨" class="headerlink" title="pydantic ä¸­çš„è½¬æ¢å™¨"></a>pydantic ä¸­çš„è½¬æ¢å™¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel,validator</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">BaseModel</span>):</span></span><br><span class="line"><span class="comment"># çœç•¥...</span></span><br><span class="line">    publish_date: datetime</span><br><span class="line"></span><br><span class="line"><span class="meta">    @validator(<span class="params"><span class="string">&quot;publish_date&quot;</span></span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">conver_to_datetime</span>(<span class="params">cls, user_input</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(user_input,<span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">return</span> datetime.strptime(user_input, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(user_input,datetime):</span><br><span class="line">            <span class="keyword">return</span> user_input</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&quot;ä¸æ”¯æŒçš„å‚æ•°ç±»å‹ï¼Œä»…æ”¯æŒ:str å’Œ datetime&quot;</span>)</span><br><span class="line"></span><br><span class="line">book = Book(name=<span class="string">&#x27;attrs&#x27;</span>,price=<span class="number">1.0</span>,author=<span class="string">&#x27;hynek Hynek Schlawack&#x27;</span>, publish_date=<span class="string">&#x27;2021-09-13 16:03:00&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(book)</span><br></pre></td></tr></table></figure><p>éªŒè¯ç»“æœ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">&#x27;attrs&#x27;</span> price=<span class="number">1.0</span> author=<span class="string">&#x27;hynek Hynek Schlawack&#x27;</span> publish_date=datetime.datetime(<span class="number">2021</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">16</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä»£ç ä¸éš¾çœ‹å‡ºï¼Œattrs æœ¬èº«å†…ç½® converter å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’å†…ç½®å‡½æ•°æˆ–è€…è‡ªå®šä¹‰å‡½æ•°å®ç°è½¬åŒ–å™¨çš„åŠŸèƒ½ï¼Œè€Œ pydantic åˆ™éœ€è¦å€ŸåŠ© validator å»å®ç°ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Š pydantic è¿˜æ˜¯ç¨å¾®é€Šè‰² attrsã€‚</p><p>é™¤äº†ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªåŠŸèƒ½ï¼Œattrs å’Œ pydantic éƒ½å…·å¤‡ <code>immutable</code> çš„æ–¹æ³•ç”¨æ¥ä¿®é¥°å±æ€§ï¼Œä»è€Œå®ç°å±æ€§ä¸å¯ä¿®æ”¹ã€‚</p><p>attrs è¿˜å…·å¤‡ <code>slots</code> å’Œ <code>programmatic creation</code> æœ‰å…´è¶£çš„å¯ä»¥è¿›ä¸€æ­¥é˜…è¯»å®˜æ–¹æ–‡æ¡£ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä»ä¸Šé¢çš„ä¾‹å­ï¼Œä¸éš¾çœ‹å‡º pydantic æœ‰ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>pydantic ä¸æ”¯æŒä½ç½®å‚æ•°</li><li>pydantic çš„è¾“å‡ºæœ‰ç‚¹å¥‡æ€ªï¼Œæ²¡æœ‰å¸¦ä¸Šç±»å</li><li>pydantic ä¸æ”¯æŒ <code>slots</code> å’Œ <code>programmatic creation</code></li><li><a href="https://github.com/samuelcolvin/pydantic/issues/2605">pydantic ä¸æ”¯æŒ Collection ç±»å‹</a> </li></ol><p>åœ¨å‚è€ƒæ–‡ç« ä¸­è¿˜æåˆ°äº† pydantic å¯¹ unions çš„ç­–ç•¥æœ‰é—®é¢˜ï¼Œä¸å®¹æ˜“å®šåˆ¶ï¼Œå¹¶ä¸”å¯¹å®šåˆ¶çš„ï¼ˆéï¼‰ç»“æ„åŒ–çš„æ”¯æŒå¾ˆå¼±ã€‚</p><p>æ‰€ä»¥å¦‚æœæœ‰å¤æ‚çš„éœ€æ±‚çš„è¯ï¼Œå»ºè®®ä½¿ç”¨ <code>attrs</code> ï¼Œåªæ˜¯æƒ³ç®€å•çš„å‘ˆç°å¯¹è±¡çš„å±æ€§çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ç”¨ <code>dataclasses</code> ã€‚</p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://jackmckew.dev/dataclasses-vs-attrs-vs-pydantic.html">dataclasses vs attrs vs Pydantic</a></p><p><a href="https://zhuanlan.zhihu.com/p/34963159">attrs å’Œ Python3.7 çš„ dataclasses</a></p><p><a href="https://threeofwands.com/why-i-use-attrs-instead-of-pydantic/amp/?__twitter_impression=true">Why I use attrs instead of pydantic</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;Python3.7 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¨¡å—é‚£å°±æ˜¯ &lt;code&gt;dataclasses&lt;/code&gt;ï¼Œæ—©åœ¨ 3.6 ç‰ˆæœ¬çš„æ—¶å€™æˆ‘å°±é€šè¿‡å®‰è£… &lt;co</summary>
      
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="Pythonæ ‡å‡†åº“" scheme="https://leetaogoooo.github.io/tags/Python%E6%A0%87%E5%87%86%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>Elasticsearch æ”¯æŒ PDF ç­‰æ–‡ä»¶æœç´¢</title>
    <link href="https://leetaogoooo.github.io/2021/09/08/07txYm7YT/"/>
    <id>https://leetaogoooo.github.io/2021/09/08/07txYm7YT/</id>
    <published>2021-09-08T10:28:54.000Z</published>
    <updated>2022-04-12T07:10:22.018Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é»˜è®¤æƒ…å†µä¸‹ es æ˜¯ä¸æ”¯æŒ pdfã€doc ç­‰æ–‡æ¡£çš„æœç´¢çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å®‰è£… <code>Ingest attachment plugin</code> æ’ä»¶æ¥ä½¿å¾— es æå–é€šç”¨æ ¼å¼çš„æ–‡ä»¶ï¼Œä»è€Œå¯ä»¥å®ç°æœç´¢çš„åŠŸèƒ½ã€‚</p><h1 id="å®‰è£…ä¸ä½¿ç”¨"><a href="#å®‰è£…ä¸ä½¿ç”¨" class="headerlink" title="å®‰è£…ä¸ä½¿ç”¨"></a>å®‰è£…ä¸ä½¿ç”¨</h1><h2 id="å®‰è£…-Ingest-attachment-plugin"><a href="#å®‰è£…-Ingest-attachment-plugin" class="headerlink" title="å®‰è£… Ingest attachment plugin"></a>å®‰è£… Ingest attachment plugin</h2><p>å®‰è£…å¾ˆç®€å•ï¼Œé€šè¿‡ <code>elasticsearch-plugin</code> å¯ä»¥ç›´æ¥è¿›è¡Œå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/elasticsearch-plugin install ingest-attachment</span><br></pre></td></tr></table></figure><blockquote><p>Ingest attachment plugin å…è®¸ Elasticsearch é€šè¿‡ä½¿ç”¨ Apache æ–‡æœ¬æå–åº“ Tika æå–é€šç”¨æ ¼å¼ï¼ˆä¾‹å¦‚ï¼šPPTï¼ŒXLS å’Œ PDFï¼‰çš„æ–‡ä»¶é™„ä»¶ã€‚Apache Tika å·¥å…·åŒ…å¯ä»ä¸€åƒå¤šç§ä¸åŒçš„æ–‡ä»¶ç±»å‹ä¸­æ£€æµ‹å¹¶æå–å…ƒæ•°æ®å’Œæ–‡æœ¬ã€‚æ‰€æœ‰è¿™äº›æ–‡ä»¶ç±»å‹éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªç•Œé¢è¿›è¡Œè§£æï¼Œä»è€Œä½¿ Tika å¯¹æœç´¢å¼•æ“ç´¢å¼•ï¼Œå†…å®¹åˆ†æï¼Œç¿»è¯‘ç­‰æœ‰ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæºå­—æ®µå¿…é¡»æ˜¯ Base64 ç¼–ç çš„äºŒè¿›åˆ¶ï¼Œå¦‚æœä¸æƒ³å¢åŠ åœ¨ Base64 ä¹‹é—´æ¥å›è½¬æ¢çš„å¼€é”€ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ CBOR æ ¼å¼è€Œä¸æ˜¯ JSONï¼Œå¹¶å°†å­—æ®µæŒ‡å®šä¸ºå­—èŠ‚æ•°ç»„è€Œä¸æ˜¯å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œè¿™æ ·å¤„ç†å™¨å°†è·³è¿‡ Base64 è§£ç ã€‚</p></blockquote><h3 id="åˆ›å»º-attachment-pipeline"><a href="#åˆ›å»º-attachment-pipeline" class="headerlink" title="åˆ›å»º attachment pipeline"></a>åˆ›å»º attachment pipeline</h3><p>é€šè¿‡ kibana çš„å¼€å‘å·¥å…·è¿›è¡Œè¯·æ±‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT _ingest/pipeline/pdfattachment</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Extract attachment information encoded in Base64 with UTF-8 charset&quot;</span>,</span><br><span class="line">  <span class="string">&quot;processors&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;attachment&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;file&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> : <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºåˆ›å»ºæˆåŠŸï¼Œæ¥ä¸‹æ¥å°±æ˜¯éªŒè¯ä¸Šä¼  pdf ä»¥åŠæœç´¢åŠŸèƒ½äº†ã€‚</p><h3 id="è½¬æ¢å¹¶ä¸Šä¼ PDFæ–‡ä»¶çš„å†…å®¹åˆ°Elasticsearchä¸­"><a href="#è½¬æ¢å¹¶ä¸Šä¼ PDFæ–‡ä»¶çš„å†…å®¹åˆ°Elasticsearchä¸­" class="headerlink" title="è½¬æ¢å¹¶ä¸Šä¼ PDFæ–‡ä»¶çš„å†…å®¹åˆ°Elasticsearchä¸­"></a>è½¬æ¢å¹¶ä¸Šä¼ PDFæ–‡ä»¶çš„å†…å®¹åˆ°Elasticsearchä¸­</h3><p>å¯¹äº Ingest attachment plugin æ¥è¯´ï¼Œå®ƒçš„æ•°æ®å¿…é¡»æ˜¯ Base64 çš„ã€‚è¿™é‡Œä¸ºäº†å¿«é€Ÿåˆ›å»ºï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª bash è„šæœ¬å»å¤„ç†ç”¨æ¥æµ‹è¯•çš„ pdf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">!/bin/bash</span><br><span class="line"></span><br><span class="line">encodedPdf=`cat sample.pdf | base64`</span><br><span class="line"></span><br><span class="line">json=<span class="string">&quot;&#123;\&quot;file\&quot;:\&quot;<span class="variable">$&#123;encodedPdf&#125;</span>\&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$json</span>&quot;</span> &gt; json.file</span><br><span class="line"></span><br><span class="line">curl -X POST <span class="string">&#x27;http://localhost:9200/pdf-test1/_doc?pipeline=pdfattachment&amp;pretty&#x27;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> -d @json.file</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æˆåŠŸä¼šè¿”å›å¦‚ä¸‹çš„ç»“æœ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;pdf-test1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1oVSxHsB1ubIHqCXIbPU&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_version&quot;</span> : 1,</span><br><span class="line">  <span class="string">&quot;result&quot;</span> : <span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : 2,</span><br><span class="line">    <span class="string">&quot;successful&quot;</span> : 1,</span><br><span class="line">    <span class="string">&quot;failed&quot;</span> : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;_seq_no&quot;</span> : 0,</span><br><span class="line">  <span class="string">&quot;_primary_term&quot;</span> : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°æç¤ºä¸‹è¿°æç¤º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;statusCode&quot;</span>: 400,</span><br><span class="line"><span class="string">&quot;error&quot;</span>: <span class="string">&quot;Bad Request&quot;</span>,</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;Payload content length greater than maximum allowed: 1048576&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ä¸Šä¼ çš„æ–‡ä»¶å¤§å°è¶…è¿‡äº† Kibana é»˜è®¤çš„ä¸Šé™ï¼ˆé»˜è®¤ 1Mï¼‰ï¼Œä¿®æ”¹ kibana çš„é…ç½® <code>kibana.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.maxPayloadBytes:</span> <span class="string">&quot;209715200&quot;</span></span><br></pre></td></tr></table></figure><h1 id="æŸ¥çœ‹ç´¢å¼•å¹¶æœç´¢"><a href="#æŸ¥çœ‹ç´¢å¼•å¹¶æœç´¢" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•å¹¶æœç´¢"></a>æŸ¥çœ‹ç´¢å¼•å¹¶æœç´¢</h1><h2 id="æŸ¥çœ‹ç´¢å¼•"><a href="#æŸ¥çœ‹ç´¢å¼•" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•"></a>æŸ¥çœ‹ç´¢å¼•</h2><p>é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹ pdf-test1 çš„ç´¢å¼•æƒ…å†µ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET pdf-test1/_search</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹å›¾<br><img src="https://www.leetao94.cn/post-images/1631096996349.png"></p><p>å…¶ä¸­ <code>_source</code> é‡Œæœ‰ä¸ª <code>content</code> å­—æ®µï¼Œå°±æ˜¯ pdf çš„å†…å®¹ï¼Œç»“æœå¦‚ä¸‹:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_source&quot;</span>: &#123;</span><br><span class="line"> <span class="attr">&quot;file&quot;</span>:<span class="string">&quot;...&quot;</span>,</span><br><span class="line"><span class="attr">&quot;attachment&quot;</span>: &#123;</span><br><span class="line">                        <span class="attr">&quot;date&quot;</span>: <span class="string">&quot;2021-08-18T07:29:34Z&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;content_type&quot;</span>: <span class="string">&quot;application/pdf&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;author&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;language&quot;</span>: <span class="string">&quot;lt&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;2021-07(copy)&quot;</span>,</span><br><span class="line">                        <span class="attr">&quot;content&quot;</span>: <span class="string">&quot;...&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>file</code> å°±æ˜¯ base64 æ ¼å¼çš„å†…å®¹ï¼Œ<code>content</code> åˆ™åŒ…å«äº† pdf çš„å†…å®¹ï¼Œå¦‚æœä¸æƒ³è¦ <code>file</code> åˆ™å¯ä»¥é€šè¿‡ <code>remove processor</code> å»é™¤è¿™ä¸ªå­—æ®µ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT _ingest/pipeline/pdfattachment</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Extract attachment information encoded in Base64 with UTF-8 charset&quot;</span>,</span><br><span class="line">  <span class="string">&quot;processors&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;attachment&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;file&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;remove&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;file&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h2><p>é€šè¿‡åœ¨ kibana çš„å¼€å‘å·¥å…·æ‰§è¡Œä¸‹è¿°å‘½ä»¤ï¼ŒéªŒè¯ä¸€ä¸‹æœç´¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET pdf-test1/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;attachment.content&quot;</span>: <span class="string">&quot;5G&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://www.cnblogs.com/sanduzxcvbnm/p/12624935.html">Elasticsearchï¼šå¦‚ä½•å¯¹PDFæ–‡ä»¶è¿›è¡Œæœç´¢</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ es æ˜¯ä¸æ”¯æŒ pdfã€doc ç­‰æ–‡æ¡£çš„æœç´¢çš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å®‰è£… &lt;code&gt;Ingest attachment plugin&lt;</summary>
      
    
    
    
    
    <category term="Elasticsearch" scheme="https://leetaogoooo.github.io/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Docker æ­å»º Elasticsearch + Kibana + IK ä¸­æ–‡åˆ†è¯</title>
    <link href="https://leetaogoooo.github.io/2021/09/07/Dxqjjq53O/"/>
    <id>https://leetaogoooo.github.io/2021/09/07/Dxqjjq53O/</id>
    <published>2021-09-07T10:26:33.000Z</published>
    <updated>2022-04-12T07:10:22.021Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å®‰è£…å¯åŠ¨-Elasticsearch"><a href="#å®‰è£…å¯åŠ¨-Elasticsearch" class="headerlink" title="å®‰è£…å¯åŠ¨ Elasticsearch"></a>å®‰è£…å¯åŠ¨ Elasticsearch</h1><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker network create elastic</span><br><span class="line">docker pull docker.elastic.co/elasticsearch/elasticsearch:<span class="number">7.14</span>.<span class="number">0</span></span><br><span class="line">docker <span class="keyword">run</span><span class="bash"> -d --name es01-test --net elastic -p 9200:9200 -p 9300:9300 -e <span class="string">&quot;discovery.type=single-node&quot;</span> docker.elastic.co/elasticsearch/elasticsearch:7.14.0</span></span><br></pre></td></tr></table></figure><h1 id="å®‰è£…å¯åŠ¨-Kibana"><a href="#å®‰è£…å¯åŠ¨-Kibana" class="headerlink" title="å®‰è£…å¯åŠ¨ Kibana"></a>å®‰è£…å¯åŠ¨ Kibana</h1><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker.elastic.co/kibana/kibana:<span class="number">7.14</span>.<span class="number">0</span></span><br><span class="line">docker <span class="keyword">run</span><span class="bash"> -d --name kib01-test --net elastic -p 5601:5601 -e <span class="string">&quot;ELASTICSEARCH_HOSTS=http://es01-test:9200&quot;</span> docker.elastic.co/kibana/kibana:7.14.0</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨å®Œæˆä¹‹åè®¿é—® <a href="http://localhost:5601/"><code>http://localhost:5601</code></a> å³å¯ï¼Œé»˜è®¤æ˜¯è‹±æ–‡ï¼Œé…ç½®ä¸­æ–‡å¯ä»¥å‚è€ƒ</p><h2 id="Kibana-æ±‰åŒ–"><a href="#Kibana-æ±‰åŒ–" class="headerlink" title="Kibana æ±‰åŒ–"></a>Kibana æ±‰åŒ–</h2><p>åœ¨ <code>kibana.yml</code> ä¸­åŠ å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i18n.locale: <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åé‡å¯ kibana å³å¯</p><p>é…ç½®å®Œæˆåé‡å¯æœåŠ¡ï¼Œç•Œé¢å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://www.leetao94.cn/post-images/1631010579381.png"></p><h1 id="å®‰è£…-IK-ä¸­æ–‡åˆ†è¯"><a href="#å®‰è£…-IK-ä¸­æ–‡åˆ†è¯" class="headerlink" title="å®‰è£… IK ä¸­æ–‡åˆ†è¯"></a>å®‰è£… IK ä¸­æ–‡åˆ†è¯</h1><p>es ä¸­æœ¬èº«è‡ªå¸¦è‹±æ–‡åˆ†è¯ï¼Œä½†æ˜¯å®é™…ä¸šåŠ¡éœ€è¦å­˜åœ¨ä¸­æ–‡åˆ†è¯çš„åœºæ™¯ï¼Œæ‰€ä»¥æ‰‹åŠ¨å®‰è£…ä¸­æ–‡åˆ†è¯æ’ä»¶ã€‚</p><h2 id="ä¸‹è½½-IK-åˆ†è¯æ’ä»¶"><a href="#ä¸‹è½½-IK-åˆ†è¯æ’ä»¶" class="headerlink" title="ä¸‹è½½ IK åˆ†è¯æ’ä»¶"></a>ä¸‹è½½ IK åˆ†è¯æ’ä»¶</h2><p>ä» github ä¸Šæ ¹æ®ä¸åŒçš„ es ç‰ˆæœ¬ä¸‹è½½å¯¹åº”çš„ ik æ’ä»¶å‹ç¼©åŒ…</p><p><a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p><h2 id="åœ¨-es-çš„-plugins-è§£å‹"><a href="#åœ¨-es-çš„-plugins-è§£å‹" class="headerlink" title="åœ¨ es çš„ plugins è§£å‹"></a>åœ¨ es çš„ plugins è§£å‹</h2><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd your-es-plugins/plugins/ &amp;&amp; mkdir ik</span><br><span class="line">unzip elasticsearch-analysis-ik-<span class="number">7.14</span>.<span class="number">0</span>.zip</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°å¯åŠ¨ esï¼Œè¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨ docker å¯åŠ¨ es çš„ï¼Œæ‰€ä»¥å…ˆé€šè¿‡ <code>docker cp</code> çš„å‘½ä»¤å°†æ’ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­çš„</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp es.zip container-id:/usr/share/elasticsearch/plugins/es</span><br></pre></td></tr></table></figure><h1 id="é‡å¯-es"><a href="#é‡å¯-es" class="headerlink" title="é‡å¯ es"></a>é‡å¯ es</h1><p>é‡å¯ es çš„æœåŠ¡ï¼Œå¦‚æœæˆåŠŸåŠ è½½æ’ä»¶ï¼Œæ§åˆ¶å°ä¼šæœ‰å¦‚ä¸‹çš„è¾“å‡º:</p><p><img src="https://www.leetao94.cn/post-images/1631010619965.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å®‰è£…å¯åŠ¨-Elasticsearch&quot;&gt;&lt;a href=&quot;#å®‰è£…å¯åŠ¨-Elasticsearch&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…å¯åŠ¨ Elasticsearch&quot;&gt;&lt;/a&gt;å®‰è£…å¯åŠ¨ Elasticsearch&lt;/h1&gt;&lt;figure c</summary>
      
    
    
    
    
    <category term="Elasticsearch" scheme="https://leetaogoooo.github.io/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>Type hinting may cause cyclic imports</title>
    <link href="https://leetaogoooo.github.io/2021/07/05/type-hinting-may-cause-cyclic-imports/"/>
    <id>https://leetaogoooo.github.io/2021/07/05/type-hinting-may-cause-cyclic-imports/</id>
    <published>2021-07-04T16:00:00.000Z</published>
    <updated>2022-04-12T07:10:22.054Z</updated>
    
    <content type="html"><![CDATA[<p>Recently I was working on rss3 SDK. In order to facilitate development, I just make a python version of the reference <a href="https://github.com/NaturalSelectionLabs/RSS3-SDK-for-JavaScript">JavaScript  SDK</a>, which means the usage should be pretty similar between both.</p><h2 id="Make-a-Python-version"><a href="#Make-a-Python-version" class="headerlink" title="Make a Python version"></a>Make a Python version</h2><p>Whatâ€™s  more, to make a clear code,I use type hinting in the new project. However, there is a code snippet in JavaScript version:</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># index.ts</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RSS3</span> </span>&#123;</span><br><span class="line">    <span class="attr">options</span>: IOptions;</span><br><span class="line">    persona: Persona;</span><br><span class="line">    file: File;</span><br><span class="line">    profile: Profile;</span><br><span class="line">    items: Items;</span><br><span class="line">    item: Item;</span><br><span class="line">    links: Links;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">options: IOptions</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.options = options;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.file = <span class="keyword">new</span> File(<span class="built_in">this</span>);</span><br><span class="line">        <span class="built_in">this</span>.persona = <span class="keyword">new</span> Persona(<span class="built_in">this</span>);</span><br><span class="line">        <span class="built_in">this</span>.profile = <span class="keyword">new</span> Profile(<span class="built_in">this</span>);</span><br><span class="line">        <span class="built_in">this</span>.items = <span class="keyword">new</span> Items(<span class="built_in">this</span>);</span><br><span class="line">        <span class="built_in">this</span>.item = <span class="keyword">new</span> Item(<span class="built_in">this</span>);</span><br><span class="line">        <span class="built_in">this</span>.links = <span class="keyword">new</span> Links(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"># file.ts</span><br><span class="line"><span class="keyword">import</span> Main <span class="keyword">from</span> <span class="string">&#x27;./index&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    private main: Main;</span><br><span class="line">    private list: &#123;</span><br><span class="line">        [key: string]: RSS3IContent;</span><br><span class="line">    &#125; = &#123;&#125;;</span><br><span class="line">    private dirtyList: &#123;</span><br><span class="line">        [key: string]: number;</span><br><span class="line">    &#125; = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">main: Main</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.main = main;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Yes, the two files refer to each other. Actually, it happens on many other files. When I turned this into Python version:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># index.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RSS3</span>:</span></span><br><span class="line">...</span><br><span class="line">    persona: Persona</span><br><span class="line">    file: File_</span><br><span class="line">    profile: Profile</span><br><span class="line">    items: Items</span><br><span class="line">    items: Item</span><br><span class="line">    links: Links</span><br><span class="line"></span><br><span class="line"><span class="comment"># file.py</span></span><br><span class="line"><span class="keyword">from</span> .index <span class="keyword">import</span> RSS3</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    rss3: RSS3</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, rss3: RSS3</span>):</span></span><br><span class="line">        self.rss3 = rss3</span><br></pre></td></tr></table></figure><h2 id="circular-import"><a href="#circular-import" class="headerlink" title="circular import"></a>circular import</h2><p>It didnâ€™t seem any errors, but when I started testing the problems appeared.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E   ImportError: cannot <span class="keyword">import</span> name <span class="string">&#x27;RSS3&#x27;</span> <span class="keyword">from</span> partially initialized module <span class="string">&#x27;rss3.src.index&#x27;</span> (most likely due to a circular <span class="keyword">import</span>) </span><br></pre></td></tr></table></figure><p>how to solve this problem ? Donâ€™t worry, <a href="https://www.python.org/dev/peps/pep-0484/#runtime-or-type-checking">PEP 484</a> has given a solution.</p><h2 id="Solutions"><a href="#Solutions" class="headerlink" title="Solutions"></a>Solutions</h2><blockquote><p>When a type hint contains names that have not been defined yet, that definition may be expressed as a string literal, to be resolved later.</p></blockquote><p>So we can modify our code like the following:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    rss3: <span class="string">&#x27;RSS3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, rss3: <span class="string">&#x27;RSS3&#x27;</span></span>):</span></span><br><span class="line">        self.rss3 = rss3</span><br></pre></td></tr></table></figure><p>Thatâ€™s okay already.</p><blockquote><p>Sometimes thereâ€™s code that must be seen by a type checker (or other static analysis tools) but should not be executed. For such situations the typing module defines a constant, TYPE_CHECKING, that is considered True during type checking (or other static analysis) but False at runtime.</p></blockquote><p>Modify out code again:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> TYPE_CHECKING:</span><br><span class="line">    <span class="keyword">from</span> .index <span class="keyword">import</span> RSS3</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    rss3: <span class="string">&#x27;RSS3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, rss3: <span class="string">&#x27;RSS3&#x27;</span></span>):</span></span><br><span class="line">        self.rss3 = rss3</span><br></pre></td></tr></table></figure><h2 id="Whatâ€™s-more"><a href="#Whatâ€™s-more" class="headerlink" title="Whatâ€™s more"></a>Whatâ€™s more</h2><p>if we are using Python 3.7+, we can at least skip having to provide an explicit string annotation by taking advantage of <a href="https://www.python.org/dev/peps/pep-0563/">PEP 563</a>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> annotations</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TYPE_CHECKING</span><br><span class="line"><span class="keyword">if</span> TYPE_CHECKING:</span><br><span class="line">    <span class="keyword">from</span> .index <span class="keyword">import</span> RSS3</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span>:</span></span><br><span class="line">    rss3: <span class="string">&#x27;RSS3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, rss3: <span class="string">&#x27;RSS3&#x27;</span></span>):</span></span><br><span class="line">        self.rss3 = rss3</span><br></pre></td></tr></table></figure><p>The <code>from __future__  import annotations</code> import will make all type hints be strings and skip evaluating them.</p><h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a href="https://www.python.org/dev/peps/pep-0484/#forward-references">PEP 484 â€“ Type Hints</a></p><p><a href="https://stackoverflow.com/questions/39740632/python-type-hinting-without-cyclic-imports">Python type hinting without cyclic imports</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Recently I was working on rss3 SDK. In order to facilitate development, I just make a python version of the reference &lt;a href=&quot;https://gi</summary>
      
    
    
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Github Action è‡ªåŠ¨æ„å»º Flutter  Android Apk</title>
    <link href="https://leetaogoooo.github.io/2021/05/22/Github%20Action%20%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%20Flutter%20%20Android%20Apk/"/>
    <id>https://leetaogoooo.github.io/2021/05/22/Github%20Action%20%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%20Flutter%20%20Android%20Apk/</id>
    <published>2021-05-21T16:00:00.000Z</published>
    <updated>2022-04-12T07:10:22.025Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰æ®µæ—¶é—´ç”¨ Flutter åšäº†ä¸€ä¸ªå¼€æºçš„é¡¹ç›® <a href="https://github.com/lt94/RSSAid">RSSAid</a>,å› ä¸ºéœ€è¦æ‰“åŒ… apkï¼Œåœ¨æ­¤ä¹‹å‰ä¸€ç›´æ˜¯åœ¨æœ¬åœ°ç­¾åæ‰“åŒ…çš„ã€‚åæ¥å’Œåˆ«äººäº¤æµäº†ä¸€ä¸‹ï¼Œæƒ³èµ·æ¥å¯ä»¥ç”¨ Github Action æ„å»ºæŒç»­åŒ–é›†æˆï¼Œè‡ªåŠ¨æ‰“åŒ…ã€‚ç„¶åå°±ç ”ç©¶äº†ä¸€ä¸‹ï¼Œæœ€åå®Œæˆäº†æ ¹æ® tag ç‰ˆæœ¬è‡ªåŠ¨ç”Ÿæˆ apk çš„ workflowsã€‚</p><h1 id="Workflows"><a href="#Workflows" class="headerlink" title="Workflows"></a>Workflows</h1><p>è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.yml</span></span><br><span class="line"><span class="comment"># è‡ªåŠ¨æ„å»º Apk</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Test,</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">Release</span> <span class="string">apk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¥ä½œæµç¨‹è§¦å‘çš„æ—¶æœºï¼Œè¿™é‡Œæ˜¯å½“ä¸€ä¸ªç‰ˆæœ¬æ ‡ç­¾æ¨é€åˆ°ä»“åº“æ—¶è§¦å‘</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">v*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™ä¸ªå·¥ä½œæµç¨‹éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">process:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">all</span> <span class="string">process</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="comment"># è¿™ä¸ªä»»åŠ¡çš„æ­¥éª¤</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># æ‹‰å–é¡¹ç›®ä»£ç </span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="comment"># å»ºç«‹ java ç¯å¢ƒ</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Java</span> <span class="string">JDK</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-java@v1.4.3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">java-version:</span> <span class="string">&quot;12.x&quot;</span></span><br><span class="line">      <span class="comment"># å»ºç«‹ Flutter ç¯å¢ƒ</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Flutter</span> <span class="string">action</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">subosito/flutter-action@v1.4.0</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">channel:</span> <span class="string">&quot;stable&quot;</span></span><br><span class="line">          <span class="attr">flutter-version:</span> <span class="string">&quot;1.22.4&quot;</span></span><br><span class="line">      <span class="comment"># ä¸‹è½½é¡¹ç›®ä¾èµ–</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">flutter</span> <span class="string">pub</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">$ENCODED_KEYSTORE</span> <span class="string">|</span> <span class="string">base64</span> <span class="string">-di</span> <span class="string">&gt;</span> <span class="string">android/app/keystore.jks</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">ENCODED_KEYSTORE:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ENCODED_KEYSTORE</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="comment"># æ‰“åŒ… APK</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">flutter</span> <span class="string">build</span> <span class="string">apk</span> <span class="string">--release</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">KEYSTORE_PASSWORD:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.KEYSTORE_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">KEY_ALIAS:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.KEY_ALIAS</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">KEY_PASSWORD:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.KEY_PASSWORD&#125;&#125;</span></span><br><span class="line">      <span class="comment"># å‘å¸ƒåˆ° Release</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Release</span> <span class="string">apk</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">ncipollo/release-action@v1.5.0</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">artifacts:</span> <span class="string">&quot;build/app/outputs/apk/release/*.apk&quot;</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.RELEASE_TOKEN</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨æ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨æ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨æ³¨æ„äº‹é¡¹</h1><p>è„šæœ¬ä¸­æœ‰å¾ˆå¤šç¯å¢ƒå˜é‡ï¼Œéƒ½éœ€è¦å®ç°å®šä¹‰å¥½ï¼Œåœ¨é¡¹ç›®çš„ secrets ä¸­æ·»åŠ ä¸Šã€‚</p><h2 id="RELASE-TOKEN"><a href="#RELASE-TOKEN" class="headerlink" title="RELASE_TOKEN"></a>RELASE_TOKEN</h2><p>è¿™ä¸ªç¯å¢ƒå˜é‡éœ€è¦åœ¨ <a href="https://github.com/settings/tokens">Personal access tokens</a> ç”³è¯·ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”³è¯·å®Œæˆä¹‹åï¼Œä¸è¦ç€æ€¥å…³é—­è¿™ä¸ªé¡µé¢ï¼Œå› ä¸ºä¸€æ—¦å…³é—­å°±ä¸èƒ½å†æ¬¡æŸ¥çœ‹ç”Ÿæˆçš„ token äº†ï¼Œè¿™ä¸ª token éœ€è¦ç”³è¯· repo å’Œ workflow çš„æƒé™</p><p><img src="/posts/1610071792.jpeg"></p><p>ç”Ÿæˆ token æˆåŠŸåï¼Œæ‰¾åˆ°é¡¹ç›®çš„ **Settings =&gt; Secrets **é€‰é¡¹ï¼Œæ–°å»ºåä¸º RELEASE_TOKEN çš„ secrets ç„¶å value å€¼ä¸ºåˆšæ‰ç”Ÿæˆçš„ tokenã€‚è¿™ä¸ªå®Œæˆä¹‹åï¼Œå°±éœ€è¦å¯¹è®¾ç½®ç”Ÿæˆ apk éœ€è¦çš„ç­¾åè¿›è¡Œå˜é‡è®¾ç½®äº†ã€‚</p><h2 id="ç­¾åç›¸å…³å˜é‡"><a href="#ç­¾åç›¸å…³å˜é‡" class="headerlink" title="ç­¾åç›¸å…³å˜é‡"></a>ç­¾åç›¸å…³å˜é‡</h2><p>æ­£å¸¸ app ç­¾åæ­¥éª¤å¯ä»¥å‚è€ƒ <a href="https://flutterchina.club/android-release/#app%E7%AD%BE%E5%90%8D">appç­¾å</a>ï¼Œæœ€ç»ˆæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ª key.properties çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">storePassword=&lt;password from previous step&gt;</span><br><span class="line">keyPassword=&lt;password from previous step&gt;</span><br><span class="line">keyAlias=key</span><br><span class="line">storeFile=&lt;location of the key store file, e.g. /Users/&lt;user name&gt;/key.jks&gt;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ android/app/build.grade ä¸­é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        keyAlias keystoreProperties[&#x27;keyAlias&#x27;]</span><br><span class="line">        keyPassword keystoreProperties[&#x27;keyPassword&#x27;]</span><br><span class="line">        storeFile keystoreProperties[&#x27;storeFile&#x27;] ? file(keystoreProperties[&#x27;storeFile&#x27;]) : null</span><br><span class="line">        storePassword keystoreProperties[&#x27;storePassword&#x27;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å°† key.properties ä¸Šä¼ åˆ°ä»“åº“æ˜¾ç„¶æ˜¯ä¸å®‰å…¨çš„ã€‚æ‰€ä»¥éœ€è¦å¯¹ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œå°†å¯¹åº”çš„å˜é‡æ·»åŠ åˆ° secrets  ä¸­ï¼Œä» secrets  ä¸­è·å–å˜é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">storeFile file(System.getenv(&quot;KEYSTORE&quot;) ?:&quot;keystore.jks&quot;)</span><br><span class="line">storePassword System.getenv(&quot;KEYSTORE_PASSWORD&quot;)</span><br><span class="line">keyAlias System.getenv(&quot;KEY_ALIAS&quot;)</span><br><span class="line">keyPassword System.getenv(&quot;KEY_PASSWORD&quot;)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ **KEYSTORE_PASSWORDã€KEY_ALIASã€KEY_PASSWORD **ç›´æ¥å°±å¯ä»¥æ·»åŠ ï¼Œé‚£ä¹ˆ **KEYSTORE **è¿™ä¸ªå˜é‡æ€ä¹ˆå¤„ç†å‘¢ï¼ŸKEYSTORE å¯¹åº”ç€ jks æ–‡ä»¶ä½ç½®ã€‚jks æ–‡ä»¶æ˜¾ç„¶ä¹Ÿä¸å¯èƒ½ä¸Šä¼ åˆ°ä»“åº“ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¢ç§æ–¹æ³•ï¼Œåœ¨æ„å»ºçš„æ—¶å€™ç”Ÿæˆ jks æ–‡ä»¶ã€‚</p><h2 id="æ„å»ºæ—¶ç”Ÿæˆ-jks-æ–‡ä»¶"><a href="#æ„å»ºæ—¶ç”Ÿæˆ-jks-æ–‡ä»¶" class="headerlink" title="æ„å»ºæ—¶ç”Ÿæˆ jks æ–‡ä»¶"></a>æ„å»ºæ—¶ç”Ÿæˆ jks æ–‡ä»¶</h2><p>æ­£å¸¸æƒ…å†µä¸‹æ‰“å¼€ç”Ÿæˆçš„ jks æ–‡ä»¶å¤šåŠæ˜¯ä¹±ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ base64 å¯¹æ–‡ä»¶è¿›è¡Œç¼–ç ï¼Œç„¶ååœ¨æ„å»ºçš„æ—¶å€™ï¼Œå†è§£ç é‡æ–°ç”Ÿæˆæ–‡ä»¶ã€‚</p><h3 id="è·å–-base64-æ ¼å¼çš„-keystore"><a href="#è·å–-base64-æ ¼å¼çš„-keystore" class="headerlink" title="è·å– base64 æ ¼å¼çš„ keystore"></a>è·å– base64 æ ¼å¼çš„ keystore</h3><p>é¦–å…ˆè·å– base64 æ ¼å¼çš„ keystore </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl base64 -A -<span class="keyword">in</span> &lt;jks.æ–‡ä»¶ä½ç½®&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†è¾“å‡ºçš„ç»“æœå¤åˆ¶ä¸‹æ¥</p><h3 id="ä¿å­˜-base64-æ ¼å¼çš„-keystore"><a href="#ä¿å­˜-base64-æ ¼å¼çš„-keystore" class="headerlink" title="ä¿å­˜ base64 æ ¼å¼çš„ keystore"></a>ä¿å­˜ base64 æ ¼å¼çš„ keystore</h3><p>å°†ç¼–ç åçš„ keystore å†…å®¹ï¼Œæ·»åŠ åˆ° secrets ï¼Œå˜é‡åå‘½åä¸º <strong>ENCODED_KEYSTOREï¼Œ</strong>ç„¶ååœ¨æ„å»ºè¿‡ç¨‹ä¸­å°±å¯ä»¥å°† keystore æ–‡ä»¶è¿˜åŸäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$ENCODED_KEYSTORE</span> | base64 -di &gt; android/app/keystore.jks</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´ç”¨ Flutter åšäº†ä¸€ä¸ªå¼€æºçš„é¡¹ç›® &lt;a href=&quot;https://github.com/lt94/RSSAid&quot;&gt;RSSAi</summary>
      
    
    
    
    
    <category term="Github Action" scheme="https://leetaogoooo.github.io/tags/Github-Action/"/>
    
    <category term="Flutter" scheme="https://leetaogoooo.github.io/tags/Flutter/"/>
    
  </entry>
  
</feed>
