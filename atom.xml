<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Leetao&#39;s Blog</title>
  
  <subtitle>Talk is cheap, show me the code</subtitle>
  <link href="https://leetaogoooo.github.io/atom.xml" rel="self"/>
  
  <link href="https://leetaogoooo.github.io/"/>
  <updated>2022-11-16T16:00:00.000Z</updated>
  <id>https://leetaogoooo.github.io/</id>
  
  <author>
    <name>Leetao</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Django 3.2 Boolean Field åœ¨ MySQL ä¸­å¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„é—®é¢˜</title>
    <link href="https://leetaogoooo.github.io/2022/11/17/Django%203.2%20Boolean%20Field%20%E5%9C%A8%20MySQL%20%E4%B8%AD%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://leetaogoooo.github.io/2022/11/17/Django%203.2%20Boolean%20Field%20%E5%9C%A8%20MySQL%20%E4%B8%AD%E5%AF%BC%E8%87%B4%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E7%9A%84%E9%97%AE%E9%A2%98/</id>
    <published>2022-11-16T16:00:00.000Z</published>
    <updated>2022-11-16T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å…¬å¸æœ‰ä¸ªé¡¹ç›®ä½¿ç”¨ Django å¼€å‘çš„ï¼Œå‰æ®µæ—¶é—´æˆ‘ä»¬æŠŠ Django çš„ç‰ˆæœ¬å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬äº†,ç„¶åå°±å‡ºç°é—®é¢˜äº†ï¼Œæˆ‘ä»¬å‘ç°ç”Ÿäº§ç¯å¢ƒå‡ºç°äº†ä¸€ä¸ªæ…¢ SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">not</span> is_delete</span><br></pre></td></tr></table></figure><p>ä¼¼ä¹çœ‹ç€å¾ˆæ­£å¸¸çš„ä¸€ä¸ª SQLï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ª <strong>is_delete</strong> å­—æ®µï¼Œåœ¨ <code>model.py</code> ä¸­æ˜¯ä½¿ç”¨ <code>BooleanField</code></p><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>ä¸Šé¢å·²ç»è¯´åˆ°äº†æˆ‘ä»¬ä½¿ç”¨çš„å­—æ®µç±»ä¼¼æ˜¯ <code>BooleanField</code>,è€Œæˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®åº“æ˜¯ MySQL æ•°æ®åº“ï¼ŒMySQL æ•°æ®åº“åŸç”Ÿå­—æ®µç±»å‹æ²¡æœ‰ bool ç±»å‹ï¼Œæ‰€ä»¥ Django æ˜¯ä»¥ <code>tinyint</code> å»å®ç°çš„ï¼Œæ‰€ä»¥é—®é¢˜å°±æ¥äº†ï¼Œå½“ä½ æŠŠä¸€ä¸ª <code>tinyint</code> å­—æ®µå½“æˆ <code>bool</code> å­—æ®µå»ä½¿ç”¨ï¼Œå°±ä¼šå‡ºç° <strong>ç±»å‹è½¬æ¢</strong> çš„é—®é¢˜ï¼Œè¿™å°±æ˜¯ç´¢å¼•ä¹‹æ‰€ä»¥å¤±æ•ˆçš„åŸå› ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆåœ¨ä¹‹å‰çš„ç‰ˆæœ¬æ²¡æœ‰å‡ºç°å‘¢ï¼Ÿ</p><p>å› ä¸ºåœ¨ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œä¸Šé¢çš„ SQL åœ¨ Django ä¼šæ˜¯è¿™æ ·ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> is_delete <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>åœ¨ Django 3.2 ç‰ˆæœ¬ä¹‹åå°±å˜æˆäº†å‰è¨€ä¸­çš„é‚£ä¸ª SQL äº†ï¼Œä¹Ÿæœ‰äººå¯¹æ­¤æå‡ºäº†ç–‘é—®ï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œå®˜æ–¹æœ€åå¹¶æ²¡æœ‰ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥åç»­åœ¨å…¶ä»–æ•°æ®åº“ä¸­ä½¿ç”¨ <code>BooleanField</code> éœ€è¦å°¤å…¶æ³¨æ„âš ï¸ã€‚</p><h1 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h1><p>å®˜æ–¹æ²¡æœ‰ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨æˆ·å°±è§£å†³äº†ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰è§£å†³åŠæ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†æ¶‰åŠ <code>BooleanField</code> çš„ ORM æ”¹æˆå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.<span class="built_in">filter</span>(bool_field=models.Value(<span class="number">0</span>)) <span class="comment"># models.Value(1)</span></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://code.djangoproject.com/ticket/32691">Performance regression in Exact lookup on BooleanField on MySQL.</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å…¬å¸æœ‰ä¸ªé¡¹ç›®ä½¿ç”¨ Django å¼€å‘çš„ï¼Œå‰æ®µæ—¶é—´æˆ‘ä»¬æŠŠ Django çš„ç‰ˆæœ¬å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬äº†,ç„¶åå°±å‡ºç°é—®é¢˜äº†ï¼Œæˆ‘ä»¬å‘ç°ç”Ÿäº§ç¯å¢ƒå‡ºç°äº†ä¸€ä¸ªæ…¢</summary>
      
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="django" scheme="https://leetaogoooo.github.io/tags/django/"/>
    
    <category term="mysql" scheme="https://leetaogoooo.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Python ä¸­è°ƒç”¨ Go ä»£ç </title>
    <link href="https://leetaogoooo.github.io/2022/10/28/Python%20%E4%B8%AD%E8%B0%83%E7%94%A8%20Go%20%E4%BB%A3%E7%A0%81/"/>
    <id>https://leetaogoooo.github.io/2022/10/28/Python%20%E4%B8%AD%E8%B0%83%E7%94%A8%20Go%20%E4%BB%A3%E7%A0%81/</id>
    <published>2022-10-27T16:00:00.000Z</published>
    <updated>2022-10-27T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Python å¯ä»¥é€šè¿‡ <a href="https://docs.python.org/3/library/ctypes.html">ctypes</a> æ¨¡å—è°ƒç”¨ C è¯­è¨€å®ç°çš„å‡½æ•°ï¼Œè°ƒç”¨çš„æ–¹å¼å¾ˆç®€å•ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ª c æ–‡ä»¶ï¼Œç„¶åç¼–å†™å¯¹åº”çš„å‡½æ•°</li><li>ä½¿ç”¨ c ç¼–è¯‘å™¨åˆ›å»ºä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼ˆ.soï¼‰</li><li>åœ¨ Python æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ª <code>CDLL</code> çš„å®ä¾‹</li><li>æœ€åé€šè¿‡ <code>&#123;CDLL_instance&#125;.&#123;function_name&#125;(&#123;function_parameters&#125;)</code> æ ¼å¼è°ƒç”¨ c è¯­è¨€å¯¹åº”çš„å‡½æ•°</li></ol><h2 id="æ­¥éª¤ä¸€"><a href="#æ­¥éª¤ä¸€" class="headerlink" title="æ­¥éª¤ä¸€"></a>æ­¥éª¤ä¸€</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  my_functions.c.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">square</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> i * i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ­¥éª¤äºŒ"><a href="#æ­¥éª¤äºŒ" class="headerlink" title="æ­¥éª¤äºŒ"></a>æ­¥éª¤äºŒ</h2><p>ä½¿ç”¨ä¸‹è¿°å‘½ä»¤ï¼Œåˆ›å»º so æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc -fPIC -shared -o my_functions.so my_functions.c</span><br></pre></td></tr></table></figure><p><img src="https://user-images.githubusercontent.com/10162120/198480454-c0ee5a37-8143-415b-b45d-9291880d9f82.png" alt="ç¼–è¯‘ç”Ÿæˆ so æ–‡ä»¶"></p><h3 id="æ­¥éª¤ä¸‰-amp-å››"><a href="#æ­¥éª¤ä¸‰-amp-å››" class="headerlink" title="æ­¥éª¤ä¸‰&amp;å››"></a>æ­¥éª¤ä¸‰&amp;å››</h3><p>è°ƒç”¨ C çš„å‡½æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; from ctypes import *</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; so_file = <span class="string">&quot;/Users/leetao/workspace/python/test/my_functions.so&quot;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; my_functions = CDLL(so_file)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; <span class="built_in">print</span>(<span class="built_in">type</span>(my_functions))</span></span><br><span class="line">&lt;class &#x27;ctypes.CDLL&#x27;&gt;</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; <span class="built_in">print</span>(my_functions.square(10))</span></span><br><span class="line">100</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; <span class="built_in">print</span>(my_functions.square(8))</span></span><br><span class="line">64</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span> </span><br></pre></td></tr></table></figure><h1 id="è°ƒç”¨-GO-ä»£ç "><a href="#è°ƒç”¨-GO-ä»£ç " class="headerlink" title="è°ƒç”¨ GO ä»£ç "></a>è°ƒç”¨ GO ä»£ç </h1><p>ä»ä¸Šé¢çš„ C è¯­è¨€çš„è°ƒç”¨è¿‡ç¨‹ï¼Œä¸éš¾å‘ç°ï¼Œæœ€é‡è¦çš„æ˜¯ç”Ÿæˆçš„ <code>.so</code> æ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å°† go ç¼–è¾‘æˆ <code>.so</code> æ–‡ä»¶å°±å¯ä»¥å¾—åˆ° Python è°ƒç”¨ Go çš„ç›®çš„äº†ã€‚</p><h2 id="CGO"><a href="#CGO" class="headerlink" title="CGO"></a>CGO</h2><p>Go æœ‰ä¸ªæ ‡å‡†åº“ <a href="https://pkg.go.dev/cmd/cgo">CGO</a> å¯ä»¥ç”¨æ¥åˆ›å»ºè°ƒç”¨ C ä»£ç çš„ Go åŒ…ï¼Œå½“ç„¶åè¿‡æ¥ä¹Ÿå¯ä»¥ã€‚</p><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span>  <span class="comment">//å¿…é¡»å¼•å…¥Cåº“</span></span><br><span class="line">â€‹</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line">â€‹</span><br><span class="line"><span class="comment">//åŠ å…¥ä¸‹é¢æ³¨é‡Šä»£ç ï¼Œè¡¨ç¤ºå¯¼å‡ºï¼Œå¯ä»¥è¢«pythonè°ƒç”¨</span></span><br><span class="line">â€‹</span><br><span class="line"><span class="comment">//export Sum</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line">â€‹</span><br><span class="line">â€‹</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">//å¿…é¡»åŠ ä¸€ä¸ªmainå‡½æ•°ï¼Œä½œä¸ºCGOç¼–è¯‘çš„å…¥å£ï¼Œæ— å…·ä½“å®ç°ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ul><li>æ³¨é‡Š //export Sum åœ¨ç¼–è¯‘ åŠ¨æ€åº“ï¼ˆdll ,soï¼‰çš„æ—¶å€™æ˜¯å¿…é¡»çš„ï¼Œè¯´æ˜äº†åŠ¨æ€åº“éœ€è¦è¾“å‡ºçš„å‡½æ•°</li><li> mainå‡½æ•°å¿…é¡»å†™ï¼Œæ²¡æœ‰æ‰§è¡Œä»£ç ï¼Œä½œä¸ºCGOç¼–è¯‘çš„å…¥å£</li><li>å¿…é¡»å¼•å…¥Cåº“ï¼ˆimport â€œCâ€ï¼‰</li></ul><h3 id="ç¼–è¯‘åŠ¨æ€åº“"><a href="#ç¼–è¯‘åŠ¨æ€åº“" class="headerlink" title="ç¼–è¯‘åŠ¨æ€åº“"></a>ç¼–è¯‘åŠ¨æ€åº“</h3><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œç¼–è¯‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go build -buildmode=c-shared -o s1.so s1.go</span><br></pre></td></tr></table></figure><p>æ³¨æ„ğŸ“¢ï¼š</p><ul><li>-oè¡¨ç¤ºè¾“å‡ºï¼Œs1.so è¡¨ç¤ºç¼–è¯‘æˆsoæ–‡ä»¶çš„åå­—ï¼Œs1.goè¡¨ç¤ºç¼–è¯‘å“ªä¸ªgoæ–‡ä»¶</li><li>â€œ-s -wâ€ é€‰é¡¹ç”¨äºå‡å°ç”ŸæˆåŠ¨æ€é“¾æ¥åº“çš„ä½“ç§¯ï¼Œ-s æ˜¯å‹ç¼©ï¼Œ-w æ˜¯å»æ‰è°ƒè¯•ä¿¡æ¯<br> <code>go build -ldflags &quot;-s -w&quot; -o main.dll -buildmode=c-shared s1.go</code></li><li>ç¼–è¯‘æ¨¡å¼buildmode:</li></ul><img width="707" alt="ç¼–è¯‘æ¨¡å¼" src="https://user-images.githubusercontent.com/10162120/198488629-bc443f2b-6e8a-4fc7-9654-458066afe740.png"><h3 id="ä½¿ç”¨-Python-è¯­è¨€è°ƒç”¨"><a href="#ä½¿ç”¨-Python-è¯­è¨€è°ƒç”¨" class="headerlink" title="ä½¿ç”¨ Python è¯­è¨€è°ƒç”¨"></a>ä½¿ç”¨ Python è¯­è¨€è°ƒç”¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> cdll</span><br><span class="line"></span><br><span class="line">lib = cdll.LoadLibrary(<span class="string">&#x27;./s1.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è°ƒç”¨goè¯­è¨€çš„Sum</span></span><br><span class="line">result = lib.Sum(<span class="number">100</span>, <span class="number">200</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>Python å’Œ GO ä¹‹é—´çš„å‚æ•°ä¼ é€’éœ€è¦ç»è¿‡ C çš„ç–å¿½ç±»å‹è½¬æ¢ï¼Œæ‰€ä»¥è¿˜éœ€è¦äº†è§£ python ä¸­ ctypes æ•°æ®ç±»å‹å’Œ python æ•°æ®ç±»å‹ä»¥åŠ C çš„æ•°æ®ç±»å‹å¯¹åº”å…³ç³»</p><p>ä¸‰ç§æ•°æ®ç±»å‹ä½¿ç”¨åœºæ™¯ï¼š</p><ol><li>ctypesæ•°æ®ç±»å‹ä¸ºæŒ‡å®šè°ƒç”¨å‡½æ•°æ—¶çš„ä¼ å…¥å‚æ•°å’Œè¿”å›å€¼çš„æ•°æ®ç±»å‹</li><li>pythonæ•°æ®ç±»å‹ä¸ºè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°çš„æ•°æ®ç±»å‹</li><li>Cçš„æ•°æ®ç±»å‹ä¸ºgoä»£ç ä¸­å®šä¹‰çš„å‡½æ•°æ‰€éœ€çš„å‚æ•°å’Œè¿”å›å€¼æ•°æ®ç±»å‹</li></ol><p><a href="https://docs.python.org/3.9/library/ctypes.html#fundamental-data-types">å¯¹åº”å…³ç³»</a>å¦‚ä¸‹ï¼š</p><img width="799" alt="å¯¹åº”å…³ç³»" src="https://user-images.githubusercontent.com/10162120/198492039-adffc174-0fb9-411d-a2b3-c5e43036c6dc.png"><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå†™å¦‚ä¸‹çš„ go ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//export hello</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(namePtr *C.char)</span></span>&#123;</span><br><span class="line">   name := C.GoString(namePtr)</span><br><span class="line">   log.Println(<span class="string">&quot;Hello&quot;</span>, name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬çš„ Python è°ƒç”¨ä»£ç ä¸­å‚æ•°ç±»å‹ä¹Ÿéœ€è¦å¯¹åº”èµ·æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello = library.hello</span><br><span class="line">hello.argtypes = [ctypes.c_char_p]</span><br><span class="line">hello(<span class="string">&quot;everyone&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ul><li><a href="https://pkg.go.dev/cmd/cgo">cgo</a></li><li><a href="https://pkg.go.dev/cmd/cgo">Running Go code from Python</a></li><li><a href="https://zhuanlan.zhihu.com/p/355538331">Pythonè°ƒç”¨Goè¯­è¨€ç¼–è¯‘çš„åŠ¨æ€é“¾æ¥åº“-Pythonå’ŒGoè¯­è¨€æ··ç¼–</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;Python å¯ä»¥é€šè¿‡ &lt;a href=&quot;https://docs.python.org/3/library/ctypes.html&quot;&gt;ct</summary>
      
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="go" scheme="https://leetaogoooo.github.io/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>Pure åŸºäº Github Discussion çš„åšå®¢</title>
    <link href="https://leetaogoooo.github.io/2022/10/28/open_source_pure/"/>
    <id>https://leetaogoooo.github.io/2022/10/28/open_source_pure/</id>
    <published>2022-10-27T16:00:00.000Z</published>
    <updated>2022-10-27T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨è¿‡å»ä¸€å¹´ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨ github action + hexo çš„æ–¹å¼å»è‡ªåŠ¨åŒ–éƒ¨ç½²æˆ‘çš„åšå®¢åˆ° github pagesï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„å°±æ˜¯ï¼Œä½ åªéœ€è¦é…ç½®å¥½ä¸€æ¬¡å°†ä»£ç ä»“åº“ï¼Œç„¶åä½ å°±åªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨ç„¶åå†™ hexo æ ¼å¼çš„ markdown æ–‡ä»¶å°±å¤Ÿäº†ã€‚</p><p>ä¸‹é¢æ˜¯æˆ‘çš„æ„å»ºå†å²è®°å½•</p><img width="1299" alt="æ„å»ºå†å²è®°å½•" src="https://user-images.githubusercontent.com/10162120/198286370-4333398a-c452-4358-b678-679a43b073c8.png"><p>åˆ°ç›®å‰ä½ç½®ç´¯è®¡æ„å»ºäº† 93 æ¬¡ï¼Œå½“ç„¶å¹¶ä¸æ˜¯æ„å‘³ç€æˆ‘å†™äº† 93 ç¯‡ï¼Œæ›´æ–°ä¹Ÿä¼šå¯¼è‡´æ–‡ç« é‡æ–°æ„å»ºã€‚è¿™ä¸€åˆ‡ä¼¼ä¹çœ‹ç€è¿˜ä¸é”™ï¼Œä½†æ˜¯æœ‰å‡ ç‚¹ä¸€ç›´è®©æˆ‘è§‰å¾—å¾ˆç—›è‹¦ï¼š</p><ol><li>hexo markdown æ–‡ç« å¼€å¤´çš„æ ¼å¼</li><li>ä¸Šä¼ å›¾ç‰‡</li><li>æ–‡ç« çš„æ›´æ–°</li></ol><p>hexo æœ‰å¾ˆå¤šå›ºå®šçš„æ ¼å¼ï¼Œæœ‰æ—¶å€™æ¯æ¬¡å†™æ–‡ç« ï¼Œæˆ‘éƒ½ä¸å¾—ä¸å»æ‰¾ä¹‹å‰çš„æ–‡ç« æŠŠæ ¼å¼å¤åˆ¶è¿‡æ¥ï¼Œç„¶ååœ¨é‡æ–°ä¿®æ”¹ä¸€ä¸‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå°±æ˜¯ä¸Šä¼ å›¾ç‰‡è¿™ä»¶äº‹æƒ…äº†ï¼Œå°è¯•è¿‡å„ç§å›¾åºŠçš„æ–¹æ¡ˆï¼Œæœ‰çš„å›¾åºŠä¹Ÿå¾ˆå¥½ç”¨ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½éœ€è¦æ‰“å¼€ä»–ä»¬çš„ç½‘ç«™ï¼Œæˆ–è€…å€ŸåŠ©ä¸‰æ–¹çš„è½¯ä»¶ç„¶åå°†å›¾ç‰‡ä¸Šä¼ ï¼Œè¿™ç§ä¸­æ–­ï¼Œè®©æˆ‘è§‰å¾—å¾ˆéš¾å—ï¼Œæ‰€ä»¥æˆ‘æƒ³æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼å»å†™åšå®¢ã€‚</p><span id="more"></span><h1 id="è°ƒç ”"><a href="#è°ƒç ”" class="headerlink" title="è°ƒç ”"></a>è°ƒç ”</h1><p>ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œgithub æ˜¯æˆ‘æœ€å–œæ¬¢é€›çš„ç½‘ç«™äº†ï¼Œæ‰€ä»¥æˆ‘åœ¨æƒ³æœ‰æ²¡æœ‰å¯ä»¥åŸºäº github çš„ä»“åº“æ„å»ºçš„ç½‘ç«™ï¼Œç„¶å github issue å’Œ github discussion å°±æˆäº†æˆ‘çš„å¤‡é€‰é¡¹äº†ï¼Œæ‰€ä»¥æˆ‘æ£€ç´¢äº†è¿™ä¸¤ä¸ªå…³é”®è¯</p><p><img width="400" alt="github issue blog" src="https://user-images.githubusercontent.com/10162120/198289445-ec7717f6-1cab-4ab2-b5c4-cc3f22337a16.png"><img width="400" alt="github discussion blog" src="https://user-images.githubusercontent.com/10162120/198289620-7622338b-896e-45a5-943d-35d2ee4ba96d.png"></p><p>æœ€åè®©æˆ‘å‘ç°äº† <a href="https://github.com/lencx/z">æµ®ä¹‹é™</a></p><img width="1679" alt="æµ®ä¹‹é™" src="https://user-images.githubusercontent.com/10162120/198290666-1380f9a5-2919-49af-9854-75b733bac6cd.png"><p>ç½‘ç«™æŒºå¥½çœ‹çš„ï¼Œä½†æ˜¯ä½†æ˜¯æ²¡æœ‰éƒ¨ç½²æ–‡æ¡£ï¼Œé‚æ”¾å¼ƒäº†ã€‚</p><h1 id="æŠ˜è…¾"><a href="#æŠ˜è…¾" class="headerlink" title="æŠ˜è…¾"></a>æŠ˜è…¾</h1><p>æ²¡åŠæ³•äº†ï¼Œæ²¡æœ‰æªæ²¡æœ‰ç‚®ï¼Œæ•Œäººç»™æˆ‘ä»¬é€ ï¼Œæ²¡æœ‰åˆé€‚çš„é¡¹ç›®ï¼Œåªå¥½è‡ªå·±åŠ¨æ‰‹æ’¸äº†ã€‚ç‰ºç‰²äº†æˆ‘ä¸¤ä¸ªå·¥ä½œæ—¥æ™šä¸Šçš„ä¼‘æ¯æ—¶é—´ï¼Œæ€»ç®—æŠŠ <a href="https://github.com/LeetaoGoooo/pure">Pure</a> åˆç‰ˆæ„å»ºå‡ºæ¥äº†ã€‚</p><img width="1207" alt="Pure" src="https://user-images.githubusercontent.com/10162120/198291338-e7c090b1-0aaa-4530-956e-66c916dbc0df.png"><p>éƒ¨ç½²ä¹Ÿå¾ˆç®€å•ï¼Œgolang é¡¹ç›®é€šç”¨éƒ¨ç½²æ­¥éª¤ï¼Œåªéœ€è¦éƒ¨ç½²å‰é…ç½®ä¸€ä¸‹å››ä¸ªç¯å¢ƒå˜é‡ï¼ˆä¸€ä¸ªéå¿…é¡»çš„ï¼‰ï¼Œç„¶åå¯åŠ¨é¡¹ç›®ï¼Œé…ç½®ä¸€ä¸‹ nginx å°±å¤§åŠŸå‘Šæˆäº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨è¿‡å»ä¸€å¹´ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨ github action + hexo çš„æ–¹å¼å»è‡ªåŠ¨åŒ–éƒ¨ç½²æˆ‘çš„åšå®¢åˆ° github pagesï¼Œè¿™ç§æ–¹å¼çš„å¥½å¤„å°±æ˜¯ï¼Œä½ åªéœ€è¦é…ç½®å¥½ä¸€æ¬¡å°†ä»£ç ä»“åº“ï¼Œç„¶åä½ å°±åªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨ç„¶åå†™ hexo æ ¼å¼çš„ markdown æ–‡ä»¶å°±å¤Ÿäº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘çš„æ„å»ºå†å²è®°å½•&lt;/p&gt;
&lt;img width=&quot;1299&quot; alt=&quot;æ„å»ºå†å²è®°å½•&quot; src=&quot;https://user-images.githubusercontent.com/10162120/198286370-4333398a-c452-4358-b678-679a43b073c8.png&quot;&gt;

&lt;p&gt;åˆ°ç›®å‰ä½ç½®ç´¯è®¡æ„å»ºäº† 93 æ¬¡ï¼Œå½“ç„¶å¹¶ä¸æ˜¯æ„å‘³ç€æˆ‘å†™äº† 93 ç¯‡ï¼Œæ›´æ–°ä¹Ÿä¼šå¯¼è‡´æ–‡ç« é‡æ–°æ„å»ºã€‚è¿™ä¸€åˆ‡ä¼¼ä¹çœ‹ç€è¿˜ä¸é”™ï¼Œä½†æ˜¯æœ‰å‡ ç‚¹ä¸€ç›´è®©æˆ‘è§‰å¾—å¾ˆç—›è‹¦ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;hexo markdown æ–‡ç« å¼€å¤´çš„æ ¼å¼&lt;/li&gt;
&lt;li&gt;ä¸Šä¼ å›¾ç‰‡&lt;/li&gt;
&lt;li&gt;æ–‡ç« çš„æ›´æ–°&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;hexo æœ‰å¾ˆå¤šå›ºå®šçš„æ ¼å¼ï¼Œæœ‰æ—¶å€™æ¯æ¬¡å†™æ–‡ç« ï¼Œæˆ‘éƒ½ä¸å¾—ä¸å»æ‰¾ä¹‹å‰çš„æ–‡ç« æŠŠæ ¼å¼å¤åˆ¶è¿‡æ¥ï¼Œç„¶ååœ¨é‡æ–°ä¿®æ”¹ä¸€ä¸‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå°±æ˜¯ä¸Šä¼ å›¾ç‰‡è¿™ä»¶äº‹æƒ…äº†ï¼Œå°è¯•è¿‡å„ç§å›¾åºŠçš„æ–¹æ¡ˆï¼Œæœ‰çš„å›¾åºŠä¹Ÿå¾ˆå¥½ç”¨ï¼Œä½†æ˜¯åŸºæœ¬ä¸Šéƒ½éœ€è¦æ‰“å¼€ä»–ä»¬çš„ç½‘ç«™ï¼Œæˆ–è€…å€ŸåŠ©ä¸‰æ–¹çš„è½¯ä»¶ç„¶åå°†å›¾ç‰‡ä¸Šä¼ ï¼Œè¿™ç§ä¸­æ–­ï¼Œè®©æˆ‘è§‰å¾—å¾ˆéš¾å—ï¼Œæ‰€ä»¥æˆ‘æƒ³æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼å»å†™åšå®¢ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Golang" scheme="https://leetaogoooo.github.io/tags/Golang/"/>
    
    <category term="å¼€æº" scheme="https://leetaogoooo.github.io/tags/%E5%BC%80%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>assert may not work as expected</title>
    <link href="https://leetaogoooo.github.io/2022/10/12/assert-may-not-work-as-expected/"/>
    <id>https://leetaogoooo.github.io/2022/10/12/assert-may-not-work-as-expected/</id>
    <published>2022-10-11T16:00:00.000Z</published>
    <updated>2022-10-11T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>assert (æ–­è¨€) æ˜¯åœ¨ç¼–ç è¿‡ç¨‹ä¸­å¸¸ç”¨çš„æ‰‹æ®µï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example.py</span></span><br><span class="line"><span class="comment"># assert_stmt ::=  &quot;assert&quot; expression [&quot;,&quot; expression]</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_admin</span>(<span class="params">user_roles</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(user_roles,<span class="built_in">list</span>) <span class="keyword">and</span> user_roles != [], <span class="string">&quot;No user roles found&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> user_roles, <span class="string">&quot;No admin role found.&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You have full access to the application.&quot;</span>)</span><br></pre></td></tr></table></figure><span id="more"></span><p>ä¸Šé¢çš„è¡¨è¾¾å¼å…¶å®ç­‰ä»·äº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_admin</span>(<span class="params">user_roles</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="literal">__debug__</span>:</span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">isinstance</span>(user_roles,<span class="built_in">list</span>) <span class="keyword">and</span> user_roles != [], <span class="string">&quot;No user roles found&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="literal">__debug__</span>:</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> user_roles, <span class="string">&quot;No admin role found.&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You have full access to the application.&quot;</span>)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>__debug__</code> æ˜¯å†…ç½®å˜é‡ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º <code>True</code>,è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ª <code>user_roles = [&#39;admin&#39;,&#39;guest&#39;]</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>is_admin([<span class="string">&#x27;admin&#x27;</span>,<span class="string">&#x27;guest&#x27;</span>])</span><br><span class="line">You have full access to the application.</span><br></pre></td></tr></table></figure><p>å¦‚æœä¼ å…¥ <code>[&#39;guest&#39;]</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> line <span class="number">4</span>, <span class="keyword">in</span> is_admin</span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> user_roles, <span class="string">&quot;No admin role found.&quot;</span></span><br><span class="line">AssertionError: No admin role found.</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æœ‰åŠæ³•æ”¹å˜ <code>__debug__</code> çš„å€¼ä¸º <code>False</code>,é‚£ä¹ˆä¸Šé¢çš„å‡½æ•°å°†æ°¸è¿œä¸ä¼šå‡ºç° <code>AssertionError</code>,å°è¯•ç›´æ¥å»ä¿®æ”¹è¿™ä¸ªå‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="literal">__debug__</span> = <span class="literal">False</span></span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span></span><br><span class="line">SyntaxError: cannot assign to <span class="literal">__debug__</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ç›´æ¥ä¿®æ”¹æ˜¯è¡Œä¸é€šçš„ï¼Œä½†æ˜¯å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸‹è¿è¡Œçš„æ—¶å€™è®¾ç½® <strong><a href="https://docs.python.org/3/using/cmdline.html#envvar-PYTHONOPTIMIZE">PYTHONOPTIMIZE</a></strong> è¾¾åˆ°ä¿®æ”¹ <code>__debug__</code> çš„ç›®çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â¯ python -O example.py</span><br><span class="line">You have full access to the application.</span><br></pre></td></tr></table></figure><p>æ‰€åœ¨åœ¨ä½¿ç”¨ assert æ—¶å€™éœ€è¦æ³¨æ„å¯åŠ¨ç¨‹åºçš„å‘½ä»¤ï¼Œé¿å… assert å¤±æ•ˆå¯¼è‡´ç¨‹åºå‡ºç°é—®é¢˜ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;assert (æ–­è¨€) æ˜¯åœ¨ç¼–ç è¿‡ç¨‹ä¸­å¸¸ç”¨çš„æ‰‹æ®µï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# example.py&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# assert_stmt ::=  &amp;quot;assert&amp;quot; expression [&amp;quot;,&amp;quot; expression]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;is_admin&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;user_roles&lt;/span&gt;):&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;isinstance&lt;/span&gt;(user_roles,&lt;span class=&quot;built_in&quot;&gt;list&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; user_roles != [], &lt;span class=&quot;string&quot;&gt;&amp;quot;No user roles found&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;#x27;admin&amp;#x27;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; user_roles, &lt;span class=&quot;string&quot;&gt;&amp;quot;No admin role found.&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;You have full access to the application.&amp;quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>paging problem in one to many query of mybatis</title>
    <link href="https://leetaogoooo.github.io/2022/08/29/paging-problem-in-one-to-many-query-of-mybatis/"/>
    <id>https://leetaogoooo.github.io/2022/08/29/paging-problem-in-one-to-many-query-of-mybatis/</id>
    <published>2022-08-28T16:00:00.000Z</published>
    <updated>2022-08-28T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>mybatis æ”¯æŒä¸€å¯¹å¤šçš„å…³ç³»æ˜ å°„ï¼Œå¦‚æœéœ€è¦åœ¨è¿™ç§å…³ç³»ä¸‹ï¼Œä½¿ç”¨ pagehelper çš„è¯ï¼Œéœ€è¦æ³¨æ„åŸæœ¬çš„ sql ä»¥åŠ resultmap çš„ç”¨æ³•, å¦åˆ™å¯èƒ½ä¼šå¯¼è‡´ pagehelper è¿”å›çš„ total æ¯”é¢„æœŸçš„æ•°é‡å¤§ã€‚</p><span id="more"></span><h1 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h1><h2 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;authorWithBlogsResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;AuthorWithBlogs&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;blogs&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;blog_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAuthorWithBlog&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;authorWithBlogsResult&quot;</span>&gt;</span></span><br><span class="line">  select a.*,b.* from author2blog ab</span><br><span class="line">  inner join author a</span><br><span class="line">  on a.id = ab.author_id</span><br><span class="line">  inner join blog b</span><br><span class="line">  on b.id = ab.blog_id</span><br><span class="line">  where ab.id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="pojo"><a href="#pojo" class="headerlink" title="pojo"></a>pojo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorWithBlogs</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="keyword">private</span> List&lt;Blog&gt;;    </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Blog</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">   <span class="keyword">private</span> String title;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä½œè€…å†™äº†ä¸¤ç¯‡æ–‡ç« ï¼Œ è°ƒç”¨ <code>selectAuthorWithBlog</code> è¿™ä¸ªæ–¹æ³•ï¼Œä¼šå‘ç°è¿”å›çš„å®é™…æ•°é‡æ˜¯ <strong>1</strong> æ¡ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ <code>pagehelper</code> å»è·å– <code>total</code> ï¼Œè¿”å›çš„ <code>total</code> æ˜¯ <strong>2</strong> æ¡ï¼Œè¿™ä¸ªä¸éš¾ç†è§£ï¼Œä¸Šé¢çš„ sql å®é™…æ‰§è¡Œç»“æœä¹Ÿæ˜¯ <strong>2</strong> æ¡ï¼Œ<code>pagehelper</code> çš„è·å– <code>total</code> ä¹Ÿæ˜¯æ ¹æ®å¯¹åŸ sql çš„ç»“æœè¿›è¡Œ <code>count</code> å¾—å‡ºçš„ã€‚</p><h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><p>åµŒå¥— select æŸ¥è¯¢ï¼ˆ<a href="https://mybatis.org/mybatis-3/sqlmap-xml.html#nested-select-for-collection">Nested Select for Collection</a>ï¼‰</p><p>å°†åŸæœ¬çš„å…³è”æŸ¥è¯¢ï¼Œä» mapper ä¸­æŠ½ç¦»ï¼Œä½¿ç”¨ <strong>åµŒå¥— select æŸ¥è¯¢</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;authorWithBlogsResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;AuthorWithBlogs&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;blogs&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">select</span>=<span class="string">&quot;selectBlogByAuthor&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;blog_id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlogByAuthor&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">    select b.id as &#x27;blog_id&#x27;,b.title from author2blog ab</span><br><span class="line">    inner join blog b</span><br><span class="line">    on ab.blog_id = b.id</span><br><span class="line">    where ab.author_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAuthorWithBlog&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;authorWithBlogsResult&quot;</span>&gt;</span></span><br><span class="line">  select * from author</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸»è¦ä¿®æ”¹æ˜¯åœ¨ <strong>select=â€selectBlogByAuthorâ€ column=â€idâ€</strong></p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/paging%20problem%20in%20one%20to%20many%20query%20of%20mybatis-01.png"></p><p>è¿™ä¸ªæ—¶å€™ pagehelper çš„æŸ¥è¯¢ç»“æœå°±è¿”å›æ­£å¸¸äº†ã€‚</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://blog.csdn.net/m0_67942533/article/details/125382052">Mybatisä¸­å¦‚ä½•å®ç°ä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šçš„å…³è”æŸ¥è¯¢</a></p><p><a href="https://blog.csdn.net/SkyCloud_/article/details/117339388?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-117339388-blog-105325244.pc_relevant_aa&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-117339388-blog-105325244.pc_relevant_aa&utm_relevant_index=2">å…³äºmybatisæ˜ å°„æ–‡ä»¶ä¸­è¡¨ä¸€å¯¹å¤šæ—¶åˆ†é¡µå¼‚å¸¸è§£å†³æ–¹æ³•</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;mybatis æ”¯æŒä¸€å¯¹å¤šçš„å…³ç³»æ˜ å°„ï¼Œå¦‚æœéœ€è¦åœ¨è¿™ç§å…³ç³»ä¸‹ï¼Œä½¿ç”¨ pagehelper çš„è¯ï¼Œéœ€è¦æ³¨æ„åŸæœ¬çš„ sql ä»¥åŠ resultmap çš„ç”¨æ³•, å¦åˆ™å¯èƒ½ä¼šå¯¼è‡´ pagehelper è¿”å›çš„ total æ¯”é¢„æœŸçš„æ•°é‡å¤§ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="mybatis" scheme="https://leetaogoooo.github.io/tags/mybatis/"/>
    
    <category term="java" scheme="https://leetaogoooo.github.io/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Python å­—ç¬¦ä¸²ç±»å‹æšä¸¾å®ç°</title>
    <link href="https://leetaogoooo.github.io/2022/07/10/string-based-enum-in-python/"/>
    <id>https://leetaogoooo.github.io/2022/07/10/string-based-enum-in-python/</id>
    <published>2022-07-09T16:00:00.000Z</published>
    <updated>2022-07-09T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Python çš„æšä¸¾ä¹Ÿæ˜¯ä¸€ä¸ªåœ¨æ—¶å¸¸è¢«è¢«ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨ Python3.11 ä¹‹å‰ï¼ŒPython æ ‡å‡†åº“æ”¯æŒæšä¸¾ç±»å‹é™¤äº†æšä¸¾åŸºç±» Enumï¼Œå°±åªæœ‰ IntEnum äº†(åˆ›å»º int å­æšä¸¾ç±»å‹å¸¸é‡çš„åŸºç±»)ï¼ŒPython 3.11 å¼€å§‹æ”¯æŒäº† StrEnumï¼Œå¦‚æœä½ çš„å½“å‰ä½¿ç”¨ç‰ˆæœ¬æ˜¯ Python3.11 åˆ™å¯ä»¥ç•¥è¿‡ä¸€ä¸‹å†…å®¹ã€‚<br>æ¥ä¸‹æ¥è¦ä»‹ç»çš„å†…å®¹ï¼Œåˆ™æ˜¯åœ¨ Python3.11 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¦‚ä½•å®ç° StrEnum ä»¥åŠä¸€äº›æ³¨æ„äº‹é¡¹ã€‚</p><span id="more"></span><h1 id="StrEnum-çš„å®ç°"><a href="#StrEnum-çš„å®ç°" class="headerlink" title="StrEnum çš„å®ç°"></a>StrEnum çš„å®ç°</h1><p>StrEnum çš„å®ç°å¾ˆç®€å•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrEnum</span>(<span class="params"><span class="built_in">str</span>, Enum</span>):</span></span><br><span class="line">  <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>å½“å­ç±»åŒ–Â <a href="https://docs.python.org/zh-cn/3.10/library/enum.html#enum.Enum">Enum</a>Â æ—¶ï¼Œåœ¨åŸºç±»åºåˆ—ä¸­çš„æ··åˆç±»å‹å¿…é¡»å‡ºç°äºÂ <a href="https://docs.python.org/zh-cn/3.10/library/enum.html#enum.Enum">Enum</a>Â æœ¬èº«ä¹‹å‰,å¦åˆ™ä¼šæŠ¥é”™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">StrEnum</span>(<span class="params">Enum,<span class="built_in">str</span></span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">&quot;/usr/local/Cellar/python@3.9/3.9.5/Frameworks/Python.framework/Versions/3.9/lib/python3.9/enum.py&quot;</span>, line <span class="number">172</span>, <span class="keyword">in</span> __prepare__</span><br><span class="line">    member_type, first_enum = metacls._get_mixins_(cls, bases)</span><br><span class="line">  File <span class="string">&quot;/usr/local/Cellar/python@3.9/3.9.5/Frameworks/Python.framework/Versions/3.9/lib/python3.9/enum.py&quot;</span>, line <span class="number">587</span>, <span class="keyword">in</span> _get_mixins_</span><br><span class="line">    <span class="keyword">raise</span> TypeError(<span class="string">&quot;new enumerations should be created as &quot;</span></span><br><span class="line">TypeError: new enumerations should be created <span class="keyword">as</span> `EnumName([mixin_type, ...] [data_type,] enum_type)`</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åŒæ ·å¾ˆç®€å•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">WorkDay</span>(<span class="params"><span class="built_in">str</span>, Enum</span>):</span></span><br><span class="line"><span class="meta">... </span>  Mon = <span class="string">&quot;Mon&quot;</span></span><br><span class="line"><span class="meta">... </span>  Tue = <span class="string">&quot;Tue&quot;</span></span><br><span class="line"><span class="meta">... </span>  Wed = <span class="string">&quot;Wed&quot;</span></span><br><span class="line"><span class="meta">... </span>  Thu = <span class="string">&quot;Thu&quot;</span></span><br><span class="line"><span class="meta">... </span>  Fri = <span class="string">&quot;Fri&quot;</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>WorkDay.Mon</span><br><span class="line">&lt;WorkDay.Mon: <span class="string">&#x27;Mon&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>WorkDay.Mon == <span class="string">&quot;Mon&quot;</span></span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><h2 id="StrEnum-å’Œ-auto"><a href="#StrEnum-å’Œ-auto" class="headerlink" title="StrEnum å’Œ auto()"></a>StrEnum å’Œ auto()</h2><p>ä½¿ç”¨è¿‡ Enum çš„è‚¯å®šå¯¹ auto è¿™ä¸ªä¸é™Œç”Ÿï¼Œå®ƒä¼šä»¥åˆé€‚çš„å€¼ä»£æ›¿ Enum çš„å®ä¾‹ï¼Œé»˜è®¤ä» 1 å¼€å§‹ï¼Œåœ¨ StrEnum åˆ™æ˜¯ä»¥ â€œ1â€ çš„å­—ç¬¦ä¸²å½¢å¼å¼€å§‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">AutoStr</span>(<span class="params"><span class="built_in">str</span>, Enum</span>):</span></span><br><span class="line"><span class="meta">... </span>    a = auto()</span><br><span class="line"><span class="meta">... </span>    b = auto()</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>AutoStr.a</span><br><span class="line">&lt;AutoStr.a: <span class="string">&#x27;1&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>AutoStr.b</span><br><span class="line">&lt;AutoStr.b: <span class="string">&#x27;2&#x27;</span>&gt;</span><br></pre></td></tr></table></figure><h1 id="auto"><a href="#auto" class="headerlink" title="auto()"></a>auto()</h1><p>å¦‚æœå¸Œæœ›å¯ä»¥è‡ªå®šä¹‰ auto çš„èµ·å§‹å€¼çš„è¯ï¼Œä½ å¯ä»¥è¿™æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">CustomAuto</span>(<span class="params">Enum</span>):</span></span><br><span class="line"><span class="meta">... </span>    a = <span class="number">3</span></span><br><span class="line"><span class="meta">... </span>    b = auto()</span><br><span class="line"><span class="meta">... </span>    c = auto()</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>CustomAuto.a</span><br><span class="line">&lt;CustomAuto.a: <span class="number">3</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>CustomAuto.b</span><br><span class="line">&lt;CustomAuto.b: <span class="number">4</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>CustomAuto.c</span><br><span class="line">&lt;CustomAuto.c: <span class="number">5</span>&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>_generate_next_value_</code> æ–¹æ³•å»å®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">Enum</span>):</span></span><br><span class="line"><span class="meta">... </span>    <span class="function"><span class="keyword">def</span> <span class="title">_generate_next_value_</span>(<span class="params">name, start, count, last_values</span>):</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">return</span> count+<span class="number">10</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">A</span>):</span></span><br><span class="line"><span class="meta">... </span>    a = auto()</span><br><span class="line"><span class="meta">... </span>    b = auto()</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>B.a</span><br><span class="line">&lt;B.a: <span class="number">10</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>B.b</span><br><span class="line">&lt;B.b: <span class="number">11</span>&gt;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><p><a href="https://docs.python.org/zh-cn/3.10/library/enum.html">python-enum</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;Python çš„æšä¸¾ä¹Ÿæ˜¯ä¸€ä¸ªåœ¨æ—¶å¸¸è¢«è¢«ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨ Python3.11 ä¹‹å‰ï¼ŒPython æ ‡å‡†åº“æ”¯æŒæšä¸¾ç±»å‹é™¤äº†æšä¸¾åŸºç±» Enumï¼Œå°±åªæœ‰ IntEnum äº†(åˆ›å»º int å­æšä¸¾ç±»å‹å¸¸é‡çš„åŸºç±»)ï¼ŒPython 3.11 å¼€å§‹æ”¯æŒäº† StrEnumï¼Œå¦‚æœä½ çš„å½“å‰ä½¿ç”¨ç‰ˆæœ¬æ˜¯ Python3.11 åˆ™å¯ä»¥ç•¥è¿‡ä¸€ä¸‹å†…å®¹ã€‚&lt;br&gt;æ¥ä¸‹æ¥è¦ä»‹ç»çš„å†…å®¹ï¼Œåˆ™æ˜¯åœ¨ Python3.11 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¦‚ä½•å®ç° StrEnum ä»¥åŠä¸€äº›æ³¨æ„äº‹é¡¹ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>MySQL çš„ Field æ‚è°ˆ</title>
    <link href="https://leetaogoooo.github.io/2022/05/11/MySQL%20%E7%9A%84%20Field%20%E6%9D%82%E8%B0%88/"/>
    <id>https://leetaogoooo.github.io/2022/05/11/MySQL%20%E7%9A%84%20Field%20%E6%9D%82%E8%B0%88/</id>
    <published>2022-05-10T16:00:00.000Z</published>
    <updated>2022-05-10T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><code>Field</code> æ˜¯ MySQL ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åŸºæœ¬ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š<br><strong>ä½œç”¨</strong>ï¼š<br>ç”¨äºè¿”å›æŒ‡å®šå€¼åœ¨ç»™å®šå€¼åˆ—è¡¨ä¸­çš„ç´¢å¼•ä½ç½®<br><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FIELD(value, val1, val2, val3, ...)</span><br></pre></td></tr></table></figure><span id="more"></span><p><strong>ä¾‹å­</strong>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT FIELD(&quot;q&quot;, &quot;s&quot;, &quot;q&quot;, &quot;l&quot;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ sql å°±æ˜¯è¿”å›å­—æ¯ <code>q</code> åœ¨ <code>s,q,l</code> ä¸­çš„ä½ç½®ï¼Œè¿™é‡Œå’Œç¼–ç¨‹è¯­è¨€ä¸­ä¸ä¸€æ ·ï¼Œè¿”å›çš„ä¸‹æ ‡æ˜¯ä» 1 å¼€å§‹çš„ï¼Œæ‰€ä»¥ä¸Šè¿°çš„è¿”å›ç»“æœæ˜¯ <code>2</code></p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141356.png"></p><p>å¦‚æœæŸ¥æ‰¾çš„å­—ç¬¦ä¸åœ¨åˆ—è¡¨é‡Œå‘¢ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT field(&quot;a&quot;,&quot;s&quot;, &quot;q&quot;, &quot;l&quot;);</span><br></pre></td></tr></table></figure><p>è¿”å›ä¸º 0 ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141448.png"></p><h1 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h1><p>è¯´å®Œäº†ï¼ŒåŸºæœ¬ç”¨æ³•ï¼Œè¯´ä¸€ä¸‹ Field çš„åº”ç”¨åœºæ™¯ï¼Œå•çº¯ä»å‡½æ•°æ¨æµ‹å‡ºå®ƒçš„åº”ç”¨åœºæ™¯ï¼Œä½†æ˜¯å®ƒçš„å®é™…åº”ç”¨åœºæ™¯ï¼Œåœ¨æŸç§ç¨‹åº¦ä¸Šè¿˜æ˜¯å¾ˆå®ç”¨çš„ï¼Œå®ƒå¯ä»¥<strong>è‡ªå®šä¹‰æ’åº</strong>ã€‚<br>æ‰€è°“çš„è‡ªå®šä¹‰æ’åºå°±æ˜¯æŒ‰ç…§æˆ‘ä»¬ç»™å®šçš„é¡ºåºå¯¹æ•°æ®ç»“æœè¿›è¡Œæ’åºï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡ <code>order by field</code> æ— å¤–ä¹å°±æ˜¯é™åºæˆ–è€…å‡åºæ’åˆ—ï¼Œä½†æ˜¯åœ¨æŸäº›ç‰¹æ®Šçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½é¢„æœŸæŒ‰ç…§è‡ªå·±çš„è§„åˆ™å»å®šä¹‰æ’åºã€‚</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>å¦‚ä¸‹è¡¨æ‰€ç¤º</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141521.png"></p><p>é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæ˜¾ç„¶æ˜¯æŒ‰ç…§ id è¿›è¡Œå‡åºæ’åˆ—çš„ï¼Œä½†æ˜¯å¦‚æœéœ€è¦æŒ‰ç…§äººå <code>a,c,b,d</code>æ¥æ’åºã€‚ä¹Ÿå°±æ˜¯ <code>name=a,c,b,d</code> æ¥æ’åºã€‚<br>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å€Ÿç”± <code>field</code> å‡½æ•°å»å®ç°äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user ORDER BY FIELD(name, &#x27;a&#x27;,&#x27;c&#x27;,&#x27;b&#x27;,&#x27;d&#x27;)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹:</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141543.png"></p><h1 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h1><p>ç°åœ¨ user è¡¨é‡Œæ–°å¢äº†ä¸‰æ¡è®°å½•:</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141633.png"></p><p>ç°åœ¨æœ‰è¿™æ ·å­çš„éœ€æ±‚ï¼Œéœ€è¦å°†è®°å½•å…ˆæŒ‰ç…§ <code>x,y,z</code> æ’åºï¼Œåé¢æŒ‰ç…§æ­£å¸¸æ’åºå³ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141654.png"></p><p>å¦‚ä½•å¯ä»¥åšåˆ°ï¼Ÿ<br>åŸç†å…¶å®å¾ˆç®€å•ï¼Œå½’æ ¹ç»“åº•å°±æ˜¯ <code>order by</code> å’Œ <code>field</code> çš„è”åˆåº”ç”¨ã€‚é¦–å…ˆéœ€è¦æ˜ç™½ï¼Œ<code>order by</code> çš„æ’åºåŸç†ï¼Œ<code>order by</code> åŸç†å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯<strong>æŒ‰ç…§æˆ‘ä»¬ç»™å®šçš„æ’åºå­—æ®µï¼ˆå‡åºæˆ–è€…é™åºæ’åˆ—ï¼‰</strong></p><h2 id="ä¸ºä»€ä¹ˆ-â€˜aâ€™-â€™câ€™-â€™bâ€™-â€™dâ€™"><a href="#ä¸ºä»€ä¹ˆ-â€˜aâ€™-â€™câ€™-â€™bâ€™-â€™dâ€™" class="headerlink" title="ä¸ºä»€ä¹ˆ â€˜aâ€™,â€™câ€™,â€™bâ€™,â€™dâ€™"></a>ä¸ºä»€ä¹ˆ â€˜aâ€™,â€™câ€™,â€™bâ€™,â€™dâ€™</h2><p>è¿™ä¸ªæ—¶å€™ï¼Œå†å›åˆ°æœ€åˆ user è¡¨åªæœ‰å››æ¡è®°å½•æ—¶ï¼ŒæŒ‰ç…§ a,c,b,d æ’åº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user ORDER BY FIELD(name, &#x27;a&#x27;,&#x27;c&#x27;,&#x27;b&#x27;,&#x27;d&#x27;)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª sql å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><p>æˆ‘ä»¬ç”¨ <code>Field</code> å‡½æ•°æ„å»ºäº†ä¸€ä¸ªä¸´æ—¶çš„æ’åºå­—æ®µï¼Œä¸åŒçš„ name è¿”å›åœ¨ field ä¸‹è¿”å›ä¸åŒçš„å€¼ï¼Œç›¸å½“äºæ„æˆäº†ä¸€ä¸ªæ–°çš„ <code>sort_field</code> å­—æ®µ</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141739.png"></p><p>æ‰€ä»¥è¿™ä¸ªæ—¶å€™ç»“æœå°±ä¼šæŒ‰ç…§ <code>a,c,b,d</code> çš„é¡ºåºæ’åˆ—äº†ã€‚</p><h2 id="å¦‚ä½•-x-y-z-ç„¶å-a-b-c-d"><a href="#å¦‚ä½•-x-y-z-ç„¶å-a-b-c-d" class="headerlink" title="å¦‚ä½• x,y,z ç„¶å a,b,c,d"></a>å¦‚ä½• x,y,z ç„¶å a,b,c,d</h2><p>é¦–å…ˆå¦‚æœå¦‚æœæŒ‰ç…§ <code>x,y,z</code> åœ¨æœ€å‰é¢çš„è¦æ±‚ï¼Œsql åº”å½“æ˜¯:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user ORDER BY FIELD(name, &#x27;x&#x27;,&#x27;y&#x27;,&#x27;z&#x27;)</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141829.png"></p><p>è¿™ä¸ªæ—¶å€™çš„ <code>sort_field</code> è¡¨ç°æ˜¯è¿™æ ·å­çš„ï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141848.png"></p><p>æˆ‘ä»¬é¢„æœŸçš„åº”å½“æ˜¯</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141907.png"></p><p>å¦‚æœåªæ˜¯å°†æ’åºç”±å‡åºæ”¹ä¸ºé™åº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user ORDER BY FIELD(name, &#x27;x&#x27;,&#x27;y&#x27;,&#x27;z&#x27;) DESC</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ç»“æœå¦‚ä¸‹:</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141928.png"></p><p>è¿™ä¸ªç»“æœå·²ç»æ¥è¿‘ é¢„æœŸäº†ï¼Œæˆ‘ä»¬åªéœ€è¦å°† <code>field</code> åé¢çš„ <code>x,y,z</code> å˜æˆ <code>z,y,x</code> å°±å¯ä»¥äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM user ORDER BY FIELD(name, &#x27;z&#x27;,&#x27;y&#x27;,&#x27;x&#x27;) DESC</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹:</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/20220511141944.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;&lt;code&gt;Field&lt;/code&gt; æ˜¯ MySQL ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åŸºæœ¬ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š&lt;br&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼š&lt;br&gt;ç”¨äºè¿”å›æŒ‡å®šå€¼åœ¨ç»™å®šå€¼åˆ—è¡¨ä¸­çš„ç´¢å¼•ä½ç½®&lt;br&gt;&lt;strong&gt;è¯­æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;FIELD(value, val1, val2, val3, ...)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="MySQL" scheme="https://leetaogoooo.github.io/categories/MySQL/"/>
    
    
    <category term="MySQL" scheme="https://leetaogoooo.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Python åˆ—è¡¨å†…å­˜é¢„åˆ†é…é—®é¢˜</title>
    <link href="https://leetaogoooo.github.io/2022/04/12/Python%20%E5%88%97%E8%A1%A8%E5%86%85%E5%AD%98%E9%A2%84%E5%88%86%E9%85%8D%E9%97%AE%E9%A2%98/"/>
    <id>https://leetaogoooo.github.io/2022/04/12/Python%20%E5%88%97%E8%A1%A8%E5%86%85%E5%AD%98%E9%A2%84%E5%88%86%E9%85%8D%E9%97%AE%E9%A2%98/</id>
    <published>2022-04-11T16:00:00.000Z</published>
    <updated>2022-04-11T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»¥ä¸‹ä¾‹å­å‡çš„è¿è¡Œç¯å¢ƒä¸º Python 3.9.5ï¼Œä¸åŒç‰ˆæœ¬çš„å®é™…è¿è¡Œç»“æœå¯èƒ½æœ‰æ‰€ä¸åŒ</p></blockquote><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰ç«¯æ—¶é—´çœ‹äº† Golang çš„ å­¦ä¹ äº†ä¸€ä¸‹ æ•°ç»„ å’Œ Sliceï¼Œå…¶ä¸­ Slice ç›¸å½“äºåŠ¨æ€æ•°ç»„ï¼Œå…¶ä¸­æ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè€Œ Slice åˆ™æ˜¯ä¸å®šé•¿çš„ã€‚åœ¨ Python ä¸­æ˜¯æ²¡æœ‰æ•°ç»„å’Œ Slice çš„æ¦‚å¿µï¼Œå®ƒä»¬å¯ä»¥é€šé€šå½’ç±»ä¸º Listï¼ˆåˆ—è¡¨ï¼‰ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå®šé•¿çš„ List å’Œ ä¸å®šé•¿çš„ List åœ¨è¡¨ç°ä¸Šä¼šæœ‰åŒºåˆ«å—ï¼Ÿï¼ˆè¿™é‡Œçš„å®šé•¿çš„ List æ˜¯æŒ‡å¯¹ List è¿›è¡Œåˆå§‹åŒ–,ä¹Ÿå°±æ˜¯æ‰€è°“çš„é¢„åˆ†é…ï¼‰<br>æ¥ä¸‹æ¥é€šè¿‡å‡ ä¸ªä¾‹å­å»éªŒè¯è¿™ä¸ªé—®é¢˜ã€‚</p><span id="more"></span><h1 id="å®éªŒè¿‡ç¨‹"><a href="#å®éªŒè¿‡ç¨‹" class="headerlink" title="å®éªŒè¿‡ç¨‹"></a>å®éªŒè¿‡ç¨‹</h1><p>é¦–å…ˆéªŒè¯ä¸€ä¸‹ ç©ºåˆ—è¡¨ ä»¥åŠåœ¨ä¸æ–­æ–°å¢å…ƒç´ çš„æƒ…å†µä¸‹ List çš„ size çš„å˜åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> getsizeof</span><br><span class="line"></span><br><span class="line">l = []</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;ç©ºåˆ—è¡¨:<span class="subst">&#123;getsizeof(l)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    l.append(l)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;å­˜åœ¨<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>å…ƒç´ çš„åˆ—è¡¨:<span class="subst">&#123;getsizeof(l)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç©ºåˆ—è¡¨:56</span><br><span class="line">å­˜åœ¨1å…ƒç´ çš„åˆ—è¡¨:88</span><br><span class="line">å­˜åœ¨2å…ƒç´ çš„åˆ—è¡¨:88</span><br><span class="line">å­˜åœ¨3å…ƒç´ çš„åˆ—è¡¨:88</span><br><span class="line">å­˜åœ¨4å…ƒç´ çš„åˆ—è¡¨:88</span><br><span class="line">å­˜åœ¨5å…ƒç´ çš„åˆ—è¡¨:120</span><br><span class="line">å­˜åœ¨6å…ƒç´ çš„åˆ—è¡¨:120</span><br><span class="line">å­˜åœ¨7å…ƒç´ çš„åˆ—è¡¨:120</span><br><span class="line">å­˜åœ¨8å…ƒç´ çš„åˆ—è¡¨:120</span><br><span class="line">å­˜åœ¨9å…ƒç´ çš„åˆ—è¡¨:184</span><br><span class="line">å­˜åœ¨10å…ƒç´ çš„åˆ—è¡¨:184</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/image_1649729308457_0.png"></p><p>ä»ä¸Šé¢çš„è¿è¡Œç»“æœå¯ä»¥å‘ç°ï¼Œå…¶å® List ä¹Ÿå­˜åœ¨ä¸€å®šçš„æ‰©å®¹æœºåˆ¶çš„ï¼Œåˆ—è¡¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­å°†ä¼šç”³è¯·ä¸€ä¸ªå­˜å‚¨å››ä¸ªå…ƒç´ çš„å­˜å‚¨åŒºï¼Œå½“å­˜å‚¨åŒºå¡«æ»¡æ—¶ï¼Œåˆ—è¡¨ä¼šå†æ¬¡ç”³è¯·å››ä¸ªå­˜å‚¨ç©ºé—´å­˜å‚¨å…ƒç´ ã€‚å½“å…ƒç´ é‡è¾¾åˆ°åŸå­˜å‚¨ç©ºé—´çš„ä¸¤å€æ—¶ï¼Œåˆ—è¡¨ä¼šå†æ¬¡ç”³è¯·åŸæ¥æ—§çš„å­˜å‚¨ç©ºé—´çš„ä¸¤å€çš„å®¹é‡å­˜å‚¨å…ƒç´ ã€‚</p><p>ä¸ç®¡ä»»ä½•è¯­è¨€åœ¨ä¸€æ—¦è¿›è¡Œæ‰©å®¹æ“ä½œå¿…ç„¶ä¼šå­˜åœ¨ï¼š<br>      1. é‡æ–°ç”³è¯·å†…å­˜<br>        2. å¤åˆ¶è€æ•°ç»„åˆ°æ–°çš„å†…å­˜<br>        3. å›æ”¶è€æ•°ç»„çš„å†…å­˜</p><p>ä¸Šé¢çš„è¿‡ç¨‹å¦‚æœå‡ºç°çš„æ¬¡æ•°æ¯”è¾ƒé¢‘ç¹å¿…ç„¶ä¼šå¯¼è‡´è¿è¡Œé€Ÿåº¦çš„é™ä½ï¼Œé‚£ä¹ˆç©¶ç«Ÿä¼šé™ä½å¤šå°‘å‘¢ï¼Ÿ</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>ä»¥ä¸‹ä¾‹å­è¿è¡Œç¯å¢ƒä¸º ipython</p><h3 id="æ²¡æœ‰ä»»ä½•å¤„ç†çš„ä¾‹å­"><a href="#æ²¡æœ‰ä»»ä½•å¤„ç†çš„ä¾‹å­" class="headerlink" title="æ²¡æœ‰ä»»ä½•å¤„ç†çš„ä¾‹å­"></a>æ²¡æœ‰ä»»ä½•å¤„ç†çš„ä¾‹å­</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%%timeit</span><br><span class="line">l=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    l.append(i)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-04-12_%E4%B8%8B%E5%8D%882.42.23_1649745745624_0.png"></p><h3 id="é¢„åˆ†é…åçš„åˆ—è¡¨"><a href="#é¢„åˆ†é…åçš„åˆ—è¡¨" class="headerlink" title="é¢„åˆ†é…åçš„åˆ—è¡¨"></a>é¢„åˆ†é…åçš„åˆ—è¡¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%%timeit</span><br><span class="line">size = <span class="number">1000</span></span><br><span class="line">l = [<span class="literal">None</span>] * size</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">    l[i] = i</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨éå†ä¹‹å‰ï¼Œç»™åˆ—è¡¨ l é¢„å…ˆåˆ†é…äº†ä¸€ä¸ªé•¿åº¦ä¸º 1000 çš„ None çš„ç©ºæ•°ç»„ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-04-12_%E4%B8%8B%E5%8D%882.45.50_1649745952420_0.png"></p><p>ä»è¿™ä¸¤ä¸ªä¾‹å­ä¸éš¾çœ‹å‡ºï¼Œå¦‚æœé¢„å…ˆçŸ¥é“è¦ä½¿ç”¨æ•°ç»„çš„å¤§å°ï¼Œå¹¶ä¸”å¯¹åˆ—è¡¨è¿›è¡Œåˆå§‹åŒ–çš„è¯ï¼Œæ˜¯å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜è¿è¡Œæ•ˆç‡çš„ã€‚</p><h1 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h1><p>ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼é€Ÿåº¦ä¼šæ›´å¿«ã€‚</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-04-12_%E4%B8%8B%E5%8D%882.50.30_1649746232891_0.png"></p><p>åˆ—è¡¨é¢„å…ˆé…å¯èƒ½å¹¶ä¸é€‚åˆå¤æ‚åœºæ™¯ï¼Œä½†æ˜¯ä¸€æ—¦æœ‰ç¬¦åˆè¿™ä¸ªç‰¹æ®Šåœºæ™¯çš„æƒ…å†µä¸‹æ•ˆæœåº”è¯¥æ˜¯è›®ä¸é”™çš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ä¾‹å­å‡çš„è¿è¡Œç¯å¢ƒä¸º Python 3.9.5ï¼Œä¸åŒç‰ˆæœ¬çš„å®é™…è¿è¡Œç»“æœå¯èƒ½æœ‰æ‰€ä¸åŒ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‰ç«¯æ—¶é—´çœ‹äº† Golang çš„ å­¦ä¹ äº†ä¸€ä¸‹ æ•°ç»„ å’Œ Sliceï¼Œå…¶ä¸­ Slice ç›¸å½“äºåŠ¨æ€æ•°ç»„ï¼Œå…¶ä¸­æ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè€Œ Slice åˆ™æ˜¯ä¸å®šé•¿çš„ã€‚åœ¨ Python ä¸­æ˜¯æ²¡æœ‰æ•°ç»„å’Œ Slice çš„æ¦‚å¿µï¼Œå®ƒä»¬å¯ä»¥é€šé€šå½’ç±»ä¸º Listï¼ˆåˆ—è¡¨ï¼‰ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå®šé•¿çš„ List å’Œ ä¸å®šé•¿çš„ List åœ¨è¡¨ç°ä¸Šä¼šæœ‰åŒºåˆ«å—ï¼Ÿï¼ˆè¿™é‡Œçš„å®šé•¿çš„ List æ˜¯æŒ‡å¯¹ List è¿›è¡Œåˆå§‹åŒ–,ä¹Ÿå°±æ˜¯æ‰€è°“çš„é¢„åˆ†é…ï¼‰&lt;br&gt;æ¥ä¸‹æ¥é€šè¿‡å‡ ä¸ªä¾‹å­å»éªŒè¯è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ä¼˜åŒ–" scheme="https://leetaogoooo.github.io/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>è¯´è¯´ Django orm çš„ bulk_update</title>
    <link href="https://leetaogoooo.github.io/2022/04/12/%E8%AF%B4%E8%AF%B4%20Django%20orm%20%E7%9A%84%20bulk_update/"/>
    <id>https://leetaogoooo.github.io/2022/04/12/%E8%AF%B4%E8%AF%B4%20Django%20orm%20%E7%9A%84%20bulk_update/</id>
    <published>2022-04-11T16:00:00.000Z</published>
    <updated>2022-04-11T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»¥ä¸‹ä¾‹å­ä»¥ mysql ä¸ºå‡†</p></blockquote><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>django orm ä¸­å…³äºæ›´æ–°ï¼Œæœ‰ä¸¤ç§æ“ä½œåˆ†åˆ«æ˜¯ï¼š</p><ol><li>update</li><li>bulk_update</li></ol><p>å¯¹äº <code>create</code> å’Œ <code>bulk_create</code> è¿™ä¿©ç±»ï¼Œæ¯«æ— ç–‘é—®å­˜åœ¨å¤§é‡æ•°æ®æ’å…¥çš„æ—¶å€™ï¼Œåè€…æ•ˆç‡æ›´é«˜ä¸€äº›ã€‚ä½†æ˜¯å¯¹äºæ›´æ–°åˆ™éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œåˆ†æäº†ï¼Œäº†è§£ django æ˜¯å¦‚ä½•å®ç° <code>bulk_update</code> ï¼Œå¯¹äºæˆ‘ä»¬ä½¿ç”¨ä¼šæœ‰ä¸€å®šçš„å¥½å¤„ã€‚</p><p><code>bulk_update</code> çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Œæ¯ä¸ªéœ€è¦æ›´æ–°çš„æ•°æ®çš„ value å€¼å„ä¸ç›¸åŒï¼Œå¦‚æœæ˜¯ç›¸åŒï¼Œåˆ™æ²¡æœ‰å¿…è¦å»ä½¿ç”¨ <code>bulk_update</code></p><span id="more"></span><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><p>å¯¹äº <code>update</code> ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå°±æ˜¯åº•å±‚ sql å°±æ˜¯ä¸€ä¸ªå¸¸è§çš„ update è¯­å¥ï¼Œé‚£ä¹ˆ <code>bulk_update</code> å‘¢ï¼Ÿé¦–å…ˆè¦æ˜ç¡®çŸ¥é“ï¼Œmysql çš„ update å¹¶ä¸å­˜åœ¨ç±»ä¼¼ insert è¿™ç§ <code>insert t values (x),(y),...(z)</code> è¯­æ³•çš„ï¼Œé‚£ä¹ˆ Django ä¸­æ˜¯å¦‚ä½•å®ç° <code>bulk_update</code> å‘¢ï¼Ÿ</p><p>æºç åœ°å€ï¼š<a href="https://github.com/django/django/blob/c6b4d62fa2c7f73b87f6ae7e8cf1d64ee5312dc5/django/db/models/query.py#L723">bulk_update</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bulk_update</span>(<span class="params">self, objs, fields, batch_size=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Update the given fields in each of the given objects in the database.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">  ...</span><br><span class="line">    <span class="comment"># PK is used twice in the resulting update query, once in the filter</span></span><br><span class="line">    updates = []</span><br><span class="line">    <span class="keyword">for</span> batch_objs <span class="keyword">in</span> batches:</span><br><span class="line">        update_kwargs = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> field <span class="keyword">in</span> fields:</span><br><span class="line">            when_statements = []</span><br><span class="line">            <span class="keyword">for</span> obj <span class="keyword">in</span> batch_objs:</span><br><span class="line">                attr = <span class="built_in">getattr</span>(obj, field.attname)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(attr, <span class="string">&quot;resolve_expression&quot;</span>):</span><br><span class="line">                    attr = Value(attr, output_field=field)</span><br><span class="line">                when_statements.append(When(pk=obj.pk, then=attr))</span><br><span class="line">            case_statement = Case(*when_statements, output_field=field)</span><br><span class="line">            <span class="keyword">if</span> requires_casting:</span><br><span class="line">                case_statement = Cast(case_statement, output_field=field)</span><br><span class="line">            update_kwargs[field.attname] = case_statement</span><br><span class="line">     ...</span><br></pre></td></tr></table></figure><p>ä»æºç ä¸éš¾çœ‹å¾—å‡ºæ¥ï¼Œdjango çš„æ‰¹é‡æ›´æ–°æ˜¯é€šè¿‡ <code>case when</code> å»å®ç°çš„ã€‚</p><h1 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h1><p>ç½‘ä¸Šä¹Ÿæœ‰å¯¹äº case when å’Œå¸¸è§„ update çš„æ€§èƒ½å¯¹æ¯”ï¼Œè¿™é‡Œä¹Ÿä¸å†é€šè¿‡å®ä¾‹å¯¹æ¯”ï¼Œç›´æ¥è´´å‡ºç»“è®ºï¼š</p><h2 id="RCéš”ç¦»çº§åˆ«"><a href="#RCéš”ç¦»çº§åˆ«" class="headerlink" title="RCéš”ç¦»çº§åˆ«"></a>RCéš”ç¦»çº§åˆ«</h2><p>æ›´æ–°æ¡æ•°å°(ä¸€èˆ¬å°äº500æ¡)ï¼Œ<code>CASE WHEN</code> ä¼˜äº <code>UDPATE</code></p><p>æ›´æ–°æ¡æ•°è¾ƒå¤§(åƒçº§åˆ«)ï¼Œ<code>CASE WHEN</code> æ•ˆç‡è¿…é€Ÿä¸‹é™</p><h2 id="RRéš”ç¦»çº§åˆ«"><a href="#RRéš”ç¦»çº§åˆ«" class="headerlink" title="RRéš”ç¦»çº§åˆ«"></a>RRéš”ç¦»çº§åˆ«</h2><p><code>CASE WHEN</code> ä¼˜äº <code>UPDATE</code></p><h2 id="RCéš”ç¦»çº§åˆ«-1"><a href="#RCéš”ç¦»çº§åˆ«-1" class="headerlink" title="RCéš”ç¦»çº§åˆ«"></a>RCéš”ç¦»çº§åˆ«</h2><p>æ›´æ–°æ¡æ•°å°ï¼Œ<code>CASE WHEN</code> ä¼˜äº <code>UDPATE</code></p><p>æ›´æ–°æ¡æ•°è¾ƒå¤§(åƒçº§åˆ«)ï¼Œ<code>CASE WHEN</code> æ•ˆç‡è¿…é€Ÿä¸‹</p><h1 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h1><p>æ‰€ä»¥è¯´ï¼Œæ•°æ®è¿‡å¤šçš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨ <code>update</code> ? ç†è®ºä¸Šæ˜¯è¿™æ ·å­çš„ï¼Œä½†æ˜¯ django çš„ <code>bulk_update</code> ä¸­è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å‚æ•° <code>batch_size</code>,é€šè¿‡ <code>batch_size</code> å¯ä»¥é™åˆ¶ä¸€æ¬¡æ‰¹é‡æ›´æ–°çš„æ•°æ®é•¿åº¦ï¼Œä¹Ÿå°±é¿å…äº†å¤§é‡æ•°æ®æ›´æ–°é€ æˆçš„ä¸è‰¯å½±å“ã€‚</p><p>æœ€åéœ€è¦ bulk_update çš„æ—¶å€™ï¼Œè®°å¾—ä½¿ç”¨äº‹åŠ¡</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://docs.djangoproject.com/zh-hans/4.0/ref/models/querysets/#bulk-update">bulk_update</a></p><p><a href="https://www.reddit.com/r/django/comments/mjpbij/running_a_bulk_update_efficiently_with_django/">Running a â€˜bulk updateâ€™ efficiently with Django</a></p><p><a href="https://www.cnblogs.com/AaronCui/p/10968893.html">Mysqlæ‰¹é‡æ›´æ–°çš„ä¸‰ç§æ–¹å¼</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹ä¾‹å­ä»¥ mysql ä¸ºå‡†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;django orm ä¸­å…³äºæ›´æ–°ï¼Œæœ‰ä¸¤ç§æ“ä½œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;update&lt;/li&gt;
&lt;li&gt;bulk_update&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹äº &lt;code&gt;create&lt;/code&gt; å’Œ &lt;code&gt;bulk_create&lt;/code&gt; è¿™ä¿©ç±»ï¼Œæ¯«æ— ç–‘é—®å­˜åœ¨å¤§é‡æ•°æ®æ’å…¥çš„æ—¶å€™ï¼Œåè€…æ•ˆç‡æ›´é«˜ä¸€äº›ã€‚ä½†æ˜¯å¯¹äºæ›´æ–°åˆ™éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œåˆ†æäº†ï¼Œäº†è§£ django æ˜¯å¦‚ä½•å®ç° &lt;code&gt;bulk_update&lt;/code&gt; ï¼Œå¯¹äºæˆ‘ä»¬ä½¿ç”¨ä¼šæœ‰ä¸€å®šçš„å¥½å¤„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bulk_update&lt;/code&gt; çš„åº”ç”¨åœºæ™¯æ˜¯ï¼Œæ¯ä¸ªéœ€è¦æ›´æ–°çš„æ•°æ®çš„ value å€¼å„ä¸ç›¸åŒï¼Œå¦‚æœæ˜¯ç›¸åŒï¼Œåˆ™æ²¡æœ‰å¿…è¦å»ä½¿ç”¨ &lt;code&gt;bulk_update&lt;/code&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="ä¼˜åŒ–" scheme="https://leetaogoooo.github.io/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
    <category term="Django" scheme="https://leetaogoooo.github.io/tags/Django/"/>
    
    <category term="ORM" scheme="https://leetaogoooo.github.io/tags/ORM/"/>
    
  </entry>
  
  <entry>
    <title>Pythonè§£æJSONå¤§æ–‡ä»¶</title>
    <link href="https://leetaogoooo.github.io/2022/03/30/Python%E8%A7%A3%E6%9E%90JSON%E5%A4%A7%E6%96%87%E4%BB%B6/"/>
    <id>https://leetaogoooo.github.io/2022/03/30/Python%E8%A7%A3%E6%9E%90JSON%E5%A4%A7%E6%96%87%E4%BB%B6/</id>
    <published>2022-03-29T16:00:00.000Z</published>
    <updated>2022-03-29T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦ç”¨ Python å»å¤„ç†ä¸€äº› JSON æ–‡ä»¶ï¼Œä¸€æ—¦ JSON æ–‡ä»¶è¿‡å¤§ï¼Œå°±æœ‰å¯èƒ½å‡ºç°åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œå†…å­˜æ¶ˆè€—è¿‡å¤§çš„é—®é¢˜ï¼Œç”šè‡³ä¼šå¯¼è‡´å†…å­˜è€—å°½ã€‚æ‰€ä»¥å¦‚æœæ­£ç¡®åœ°å¤„ç†å¤§çš„ JSON æ–‡ä»¶å‘¢ï¼Ÿ</p><span id="more"></span><h1 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h1><p>é¦–å…ˆæ„é€ ä¸€ä¸ªå¤§çš„ JSON æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåœ¨ githubä¸Šå¼€æºçš„ä¸€ä¸ª json æ–‡ä»¶ <a href="https://github.com/json-iterator/test-data/blob/master/large-file.json">large-file.json</a>ï¼Œæ–‡ä»¶å¤§å°ä¸º 24.9 M</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-03-30_14.30.06_1648621812730_0.png"></p><p>æ–‡ä»¶å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;<span class="attr">&quot;id&quot;</span>:<span class="string">&quot;2489651045&quot;</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;CreateEvent&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;actor&quot;</span>:&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">665991</span>,<span class="attr">&quot;login&quot;</span>:<span class="string">&quot;petroav&quot;</span>,<span class="attr">&quot;gravatar_id&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="attr">&quot;url&quot;</span>:<span class="string">&quot;https://api.github.com/users/petroav&quot;</span>,<span class="attr">&quot;avatar_url&quot;</span>:<span class="string">&quot;https://avatars.githubusercontent.com/u/665991?&quot;</span>&#125;,</span><br><span class="line">   <span class="attr">&quot;repo&quot;</span>:&#123;<span class="attr">&quot;id&quot;</span>:<span class="number">28688495</span>,<span class="attr">&quot;name&quot;</span>:<span class="string">&quot;petroav/6.828&quot;</span>,<span class="attr">&quot;url&quot;</span>:<span class="string">&quot;https://api.github.com/repos/petroav/6.828&quot;</span>&#125;,</span><br><span class="line">   <span class="attr">&quot;payload&quot;</span>:&#123;<span class="attr">&quot;ref&quot;</span>:<span class="string">&quot;master&quot;</span>,<span class="attr">&quot;ref_type&quot;</span>:<span class="string">&quot;branch&quot;</span>,<span class="attr">&quot;master_branch&quot;</span>:<span class="string">&quot;master&quot;</span>,<span class="attr">&quot;description&quot;</span>:<span class="string">&quot;Solution to homework and assignments from MIT&#x27;s 6.828 (Operating Systems Engineering). Done in my spare time.&quot;</span>,<span class="attr">&quot;pusher_type&quot;</span>:<span class="string">&quot;user&quot;</span>&#125;,</span><br><span class="line">   <span class="attr">&quot;public&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;created_at&quot;</span>:<span class="string">&quot;2015-01-01T15:00:00Z&quot;</span>&#125;,</span><br><span class="line">...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¼šé€šè¿‡ä¸åŒçš„æ–¹æ¡ˆå»è§£æè¿™ä¸ªjsonæ–‡ä»¶ï¼Œç„¶åæå–å¯¹åº”çš„ actor.id å’Œ repo.id çš„å†…å®¹ï¼Œå€ŸåŠ© fileprofiler å»éªŒè¯ä¸åŒæ–¹æ¡ˆä¸­å†…å­˜çš„æ¶ˆè€—æƒ…å†µã€‚</p><h2 id="ä½¿ç”¨å†…ç½®æ ‡å‡†åº“-json"><a href="#ä½¿ç”¨å†…ç½®æ ‡å‡†åº“-json" class="headerlink" title="ä½¿ç”¨å†…ç½®æ ‡å‡†åº“-json"></a>ä½¿ç”¨å†…ç½®æ ‡å‡†åº“-json</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;large-file.json&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br><span class="line"></span><br><span class="line">user_to_repos = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> record <span class="keyword">in</span> data:</span><br><span class="line">    user = record[<span class="string">&quot;actor&quot;</span>][<span class="string">&quot;login&quot;</span>]</span><br><span class="line">    repo = record[<span class="string">&quot;repo&quot;</span>][<span class="string">&quot;name&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> user <span class="keyword">not</span> <span class="keyword">in</span> user_to_repos:</span><br><span class="line">        user_to_repos[user] = <span class="built_in">set</span>()</span><br><span class="line">    user_to_repos[user].add(repo)</span><br></pre></td></tr></table></figure><p>é€šè¿‡ fileprofiler çœ‹ä¸€ä¸‹è¿è¡Œç»“æœï¼š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-03-30_%E4%B8%8B%E5%8D%885.08.57_1648631340541_0.png"></p><p>ä»ä¸Šé¢çš„å›¾ï¼Œä¸éš¾çœ‹å‡ºï¼Œå†…å­˜é‡ç¾åŒºä¸ºä¸¤å¤„ï¼š<br>    1. è¯»å–æ–‡ä»¶<br>    2. ç»“æœè¿›è¡Œ decode</p><p>çœ‹ä¸€ä¸‹ <code>json</code> æ¨¡å—çš„<a href="https://github.com/python/cpython/blob/15da2a2723245710f1bd2c7cbd5b450532ae7728/Lib/json/__init__.py#L293">å®ç°æºç </a>ï¼Œä¸éš¾å‘ç°ï¼Œåœ¨è§£æä¹‹å‰ï¼Œ<code>json.load()</code> å°†æ•´ä¸ªæ–‡ä»¶éƒ½åŠ è½½åˆ°å†…å­˜å½“ä¸­å»äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span>(<span class="params">fp, *, cls=<span class="literal">None</span>, object_hook=<span class="literal">None</span>, parse_float=<span class="literal">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">        parse_int=<span class="literal">None</span>, parse_constant=<span class="literal">None</span>, object_pairs_hook=<span class="literal">None</span>, **kw</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Deserialize ``fp`` (a ``.read()``-supporting file-like object containing</span></span><br><span class="line"><span class="string">    a JSON document) to a Python object.</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> loads(fp.read(),...)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ˜¾ç„¶æ˜“è§ï¼Œå¦‚æœç›´æ¥åŠ è½½æ–‡ä»¶å°†ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå€¼å¾—æ€è€ƒçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ–‡ä»¶å¤§å°åªæœ‰ 24.9 Mï¼Œè€Œä½¿ç”¨çš„å†…å­˜ç«Ÿç„¶é«˜è¾¾ 124 M å‘¢ï¼Ÿè¿™ä¸ªä¸»è¦æ˜¯å’Œ Python å­—ç¬¦ä¸²çš„å†…å­˜è¡¨ç¤º æœ‰å…³ï¼Œç®€å•çœ‹ä¸€ä¸‹ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">&quot;a&quot;</span> * <span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s)</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getsizeof(s)</span><br><span class="line"><span class="number">1049</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s2 = <span class="string">&quot;â„&quot;</span> + <span class="string">&quot;a&quot;</span> * <span class="number">999</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s2)</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getsizeof(s2)</span><br><span class="line"><span class="number">2074</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s3 = <span class="string">&quot;ğŸš©&quot;</span> + <span class="string">&quot;a&quot;</span> * <span class="number">999</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(s3)</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.getsizeof(s3)</span><br><span class="line"><span class="number">4076</span></span><br></pre></td></tr></table></figure><p>ä¸‰ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦éƒ½æ˜¯ 1000ï¼Œä½†æ˜¯å®ƒä»¬å ç”¨çš„å†…å­˜å´æ˜¯å„ä¸ç›¸åŒï¼Œæ‰€ä»¥ JSON æ–‡ä»¶å ç”¨å†…å­˜çš„å¤§å°å¹¶ä¸æ˜¯å–å†³äºå®ƒä»¬åŒ…å«çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œæ˜¯å­—ç¬¦ä¸²é‡ŒåŒ…å«ä»€ä¹ˆç±»ä¼¼çš„å­—ç¬¦ã€‚<br>å›å½’æ­£é¢˜ï¼Œæ˜¾ç„¶ä½¿ç”¨å†…ç½®çš„æ ‡å‡†åº“ <code>json</code> çš„æ•ˆæœå¹¶ä¸æ˜¯å¾ˆç†æƒ³ï¼Œæ‰€ä»¥æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ¡ˆå‘¢ï¼Ÿå¯¹äºå¤§çš„ JSON æ–‡ä»¶å¹¶ä¸æ˜¯ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜å½“ä¸­å»ï¼Œè€Œæ˜¯æŒ‰éœ€åŠ è½½ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæœ‰ä¸€ä¸ªåç§°å«åš - æµï¼ˆstreamï¼‰<br>æœ‰å¾ˆå¤šä¸‰æ–¹åº“æ”¯æŒè¿™ä¸ªç‰¹æ€§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªåº“ <a href="https://github.com/ICRAR/ijson">ijson</a></p><h1 id="ä¸‰æ–¹åº“-ijson"><a href="#ä¸‰æ–¹åº“-ijson" class="headerlink" title="ä¸‰æ–¹åº“ - ijson"></a>ä¸‰æ–¹åº“ - ijson</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ijson</span><br><span class="line"></span><br><span class="line">user_to_repos = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;large-file.json&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> record <span class="keyword">in</span> ijson.items(f, <span class="string">&quot;item&quot;</span>):</span><br><span class="line">        user = record[<span class="string">&quot;actor&quot;</span>][<span class="string">&quot;login&quot;</span>]</span><br><span class="line">        repo = record[<span class="string">&quot;repo&quot;</span>][<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">not</span> <span class="keyword">in</span> user_to_repos:</span><br><span class="line">            user_to_repos[user] = <span class="built_in">set</span>()</span><br><span class="line">        user_to_repos[user].add(repo)</span><br></pre></td></tr></table></figure><p>åŒæ ·ä½¿ç”¨ fileprofiler çœ‹ä¸€ä¸‹è¿è¡Œç»“æœ</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%88%AA%E5%B1%8F2022-03-30_%E4%B8%8B%E5%8D%886.21.59_1648635722250_0.png"></p><p>ä»å›¾ç‰‡ä¸éš¾çœ‹å‡ºæ¥ï¼Œå†…å­˜æ¶ˆè€—ä¸€ä¸‹å­å°±é™ä½äº†ä¸‹æ¥ã€‚æ‰€ä»¥ä¸‹æ¬¡æœ‰å¤§çš„ JSON æ–‡ä»¶ï¼Œå¯ä»¥å°è¯•ç”¨ <code>ijson</code> åº“</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p> <a href="https://github.com/ICRAR/ijson">ijson</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ‰æ—¶å€™éœ€è¦ç”¨ Python å»å¤„ç†ä¸€äº› JSON æ–‡ä»¶ï¼Œä¸€æ—¦ JSON æ–‡ä»¶è¿‡å¤§ï¼Œå°±æœ‰å¯èƒ½å‡ºç°åŠ è½½æ—¶é—´è¿‡é•¿ï¼Œå†…å­˜æ¶ˆè€—è¿‡å¤§çš„é—®é¢˜ï¼Œç”šè‡³ä¼šå¯¼è‡´å†…å­˜è€—å°½ã€‚æ‰€ä»¥å¦‚æœæ­£ç¡®åœ°å¤„ç†å¤§çš„ JSON æ–‡ä»¶å‘¢ï¼Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="ä¼˜åŒ–" scheme="https://leetaogoooo.github.io/categories/%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
    <category term="JSON" scheme="https://leetaogoooo.github.io/tags/JSON/"/>
    
  </entry>
  
  <entry>
    <title>python ä¸­å®ç°ç±»æ–¹æ³•é‡è½½</title>
    <link href="https://leetaogoooo.github.io/2022/02/14/python%20%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%B1%BB%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/"/>
    <id>https://leetaogoooo.github.io/2022/02/14/python%20%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%B1%BB%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/</id>
    <published>2022-02-13T16:00:00.000Z</published>
    <updated>2022-02-13T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ Java ä¸­æœ‰ [[é‡è½½]] çš„æ¦‚å¿µï¼š</p><blockquote><p>é‡è½½(overloading) æ˜¯åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œæ–¹æ³•åå­—ç›¸åŒï¼Œè€Œå‚æ•°ä¸åŒã€‚è¿”å›ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚æ¯ä¸ªé‡è½½çš„æ–¹æ³•ï¼ˆæˆ–è€…æ„é€ å‡½æ•°ï¼‰éƒ½å¿…é¡»æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å‚æ•°ç±»å‹åˆ—è¡¨ã€‚</p></blockquote><p>Python æœ¬èº«ä¸æ”¯æŒ <code>é‡è½½</code> è¿™ä¸ªç‰¹æ€§ï¼Œä½†æ˜¯é€šè¿‡ <code>functools.singledispatch</code>  å¯ä»¥å®ç°å‡½æ•°çš„é‡è½½ã€‚æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œç®€å•åœ°æ¼”ç¤ºä¸€ä¸‹ Python çš„å‡½æ•°é‡è½½ã€‚</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch</span><br><span class="line"></span><br><span class="line"><span class="meta">@singledispatch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span>(<span class="params">arg</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@fun.register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">arg: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;arg is int: <span class="subst">&#123;arg&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@fun.register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">arg: <span class="built_in">list</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;arg is list: <span class="subst">&#123;arg&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@fun.register</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">arg: <span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;arg is str: <span class="subst">&#123;arg&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    fun([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">    fun(<span class="number">1</span>)</span><br><span class="line">    fun(<span class="string">&#x27;str&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºæŸ¥çœ‹ä¸€ä¸‹ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arg is list: [1, 2, 3]</span><br><span class="line">arg is int: 1</span><br><span class="line">arg is str: str</span><br></pre></td></tr></table></figure><p>æ ¹æ®å‚æ•°çš„ä¸åŒçš„ç±»å‹ï¼ŒæˆåŠŸäº†æ‰§è¡Œäº†å¯¹åº”çš„å‡½æ•°ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å®Œæˆäº† Python ä¸­å¯¹å‡½æ•°çš„<code>é‡è½½</code>ã€‚Java ä¸­ <code>é‡è½½</code> ä¸ä»…ä»…é’ˆå¯¹æ™®é€šå‡½æ•°ï¼Œå…¶ç±»æ–¹æ³•ä¹Ÿæ”¯æŒè¿™ä¸ªç‰¹æ€§ï¼Œé‚£ä¹ˆ Python å¦‚ä½•å®ç°ç±»æ–¹æ³•çš„<code>é‡è½½</code>å‘¢ï¼Ÿ</p><h1 id="ç±»æ–¹æ³•é‡è½½"><a href="#ç±»æ–¹æ³•é‡è½½" class="headerlink" title="ç±»æ–¹æ³•é‡è½½"></a>ç±»æ–¹æ³•é‡è½½</h1><h2 id="Python-gt-3-8"><a href="#Python-gt-3-8" class="headerlink" title="Python &gt;= 3.8"></a>Python &gt;= 3.8</h2><p>å½“ Python ç‰ˆæœ¬ä¸ä½äº 3.8 çš„æ—¶å€™ï¼Œ<code>functools</code> æ–°å¢äº†ä¸€ä¸ª <code>singledispatchmethod</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è®© Python çš„ç±»æ–¹æ³•æ”¯æŒ <code>é‡è½½</code>ï¼Œä½¿ç”¨æ–¹æ³•å’Œ <code>singledispatch</code> ç±»ä¼¼ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé‡è½½çš„ç±»å‹æ˜¯ç”±ç±»å‡½æ•°ä¸­ç¬¬ä¸€ä¸ªé <code>self</code> å’Œ <code>cls</code> çš„å‚æ•°ç±»å‹å†³å®šçš„ã€‚</p><p>çœ‹ä¸€ä¸‹å®˜æ–¹å®ä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Negator</span>:</span></span><br><span class="line"><span class="meta">    @singledispatchmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">neg</span>(<span class="params">self, arg</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;Cannot negate a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">self, arg: <span class="built_in">int</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> -arg</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">self, arg: <span class="built_in">bool</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> arg</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>singledispatchmethod</code> è¿˜æ”¯æŒåµŒå¥—çš„è£…é¥°å™¨ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>dispatcher.register</code> å’Œ <code>singledispatchmethod</code> éœ€è¦åœ¨ç»å¤§å¤šæ•°è£…é¥°å™¨çš„æœ€ä¸Šå±‚ï¼ŒåŸºäºä¸Šé¢çš„ä¾‹å­ä¿®æ”¹ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Negator</span>:</span></span><br><span class="line"><span class="meta">    @singledispatchmethod</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">neg</span>(<span class="params">cls, arg</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;Cannot negate a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">cls, arg: <span class="built_in">int</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> -arg</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">cls, arg: <span class="built_in">bool</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> arg</span><br></pre></td></tr></table></figure><h2 id="Python-lt-3-8"><a href="#Python-lt-3-8" class="headerlink" title="Python &lt; 3.8"></a>Python &lt; 3.8</h2><p>å½“ Python ç‰ˆæœ¬å°äº 3.8 çš„æ—¶å€™ï¼Œç”±äº Python æœ¬èº«ä¸æ”¯æŒç±»æ–¹æ³•çš„<code>é‡è½½</code>ï¼Œåˆ™éœ€è¦æˆ‘ä»¬è‡ªè¡Œå®ç°ã€‚åœ¨å®ç°ä¹‹å‰ï¼Œå¯ä»¥å…ˆå€Ÿé‰´ä¸€ä¸‹ [<code>singledispatch</code> çš„æºç ](<a href="https://hg.python.org/cpython/file/f6f691ff27b9/Lib/functools.py#l706">cpython: f6f691ff27b9 Lib/functools.py</a>)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">    <span class="keyword">return</span> dispatch(args[<span class="number">0</span>].__class__)(*args, **kw)</span><br></pre></td></tr></table></figure><p>ä»æºç ä¸­ä¸éš¾çœ‹å¾—å‡º <code>singledispatch</code> æœ€ç»ˆè¿”å›çš„å°±æ˜¯ä¸Šè¿°çš„ <code>wrapper</code> å‡½æ•°ï¼Œå¹¶ä¸”å‡½æ•°æ˜¯æ ¹æ®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼ˆ<code>args[0].__class__</code>ï¼‰æœ€ç»ˆæ¥å®ç°å‡½æ•°çš„<code>é‡è½½</code>çš„ï¼Œå¯¹äºå‡½æ•°è¿™ç§å®ç°æ–¹å¼æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯ç±»æ–¹æ³•çš„è¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å§‹ç»ˆæ˜¯ <code>self</code>ï¼Œåˆ™æ— æ³•è¿›è¡ŒåŒºåˆ†äº†ï¼Œ<code>é‡è½½</code>å°±æ›´æ— ä»è°ˆèµ·äº†ã€‚</p><p>æ‰€ä»¥å®ç°ç±»æ–¹æ³•çš„é‡è½½éš¾ç‚¹åœ¨äºé‡å†™ <code>wrapper</code> å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ <code>singledispatch</code> åŸºç¡€ä¸Šæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°å¯¹<code>wrapper</code> è¿›è¡Œé‡å†™ï¼ŒæŠŠ wrapper ä¸­çš„å‚æ•° <code>args[0]</code> è°ƒæ•´ä¸º <code>args[1]</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch, update_wrapper</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">methdispatch</span>(<span class="params">func</span>):</span></span><br><span class="line">    dispatcher = singledispatch(func)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">        <span class="keyword">return</span> dispatcher.dispatch(args[<span class="number">1</span>].__class__)(*args, **kw)</span><br><span class="line">    wrapper.register = dispatcher.register</span><br><span class="line">    update_wrapper(wrapper, func)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Negator</span>:</span></span><br><span class="line"><span class="meta">    @methdispatch</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">neg</span>(<span class="params">self, arg</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;Cannot negate a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">self, arg: <span class="built_in">int</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> -arg</span><br><span class="line"></span><br><span class="line"><span class="meta">    @neg.register</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_</span>(<span class="params">self, arg: <span class="built_in">bool</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> arg</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    neg = Negator()</span><br><span class="line">    neg.neg(<span class="number">1</span>)</span><br><span class="line">    neg.neg(<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-1</span><br><span class="line">True</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤æ‰‹åŠ¨å®ç°ç±»æ–¹æ³•çš„é‡è½½æˆåŠŸã€‚</p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><p>åœ¨ pypi ä¸Šä¹Ÿæœ‰å¯¹åº”çš„ <a href="https://pypi.org/project/singledispatchmethod/">singledispatchmethod Â· PyPI</a> åº“ï¼Œå¯ä»¥é€šè¿‡ pip å®‰è£…åç›´æ¥ä½¿ç”¨ï¼Œç”¨æ³•å’Œ 3.8 ä¹‹åç‰ˆæœ¬ç”¨æ³•ä¸€è‡´ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol><li><a href="https://stackoverflow.com/questions/24601722/how-can-i-use-functools-singledispatch-with-instance-methods?utm_source=pocket_mylist">python - How can I use functools.singledispatch with instance methods? - Stack Overflow</a></li><li><a href="https://hg.python.org/cpython/file/f6f691ff27b9/Lib/functools.py#l706">cpython: f6f691ff27b9 Lib/functools.py</a></li><li><a href="https://legacy.python.org/dev/peps/pep-3124/">PEP 3124 â€“ Overloading, Generic Functions, Interfaces, and Adaptation (python.org)</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ Java ä¸­æœ‰ [[é‡è½½]] çš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é‡è½½(overloading) æ˜¯åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œæ–¹æ³•åå­—ç›¸åŒï¼Œè€Œå‚æ•°ä¸åŒã€‚è¿”å›ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒã€‚æ¯ä¸ªé‡è½½çš„æ–¹æ³•ï¼ˆæˆ–è€…æ„é€ å‡½æ•°ï¼‰éƒ½å¿…é¡»æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å‚æ•°ç±»å‹åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Python æœ¬èº«ä¸æ”¯æŒ &lt;code&gt;é‡è½½&lt;/code&gt; è¿™ä¸ªç‰¹æ€§ï¼Œä½†æ˜¯é€šè¿‡ &lt;code&gt;functools.singledispatch&lt;/code&gt;  å¯ä»¥å®ç°å‡½æ•°çš„é‡è½½ã€‚æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œç®€å•åœ°æ¼”ç¤ºä¸€ä¸‹ Python çš„å‡½æ•°é‡è½½ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="singledispatch" scheme="https://leetaogoooo.github.io/tags/singledispatch/"/>
    
  </entry>
  
  <entry>
    <title>django bulk_create support post_save signal</title>
    <link href="https://leetaogoooo.github.io/2022/02/05/django-bulk-create-support-post-save-signal/"/>
    <id>https://leetaogoooo.github.io/2022/02/05/django-bulk-create-support-post-save-signal/</id>
    <published>2022-02-04T16:00:00.000Z</published>
    <updated>2022-02-04T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>django é»˜è®¤ <code>bulk_create</code> ä¸æ”¯æŒ <code>signal</code>ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ <code>models.Manager</code> æ”¯æŒè¿™ä¸ªç‰¹æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomManager</span>(<span class="params">models.Manager</span>):</span>  </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">bulk_create</span>(<span class="params">self, items, **kwargs</span>):</span>  </span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> items:  </span><br><span class="line"> post_save.send(i.__class__, instance=i, created=<span class="literal">True</span>)  </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().bulk_create(items, **kwargs)  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bulk_update</span>(<span class="params">self, items, fields, **kwargs</span>):</span>  </span><br><span class="line"> <span class="built_in">super</span>().bulk_update(items, fields, **kwargs)  </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> items:  </span><br><span class="line"> post_save.send(i.__class__, instance=i, created=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å®ä¾‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>(<span class="params">db.models</span>):</span></span><br><span class="line">objects = CustomManager()</span><br><span class="line">...</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;django é»˜è®¤ &lt;code&gt;bulk_create&lt;/code&gt; ä¸æ”¯æŒ &lt;code&gt;signal&lt;/code&gt;ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ &lt;code&gt;models.Manager&lt;/code&gt; æ”¯æŒè¿™ä¸ªç‰¹æ€§&lt;/p&gt;
&lt;figure class=&quot;highlight python</summary>
      
    
    
    
    
    <category term="django" scheme="https://leetaogoooo.github.io/tags/django/"/>
    
    <category term="orm" scheme="https://leetaogoooo.github.io/tags/orm/"/>
    
  </entry>
  
  <entry>
    <title>django orm custom mysql round function</title>
    <link href="https://leetaogoooo.github.io/2022/01/30/django-orm-custom-mysql-round-function/"/>
    <id>https://leetaogoooo.github.io/2022/01/30/django-orm-custom-mysql-round-function/</id>
    <published>2022-01-29T16:00:00.000Z</published>
    <updated>2022-01-29T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><code>Django.db.models</code> è‡ªå¸¦çš„ <code>Round</code> çš„å‡½æ•°æ²¡æœ‰ä¸æ”¯æŒå°æ•°ç‚¹ä½æ•°çš„ä¿ç•™ï¼Œé»˜è®¤ä¿ç•™2ä½ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„ <code>Func</code> å¯ä»¥å®ç°è°ƒç”¨ <code>MySQL</code> çš„ <code>ROUND</code> å‡½æ•°</p><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoundPlus</span>(<span class="params">Func</span>):</span>  </span><br><span class="line"> function = <span class="string">&#x27;ROUND&#x27;</span>  </span><br><span class="line"> template = <span class="string">&#x27;%(function)s(%(expressions)s, %(precision)s)&#x27;</span>  </span><br><span class="line">  </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *expressions, precision=<span class="number">2</span></span>):</span>  </span><br><span class="line"> <span class="built_in">super</span>().__init__(*expressions, precision=precision)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;code&gt;Django.db.models&lt;/code&gt; è‡ªå¸¦çš„ &lt;code&gt;Round&lt;/code&gt; çš„å‡½æ•°æ²¡æœ‰ä¸æ”¯æŒå°æ•°ç‚¹ä½æ•°çš„ä¿ç•™ï¼Œé»˜è®¤ä¿ç•™2ä½ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„ &lt;code&gt;Func&lt;/code&gt; å¯ä»¥å®ç°è°ƒç”¨ &lt;code&gt;MySQL&lt;/code&gt; çš„ &lt;code&gt;ROUND&lt;/code&gt; å‡½æ•°&lt;/p&gt;</summary>
    
    
    
    
    <category term="django" scheme="https://leetaogoooo.github.io/tags/django/"/>
    
    <category term="orm" scheme="https://leetaogoooo.github.io/tags/orm/"/>
    
  </entry>
  
  <entry>
    <title>Automated deployment of hexo via github action</title>
    <link href="https://leetaogoooo.github.io/2022/01/30/%E4%BD%BF%E7%94%A8%20github%20actions%20%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%20hexo%20%E5%8D%9A%E5%AE%A2/"/>
    <id>https://leetaogoooo.github.io/2022/01/30/%E4%BD%BF%E7%94%A8%20github%20actions%20%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%20hexo%20%E5%8D%9A%E5%AE%A2/</id>
    <published>2022-01-29T16:00:00.000Z</published>
    <updated>2022-01-29T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æ¯å¹´éƒ½è¦æŠ˜è…¾ä¸€ä¸‹è‡ªå·±çš„åšå®¢ï¼Œä»Šå¹´å‡†å¤‡æŠŠæ‰€æœ‰çš„åšå®¢å†æ¬¡è¿ç§»åˆ°é™æ€åšå®¢ Hexo ä¸­ï¼Œé…åˆ Github Action å®ç°ï¼Œåªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²åšå®¢ã€‚</p><span id="more"></span><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>æ•´ä½“æ€è·¯å¾ˆç®€å•ï¼Œåœ¨ä½ çš„ github-pages çš„é¡¹ç›®å»ºç«‹ä¸¤ä¸ª åˆ†æ”¯ <code>master</code> å’Œ <code>gh-pages</code>ï¼Œåœ¨ <code>gh-pages</code> åˆ†æ”¯ä¸Šå®Œæˆ <code>hexo</code> çš„æ„å»ºï¼Œç„¶åå°†æ„å»ºåçš„é™æ€ç½‘é¡µæ¨é€åˆ° <code>master</code> åˆ†æ”¯ä¸Š</p><p><img src="https://raw.githubusercontent.com/LeetaoGoooo/leetaogoooo.github.io/images/%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B.png"></p><p>å…¶ä¸­åœ¨ github actions æ¶‰åŠçš„ä¸»è¦ action ä¸º <a href="https://github.com/JamesIves/github-pages-deploy-action">github-pages-deploy-action</a>ï¼Œå‚è€ƒè¯´æ˜æ–‡æ¡£ï¼Œéœ€è¦ä½¿ç”¨åˆ° <code>token</code> æˆ–è€… <code>ssh-key</code>ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨åˆ°æ˜¯å‰è€…ï¼Œè·å– token çš„æ–¹æ³•å¯ä»¥å‚è€ƒ <a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets">encrypted-secrets</a>ï¼Œç„¶ååœ¨ä½ çš„ github-pages ä»“åº“ <code>secrets</code> è®¾ç½®ä¸€ä¸‹ <code>token</code>ï¼Œå‘½åä¸º <code>ACCESS_TOKEN</code></p><h1 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Blog</span> <span class="string">CI/CD</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§¦å‘æ¡ä»¶ï¼šåœ¨ push åˆ° gh-pages åˆ†æ”¯åè§¦å‘</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">gh-pages</span></span><br><span class="line"></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">blog-cicd:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">blog</span> <span class="string">build</span> <span class="string">&amp;</span> <span class="string">deploy</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">macos-latest</span> <span class="comment"># ç³»ç»Ÿç¯å¢ƒï¼Œå¯ä»¥è‡ªç”±è®¾ç½®</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">codes</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">node</span></span><br><span class="line">      <span class="comment"># è®¾ç½® node.js ç¯å¢ƒ</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">&#x27;12.x&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">node</span> <span class="string">modules</span></span><br><span class="line">      <span class="comment"># è®¾ç½®åŒ…ç¼“å­˜ç›®å½•ï¼Œé¿å…æ¯æ¬¡ä¸‹è½½</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/cache@v1</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">~/.npm</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-node-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/package-lock.json&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">hexo</span> <span class="string">dependencies</span></span><br><span class="line">      <span class="comment"># ä¸‹è½½ hexo-cli è„šæ‰‹æ¶åŠç›¸å…³å®‰è£…åŒ…</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        npm install -g hexo-cli</span></span><br><span class="line"><span class="string">        npm install</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">files</span></span><br><span class="line">      <span class="comment"># ç¼–è¯‘ markdown æ–‡ä»¶</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        hexo clean</span></span><br><span class="line"><span class="string">        hexo generate</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">hexo</span> <span class="string">blog</span></span><br><span class="line">      <span class="comment"># éƒ¨ç½²åˆ° GitHub Pages</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">JamesIves/github-pages-deploy-action@releases/v3</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">ACCESS_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ACCESS_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">BRANCH:</span> <span class="string">master</span></span><br><span class="line">        <span class="attr">FOLDER:</span> <span class="string">public</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç•¥è¿‡äº†å…³äº hexo çš„é…ç½®ï¼Œå¦‚æœå¯¹ hexo çš„é…ç½®ä¸å¤ªäº†è§£å¯ä»¥å‚è€ƒ <a href="https://hexo.io/zh-cn/">hexoå®˜ç½‘</a>,åˆ°æ­¤ï¼Œåªè¦æ¯æ¬¡ç›´æ¥æ›´æ–° gh-pages å°±å¯ä»¥è§¦å‘è‡ªåŠ¨æ„å»ºæµç¨‹äº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æ¯å¹´éƒ½è¦æŠ˜è…¾ä¸€ä¸‹è‡ªå·±çš„åšå®¢ï¼Œä»Šå¹´å‡†å¤‡æŠŠæ‰€æœ‰çš„åšå®¢å†æ¬¡è¿ç§»åˆ°é™æ€åšå®¢ Hexo ä¸­ï¼Œé…åˆ Github Action å®ç°ï¼Œåªéœ€è¦ä¸€ä¸ªæµè§ˆå™¨å°±å¯ä»¥è‡ªåŠ¨éƒ¨ç½²åšå®¢ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="github-action" scheme="https://leetaogoooo.github.io/tags/github-action/"/>
    
    <category term="hexo" scheme="https://leetaogoooo.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>functools.lru_cache çš„æ­£ç¡®ç”¨æ³•</title>
    <link href="https://leetaogoooo.github.io/2022/01/26/functools.lru_cache%20%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%94%A8%E6%B3%95/"/>
    <id>https://leetaogoooo.github.io/2022/01/26/functools.lru_cache%20%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%94%A8%E6%B3%95/</id>
    <published>2022-01-26T09:29:53.000Z</published>
    <updated>2022-01-26T09:29:53.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote><p>lru_cache æ˜¯ functools åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸ºå‡½æ•°æä¾›ç¼“å­˜åŠŸèƒ½çš„è£…é¥°å™¨ï¼Œç¼“å­˜ maxsize ç»„ä¼ å…¥å‚æ•°ï¼Œåœ¨ä¸‹æ¬¡ä»¥ç›¸åŒå‚æ•°è°ƒç”¨æ—¶ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡çš„ç»“æœã€‚</p></blockquote><p>ä»å®ƒçš„åŠŸèƒ½æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜å‡½æ•°çš„è¿è¡Œé€Ÿåº¦ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>å½“ä½ ç”¨functools.lru_cacheè£…é¥°å™¨æ¥è£…é¥°ä¸€ä¸ªå®ä¾‹æ–¹æ³•æ—¶ï¼Œå°è£…è¯¥æ–¹æ³•çš„ç±»çš„å®ä¾‹åœ¨æŒæœ‰å®ƒä»¬çš„è¿›ç¨‹ä¸­æ°¸è¿œä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚</strong></p><span id="more"></span><h2 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h2><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­å»è®ºè¯ä¸Šè¿°çš„è§‚ç‚¹ã€‚ï¼ˆä»¥ä¸‹ä»£ç è¿è¡Œäº python3.6.8ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test.py</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Number = TypeVar(<span class="string">&quot;Number&quot;</span>, <span class="built_in">int</span>, <span class="built_in">float</span>, <span class="built_in">complex</span>)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestLruCache</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, delay: <span class="built_in">int</span> = <span class="number">1</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"></span><br><span class="line">self.delay = delay</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="number">128</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate</span>(<span class="params">self, *args: Number</span>) -&gt; Number:</span></span><br><span class="line"></span><br><span class="line">time.sleep(self.delay)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">sum</span>(args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Deleting instance ...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"></span><br><span class="line">test = TestLruCache(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»Ÿè®¡è¿è¡Œæ—¶é•¿</span></span><br><span class="line"></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">result = test.calculate(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">end_time = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—è€—æ—¶ <span class="subst">&#123;end_time-start_time&#125;</span> s, result: <span class="subst">&#123;result&#125;</span>.&quot;</span>)</span><br><span class="line"></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">result = test.calculate(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">end_time = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è®¡ç®—è€—æ—¶ <span class="subst">&#123;end_time-start_time&#125;</span> s, result: <span class="subst">&#123;result&#125;</span>.&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»æœ‰ä¸ª <code>calculate</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä½¿ç”¨ <code>lru_cache</code> è£…é¥°ï¼Œä¸ºäº†æ›´å¥½çš„ä½“ç° <code>lru_cache</code>çš„ä½œç”¨ï¼ŒåŠ ä¸Šäº†ä¸€ä¸ª <code>delay</code> çš„å‚æ•°ï¼Œå…¶ä¸­ <code>__del__</code> çš„é­”æœ¯æ–¹æ³•ä½œç”¨å°±æ˜¯å½“å¼€å§‹åƒåœ¾å›æ”¶çš„æ—¶å€™ï¼Œ<code>__del__</code> æ–¹æ³•å°±ä¼šè¢«æ‰§è¡Œã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•è¿è¡Œè¯¥ç¨‹åºï¼Œçœ‹ä¸€ä¸‹è¾“å‡ºç»“æœ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è®¡ç®—è€—æ—¶ 2.0021407306194305 s, result: 3.</span><br><span class="line">è®¡ç®—è€—æ—¶ 4.209578037261963e-06 s, result: 3.</span><br><span class="line">Deleting instance ...</span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºç»“æœä¸éš¾çœ‹çš„å‡ºï¼Œä½¿ç”¨ <code>lru_cache</code> åï¼Œç¬¬äºŒæ¬¡è°ƒç”¨ <code>calculate</code> æ–¹æ³•ï¼Œè¿è¡Œçš„æ—¶é—´é™ä½äº†å¾ˆå¤šï¼Œä¸éš¾ç†è§£ï¼Œç¬¬äºŒæ¬¡æˆ‘ä»¬è¯·æ±‚çš„å‚æ•°å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥ç»“æœç›´æ¥ä»å­—å…¸ä¸­å°±è·å–åˆ°äº†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„åˆ°ä¸€ç‚¹ï¼Œåœ¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œ<code>TestLruCache</code> çš„å®ä¾‹è¢«æ²¡æœ‰è¢«åƒåœ¾å›æ”¶ã€‚</p><p>ä¸Šé¢çš„ä¾‹å­å¯èƒ½è¯´æœåŠ›è¿˜ä¸å¤Ÿï¼Œæ²¡å…³ç³»ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹å‡ ä¸ªä¾‹å­ã€‚</p><h2 id="åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆ"><a href="#åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆ" class="headerlink" title="åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆ"></a>åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆ</h2><p>å¦‚æœæˆ‘ä»¬é€šè¿‡ <code>python -i</code> çš„æ–¹å¼æ‰§è¡Œä¸Šè¿°çš„è„šæœ¬ï¼Œä½ å°±æ¸…æ™°åœ°å‘ç°åƒåœ¾å›æ”¶æ²¡æœ‰ç”Ÿæ•ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ python3 -i test.py</span><br><span class="line">è®¡ç®—è€—æ—¶ <span class="number">2.004133677983191</span> s, result: <span class="number">3.</span></span><br><span class="line">è®¡ç®—è€—æ—¶ <span class="number">3.143970388919115e-06</span> s, result: <span class="number">3.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> gc</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test = <span class="literal">None</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gc.collect()</span><br><span class="line"><span class="number">22</span></span><br></pre></td></tr></table></figure><p>åœ¨äº¤äº’æ¨¡å¼ä¸‹ï¼Œæˆ‘å°† <code>test</code> èµ‹å€¼ä¸º <code>None</code>ï¼Œå¹¶ä¸”ä¸»åŠ¨è°ƒç”¨åƒåœ¾å›æ”¶å™¨ï¼Œèƒ½çœ‹åˆ° <code>gc.collect()</code> çš„è¾“å‡ºç»“æœä¸º <code>22</code>ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰çœ‹åˆ° <code>__del__</code> æ–¹æ³•çš„è¾“å‡ºï¼Œè¿™è¯´æ˜ç¨‹åºé‡Œä¾ç„¶å­˜åœ¨ <code>TestLruCache</code> çš„å®ä¾‹å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶å™¨å¹¶ä¸èƒ½å°†å¯¹è±¡æˆåŠŸçš„å›æ”¶ã€‚</p><p>è®©æˆ‘ä»¬æ’æŸ¥ä¸€ä¸‹ç©¶ç«Ÿæ˜¯è°è¿˜åœ¨å¼•ç”¨å®ä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -i test.py</span><br><span class="line"></span><br><span class="line">è®¡ç®—è€—æ—¶ <span class="number">2.004039512015879</span> s, result: <span class="number">3.</span></span><br><span class="line"></span><br><span class="line">è®¡ç®—è€—æ—¶ <span class="number">3.3050309866666794e-06</span> s, result: <span class="number">3.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate.cache_info()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line">CacheInfo(hits=<span class="number">1</span>, misses=<span class="number">1</span>, maxsize=<span class="number">128</span>, currsize=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate.cache_info()</span><br><span class="line">CacheInfo(hits=<span class="number">2</span>, misses=<span class="number">1</span>, maxsize=<span class="number">128</span>, currsize=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate.cache_clear()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test = <span class="literal">None</span></span><br><span class="line">Deleting instance ...</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ <code>cache_info</code> è¾“å‡ºç»“æœè¡¨æ˜ï¼Œè¿™ä¸ªç¼“å­˜ä¿å­˜ç€å®ä¾‹çš„å¼•ç”¨ï¼Œé™¤éæ‰‹åŠ¨æ¸…é™¤ã€‚å½“æˆ‘ä»¬æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜å¹¶å°†å˜é‡ <code>test</code> é‡æ–°åˆ†é…ä¸º <code>None</code> æ—¶ï¼Œåƒåœ¾æ”¶é›†å™¨æ‰ä¼šåˆ é™¤è¯¥å®ä¾‹ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œæˆ‘ä»¬è®¾ç½®çš„ <code>maxsize</code> æ˜¯ <code>128</code>ï¼Œè¡¨æ˜æœ€å¤§ç¼“å­˜çš„ç»“æœä¸ªæ•°æ˜¯ <code>128</code> ä¸ªï¼Œä¸€æ—¦æˆ‘ä»¬å°† <code>maxsize</code> ç½®ä¸º <code>None</code> çš„è¯ï¼ŒLRU ç‰¹æ€§å°†è¢«ç¦ç”¨ä¸”ç¼“å­˜å¯æ— é™å¢é•¿ã€‚åœ¨è¿™æƒ…å†µä¸‹å°†ä¼šå¾ˆå±é™©ï¼Œä¸€æ—¦æˆ‘ä»¬åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­åˆ›å»ºå¾ˆå¤šå®ä¾‹ï¼Œè¿™äº›å®ä¾‹ä¸èƒ½ä¸ºåƒåœ¾å›æ”¶ï¼Œä¸€æ—¦è¾¾åˆ°ä¸€å®šç¨‹åºï¼Œå¿…ç„¶ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼Œä»è€Œé€ æˆç¨‹åºå´©æºƒã€‚</p><p>é‚£ä¹ˆèƒ½ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿåˆ«ç€æ€¥ï¼Œå¾€ä¸‹çœ‹</p><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€ç­”ï¼Œæˆ‘ä»¬åªéœ€è¦è®©ç¼“å­˜æˆä¸ºå®ä¾‹çš„æœ¬åœ°å˜é‡å°±è¡Œäº†ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä»ç¼“å­˜åˆ°å®ä¾‹çš„å¼•ç”¨å°±ä¼šéšç€å®ä¾‹ä¸€èµ·è¢«åˆ é™¤ã€‚çœ‹ä¸€ä¸‹æ”¹é€ åçš„ä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar</span><br><span class="line"></span><br><span class="line">Number = TypeVar(<span class="string">&quot;Number&quot;</span>, <span class="built_in">int</span>, <span class="built_in">float</span>, <span class="built_in">complex</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestLruCache</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, delay: <span class="built_in">int</span> = <span class="number">1</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">self.delay = delay</span><br><span class="line">self.calculate = lru_cache(maxsize=<span class="number">128</span>)(self._calculate)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_calculate</span>(<span class="params">self, *args: Number</span>) -&gt; Number:</span></span><br><span class="line">time.sleep(self.delay)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">sum</span>(args)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Deleting instance ...&quot;</span>)</span><br></pre></td></tr></table></figure><p>å¥½äº†è®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹æ”¹é€ åçš„ç¨‹åºæ˜¯å¦å¯ä»¥:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -i test.py</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test = TestLruCache(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test.calculate.cache_info()</span><br><span class="line">CacheInfo(hits=<span class="number">0</span>, misses=<span class="number">1</span>, maxsize=<span class="number">128</span>, currsize=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> gc</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test = <span class="literal">None</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>gc.collect()</span><br><span class="line">Deleting instance ...</span><br><span class="line"><span class="number">30</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°è¿™æ¬¡ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸»åŠ¨å»æ¸…é™¤ç¼“å­˜ï¼Œä½†æ˜¯éœ€è¦æ˜¾ç¤ºçš„è°ƒç”¨ <code>gc.collect()</code> å»æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚è¿™æ˜¯å› ä¸ºè¿™ç§è¯¡è®¡åˆ›é€ äº†å¾ªç¯å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶éœ€è¦åšä¸€äº›ç‰¹æ®Šçš„é­”æœ¯æ¥æ¸…é™¤å†…å­˜ã€‚åœ¨çœŸæ­£çš„ä»£ç ä¸­ï¼ŒPython è§£é‡Šå™¨ä¼šåœ¨åå°ä¸ºæˆ‘ä»¬æ¸…ç†è¿™äº›ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬è°ƒç”¨åƒåœ¾å›æ”¶ã€‚</p><h1 id="ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•"><a href="#ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•" class="headerlink" title="ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•"></a>ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•</h1><p>ä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œä¼šå¯¹ç±»æ–¹æ³•å’Œé™æ€æ–¹æ³•äº§ç”Ÿå½±å“å—ï¼Ÿ<strong>ç­”æ¡ˆæ˜¯å¦å®šçš„</strong>ï¼Œè®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># -*coding: utf-8 -* # test1.py</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="number">128</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">cls, delay: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line"></span><br><span class="line">cls.delay = delay</span><br><span class="line">time.sleep(delay)</span><br><span class="line"><span class="keyword">return</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Deleting instance ...&quot;</span>)</span><br><span class="line"></span><br><span class="line">test_1 = Test()</span><br><span class="line">test_2 = Test()</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">result = test_1.test(<span class="number">2</span>)</span><br><span class="line">end_time = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è€—æ—¶ <span class="subst">&#123;end_time start_time&#125;</span> s, result: <span class="subst">&#123;result&#125;</span>.&quot;</span>)</span><br><span class="line"></span><br><span class="line">start_time = time.perf_counter()</span><br><span class="line">result = test_2.test(<span class="number">2</span>)</span><br><span class="line">end_time = time.perf_counter()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;è€—æ—¶ <span class="subst">&#123;end_time start_time&#125;</span> s, result: <span class="subst">&#123;result&#125;</span>.&quot;</span>)</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬åœ¨äº¤äº’æ¨¡å¼ä¸‹éªŒè¯ç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ python -i test1.py</span><br><span class="line">è€—æ—¶ <span class="number">2.003696349042002</span> s, result: <span class="number">42.</span></span><br><span class="line">è€—æ—¶ <span class="number">4.3199979700148106e-06</span> s, result: <span class="number">42.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test_1 = <span class="literal">None</span></span><br><span class="line">Deleting instance ...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>test_2 = <span class="literal">None</span></span><br><span class="line">Deleting instance ...</span><br></pre></td></tr></table></figure><p>åŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥éªŒè¯ä¸€ä¸‹é™æ€æ–¹æ³•ï¼ŒåŸºæœ¬ä¸Šä¸€æ ·ï¼Œè¿™é‡Œå°±æä¾›ä¸€ä¸‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="number">128</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">cls, delay: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">cls.delay = delay</span><br><span class="line">time.sleep(delay)</span><br><span class="line"><span class="keyword">return</span> <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Deleting instance ...&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://docs.python.org/3.6/library/functools.html#functools.lru_cache">functools.lru_cache</a><br><a href="https://stackoverflow.com/questions/70409673/python-lru-cache-in-a-class-disregards-maxsize-limit-when-decorated-with-a-stati">Python LRU cache in a class disregards maxsize limit when decorated with a staticmethod or classmethod decorator</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;lru_cache æ˜¯ functools åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¸ºå‡½æ•°æä¾›ç¼“å­˜åŠŸèƒ½çš„è£…é¥°å™¨ï¼Œç¼“å­˜ maxsize ç»„ä¼ å…¥å‚æ•°ï¼Œåœ¨ä¸‹æ¬¡ä»¥ç›¸åŒå‚æ•°è°ƒç”¨æ—¶ç›´æ¥è¿”å›ä¸Šä¸€æ¬¡çš„ç»“æœã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»å®ƒçš„åŠŸèƒ½æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜å‡½æ•°çš„è¿è¡Œé€Ÿåº¦ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œ&lt;strong&gt;å½“ä½ ç”¨functools.lru_cacheè£…é¥°å™¨æ¥è£…é¥°ä¸€ä¸ªå®ä¾‹æ–¹æ³•æ—¶ï¼Œå°è£…è¯¥æ–¹æ³•çš„ç±»çš„å®ä¾‹åœ¨æŒæœ‰å®ƒä»¬çš„è¿›ç¨‹ä¸­æ°¸è¿œä¸ä¼šè¢«åƒåœ¾å›æ”¶ã€‚&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ pre-commit é…åˆ blackã€isort è‡ªåŠ¨æ ¼å¼åŒ– Python æ–‡ä»¶</title>
    <link href="https://leetaogoooo.github.io/2021/12/30/lwp55SOlQ/"/>
    <id>https://leetaogoooo.github.io/2021/12/30/lwp55SOlQ/</id>
    <published>2021-12-30T00:18:00.000Z</published>
    <updated>2021-12-30T00:18:00.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¸ºäº†ä¿è¯ Python çš„ä»£ç è§„èŒƒï¼Œåœ¨ä½¿ç”¨ <code>git commit</code> æäº¤ä»£ç ä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨ blakeã€isort å·¥å…·å¯¹æäº¤çš„æ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¦‚æœæäº¤çš„ä»£ç ç¬¦åˆè§„æ³•åˆ™ commit æˆåŠŸï¼Œå¦åˆ™è‡ªåŠ¨æ ¼å¼åŒ–æ–‡ä»¶ï¼Œç„¶åé‡æ–° commit</p></blockquote><p>æ•´ä¸ªå·¥ä½œæµå¤§æ¦‚æ˜¯è¿™æ ·å­ï¼š</p><p><img src="https://www.leetao94.cn/post-images/1640823506631.png"></p><p>å…¶ä¸­ <code>black</code> æ˜¯ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ <code>pip install black</code> åç›´æ¥ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">black &#123;source_file_or_directory&#125;...</span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¹Ÿæ”¯æŒé…ç½®æ–‡ä»¶è‡ªå®šä¹‰è§„åˆ™ï¼Œè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://black.readthedocs.io/en/stable/">The uncompromising code formatter â€” Black</a></p><p><code>isort</code>  åˆ™æ˜¯ç”¨æ¥è§„èŒƒ python åº“çš„å¼•å…¥çš„ï¼ŒæŒ‰å­—æ¯é¡ºåºå¯¹ packages è¿›è¡Œæ’åºï¼Œå¹¶è‡ªåŠ¨åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†å’Œç±»å‹ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡ <code>pip install isort</code> åç›´æ¥ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isort mypythonfile.py mypython file2.py</span><br></pre></td></tr></table></figure><p>å’Œ <code>black</code> ä¸€æ ·ä¹Ÿæ”¯æŒé…ç½®æ–‡ä»¶è‡ªå®šä¹‰è§„åˆ™ï¼Œå…·ä½“å†…å®¹å‚è€ƒå®˜ç½‘ <a href="https://pycqa.github.io/isort/">isort (pycqa.github.io)</a></p><p><code>pre-commit</code> æ˜¯æ•´ä¸ªå·¥ä½œæµæœ€é‡è¦çš„ä¸€ç¯ï¼Œ<code>pre-commit</code> æ˜¯ <code>git-hooks</code> ä¸­çš„ä¸€ä¸ªé‡è¦çš„é’©å­ï¼Œå®ƒåœ¨é”®å…¥æäº¤ä¿¡æ¯å‰è¿è¡Œã€‚<strong>å¯ä»¥ç”¨äºæ£€æŸ¥å³å°†æäº¤çš„å¿«ç…§ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ‰€é—æ¼ï¼Œç¡®ä¿æµ‹è¯•è¿è¡Œï¼Œä»¥åŠæ ¸æŸ¥ä»£ç ã€‚ å¦‚æœè¯¥é’©å­ä»¥éé›¶å€¼é€€å‡ºï¼ŒGit å°†æ”¾å¼ƒæ­¤æ¬¡æäº¤ã€‚</strong> ä¸Šé¢æåˆ°çš„æœºåˆ¶æ˜¯æ•´ä¸ªå·¥ä½œæµå¯ä»¥è¿›è¡Œçš„å…³é”®ã€‚</p><p>å®Œå…¨å¯ä»¥è‡ªå®šä¹‰ <code>pre-commit</code> é’©å­çš„ï¼Œä½†æ˜¯å¦‚æœåªæ˜¯ä¸ºäº†æ£€éªŒçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ç°æˆçš„æ–¹æ¡ˆ <a href="https://github.com/pre-commit/pre-commit">pre-commit/pre-commit</a>,ç”¨ Python æ„å»ºï¼Œæ”¯æŒå¤šè¯­è¨€çš„ç®¡ç†å™¨ã€‚é€šè¿‡ <code>pre-commit</code> è¿™ä¸ªåº“ï¼Œç®€å•åœ°å‡ æ­¥å°±å¯ä»¥å®ç°è‡ªåŠ¨åŒ–å·¥ä½œæµã€‚</p><ol><li>å®‰è£… pre-commit</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pre-commit</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡ <code>pre-commit --version</code> ç¡®å®šæ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pre-commit --version</span><br><span class="line">pre-commit 2.16.0</span><br></pre></td></tr></table></figure><ol start="2"><li>æ·»åŠ  <code>.pre-commit-config.yaml</code> çš„é…ç½®æ–‡ä»¶</li></ol><p>å¯ä»¥é€šè¿‡ <code>pre-commit sample-config</code> ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„é…ç½®æ–‡ä»¶,è¿™é‡Œè´´ä¸€ä¸‹å…³äº <code>black</code> å’Œ <code>isort</code> çš„é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">repos:</span>  </span><br><span class="line"><span class="bullet">-</span>   <span class="attr">repo:</span> <span class="string">https://github.com/psf/black</span>  </span><br><span class="line"> <span class="attr">rev:</span> <span class="number">21.</span><span class="string">12b0</span>  </span><br><span class="line"> <span class="attr">hooks:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">black</span>  </span><br><span class="line">  </span><br><span class="line"><span class="bullet">-</span>   <span class="attr">repo:</span> <span class="string">https://github.com/PyCQA/isort</span>  </span><br><span class="line"> <span class="attr">rev:</span> <span class="number">5.10</span><span class="number">.1</span>  </span><br><span class="line"> <span class="attr">hooks:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">isort</span></span><br></pre></td></tr></table></figure><p>æ”¯æŒçš„é…ç½®é¡¹å¾ˆå¤šï¼Œå…·ä½“å‚è€ƒ <a href="https://pre-commit.com/#plugins">plugins</a></p><ol start="3"><li> å®‰è£… git hooks è„šæœ¬</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ pre-commit install</span><br><span class="line">pre-commit installed at .git/hooks/pre-commit</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å°±å¤§åŠŸå‘Šæˆäº†</p><p><img src="https://www.leetao94.cn/post-images/1640823519964.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯ Python çš„ä»£ç è§„èŒƒï¼Œåœ¨ä½¿ç”¨ &lt;code&gt;git commit&lt;/code&gt; æäº¤ä»£ç ä¹‹å‰ï¼Œéœ€è¦ä½¿ç”¨ blakeã€isort å·¥å…·å¯¹æäº¤çš„æ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¦‚æœæäº¤çš„ä»£ç ç¬¦åˆè§„æ³•åˆ™ commit æˆåŠŸï¼Œå¦åˆ™è‡ªåŠ¨æ ¼å¼åŒ–æ–‡ä»¶ï¼Œç„¶åé‡æ–° co</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ç±»çš„è‡ªå®šæ³¨å†Œä»¥åŠåº”ç”¨åœºæ™¯</title>
    <link href="https://leetaogoooo.github.io/2021/12/25/3K1fxgdEp/"/>
    <id>https://leetaogoooo.github.io/2021/12/25/3K1fxgdEp/</id>
    <published>2021-12-25T02:38:21.000Z</published>
    <updated>2021-12-25T02:38:21.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨ 3.6 ä¹‹å‰å¯ä»¥é€šè¿‡ <code>meta class</code> å»å®ç°ï¼Œ3.6 ä¹‹åå¯ä»¥é€šè¿‡ <code>__init_subclass__</code> å®ç°</p></blockquote><h2 id="meta-class"><a href="#meta-class" class="headerlink" title="meta class"></a><code>meta class</code></h2><p>é€šè¿‡ <code>meta class</code> çš„ <code>__new__</code> æ–¹æ³•å¯ä»¥å®ç°è‡ªåŠ¨æ³¨å†Œ <code>class</code> çš„åŠŸèƒ½ï¼ŒåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡å…ƒç±»å»æ§åˆ¶ç±»çš„åˆ›å»ºï¼Œåœ¨è°ƒç”¨ <code>__new__</code>  æ–¹æ³•çš„æ—¶å€™è‡ªåŠ¨å°† <code>class</code> æ³¨å†Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetaClass</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, clsname, bases, attrs</span>):</span></span><br><span class="line">        newclass = <span class="built_in">super</span>(MetaClass, cls).__new__(cls, clsname, bases, attrs)</span><br><span class="line">        register(newclass)  <span class="comment"># æ³¨å†Œå‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> newclass</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>(<span class="params">metaclass=MetaClass</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="init-subclass"><a href="#init-subclass" class="headerlink" title="__init_subclass__"></a><code>__init_subclass__</code></h2><p><code>__init_subclass__</code> æ˜¯ 3.6 åå¼•å…¥çš„ä¸€ä¸ªæ–°çš„ç‰¹æ€§ï¼Œä¸€ä¸ª hookï¼Œå¯ä»¥è®©æ‰€æœ‰çš„å­ç±»åœ¨åˆ›å»ºä¹‹åæ‰§è¡Œä¸€äº›åˆå§‹åŒ–çš„æ“ä½œï¼Œé€šè¿‡è¿™ä¸ªç‰¹æ€§æˆ‘ä»¬å°±å¯ä»¥æ›´ç®€å•åœ°å®ç°ä¸Šè¿°é€šè¿‡å…ƒç±»å®ç°çš„åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParentClass</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init_subclass_</span>(<span class="params">cls, **kwargs</span>):</span></span><br><span class="line"><span class="built_in">super</span>().__init_subclass(**kwargs)</span><br><span class="line">register(cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildClass</span>(<span class="params">ParentClass</span>):</span></span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>__init_subclass__</code>  <strong>æ²¡æœ‰éå…³é”®å­—å‚æ•°</strong>ã€‚</p><h1 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h1><p>ä»£ç å­˜åœ¨å¦‚ä¸‹çš„é€»è¾‘:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> category == <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">handle_a()</span><br><span class="line"><span class="keyword">elif</span> cateogory == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">handle_b()</span><br><span class="line"><span class="keyword">elif</span> category == <span class="string">&#x27;c&#x27;</span>:</span><br><span class="line">handle_c()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">handle_else()</span><br></pre></td></tr></table></figure><p>å­˜åœ¨å¾ˆå¤šéƒ½å¤„ç†é€»è¾‘ï¼Œæ¯ä¸ªé€»è¾‘å¯èƒ½ç”±ä¸åŒçš„å¼€å‘äººå‘˜ç¼–å†™ï¼Œå…¨éƒ¨æ”¾åˆ°ä¸€ä¸ªä»£ç å—ä¸­ï¼Œå¯ä»¥é¢„è§éšç€åˆ†æ”¯çš„å¢å¤šï¼Œè¿™éƒ¨åˆ†ä»£ç ä¼šå˜å¾—è¶Šæ¥è¶Šåºå¤§ï¼Œä¸åˆ©äºåæœŸç»´æŠ¤ï¼Œæ‰€ä»¥æœ€ç®€å•çš„æ–¹æ¡ˆï¼Œå­˜åœ¨ä¸€ä¸ª dict ä¿å­˜ <code>category</code> å’Œ å¤„ç†æ–¹æ³•çš„æ˜ å°„å…³ç³»:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">category_to_func = &#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: handle_a</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥å°†æœ€åˆçš„ä»£ç ç®€åŒ–ä¸º:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> category_to_func.get(category)()</span><br></pre></td></tr></table></figure><h1 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h1><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>åŸºäºä¸Šé¢çš„æ€è·¯ï¼Œå¯ä»¥å†™å‡ºæœ€ç®€å•çš„æ–¹æ³•ï¼Œè®©å¤§å®¶è‡ªè¡Œç¼–å†™è‡ªå·±çš„å¤„ç†æ–¹æ³•ï¼Œç„¶ååœ¨ <code>category_to_func</code> ä¸­ç»Ÿä¸€æ³¨å†Œè‡ªå·±çš„æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">category_to_func = &#123;</span><br><span class="line"><span class="string">&#x27;a&#x27;</span>: handle_a <span class="comment"># A æ’°å†™æ³¨å†Œ</span></span><br><span class="line"><span class="string">&#x27;b&#x27;</span>: handle_b <span class="comment"># B æ’°å†™æ³¨å†Œ</span></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å­æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯ä¸å¤Ÿä¼˜é›…ï¼Œå¼€å‘äººå‘˜æ’°å†™äº†è‡ªå·±çš„å¤„ç†æ–¹æ³•ä¹‹åï¼Œè¿˜è¦å»æŒ‡å®šçš„åœ°æ–¹æ³¨å†Œè‡ªå·±çš„æ–¹æ³•ï¼Œå¼€å‘ä½“éªŒä¸å¤ªå¥½ã€‚<br>å¦‚æœå­˜åœ¨ä¸€ç§æ–¹å¼ï¼Œå¼€å‘äººå‘˜åªéœ€è¦æ’°å†™å¤„ç†æ–¹æ³•ï¼Œä»£ç å¯ä»¥è‡ªå®šæ³¨å†Œå°±æ›´å¥½äº†ã€‚</p><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>é€šè¿‡ä¸Šé¢çš„è‡ªæ³¨å†Œçš„æ–¹æ³•ï¼Œè®©å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œç„¶åå°†å…¶è‡ªåŠ¨æ³¨å†Œåˆ°å…¨å±€å½“ä¸­ï¼Œè¿™æ ·å­å¼€å‘äººå‘˜åªéœ€è¦å…³æ³¨è‡ªå·±çš„ä¸šåŠ¡å®ç°å°±å¯ä»¥äº†ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://www.python.org/dev/peps/pep-0487/">PEP 487 â€“ Simpler customisation of class creation</a><br><a href="https://stackoverflow.com/questions/5189232/how-to-auto-register-a-class-when-its-defined">python - How to auto register a class when itâ€™s defined - Stack Overflow</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;åœ¨ 3.6 ä¹‹å‰å¯ä»¥é€šè¿‡ &lt;code&gt;meta class&lt;/code&gt; å»å®ç°ï¼Œ3.6 ä¹‹åå¯ä»¥é€šè¿‡ &lt;code&gt;__init_subclass__&lt;/code&gt; å®ç°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;meta-class&quot;&gt;</summary>
      
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="pep" scheme="https://leetaogoooo.github.io/tags/pep/"/>
    
  </entry>
  
  <entry>
    <title>Django è‡ªå®šä¹‰ SearchFilterå…¼å®¹ç©ºæ ¼æœç´¢</title>
    <link href="https://leetaogoooo.github.io/2021/12/09/GLNcAwN1I/"/>
    <id>https://leetaogoooo.github.io/2021/12/09/GLNcAwN1I/</id>
    <published>2021-12-09T00:29:49.000Z</published>
    <updated>2021-12-09T00:29:49.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>Django è‡ªå¸¦çš„ SearchFilter æ˜¯ä¸æ”¯æŒç©ºæ ¼æœç´¢çš„ï¼Œå¦‚æœéœ€è¦æ”¯æŒç©ºæ ¼æœç´¢å¹¶ä¸”ä¿ç•™ä¹‹å‰çš„æœç´¢åŠŸèƒ½åˆ™éœ€è¦è‡ªå®šä¹‰ SearchFilterã€‚</p><h1 id="è‡ªå®šä¹‰-SearchFilter"><a href="#è‡ªå®šä¹‰-SearchFilter" class="headerlink" title="è‡ªå®šä¹‰ SearchFilter"></a>è‡ªå®šä¹‰ SearchFilter</h1><p>ç»§æ‰¿ SeachFilter ç„¶åå®ç° <code>get_search_terms</code> æ–¹æ³•ï¼Œå¦‚æœåŒæ—¶æ”¯æŒ space ç„¶ååˆå¯ä»¥ä¿æŒä¹‹å‰çš„æœç´¢ç‰¹æ€§å‘¢ï¼Ÿ</p><p>ç®€å•çš„åšæ³•å°±æ˜¯ï¼Œå¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœåªæœ‰å«æœ‰ç©ºæ ¼å°±è¿”å›ç©ºæ ¼ï¼Œå¦åˆ™å°±æ‰§è¡Œä¹‹å‰çš„æœç´¢é€»è¾‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CanSerachBothCharFilter</span>(<span class="params">SearchFilter</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_search_terms</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        params = request.query_params.get(self.search_param, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="comment"># åˆ¤æ–­åŸæ¥çš„å‚æ•°æ˜¯å¦æœ‰åªæœ‰ç©ºæ ¼</span></span><br><span class="line">        only_space = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(params) != <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(params.strip()) == <span class="number">0</span>:</span><br><span class="line">            only_space = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        params = params.replace(<span class="string">&#x27;\x00&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># strip null characters</span></span><br><span class="line">        params = params.replace(<span class="string">&#x27;,&#x27;</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> only_space:</span><br><span class="line">            <span class="keyword">return</span> [params]</span><br><span class="line">        <span class="keyword">return</span> params.split()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;Django è‡ªå¸¦çš„ SearchFilter æ˜¯ä¸æ”¯æŒç©ºæ ¼æœç´¢çš„ï¼Œå¦‚æœéœ€è¦æ”¯æŒç©ºæ ¼æœç´¢å¹¶ä¸”ä¿ç•™ä¹‹å‰çš„æœç´¢åŠŸèƒ½åˆ™éœ€è¦è‡ªå®šä¹‰ SearchFi</summary>
      
    
    
    
    
    <category term="python" scheme="https://leetaogoooo.github.io/tags/python/"/>
    
    <category term="django" scheme="https://leetaogoooo.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>pep 544 Protocols: Structural subtyping (static duck typing)</title>
    <link href="https://leetaogoooo.github.io/2021/11/29/HwmFtxua0/"/>
    <id>https://leetaogoooo.github.io/2021/11/29/HwmFtxua0/</id>
    <published>2021-11-29T00:17:04.000Z</published>
    <updated>2021-11-29T00:17:04.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ <a href="https://www.python.org/dev/peps/pep-0484">PEP 484</a>  ä¸­å¼•å…¥çš„ Typing hints (ç±»å‹æç¤º) å¯ä»¥ç”¨æ¥ä¸ºé™æ€ç±»å‹æ£€æŸ¥å™¨å’Œå…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·æŒ‡å®šç±»å‹å…ƒæ•°æ®ã€‚ä½†æ˜¯åœ¨ï¼Œ<a href="https://www.python.org/dev/peps/pep-0484">PEP 484</a>  åªæŒ‡å®šäº†åä¹‰å­ç±»å‹çš„è¯­ä¹‰ã€‚åœ¨è¿™ä¸ª <a href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a> ä¸­ï¼ŒæŒ‡å®šäº†åè®®ç±»çš„é™æ€å’Œè¿è¡Œæ—¶è¯­ä¹‰ï¼Œè¿™å°†ä¸ºç»“æ„æ€§å­ç±»å‹ï¼ˆé™æ€é¸­å­ç±»å‹ï¼‰æä¾›ä¸€ä¸ªæ”¯æŒã€‚</p><h2 id="ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹-Duck-Typing-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹-Duck-Typing-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹(Duck Typing)ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹(Duck Typing)ï¼Ÿ</h2><blockquote><p>If it walks like a duck and it quacks like a duck, then it must be a duckã€‚</p></blockquote><p>ç®€å•åœ°è¯´ï¼Œâ€å¦‚æœå®ƒèµ°è·¯åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£å®ƒä¸€å®šæ˜¯é¸­å­â€œã€‚</p><p>åœ¨ç¼–ç¨‹ä¸­è¿™å°±æ„å‘³ç€å½“æˆ‘ä»¬ç¼–å†™æ¥æ”¶ç‰¹å®šè¾“å…¥çš„å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒè¯¥å‡½æ•°è¾“å…¥çš„è¡Œä¸ºã€å±æ€§ï¼Œè€Œä¸æ˜¯è¯¥å‡½æ•°è¾“å…¥çš„æ˜¾å¼ç±»å‹ã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œåœ¨ä¸ä½¿ç”¨é¸­å­ç±»å‹çš„è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªç±»å‹ä¸ºâ€é¸­å­â€çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„â€èµ°â€å’Œâ€å«â€æ–¹æ³•ã€‚åœ¨ä½¿ç”¨é¸­å­ç±»å‹çš„è¯­è¨€ä¸­ï¼Œè¿™æ ·çš„ä¸€ä¸ªå‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„â€èµ°â€å’Œâ€å«â€æ–¹æ³•ã€‚â€” ç™¾åº¦ç™¾ç§‘</p></blockquote><p>é‚£ä¹ˆå¦‚ä½•åœ¨ Python ä¸­å®ç°â€œé¸­å­ç±»å‹â€å‘¢ï¼Ÿ</p><h1 id="é¸­å­ç±»å‹"><a href="#é¸­å­ç±»å‹" class="headerlink" title="é¸­å­ç±»å‹"></a>é¸­å­ç±»å‹</h1><p>ç°åœ¨æœ‰è¿™æ ·å­åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªå‡½æ•°å»è®¡ç®—ä¸€ä¸ªæ‹¥æœ‰è¾¹é•¿(len_side)çš„ç‰©ä½“çš„å‘¨é•¿ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> calcute_circumference(shape):</span><br><span class="line">circumference <span class="operator">=</span> <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> side <span class="keyword">in</span> shape.len_side: <span class="operator">/</span><span class="operator">/</span><span class="operator">/</span> éå†è¾¹é•¿</span><br><span class="line">circumference <span class="operator">+</span><span class="operator">=</span> side</span><br><span class="line"><span class="keyword">return</span> circumference <span class="operator">/</span><span class="operator">/</span><span class="operator">/</span> å‘¨é•¿</span><br></pre></td></tr></table></figure><p>ä»ä¼ªä»£ç ä¸éš¾çœ‹å‡ºï¼Œæˆ‘ä»¬ä¸å…³å¿ƒæ˜¯ä»€ä¹ˆçš„ç‰©ä½“ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯è¿™ä¸ªç‰©ä½“å¯ä»¥æœ‰ä¸€ä¸ª len_sideï¼ˆåˆ—è¡¨ï¼‰ å­—æ®µå°±å¯ä»¥äº†ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å€Ÿç”± <code>Protocol</code> å»å®ç°å®ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Protocol</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjWithSideLen</span>(<span class="params">Protocol</span>):</span></span><br><span class="line">side_len: <span class="built_in">list</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcute_circumference</span>(<span class="params">shape: ObjWithSideLen</span>):</span></span><br><span class="line">circumference = <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> side <span class="keyword">in</span> shape.side_len:</span><br><span class="line">circumference += side</span><br><span class="line"><span class="keyword">return</span> circumference</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢çš„ä¾‹å­ä¸éš¾çœ‹å‡º <code>Protocol</code> æœ‰ç‚¹ç±»ä¼¼ Java ä¸­çš„æ¥å£ï¼Œåªéœ€è¦åœ¨å‡½æ•°ä¸Šä½¿ç”¨å®ƒï¼Œå¹¶ä¸éœ€è¦å»å…³æ³¨è¾“å…¥çš„å‚æ•°çš„å…·ä½“ç±»å‹ã€‚</p><h1 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h1><p>æˆ‘ä»¬è¿˜å¯ä»¥é…åˆä½¿ç”¨ <code>typing</code> ä¸­çš„ <code>TypeVar</code> å®ç°æ³›å‹å‚æ•°åŒ–ï¼Œè®©æˆ‘ä»¬çš„å‡½æ•°æ›´åŠ æŠ½è±¡åŒ–ï¼Œåªè¦ç¬¦åˆåè®®ï¼Œæ— è®ºä»€ä¹ˆç±»å‹çš„è¾“å…¥éƒ½å¯ä»¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Protocol</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ObjWithSideLen</span>(<span class="params">Protocol</span>):</span></span><br><span class="line">side_len: <span class="built_in">list</span></span><br><span class="line"></span><br><span class="line">T = TypeVar(<span class="string">&#x27;T&#x27;</span>, bound=ObjWithSideLen)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcute_circumference</span>(<span class="params">shape: T</span>) -&gt; T:</span></span><br><span class="line">circumference = <span class="number">0</span> </span><br><span class="line"><span class="keyword">for</span> side <span class="keyword">in</span> shape.side_len:</span><br><span class="line">circumference += side</span><br><span class="line">shape.circumference = circumference</span><br><span class="line"><span class="keyword">return</span> shape</span><br></pre></td></tr></table></figure><h1 id="å»¶ä¼¸"><a href="#å»¶ä¼¸" class="headerlink" title="å»¶ä¼¸"></a>å»¶ä¼¸</h1><p>ä¸Šè¿°çš„ä¾‹å­éƒ½å¯ä»¥å€Ÿç”± Python ä¸­çš„ ABCs å»å®ç°çš„ï¼Œä½†æ˜¯ä¸¤è€…çš„ä¾§é‡ç‚¹æœ‰æ‰€ä¸åŒï¼Œç”±äºç¯‡å¹…æœ‰é™ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œè®©æˆ‘ä»¬ä»”ç»†å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„çš„åŒºåˆ«ã€‚</p><ul><li>å‚è€ƒæ–‡ç«   <a href="https://docs.python.org/zh-cn/3/library/typing.html">python-typing</a>  <a href="https://www.daan.fyi/writings/python-protocols">Static Duck Typing in Python with Protocols</a>  <a href="https://www.python.org/dev/peps/pep-0544/">PEP 544</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ &lt;a href=&quot;https://www.python.org/dev/peps/pep-0484&quot;&gt;PEP 484&lt;/a&gt;  ä¸­å¼•å…¥çš„</summary>
      
    
    
    
    
    <category term="Python" scheme="https://leetaogoooo.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>git commit è§„èŒƒä»¥åŠæ ¡éªŒæ–¹æ¡ˆ</title>
    <link href="https://leetaogoooo.github.io/2021/11/19/KS62tWWwN/"/>
    <id>https://leetaogoooo.github.io/2021/11/19/KS62tWWwN/</id>
    <published>2021-11-18T23:55:16.000Z</published>
    <updated>2021-11-18T23:55:16.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·æ—¶ï¼Œæ¯æ¬¡æ–‡ä»¶å‘ç”Ÿä¿®æ”¹çš„æ—¶å€™æäº¤éƒ½éœ€è¦ <code>git commit</code> å‘½ä»¤å»è®°å½•æœ¬æ¬¡çš„ä¿®æ”¹ï¼Œå¦åˆ™å°±ä¸å…è®¸æäº¤ï¼Œæ˜¾ç„¶ <code>git commit</code>  æ˜¯ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚ï¼Œå› æ­¤åˆ¶å®šä¸€ä¸ª Git Commit è§„èŒƒæ˜¯æœ‰å¿…è¦çš„ï¼Œå¦åˆ™å°±ä¼šå‡ºç°æ··ä¹±çš„æäº¤ä¿¡æ¯ï¼Œè¿™é‡Œè…¾è®¯æŸå›¢é˜Ÿçš„è§„èŒƒä½œä¸ºä¾‹å­ï¼Œç„¶åé€šè¿‡ä¸€å®šçš„æ‰‹æ®µå»å¸®åŠ©æˆ‘ä»¬æŠŠè¿™ä¸ªè§„èŒƒè½åˆ°å®å¤„ã€‚</p><p>ç›®çš„ï¼š</p><ul><li>ç»Ÿä¸€å›¢é˜ŸÂ <code>Git commit</code>Â æ—¥å¿—æ ‡å‡†ï¼Œä¾¿äºåç»­ä»£ç  reviewï¼Œç‰ˆæœ¬å‘å¸ƒä»¥åŠæ—¥å¿—è‡ªåŠ¨åŒ–ç”Ÿæˆç­‰ç­‰ã€‚</li><li>ç»Ÿä¸€å›¢é˜Ÿçš„ Git å·¥ä½œæµï¼ŒåŒ…æ‹¬åˆ†æ”¯ä½¿ç”¨ã€tag è§„èŒƒã€issue ç­‰</li></ul><h1 id="Git-commit-æ—¥å¿—å‚è€ƒæ¡ˆä¾‹"><a href="#Git-commit-æ—¥å¿—å‚è€ƒæ¡ˆä¾‹" class="headerlink" title="Git commit æ—¥å¿—å‚è€ƒæ¡ˆä¾‹"></a><strong>Git commit æ—¥å¿—å‚è€ƒæ¡ˆä¾‹</strong></h1><ul><li><a href="https://github.com/angular/angular">angular</a></li><li><a href="https://github.com/cpselvis/commit-message-test-project">commit-message-test-project</a></li><li><a href="https://github.com/istanbuljs/babel-plugin-istanbul">babel-plugin-istanbul</a></li><li><a href="https://github.com/conventional-changelog/conventional-changelog">conventional-changelog</a></li></ul><h1 id="æ€»ä½“æ–¹æ¡ˆ"><a href="#æ€»ä½“æ–¹æ¡ˆ" class="headerlink" title="æ€»ä½“æ–¹æ¡ˆ"></a><strong>æ€»ä½“æ–¹æ¡ˆ</strong></h1><p><img src="https://www.leetao94.cn/post-images/1637279828697.png" alt="æ¥è‡ª feflow çš„ git commit è§„èŒƒ"></p><h1 id="Git-commitæ—¥å¿—åŸºæœ¬è§„èŒƒ"><a href="#Git-commitæ—¥å¿—åŸºæœ¬è§„èŒƒ" class="headerlink" title="Git commitæ—¥å¿—åŸºæœ¬è§„èŒƒ"></a><strong>Git commitæ—¥å¿—åŸºæœ¬è§„èŒƒ</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">type</span>&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure><h2 id="type-ç±»å‹"><a href="#type-ç±»å‹" class="headerlink" title="type ç±»å‹"></a><strong>type ç±»å‹</strong></h2><blockquote><p>typeä»£è¡¨æŸæ¬¡æäº¤çš„ç±»å‹ï¼Œæ¯”å¦‚æ˜¯ä¿®å¤ä¸€ä¸ªbugè¿˜æ˜¯å¢åŠ ä¸€ä¸ªæ–°çš„feature</p></blockquote><ul><li>featï¼š æ–°å¢ feature</li><li>fix: ä¿®å¤ bug</li><li>docs: ä»…ä»…ä¿®æ”¹äº†æ–‡æ¡£ï¼Œæ¯”å¦‚ README, CHANGELOG, CONTRIBUTEç­‰ç­‰</li><li>style: ä»…ä»…ä¿®æ”¹äº†ç©ºæ ¼ã€æ ¼å¼ç¼©è¿›ã€é€—å·ç­‰ç­‰ï¼Œä¸æ”¹å˜ä»£ç é€»è¾‘</li><li>refactor: ä»£ç é‡æ„ï¼Œæ²¡æœ‰åŠ æ–°åŠŸèƒ½æˆ–è€…ä¿®å¤ bug</li><li>perf: ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ</li><li>test: æµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰</li><li>chore: æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰</li><li>revert: å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</li></ul><h2 id="æ ¼å¼è¦æ±‚"><a href="#æ ¼å¼è¦æ±‚" class="headerlink" title="æ ¼å¼è¦æ±‚"></a><strong>æ ¼å¼è¦æ±‚</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ‡é¢˜è¡Œï¼š50ä¸ªå­—ç¬¦ä»¥å†…ï¼Œæè¿°ä¸»è¦å˜æ›´å†…å®¹</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ä¸»ä½“å†…å®¹ï¼šæ›´è¯¦ç»†çš„è¯´æ˜æ–‡æœ¬ï¼Œå»ºè®®72ä¸ªå­—ç¬¦ä»¥å†…ã€‚ éœ€è¦æè¿°çš„ä¿¡æ¯åŒ…æ‹¬:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># * ä¸ºä»€ä¹ˆè¿™ä¸ªå˜æ›´æ˜¯å¿…é¡»çš„? å®ƒå¯èƒ½æ˜¯ç”¨æ¥ä¿®å¤ä¸€ä¸ªbugï¼Œå¢åŠ ä¸€ä¸ªfeatureï¼Œæå‡æ€§èƒ½ã€å¯é æ€§ã€ç¨³å®šæ€§ç­‰ç­‰</span></span><br><span class="line"><span class="comment"># * ä»–å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜? å…·ä½“æè¿°è§£å†³é—®é¢˜çš„æ­¥éª¤</span></span><br><span class="line"><span class="comment"># * æ˜¯å¦å­˜åœ¨å‰¯ä½œç”¨ã€é£é™©?</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># å°¾éƒ¨ï¼šå¦‚æœéœ€è¦çš„åŒ–å¯ä»¥æ·»åŠ ä¸€ä¸ªé“¾æ¥åˆ°issueåœ°å€æˆ–è€…å…¶å®ƒæ–‡æ¡£ï¼Œæˆ–è€…å…³é—­æŸä¸ªissueã€‚</span></span><br></pre></td></tr></table></figure><h1 id="æ ¡éªŒæ–¹æ¡ˆ"><a href="#æ ¡éªŒæ–¹æ¡ˆ" class="headerlink" title="æ ¡éªŒæ–¹æ¡ˆ"></a>æ ¡éªŒæ–¹æ¡ˆ</h1><p>node é¡¹ç›®å·²ç»æœ‰æ¯”è¾ƒæˆç†Ÿçš„æ–¹æ¡ˆï¼Œè¿™é‡Œä»¥ Python é¡¹ç›®ä¸ºä¾‹ï¼Œè€ƒè™‘å®é™…ä½¿ç”¨çš„ä¾¿åˆ©æ€§ï¼Œå¸Œæœ›å¯ä»¥å¯ä»¥å®ç°ä»¥ä¸‹çš„ç›®çš„ï¼š</p><ol><li>æˆå‘˜åœ¨<strong>æœ¬åœ°æ‰§è¡Œ git commit çš„å‘½ä»¤æ—¶å°±å®Œæˆæ ¡éªŒ</strong>ï¼Œé€šè¿‡åˆ™å…è®¸æ‰§è¡Œ <code>git push</code> å¦åˆ™åˆ™éœ€è¦é‡æ–°æäº¤ commit çš„ä¿¡æ¯ã€‚</li><li>æäº¤åˆ° gitlabï¼Œç”±æœåŠ¡ç«¯å®Œæˆå†æ¬¡æ ¡éªŒ</li></ol><h2 id="æœ¬åœ°æ ¡éªŒ"><a href="#æœ¬åœ°æ ¡éªŒ" class="headerlink" title="æœ¬åœ°æ ¡éªŒ"></a>æœ¬åœ°æ ¡éªŒ</h2><h3 id="git-hooks"><a href="#git-hooks" class="headerlink" title="git hooks"></a>git hooks</h3><p>Git åœ¨æ‰§è¡Œ <code>git init</code> è¿›è¡Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šåœ¨ <code>.git/hooks</code> ç›®å½•ä¸‹ç”Ÿæˆä¸€ç³»åˆ— hooks è„šæœ¬:</p><p><img src="https://www.leetao94.cn/post-images/1637279929295.png" alt="git-hooks"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ¯ä¸ªè„šæœ¬çš„åç¼€éƒ½æ˜¯ä»¥Â <code>.sample</code>Â ç»“å°¾çš„ï¼Œåœ¨è¿™ä¸ªæ—¶å€™ï¼Œè„šæœ¬æ˜¯ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œçš„ã€‚æˆ‘ä»¬éœ€è¦æŠŠåç¼€å»æ‰ä¹‹åæ‰ä¼šç”Ÿæ•ˆï¼Œå³å°†Â <code>pre-commit.sample</code>Â å˜æˆÂ <code>pre-commit</code>Â æ‰ä¼šèµ·ä½œç”¨ã€‚ç”±äºåªæ˜¯å¯¹ commit msg åšæ ¡éªŒï¼Œæ‰€ä»¥åªéœ€è¦ä½¿ç”¨ <code>commit-msg</code> è„šæœ¬å³å¯ã€‚</p><h3 id="commit-msg-è„šæœ¬"><a href="#commit-msg-è„šæœ¬" class="headerlink" title="commit-msg è„šæœ¬"></a>commit-msg è„šæœ¬</h3><p>åœ¨ <code>commit-msg</code> hooks ä¸­å®Œæˆå¯¹ commit æ¶ˆæ¯æ ¡éªŒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰æäº¤çš„ commit msg</span></span><br><span class="line">commit_msg=`cat $<span class="number">1</span>`</span><br><span class="line"></span><br><span class="line">msg_re=<span class="string">&quot;^(feat|fix|docs|style|refactor|perf|test|workflow|build|ci|chore|release|workflow)(\(.+\))?: .&#123;1,100&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ ! $commit_msg =~ $msg_re ]]</span><br><span class="line">then</span><br><span class="line">    echo <span class="string">&quot;\nä¸åˆæ³•çš„ commit æ¶ˆæ¯æäº¤æ ¼å¼ï¼Œè¯·ä½¿ç”¨æ­£ç¡®çš„æ ¼å¼\n &lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;&quot;</span></span><br><span class="line">    <span class="comment"># å¼‚å¸¸é€€å‡º</span></span><br><span class="line">    exit <span class="number">1</span></span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>å°†ä¸Šè¿°è„šæœ¬ä¿æŒåœ¨é¡¹ç›®æ‰€åœ¨å¯¹ <code>.git/hooks</code> ç›®å½•ä¸‹å‘½åä¸º <code>commit-msg</code>,ç„¶åæ‰§è¡Œ <code>chmod</code> å‘½ä»¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x .git/hooks/commit-msg</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯ç»“æœ"><a href="#éªŒè¯ç»“æœ" class="headerlink" title="éªŒè¯ç»“æœ"></a>éªŒè¯ç»“æœ</h3><ol><li>ä¸ç¬¦åˆè§„æ³•çš„ commit msg</li></ol><p><img src="https://www.leetao94.cn/post-images/1637280036579.png" alt="ä¸åˆè§„çš„git-commit-msg"></p><ol start="2"><li>ç¬¦åˆè§„èŒƒçš„ commit-msg</li></ol><p><img src="https://www.leetao94.cn/post-images/1637280050146.png" alt="åˆè§„çš„git-commit-msg"></p><h1 id="æœåŠ¡ç«¯æ ¡éªŒ"><a href="#æœåŠ¡ç«¯æ ¡éªŒ" class="headerlink" title="æœåŠ¡ç«¯æ ¡éªŒ"></a>æœåŠ¡ç«¯æ ¡éªŒ</h1><p>Git åœ¨æœåŠ¡ç«¯ä¹ŸåŒæ ·æœ‰ä¸€äº› hooks:</p><ul><li><code>pre-receive</code></li><li><code>update</code></li><li><code>post-receive</code></li></ul><p>æ¯ä¸ª hooks çš„å…·ä½“åŠŸèƒ½å¯ä»¥å‚è€ƒ <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks#_server_side_hooks">Server-Side Hooks</a> ï¼Œå…¶ä¸­ <code>pre-receive</code> å’Œ <code>update</code> å‡ç¬¦åˆä½¿ç”¨åœºæ™¯ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯<strong>ç”¨æˆ·åŒæ—¶æ¨é€åˆ°å¤šä¸ªåˆ†æ”¯æ—¶ï¼Œ update é’ˆå¯¹æ¯ä¸ªåˆ†æ”¯éƒ½ä¼šè¢«è§¦å‘æ‰§è¡Œï¼Œè€Œ <code>pre-receive</code> åªæ‰§è¡Œä¸€æ¬¡ã€‚</strong></p><h2 id="pre-receive"><a href="#pre-receive" class="headerlink" title="pre-receive"></a>pre-receive</h2><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>åœ¨ä»»ä½•æ–‡ä»¶è¢«æ›´æ–°æ—¶ï¼Œå¦‚æœ<code>$GIT_DIR/hooks/pre-receive</code> å­˜åœ¨å¹¶ä¸”æ˜¯å¯æ‰§è¡Œçš„æ–‡ä»¶ï¼Œåˆ™ pre-receive ä¼šè¢«æ— å‚æ•°è§¦å‘æ‰§è¡Œä¸€æ¬¡ï¼Œæ­£å¸¸ pre-receive è§¦å‘æ‰§è¡Œçš„æ—¶å€™ä¼šæ¥æ”¶å¦‚ä¸‹çš„å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sha1-old SP sha1-new SP refname LF</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ sha1-old ä¸ºå¤šæ¬¡ commit çš„æœ€æ—©ä¸€æ¬¡çš„ commit çš„ idï¼Œè€Œ sha1-new åˆ™æ˜¯æœ€æ–°ä¸€æ¬¡çš„ idã€‚é™¤æ­¤ä¹‹å¤–ï¼Œgit push çš„æ—¶å€™è¿˜ä¼šä¼ é€’å…¶ä»–çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ <a href="https://git-scm.com/docs/git-receive-pack#_pre_receive_hook">pre-receive-hooks</a> ã€‚</p><h3 id="æ ¡éªŒæ–¹æ³•"><a href="#æ ¡éªŒæ–¹æ³•" class="headerlink" title="æ ¡éªŒæ–¹æ³•"></a>æ ¡éªŒæ–¹æ³•</h3><p>é€šè¿‡ <code>git log old-commit-ID new-commit-ID -pretty=format:%s</code> æå–å‡ºä¿©ä¸ª commit ä¹‹é—´çš„æ‰€æœ‰ commit-msg ç„¶åé€ä¸€æ ¡éªŒã€‚</p><p><img src="https://www.leetao94.cn/post-images/1637280064019.png"></p><p>è€ƒè™‘æ˜“ç”¨æ€§ï¼Œç”¨ golang æ„å»ºæ ¡éªŒè„šæœ¬</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line"><span class="string">&quot;regexp&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CommitTypeConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">commitTypeList []<span class="keyword">string</span></span><br><span class="line">strictMode     <span class="keyword">bool</span> <span class="comment">// ä¸¥æ ¼æ¨¡å¼ä¸‹å°†æ ¡éªŒæ‰€æœ‰çš„æäº¤ä¿¡æ¯æ ¼å¼(å¤š commit ä¸‹)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkFailedMeassge = <span class="string">`</span></span><br><span class="line"><span class="string">Commit message æ ¼å¼æ ¡éªŒå¤±è´¥âŒ</span></span><br><span class="line"><span class="string">Commit message æ ¼å¼å¿…é¡»ç¬¦åˆä¸‹è¿°è§„åˆ™:</span></span><br><span class="line"><span class="string">    ^(\w+)(\(\w+\))*: (.+)|^Merge\ branch(.*)|^Merge\ remote-tracking branch(.*)</span></span><br><span class="line"><span class="string">Example:</span></span><br><span class="line"><span class="string">    feat(test): test commit style check.`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ZERO_COMMIT = <span class="string">&quot;0000000000000000000000000000000000000000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">config := CommitTypeConfig&#123;</span><br><span class="line">commitTypeList: []<span class="keyword">string</span>&#123;<span class="string">&quot;feat&quot;</span>, <span class="string">&quot;fix&quot;</span>, <span class="string">&quot;docs&quot;</span>, <span class="string">&quot;style&quot;</span>, <span class="string">&quot;refactor&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;chore&quot;</span>, <span class="string">&quot;perf&quot;</span>, <span class="string">&quot;hotfix&quot;</span>&#125;,</span><br><span class="line">strictMode:     <span class="literal">true</span>&#125;</span><br><span class="line">input, _ := ioutil.ReadAll(os.Stdin)</span><br><span class="line">param := strings.Fields(<span class="keyword">string</span>(input))</span><br><span class="line"><span class="comment">// allow branch/tag delete</span></span><br><span class="line"><span class="keyword">if</span> param[<span class="number">1</span>] == ZERO_COMMIT &#123;</span><br><span class="line">os.Exit(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> isExists(<span class="string">&quot;pre-receive.json&quot;</span>) &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ£€æµ‹åˆ°å­˜åœ¨é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶è§„åˆ™ğŸ’ª&quot;</span>)</span><br><span class="line">file, _ := ioutil.ReadFile(<span class="string">&quot;pre-receive.json&quot;</span>)</span><br><span class="line">tmpConfig := CommitTypeConfig&#123;&#125;</span><br><span class="line">err := json.Unmarshal([]<span class="keyword">byte</span>(file), &amp;tmpConfig)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æˆåŠŸåŠ è½½é…ç½®æ–‡ä»¶è§„åˆ™ğŸ˜Š&quot;</span>)</span><br><span class="line">config = tmpConfig</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;åŠ è½½é…ç½®æ–‡ä»¶è§„åˆ™å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è§„åˆ™æ–‡ä»¶ğŸ˜­&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;å¼€å§‹åŠ è½½é»˜è®¤é…ç½®æ–‡ä»¶è§„åˆ™ğŸ’ª&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">commitMsg := getCommitMsg(param[<span class="number">0</span>], param[<span class="number">1</span>])</span><br><span class="line">checkCommitMsg(commitMsg, config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getCommitMsg</span><span class="params">(oldCommitID <span class="keyword">string</span>, commitID <span class="keyword">string</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">s := fmt.Sprintf(<span class="string">&quot;git log %s..%s --pretty=format:%%s&quot;</span>, oldCommitID, commitID)</span><br><span class="line"><span class="keyword">if</span> oldCommitID == ZERO_COMMIT &#123;</span><br><span class="line">s = fmt.Sprintf(<span class="string">&quot;git rev-list --pretty=format:%%s $(git for-each-ref --format=&#x27;%%(refname)&#x27; refs/heads/* | sed &#x27;s/^/\\^/g&#x27;) %s | grep -v ^commit&quot;</span>, commitID)</span><br><span class="line">&#125;</span><br><span class="line">commitMsg := strings.Split(runCmd(s), <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> commitMsg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkFailed</span><span class="params">(tmpStr <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Fprintln(os.Stderr, <span class="string">&quot;===================================&quot;</span>)</span><br><span class="line">fmt.Fprintln(os.Stderr, tmpStr)</span><br><span class="line">fmt.Fprintln(os.Stderr, <span class="string">&quot;===================================&quot;</span>)</span><br><span class="line">fmt.Fprintln(os.Stderr, checkFailedMeassge)</span><br><span class="line">os.Exit(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isExists</span><span class="params">(path <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">_, err := os.Stat(path)</span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> os.IsNotExist(err) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// è§„åˆ™æ ¡éªŒ</span></span><br><span class="line"><span class="comment">/// @commitMsg []string æäº¤çš„ä¿¡æ¯æ•°ç»„</span></span><br><span class="line"><span class="comment">/// @config è§„åˆ™é…ç½®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkCommitMsg</span><span class="params">(commitMsg []<span class="keyword">string</span>, config CommitTypeConfig)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> CommitMessagePattern = <span class="string">`^(\w+)(\(\w+\))*: (.+)|^Merge\ branch(.*)|^Merge\ remote-tracking branch(.*)`</span></span><br><span class="line"><span class="keyword">var</span> commitMsgReg = regexp.MustCompile(CommitMessagePattern)</span><br><span class="line"><span class="keyword">for</span> _, tmpStr := <span class="keyword">range</span> commitMsg &#123;</span><br><span class="line"><span class="keyword">if</span> strings.Trim(tmpStr, <span class="string">&quot; &quot;</span>) == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">commitTypes := commitMsgReg.FindAllStringSubmatch(tmpStr, <span class="number">-1</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(commitTypes) != <span class="number">1</span> &#123;</span><br><span class="line">checkFailed(tmpStr)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> !strings.HasPrefix(tmpStr, <span class="string">&quot;Merge&quot;</span>) &amp;&amp; !stringInSlice(commitTypes[<span class="number">0</span>][<span class="number">1</span>], config.commitTypeList) &#123;</span><br><span class="line">checkFailed(tmpStr)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !config.strictMode &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ­å–œğŸ‰ï¼Œcommit message æ ¡éªŒé€šè¿‡âœ…&quot;</span>)</span><br><span class="line">os.Exit(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;æ­å–œğŸ‰ï¼Œcommit message æ ¡éªŒé€šè¿‡âœ…&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stringInSlice</span><span class="params">(a <span class="keyword">string</span>, list []<span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, b := <span class="keyword">range</span> list &#123;</span><br><span class="line"><span class="keyword">if</span> b == a &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runCmd</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, s)</span><br><span class="line">cmd.Stdin = os.Stdin</span><br><span class="line">cmd.Stderr = os.Stderr</span><br><span class="line">r, err := cmd.Output()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;Run command failed, [%s]\nerr: %s&quot;</span>, s, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶æ”¯æŒæ·»åŠ é…ç½®æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;commitTypeList&quot;</span>:[ <span class="comment">// æ”¯æŒçš„ commitType</span></span><br><span class="line">        <span class="string">&quot;feat&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fix&quot;</span>,</span><br><span class="line">        <span class="string">&quot;docs&quot;</span>,</span><br><span class="line">        <span class="string">&quot;style&quot;</span>,</span><br><span class="line">        <span class="string">&quot;refactor&quot;</span>,</span><br><span class="line">        <span class="string">&quot;test&quot;</span>,</span><br><span class="line">        <span class="string">&quot;chore&quot;</span>,</span><br><span class="line">        <span class="string">&quot;perf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hotfix&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;strictMode&quot;</span>: <span class="literal">true</span> <span class="comment">// ä¸¥æ ¼æ¨¡å¼ä¼šæ ¡éªŒå¤šæ¬¡ commit çš„æ‰€æœ‰ä¿¡æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœåŠ¡å™¨é…ç½®-pre-receive"><a href="#æœåŠ¡å™¨é…ç½®-pre-receive" class="headerlink" title="æœåŠ¡å™¨é…ç½® pre-receive"></a>æœåŠ¡å™¨é…ç½® pre-receive</h2><p>å‚è€ƒ <a href="https://docs.gitlab.com/ee/administration/server_hooks.html">Server Hooks</a> éœ€è¦å°†ç¼–è¯‘å <code>pre-receive</code> æ”¾åˆ°åˆ¶å®šçš„ repository çš„é’©å­ç›®å½•å³å¯ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹:</p><ol><li>æ‰¾åˆ°å¯¹åº” repository çš„ <code>.git</code> ç›®å½•</li><li>åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º <code>custom_hooks</code> çš„ç›®å½•</li><li>å°†ç¼–è¯‘åçš„ <code>pre-receive</code> æ”¾åˆ°è¯¥ç›®å½•ä¸‹(å¦‚æœæœ‰é…ç½®æ–‡ä»¶ä¹Ÿä¸Šä¼ åˆ°è¯¥ç›®å½•ä¸‹)</li><li>é€šè¿‡ <code>chmod +x pre-receive</code> è®©è¯¥æ–‡ä»¶å¯æ‰§è¡Œï¼ŒåŒæ—¶å°†è¯¥æ–‡ä»¶çš„ç”¨æˆ·ç»„åˆ‡æ¢ä¸º <code>git:git</code></li><li>æ¨é€ä»£ç éªŒè¯ç»“æœ</li></ol><p><img src="https://www.leetao94.cn/post-images/1637280076441.png" alt="pre-receive-æ ¡éªŒé€šè¿‡ç»“æœ"></p><ul><li>å‚è€ƒé“¾æ¥<ul><li><a href="https://git-scm.com/docs/git-receive-pack#_pre_receive_hook">pre-receive-hooks</a></li><li><a href="https://docs.gitlab.com/ee/administration/server_hooks.html">Server Hooks</a></li><li><a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks#_server_side_hooks">Server-Side Hooks</a></li><li><a href="https://feflowjs.com/zh/guide/rule-git-commit.html">Git Commit è§„èŒƒ</a></li><li><a href="https://segmentfault.com/a/1190000009048911">git commit è§„èŒƒæŒ‡å—</a></li><li><a href="https://git-scm.com/docs/git-commit">git-commit</a></li><li><a href="https://zhuanlan.zhihu.com/p/182553920">å¦‚ä½•è§„èŒƒä½ çš„Git commitï¼Ÿ</a></li></ul></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬æ§åˆ¶å·¥å…·æ—¶ï¼Œæ¯æ¬¡æ–‡ä»¶å‘ç”Ÿä¿®æ”¹çš„æ—¶å€™æäº¤éƒ½éœ€è¦ &lt;code&gt;git commit&lt;/code&gt; å‘½ä»¤å»è®°å½•æœ¬æ¬¡çš„ä¿®æ”¹ï¼Œ</summary>
      
    
    
    
    
    <category term="gitflow" scheme="https://leetaogoooo.github.io/tags/gitflow/"/>
    
  </entry>
  
</feed>
