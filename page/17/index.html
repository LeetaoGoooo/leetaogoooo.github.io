<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"leetaogoooo.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Je pense, donc je suis">
<meta property="og:type" content="website">
<meta property="og:title" content="Leetao&#39;s Blog">
<meta property="og:url" content="https://leetaogoooo.github.io/page/17/">
<meta property="og:site_name" content="Leetao&#39;s Blog">
<meta property="og:description" content="Je pense, donc je suis">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Leetao">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://leetaogoooo.github.io/page/17/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/17/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Leetao's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Leetao's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Leetao's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Talk is cheap, show me the code</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leetao"
      src="/images/avatar.ico">
  <p class="site-author-name" itemprop="name">Leetao</p>
  <div class="site-description" itemprop="description">Je pense, donc je suis</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">192</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">74</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/leetaogoooo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;leetaogoooo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:leetao94cn@gmail.com" title="E-Mail → mailto:leetao94cn@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/LeetaoGoooo" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;LeetaoGoooo" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/leetaoGoooo" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;leetaoGoooo" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/06/07/php%20artisan%20migrate%20%E5%87%BA%E9%94%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/07/php%20artisan%20migrate%20%E5%87%BA%E9%94%99/" class="post-title-link" itemprop="url">php artisan migrate 出错</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-07 00:00:00" itemprop="dateCreated datePublished" datetime="2017-06-07T00:00:00+08:00">2017-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在执行 <em>php artisan migrate</em>出现如下错误:<br><img src="http://ww1.sinaimg.cn/large/d9e82fa4ly1fgcuzkgc7zj20og09xwfm.jpg"></p>
<p>从网上找到了如下的原因和解决办法</p>
<h1 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h1><p>MySql支持的utf8编码最大字符长度为3字节，如果遇到4字节的宽字符就会出现插入异常。三个字节UTF-8最大能编码的Unicode字符是0xffff，即Unicode中的基本多文种平面（BMP）。因而包括Emoji表情（Emoji是一种特殊的Unicode编码）在内的非基本多文种平面的Unicode字符都无法使用MySql的utf8字符集存储。</p>
<p>这也应该就是Laravel 5.4改用4字节长度的utf8mb4字符编码的原因之一。不过要注意的是，只有MySql 5.5.3版本以后才开始支持utf8mb4字符编码（查看版本：selection version();）。如果MySql版本过低，需要进行版本更新。</p>
<p><em>注：如果是从Laravel 5.3升级到Laravel 5.4，不需要对字符编码做切换。</em></p>
<h1 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h1><ol>
<li>升级MySql版本到5.5.3以上。</li>
<li>手动配置迁移命令migrate生成的默认字符串长度，在AppServiceProvider中调用Schema::defaultStringLength方法来实现配置：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Schema</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Bootstrap any application services.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Schema::defaultStringLength(<span class="number">191</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>我的 MySQL 版本是 5.5.53,同样产生了如上的错误.不过发现相应的表还是正常生成了。</p>
<h1 id="再次出错"><a href="#再次出错" class="headerlink" title="再次出错"></a>再次出错</h1><p>之后通过使用 Artisan 工具新建 Model 类及其附属的 Migration 和 Seeder（数据填充）类,在使用 artisan 生成 Migration出现如下的错误:</p>
<p><img src="http://ww1.sinaimg.cn/large/d9e82fa4ly1fgcv521vjlj20o80a9q45.jpg"></p>
<p>由手册可知,执行上述命令行其实是在执行 <em>database/migrations</em>中的所有文件的 <em>up</em> 函数,于是尝试修改所有的 up 函数,增加如下的判断:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!Schema::hasTable(<span class="string">&#x27;table&#x27;</span>)) &#123;</span><br><span class="line">   <span class="comment">// 创建表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>参考文章:<br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008416200">Laravel 5.4 migrate时报错: Specified key was too long error</a><br><a target="_blank" rel="noopener" href="http://www.cnblogs.com/betx/p/6544090.html">Laravel 5.4: 特殊字段太长报错</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/06/06/%E7%94%9F%E6%88%90%E5%99%A8(generator)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/06/%E7%94%9F%E6%88%90%E5%99%A8(generator)/" class="post-title-link" itemprop="url">生成器(generator)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-06 00:00:00" itemprop="dateCreated datePublished" datetime="2017-06-06T00:00:00+08:00">2017-06-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="What-is-yield"><a href="#What-is-yield" class="headerlink" title="What is yield"></a>What is <em>yield</em></h1><p><em>yield</em> 关键字返回生成器( generator )的数据。</p>
<blockquote>
<p>The heart of a generator function is the yield keyword. In its simplest form, a yield statement looks much like a return statement, except that instead of stopping execution of the function and returning, yield instead provides a value to the code looping over the generator and pauses execution of the generator function.</p>
</blockquote>
<h1 id="What-is-a-generator-function"><a href="#What-is-a-generator-function" class="headerlink" title="What is a generator function"></a>What is a generator function</h1><p>生成器函数是一种更为紧凑和有效编写迭代器的方法。它允许你定义一个函数,在循环时计算和返回结果。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (xrange(<span class="number">1</span>, <span class="number">10</span>) <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$key</span> =&gt; <span class="subst">$value</span>&quot;</span>, PHP_EOL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将会有如下的输出:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span> =&gt; <span class="number">1</span></span><br><span class="line"><span class="number">1</span> =&gt; <span class="number">2</span></span><br><span class="line">…</span><br><span class="line"><span class="number">9</span> =&gt; <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>你同样可以控制在 <em>foreach</em> 中的 $key,通过如下的方式:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">yield</span> <span class="variable">$someKey</span> =&gt; <span class="variable">$someValue</span>;</span><br></pre></td></tr></table></figure>
<p>在生成器函数中,someKey 是你想要出现的 key,someVaue 则是 val 中的值。在例子中,它则是 i</p>
<h1 id="What’s-the-difference-to-normal-functions"><a href="#What’s-the-difference-to-normal-functions" class="headerlink" title="What’s the difference to normal functions?"></a>What’s the difference to normal functions?</h1><p>你可能会觉得我们用 PHP 原生的 range 函数同样也可以实现一样的输出，这点没错，但是最大的区别是这两种方式的输出是如何得到的。</p>
<p>当我们使用 range 的时候,它在内存中将整个数组创建出来,并将整个数组交给 foreach 去遍历。换句话说，foreach 将自己来操作整个数组。range 函数和 foreach 函数只交互了一次。想想我们接收邮件包裹，派送人员把包裹给你了，然后就离开了，剩下的就需要你自己去打开包裹并发现包裹里装的是什么了。</p>
<p>当我们使用生成函数时，PHP将进入函数并执行它，直到它满足结束或遇到 yield 关键字。 当它遇到 yield 时，它将返回当时值的任何值到外部循环。 然后它回到生成器，并继续从它产生的地方开始。 由于你的 xrange 拥有一个 for 循环，它将执行并产生，直到达到$max。想象一下 foreach 和生成器打乒乓球的场景。</p>
<h1 id="Why-do-I-need-that"><a href="#Why-do-I-need-that" class="headerlink" title="Why do I need that?"></a>Why do I need that?</h1><p>很显然，生成器可以被应用于内存有限的场景中。取决于你的环境而言，如果做一个 range(0,100000)循环可能导致你的脚本严重错误的话，使用生成器仍旧可以很好的运行。或者就如维基百科所言:</p>
<blockquote>
<p>Because generators compute their yielded values only on demand, they are useful for representing sequences that would be expensive or impossible to compute at once. These include e.g. infinite sequences and live data streams.</p>
</blockquote>
<p>生成器应该很快。 但请记住，当我们谈论很快时，我们通常是在非常少的场景中讨论。 所以在你现在跑掉并更改所有代码以使用生成器之前，请做一个基准测试，看看它在哪里有意义。</p>
<p>生成器的另一个用例是异步协同程序。 yield关键字不仅返回值，而且还接受它们</p>
<h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>PHP 的生成器不能满足所有迭代操作的需求，因为如果不查询，生成器永远不知道下一个要迭代的值是什么，在生成器中无法后退或者快进。生成器还是一次性的，无法多次迭代同一个生成器。不过，如果需要的，可以重建或者克隆生成器。</p>
<h1 id="待测试"><a href="#待测试" class="headerlink" title="待测试"></a>待测试</h1><p>未完待续，通过生成器是否能够解决大文件加载问题，已经是否能够提高读取速度问题。</p>
<p>整理翻译自:<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/17483806/what-does-yield-mean-in-php">What does yield mean in PHP?</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/06/02/Openlayers3%E4%BB%BF%E9%93%BE%E5%AE%B6%E7%BD%91%E6%95%88%E6%9E%9C(%E4%BA%8C)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/02/Openlayers3%E4%BB%BF%E9%93%BE%E5%AE%B6%E7%BD%91%E6%95%88%E6%9E%9C(%E4%BA%8C)/" class="post-title-link" itemprop="url">Openlayers3仿链家网效果(二)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-02 00:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T00:00:00+08:00">2017-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="http://ww1.sinaimg.cn/large/d9e82fa4ly1feucc4km7cg20bv0djhdt.gif"></p>
<p>接着上一篇的demo,经过几天的折腾，基本上完成了类似链家网的效果.上一篇文章的地址<a target="_blank" rel="noopener" href="http://www.leetao94.cn/2017/03/28/Openlayers%E4%BB%BF%E9%93%BE%E5%AE%B6%E7%BD%91%E5%8A%A0%E8%BD%BD%E6%95%88%E6%9E%9C/">Openlayers3仿链家网效果</a></p>
<h1 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h1><h2 id="不同-Zoom-加载不同的图层"><a href="#不同-Zoom-加载不同的图层" class="headerlink" title="不同 Zoom 加载不同的图层"></a>不同 Zoom 加载不同的图层</h2><p>通过 view 的 chaneg:resolution 事件，在不同 zoom 下加载不同的图层</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> changeViewToZoom = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> view = map.getView();</span><br><span class="line">    view.on(<span class="string">&#x27;change:resolution&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> zoom = view.getZoom();</span><br><span class="line">        <span class="keyword">if</span> (zoom &gt;= xxxZoom) &#123;</span><br><span class="line">            <span class="comment">// 加载图层</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 加载其他图层</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="圆圈的绘制"><a href="#圆圈的绘制" class="headerlink" title="圆圈的绘制"></a>圆圈的绘制</h2><p>根据圆圈的中心点坐标和半径绘制圆</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  添加圆圈图层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genarateCircleLayer</span>(<span class="params">CircleObjArrs, title</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">arguments</span>[<span class="number">2</span>] != <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> createCircleLayer(createCircleSource(CircleObjArrs, <span class="built_in">arguments</span>[<span class="number">2</span>]), title);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> createCircleLayer(createCircleSource(CircleObjArrs), title)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCircleLayer</span>(<span class="params">source, title</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> circleLayer = <span class="keyword">new</span> ol.layer.Vector(&#123;</span><br><span class="line">        <span class="attr">title</span>: title,</span><br><span class="line">        <span class="attr">source</span>: source,</span><br><span class="line">        <span class="attr">style</span>: circleStyleFunction</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> circleLayer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCircleSource</span>(<span class="params">CircleObjArrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> view = map.getView();</span><br><span class="line">    <span class="keyword">var</span> zoom = view.getZoom();</span><br><span class="line">    <span class="keyword">var</span> CircleSource = <span class="keyword">new</span> ol.source.Vector();</span><br><span class="line">    <span class="keyword">var</span> radius = <span class="number">1</span> / <span class="built_in">Math</span>.pow(<span class="number">2</span>, zoom - <span class="number">6</span>);</span><br><span class="line">    <span class="comment">// 判断是否定义 radius,否则才用默认值</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (<span class="built_in">arguments</span>[<span class="number">1</span>]) != <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        radius = <span class="built_in">arguments</span>[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; CircleObjArrs.length; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> feature = <span class="keyword">new</span> ol.Feature(&#123;</span><br><span class="line">            <span class="attr">geometry</span>: <span class="keyword">new</span> ol.geom.Circle(CircleObjArrs[i].center, radius),</span><br><span class="line">            <span class="attr">text</span>: CircleObjArrs[i].text</span><br><span class="line">        &#125;);</span><br><span class="line">        CircleSource.addFeature(feature);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> CircleSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="展示效果"><a href="#展示效果" class="headerlink" title="展示效果"></a>展示效果</h2><p>展示效果包括:圆圈样式的切换,和圆圈下的图层显示.圆圈下的图层是在绘制圆圈的时候就一同加载了,只是样式设置透明，让它隐藏起来了,当鼠标移动到圆圈上，改变圆圈的样式的同时也改变了图层的样式，从而使得图层展示出来.主要调用<strong>forEachFeatureAtPixel</strong>方法，遍历当前坐标系下的所有feature,然后根据type切换不同样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> displayFeature = <span class="function"><span class="keyword">function</span> (<span class="params">pixel</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> features = [];</span><br><span class="line">    map.forEachFeatureAtPixel(pixel, <span class="function"><span class="keyword">function</span> (<span class="params">feature, layer</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (layer.getVisible()) &#123; <span class="comment">// 当图层被隐藏之后,光标下该图层忽略</span></span><br><span class="line">            features.push(feature);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> len = features.length;</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> text = features[i].getProperties().text;</span><br><span class="line">            <span class="keyword">var</span> type = features[i].getGeometry().getType();</span><br><span class="line">            features[i].setStyle(getSelectedPropertyStyle(type, text));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> featureArr = map.getLayers().getArray();</span><br><span class="line">        <span class="keyword">var</span> featureArr_len = featureArr.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; featureArr_len; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> featureArr[j].setStyle !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> source = featureArr[j].getSource();</span><br><span class="line">                features_by_source = source.getFeatures();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> feature_len = features_by_source.length;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> m = <span class="number">0</span>; m &lt; feature_len; m++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">typeof</span> features_by_source[m].getProperties().text === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">                        text = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">var</span> text = features_by_source[m].getProperties().text</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">var</span> type = features_by_source[m].getGeometry().getType();</span><br><span class="line">                    features_by_source[m].setStyle(getUnselectedPropertyStyle(type, text));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getUnselectedPropertyStyle = <span class="function"><span class="keyword">function</span> (<span class="params">type, text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> style = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="string">&#x27;Circle&#x27;</span>) &#123;</span><br><span class="line">        style = <span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;rgba(57,172,106,0.9)&#x27;</span>,</span><br><span class="line">                <span class="attr">opacity</span>: <span class="string">&#x27;0.05&#x27;</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="attr">text</span>: <span class="keyword">new</span> ol.style.Text(&#123;</span><br><span class="line">                <span class="attr">font</span>: <span class="string">&#x27;14px sans-serif&#x27;</span>,</span><br><span class="line">                <span class="attr">text</span>: text,</span><br><span class="line">                <span class="attr">textAlign</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="attr">rotateWithView</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#FFFFFF&#x27;</span></span><br><span class="line">                &#125;),</span><br><span class="line">                <span class="attr">stroke</span>: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#FFFFFF&#x27;</span>,</span><br><span class="line">                    <span class="attr">width</span>: <span class="number">1</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// radius:100</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="string">&#x27;MultiPolygon&#x27;</span> || type == <span class="string">&#x27;Polygon&#x27;</span>) &#123;</span><br><span class="line">        style = <span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            <span class="attr">stroke</span>: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;rgba(255, 255, 0, 0)&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">2</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;rgba(255, 255, 0, 0)&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> style;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getSelectedPropertyStyle = <span class="function"><span class="keyword">function</span> (<span class="params">type, text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> style = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="string">&#x27;Circle&#x27;</span>) &#123;</span><br><span class="line">        style = <span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;rgba(228,57,60,0.9)&#x27;</span>,</span><br><span class="line">                <span class="attr">opacity</span>: <span class="string">&#x27;0.05&#x27;</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="attr">text</span>: <span class="keyword">new</span> ol.style.Text(&#123;</span><br><span class="line">                <span class="attr">font</span>: <span class="string">&#x27;14px sans-serif&#x27;</span>,</span><br><span class="line">                <span class="attr">text</span>: text,</span><br><span class="line">                <span class="attr">textAlign</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="comment">// rotateWithView:true,</span></span><br><span class="line">                <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#FFFFFF&#x27;</span></span><br><span class="line">                &#125;),</span><br><span class="line">                <span class="attr">stroke</span>: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                    <span class="attr">color</span>: <span class="string">&#x27;#FFFFFF&#x27;</span>,</span><br><span class="line">                    <span class="attr">width</span>: <span class="number">1</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (type == <span class="string">&#x27;MultiPolygon&#x27;</span> || type == <span class="string">&#x27;Polygon&#x27;</span>) &#123;</span><br><span class="line">        style = <span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            <span class="attr">stroke</span>: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;green&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">2</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;rgba(57,172,106,0.1)&#x27;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> style;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/06/02/Openlayers3%E5%85%B3%E4%BA%8EMouseWheelZoom%E7%9A%84%E7%A6%81%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/02/Openlayers3%E5%85%B3%E4%BA%8EMouseWheelZoom%E7%9A%84%E7%A6%81%E7%94%A8/" class="post-title-link" itemprop="url">Openlayers3关于MouseWheelZoom的禁用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-02 00:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T00:00:00+08:00">2017-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>由于使用鼠标滚轮控制地图缩放不可控,所以决定禁用鼠标滚轮事件.代码如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">map.getInteractions().forEach(<span class="function"><span class="keyword">function</span> (<span class="params">interaction</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (interaction <span class="keyword">instanceof</span> ol.interaction.MouseWheelZoom) &#123;</span><br><span class="line">        map.removeInteraction(interaction);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/06/02/Trait(%E6%80%A7%E7%8A%B6)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/02/Trait(%E6%80%A7%E7%8A%B6)/" class="post-title-link" itemprop="url">Trait(性状)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-02 00:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T00:00:00+08:00">2017-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近想重构一下自己的代码,仔细查看了自己写的代码，发现自己写的两个类,其中一个类是对 Gis 信息的处理展示,另外一个类是生成符合 Highcharts 格式的数据，两个类的功能十分不同，而且在 <strong>继承层次结构</strong> 中没有 <strong>共同的父类</strong>。但是两个类在生成数据之前,都必须对前台传来的指标名称进行转换成相应的指标 id,要怎么解决这个问题呢?</p>
<ol>
<li>创建一个父类让这两个类都继承</li>
<li>创建一个接口，定义实现转换指标的的方法，然后让这两个类都实现它</li>
<li>创建一个性状，定义实现指标转换的方法，然后让这两个类混入这个性状</li>
</ol>
<p>第一种解决方法不好，因为这样子做会强制让两个无关的类继承同一个祖先，而且这个祖先不属于各自的继承层次结。<br>第二种解决方法好，因为每个类都能保有自然的继承层次结构。但是，我们要在两个类中重复实现的地理编码功能，这不符合 DRY (<em>Don’t Repeat Yourself</em> ) 原则。<br>第三种解决方法最好，这么做不会搅乱这两个类原本自然的继承层次结构。</p>
<blockquote>
<p>自 PHP 5.4.0 起，PHP 实现了一种代码复用的方法，称为 trait。<br>Trait 是为类似 PHP 的单继承语言而准备的一种代码复用机制。Trait 为了减少单继承语言的限制，使开发人员能够自由地在不同层次结构内独立的类中复用 method。Trait 和 Class 组合的语义定义了一种减少复杂性的方式，避免传统多继承和 Mixin 类相关典型问题。<br>Trait 和 Class 相似，但仅仅旨在用细粒度和一致的方式来组合功能。 无法通过 trait 自身来实例化。它为传统继承增加了水平特性的组合；也就是说，<strong>应用的几个 Class 之间不需要继承</strong>。</p>
</blockquote>
<p>性状有两个作用:</p>
<ol>
<li>表明类可以做什么( 像是接口 )</li>
<li>提供模块化实现 ( 像是类 )</li>
</ol>
<p>性状能把模块化的实现方法注入到多个无关的类中。而且性状还能促进代码重用。</p>
<h1 id="性状的创建"><a href="#性状的创建" class="headerlink" title="性状的创建"></a>性状的创建</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">KeyHandle</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tranKeyNameToKeyId</span>(<span class="params"><span class="variable">$keyname</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 将 keyname =&gt; keyid</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="性状的使用"><a href="#性状的使用" class="headerlink" title="性状的使用"></a>性状的使用</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Gis</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">KeyHandle</span>;</span><br><span class="line">    <span class="comment">// 类的具体实现</span></span><br><span class="line">    <span class="keyword">public</span> funcition getGisByKeyId(<span class="variable">$keyid</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="性状的优先级"><a href="#性状的优先级" class="headerlink" title="性状的优先级"></a>性状的优先级</h1><p>从基类继承的成员会被 trait 插入的成员所覆盖。优先顺序是来自当前类的成员覆盖了trait的方法,而 trait 则覆盖了被继承的方法。</p>
<h1 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h1><h2 id="可运行示例"><a href="#可运行示例" class="headerlink" title="可运行示例"></a>可运行示例</h2><h3 id="trait-则覆盖了被继承的方法"><a href="#trait-则覆盖了被继承的方法" class="headerlink" title="trait 则覆盖了被继承的方法"></a>trait 则覆盖了被继承的方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Base</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">sayHello</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>  <span class="string">&#x27;Hello &#x27;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span>  <span class="title">SayWorld</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">sayHello</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">         <span class="built_in">parent</span> :: sayHello ();</span><br><span class="line">        <span class="keyword">echo</span>  <span class="string">&#x27;World!&#x27;</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">MyHelloWorld</span>  <span class="keyword">extends</span>  <span class="title">Base</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">use</span>  <span class="title">SayWorld</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="variable">$o</span>  = <span class="keyword">new</span>  MyHelloWorld ();</span><br><span class="line"> <span class="variable">$o</span> -&gt; sayHello ();</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure>

<h3 id="当前类的成员覆盖了-trait-的方法"><a href="#当前类的成员覆盖了-trait-的方法" class="headerlink" title="当前类的成员覆盖了 trait 的方法"></a>当前类的成员覆盖了 trait 的方法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TheWorldIsNotEnough</span> </span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HelloWorld</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sayHello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Hello Universe!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> TheWorldIsNotEnough();</span><br><span class="line"><span class="variable">$o</span>-&gt;sayHello();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello Universe!</span><br></pre></td></tr></table></figure>

<h2 id="项目示例"><a href="#项目示例" class="headerlink" title="项目示例"></a>项目示例</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$gis</span> = <span class="keyword">new</span> Gis();</span><br><span class="line"><span class="variable">$keyid</span> = <span class="variable">$gis</span>-&gt;tranKeyNameToKeyId(<span class="variable">$keyname</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$gis</span>-&gt;getGisByKeyId(<span class="variable">$keyid</span>);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/06/02/%E5%85%B3%E4%BA%8E%E5%9C%A8Flask%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E5%AE%9A%E6%97%B6%E8%B0%83%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/02/%E5%85%B3%E4%BA%8E%E5%9C%A8Flask%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E5%AE%9A%E6%97%B6%E8%B0%83%E7%94%A8/" class="post-title-link" itemprop="url">关于在Flask页面中的定时调用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-02 00:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T00:00:00+08:00">2017-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>|<br>| code  | 必需,要推迟执行的函数名或者一段js代码 |<br>| millisec     |   必须,推迟执行的毫秒数 |<br>| lang | 可选,JScript/VBScript/JavaScript|</p>
<p>Talk is cheep.show me the code~~看下面一段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// code1</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// code3    </span></span><br><span class="line">    &#125;,<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// code2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在讲述这段代码之前，我们首先还得明确一件事情:<br>js任务分为同步任务和异步任务，只有当主线程空闲，才会去读取“任务队列”，不幸的是，异步任务就是进入到“任务队列”的任务，只有当“任务列队”通知主线程，某个异步任务可以执行了并且同步任务执行完毕，该任务才会进入主线程执行。额外补充这些知识，之后再往下看。</p>
<p>假设该函数被执行了,首先执行到 code1 的内容,然后运行到 setTimeout 部分,setTimeout 这个时候告诉浏览器，我这里有段代码将会在 1000 ms之后插入到你的任务队列当中去,然后浏览器主线程接着执行了 code2,等到了 1000ms,会出现什么情况呢，这个时候定时器将 code3 插入到了任务队列,这并不意味着code3就会被立即执行,如果 code2 的执行时间超过了 1000ms,那么这个时候很显然 code3不会被执行,需要等待 code2 执行完毕，当然如果 code2 的执行时间不超过 1000ms,那么到了1000ms,code3就会被执行了,这个时候定时器就正常发挥作用了。</p>
<p>把上面的代码改一下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// code1</span></span><br><span class="line">    <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// code3    </span></span><br><span class="line">    &#125;,<span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// code2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于这段代码可能会出现三种情况:</p>
<ol>
<li>正常执行</li>
<li>时间间隔可能会跳过</li>
<li>时间间隔可能小于定时调用的代码的执行时间</li>
</ol>
<p>正常的情况就不多说了，说说第二种可能会被跳过的原因，整个函数执行下来要1500ms,假设 code1 在200ms执行完成,以此作为时间点,setInterval将在1200ms时将code3插入到任务队列当中,然后func()函数顺利执行，不幸的是,code3代码执行的时间比较长,到下个 时间点2200ms时又插入了一份code3,你觉得接下来的时间点中,还会再插入新的code3吗~~实际上并不会，所以3200ms这个时间点会被跳过<br>为了避免这种情况,可以使用如下的代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line"><span class="comment">//processing </span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="built_in">arguments</span>.callee, interval); </span><br><span class="line">&#125;, interval); </span><br></pre></td></tr></table></figure>

<p>arguments.callee表示引用当前正在执行的函数，或者说是调用arguments.callee的函数对象的引用，它给匿名函数提供了一种自我引用的方式。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/06/02/How%20To%20Structure%20Large%20Flask%20Applications/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/06/02/How%20To%20Structure%20Large%20Flask%20Applications/" class="post-title-link" itemprop="url">How To Structure Large Flask Applications</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-06-02 00:00:00" itemprop="dateCreated datePublished" datetime="2017-06-02T00:00:00+08:00">2017-06-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>整理翻译自<a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-structure-large-flask-applications">How To Structure Large Flask Applications</a></p>
</blockquote>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>其实已经有许多关于如何组织架构 Python Web 应用的方法和约定。尽管现在有些框架本身承载了一些工具(脚手架)从而可以达到实现自动化和降低任务难度的效果,但是究根结底几乎所有的解决方案都是依赖于打包/模块化应用作为代码块从而达到分发到相关的文件和文件夹的目的。</p>
<p>最小的 web 应用开发框架 Flask 有着它特有的(工具)-blueprints。</p>
<p>在这篇数码海洋的文章里,我们将会了解到如何使用 Flask 的 blueprints 来创建一个应用目录和组织架构它从而使其变成可重用的组件。这些将会给你的维护和组件的开发带来巨大的好处和便捷。</p>
<h2 id="学术表"><a href="#学术表" class="headerlink" title="学术表"></a>学术表</h2><ol>
<li>Flask：最小的应用开发框架</li>
<li>关于我们在这篇文章的选择</li>
<li>准备Flask系统<ol>
<li>准备操作系统</li>
<li>安装Python,pip以及virtualenv</li>
</ol>
</li>
<li>组织架构应用的目录<ol>
<li>创建应用目录</li>
<li>创建虚拟环境</li>
<li>创建应用文件</li>
<li>安装 Flask</li>
</ol>
</li>
<li>使用模块和 Blueprints(组件)<ol>
<li>模块基础</li>
<li>模块模板</li>
</ol>
</li>
<li>创建应用(run.py,init.py 等等)<ol>
<li>使用 nano 编辑 run.py</li>
<li>使用 nano 编辑 config.py</li>
</ol>
</li>
<li>创建一个模块/组件<ol>
<li>组织架构模型</li>
<li>定义模块数据类型</li>
<li>定义模块表单</li>
<li>定义应用控制器(views)</li>
<li>在 “app/init.py” 中建立应用</li>
<li>创建模板</li>
<li>实际操作中查看你的模型</li>
</ol>
</li>
</ol>
<h2 id="Flask-最小的应用开发框架"><a href="#Flask-最小的应用开发框架" class="headerlink" title="Flask:最小的应用开发框架"></a>Flask:最小的应用开发框架</h2><p>Flask 迷你的框架但是丝毫不会影响重要事情的处理方式。相反, Flask 允许开发者使用他们渴望的并且熟悉的工具。出于这个目的,它由此产生了自己的扩展索引和大量已经存在并解决大多数事情的的工具从登陆到日志方方面面。</p>
<p>它不是一个严格的“常规”框架，部分依赖于配置文件,这些配置文件使得其在开始使用和保持事项时变得更容易。</p>
<h2 id="我们在文章中的选择"><a href="#我们在文章中的选择" class="headerlink" title="我们在文章中的选择"></a>我们在文章中的选择</h2><p>通过我们前面浏览的内容了解到,Flask 的方式就是让我们使用那些用起来最舒服的工具。在我们的文章中,我们将会使用最常见的扩展和库。这些选择包括:</p>
<ol>
<li>SQLAlchemy</li>
<li>WTForms</li>
</ol>
<h3 id="Flask-SQLAlchemy"><a href="#Flask-SQLAlchemy" class="headerlink" title="Flask-SQLAlchemy"></a>Flask-SQLAlchemy</h3><p>在 Flask 中添加 SQLAlchemy 支持很快捷。这是一个很好的扩展。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Author: Armin Ronacher</span><br><span class="line">PyPI Page: Flask-SQLAlchemy</span><br><span class="line">Documentation: Read docs @ packages.python.org</span><br><span class="line">On Github: [mitsuhiko/flask-sqlalchemy](https://github.com/mitsuhiko/flask-sqlalchemy)</span><br></pre></td></tr></table></figure>

<h3 id="Flask-WTF"><a href="#Flask-WTF" class="headerlink" title="Flask-WTF"></a>Flask-WTF</h3><p>Flask-WTF 提供简单的 WTForms 集成。集成包括可选择的 用来提供更好安全保障的 CSRF。这也是一个很好的扩展。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Author: Anthony Ford (created by Dan Jacob)</span><br><span class="line">PyPI Page: Flask-WTF</span><br><span class="line">Documentation: Read docs @ packages.python.org</span><br><span class="line">On Github: [ajford/flask-wtf](https://github.com/mitsuhiko/flask-wtf)</span><br></pre></td></tr></table></figure>

<h2 id="准备-Flask-系统"><a href="#准备-Flask-系统" class="headerlink" title="准备 Flask 系统"></a>准备 Flask 系统</h2><h3 id="准备操作系统"><a href="#准备操作系统" class="headerlink" title="准备操作系统"></a>准备操作系统</h3><p>使用如下命令安装必要的开发工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aptitude update</span><br><span class="line">aptitude -y upgrade</span><br><span class="line">aptitude install -y build-essential python-dev python2.7-dev</span><br></pre></td></tr></table></figure>

<h3 id="安装python-pip以及virtualenv"><a href="#安装python-pip以及virtualenv" class="headerlink" title="安装python,pip以及virtualenv"></a>安装python,pip以及virtualenv</h3><p>参考 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26663186">Flask入门——从无到有构建一个网站 （二）环境搭建</a></p>
<h2 id="组织应用的目录"><a href="#组织应用的目录" class="headerlink" title="组织应用的目录"></a>组织应用的目录</h2><p>我们将使用典型的大型应用名称作为我们的应用的文件夹。在文件夹里，我们将会有一个虚拟环境与此同时还有应用的包以及一些其他的文件夹包括 用来运行 测试(开发)环境的 “run.py” 和 Flask 的配置文件 “config.py”</p>
<p>下面给出的作为样例的目录结构，该目录结构是高度可扩展的,它构建的目的是充分利用 Flask 和其他库提供的工具。不要被它吓着了，我们将会一步一步构建它直至完成。</p>
<p>目标样例结构:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~/LargeApp</span><br><span class="line">    |-- run.py</span><br><span class="line">    |-- config.py</span><br><span class="line">    |__ /env             # Virtual Environment</span><br><span class="line">    |__ /app             # Our Application Module</span><br><span class="line">         |-- __init__.py</span><br><span class="line">         |-- /module_one</span><br><span class="line">             |-- __init__.py</span><br><span class="line">             |-- controllers.py</span><br><span class="line">             |-- models.py                </span><br><span class="line">         |__ /templates</span><br><span class="line">             |__ /module_one</span><br><span class="line">                 |-- hello.html</span><br><span class="line">         |__ /static</span><br><span class="line">         |__ ..</span><br><span class="line">         |__ .</span><br><span class="line">    |__ ..</span><br><span class="line">    |__ .</span><br></pre></td></tr></table></figure>

<h3 id="创建应用文件夹"><a href="#创建应用文件夹" class="headerlink" title="创建应用文件夹"></a>创建应用文件夹</h3><p>让我们开始创建我们需要的主要目录。<br>逐条去执行下述命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/LargeApp</span><br><span class="line">mkdir ~/LargeApp/app</span><br><span class="line">mkdir ~/LargeApp/app/templates</span><br><span class="line">mkdir ~/LargeApp/app/static   </span><br></pre></td></tr></table></figure>

<p>执行完成之后我们的当前目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~/LargeApp</span><br><span class="line">    |__ /app             # Our Application Module</span><br><span class="line">         |__ /templates</span><br><span class="line">         |__ /static</span><br></pre></td></tr></table></figure>
<h3 id="创建一个虚拟环境"><a href="#创建一个虚拟环境" class="headerlink" title="创建一个虚拟环境"></a>创建一个虚拟环境</h3><p>使用一个虚拟环境能给你带来很多好处。对于你的每一个应用都强烈推荐使用一个新的虚拟环境。在你的应用中创建一个虚拟环境是一个很好的让你应用有序和干净的方法。</p>
<p>使用下列命令创建一个虚拟环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/LargetApp</span><br><span class="line">virtualenv env</span><br></pre></td></tr></table></figure>

<h3 id="创建应用文件"><a href="#创建应用文件" class="headerlink" title="创建应用文件"></a>创建应用文件</h3><p>在这步，我们将会在使用 modules 和 blueprints 之前创建我们基础应用文件。</p>
<p>运行下列文件创建基本应用文件:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch ~/LargeApp/run.py</span><br><span class="line">touch ~/LargeApp/config.py</span><br><span class="line">touch ~/LargeApp/app/__init__.py</span><br></pre></td></tr></table></figure>

<p>我们当前的结构:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">~/LargeApp</span><br><span class="line">    |-- run.py</span><br><span class="line">    |-- config.py</span><br><span class="line">    |__ /env             # Virtual Environment</span><br><span class="line">    |__ /app             # Our Application Module</span><br><span class="line">         |-- __init__.py</span><br><span class="line">         |__ /templates</span><br><span class="line">         |__ /static</span><br></pre></td></tr></table></figure>

<h3 id="安装-Flask-和相关依赖库"><a href="#安装-Flask-和相关依赖库" class="headerlink" title="安装 Flask 和相关依赖库"></a>安装 Flask 和相关依赖库</h3><p>目录什么都创建好之后，我们开始使用 pip 下载安装我们的Flask</p>
<p>使用下述命令将 Flask 安装到虚拟环境当中:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~/LargeApp</span><br><span class="line">env/bin/pip install flask</span><br><span class="line">env/bin/pip install flask-sqlalchemy</span><br><span class="line">env/bin/pip install flask-wtf</span><br></pre></td></tr></table></figure>

<h2 id="使用-Modules-和-Blueprints（组件）"><a href="#使用-Modules-和-Blueprints（组件）" class="headerlink" title="使用 Modules 和 Blueprints（组件）"></a>使用 Modules 和 Blueprints（组件）</h2><h3 id="基础模块"><a href="#基础模块" class="headerlink" title="基础模块"></a>基础模块</h3><p>在走到这一步的时候，我们已经将我们的应用结构创建好了并且也将所有的依赖下载完成了。</p>
<p>我们的目标是模块化可逻辑分组的所有相关模块。</p>
<p>举个简单的例子比如认证系统。将所有视图，控制器，模型和帮助器置于一个位置，以允许可重用性的方式进行设置，这使得这种结构化成为维护应用程序同时提高生产力的好方法。</p>
<p>目标案例模块(组件)结构(在/app里面)：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Our module example here is called *mod_auth*</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You can name them as you like as long as conventions are followed</span></span><br><span class="line"></span><br><span class="line">/mod_auth</span><br><span class="line">    |-- __init__.py</span><br><span class="line">    |-- controllers.py</span><br><span class="line">    |-- models.py</span><br><span class="line">    |-- ..</span><br><span class="line">    |-- .</span><br></pre></td></tr></table></figure>

<h3 id="模块模板"><a href="#模块模板" class="headerlink" title="模块模板"></a>模块模板</h3><p>为了使得达到最大的模块化，我们将遵循上述规定创建 “templates” 文件夹,同时并保护一个与模块相同或相似的相关名称的新文件夹，以包含其模板文件。</p>
<p>目标样例模板目录结构(在 LargeApp 中):</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/templates</span><br><span class="line">    |-- 404.html</span><br><span class="line">    |__ /auth</span><br><span class="line">         |-- signin.html</span><br><span class="line">         |-- signup.html</span><br><span class="line">         |-- forgot.html</span><br><span class="line">         |-- ..</span><br><span class="line">         |-- .</span><br></pre></td></tr></table></figure>

<h2 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h2><p>在本节中，我们将继续前面的步骤，并从我们的应用程序的实际编码开始，然后再转到创建第一个模块化组件（使用蓝图）：mod_auth，其用来处理所有与身份验证相关的过程。</p>
<h3 id="使用-nano-编辑-“run-py”"><a href="#使用-nano-编辑-“run-py”" class="headerlink" title="使用 nano 编辑 “run.py”"></a>使用 nano 编辑 “run.py”</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/LargeApp/run.py</span><br></pre></td></tr></table></figure>

<p>输入如下内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Run a <span class="built_in">test</span> server.</span></span><br><span class="line">from app import app</span><br><span class="line">app.run(host=&#x27;0.0.0.0&#x27;, port=8080, debug=True)</span><br></pre></td></tr></table></figure>

<p>保存退出。</p>
<h3 id="使用-nano-编辑-“config-py”"><a href="#使用-nano-编辑-“config-py”" class="headerlink" title="使用 nano 编辑 “config,py”"></a>使用 nano 编辑 “config,py”</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/LargeApp/config.py</span><br></pre></td></tr></table></figure>

<p>输入如下内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Statement <span class="keyword">for</span> enabling the development environment</span></span><br><span class="line">DEBUG = True</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Define the application directory</span></span><br><span class="line">import os</span><br><span class="line">BASE_DIR = os.path.abspath(os.path.dirname(__file__))  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Define the database - we are working with</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SQLite <span class="keyword">for</span> this example</span></span><br><span class="line">SQLALCHEMY_DATABASE_URI = &#x27;sqlite:///&#x27; + os.path.join(BASE_DIR, &#x27;app.db&#x27;)</span><br><span class="line">DATABASE_CONNECT_OPTIONS = &#123;&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Application threads. A common general assumption is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> using 2 per available processor cores - to handle</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> incoming requests using one and performing background</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> operations using the other.</span></span><br><span class="line">THREADS_PER_PAGE = 2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enable protection agains *Cross-site Request Forgery (CSRF)*</span></span><br><span class="line">CSRF_ENABLED     = True</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Use a secure, unique and absolutely secret key <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> signing the data.</span> </span><br><span class="line">CSRF_SESSION_KEY = &quot;secret&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Secret key <span class="keyword">for</span> signing cookies</span></span><br><span class="line">SECRET_KEY = &quot;secret&quot;</span><br></pre></td></tr></table></figure>

<p>保存退出。</p>
<h2 id="创建模块-组件"><a href="#创建模块-组件" class="headerlink" title="创建模块/组件"></a>创建模块/组件</h2><p>本节是定义本文核心的第一个主要步骤。 在这里，我们将看到如何使用Flask的蓝图来创建一个模块（即组件）。</p>
<h3 id="第一步-结构化模块"><a href="#第一步-结构化模块" class="headerlink" title="第一步 结构化模块"></a>第一步 结构化模块</h3><p>正如我们已经开始做的，让我们创建我们的第一个模块（mod_auth）目录和文件来开始工作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Create the module directory inside the *app* module</span></span><br><span class="line">mkdir ~/LargeApp/app/mod_auth</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create <span class="built_in">where</span> module<span class="string">&#x27;s templates will reside</span></span></span><br><span class="line">mkdir ~/LargeApp/app/templates/auth</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Create __init__.py to set the directory as a Python module</span></span></span><br><span class="line">touch ~/LargeApp/app/mod_auth/__init__.py</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Create module&#x27;</span>s controllers and models etc.</span></span><br><span class="line">touch ~/LargeApp/app/mod_auth/controllers.py</span><br><span class="line">touch ~/LargeApp/app/mod_auth/models.py</span><br><span class="line">touch ~/LargeApp/app/mod_auth/forms.py</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Create module<span class="string">&#x27;s templates</span></span></span><br><span class="line">touch ~/LargeApp/app/templates/auth/signin.html</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Create a HTTP 404 Error page</span></span></span><br><span class="line">touch ~/LargeApp/app/templates/404.html</span><br></pre></td></tr></table></figure>

<p>在上述操作过程之后,我们的目录结构类似这样:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~/LargeApp</span><br><span class="line">    |-- run.py</span><br><span class="line">    |-- config.py</span><br><span class="line">    |__ /env             # Virtual Environment</span><br><span class="line">    |__ /app             # Our Application Module</span><br><span class="line">         |-- __init__.py</span><br><span class="line">         |-- /mod_auth   # Our first module, mod_auth</span><br><span class="line">             |-- __init__.py</span><br><span class="line">             |-- controllers.py</span><br><span class="line">             |-- models.py</span><br><span class="line">             |-- forms.py</span><br><span class="line">         |__ /templates</span><br><span class="line">             |-- 404.html</span><br><span class="line">             |__ /auth</span><br><span class="line">                 |-- signin.html</span><br><span class="line">         |__ /static</span><br></pre></td></tr></table></figure>

<h3 id="第二步-定义模块数据模型"><a href="#第二步-定义模块数据模型" class="headerlink" title="第二步 定义模块数据模型"></a>第二步 定义模块数据模型</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/LargeApp/app/mod_auth/models.py</span><br></pre></td></tr></table></figure>

<p>输入下述内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import the database object (db) from the main application module</span></span><br><span class="line"><span class="comment"># We will define this inside /app/__init__.py in the next sections.</span></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a base model for other database tables to inherit</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span>(<span class="params">db.Model</span>):</span></span><br><span class="line"></span><br><span class="line">    __abstract__  = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">id</span>            = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    date_created  = db.Column(db.DateTime,  default=db.func.current_timestamp())</span><br><span class="line">    date_modified = db.Column(db.DateTime,  default=db.func.current_timestamp(),</span><br><span class="line">                                           onupdate=db.func.current_timestamp())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a User model</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">Base</span>):</span></span><br><span class="line"></span><br><span class="line">    __tablename__ = <span class="string">&#x27;auth_user&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># User Name</span></span><br><span class="line">    name    = db.Column(db.String(<span class="number">128</span>),  nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Identification Data: email &amp; password</span></span><br><span class="line">    email    = db.Column(db.String(<span class="number">128</span>),  nullable=<span class="literal">False</span>,</span><br><span class="line">                                            unique=<span class="literal">True</span>)</span><br><span class="line">    password = db.Column(db.String(<span class="number">192</span>),  nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Authorisation Data: role &amp; status</span></span><br><span class="line">    role     = db.Column(db.SmallInteger, nullable=<span class="literal">False</span>)</span><br><span class="line">    status   = db.Column(db.SmallInteger, nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># New instance instantiation procedure</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, email, password</span>):</span></span><br><span class="line"></span><br><span class="line">        self.name     = name</span><br><span class="line">        self.email    = email</span><br><span class="line">        self.password = password</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;User %r&gt;&#x27;</span> % (self.name)      </span><br></pre></td></tr></table></figure>

<p>保存并退出</p>
<h3 id="第三步-定义模块表单"><a href="#第三步-定义模块表单" class="headerlink" title="第三步 定义模块表单"></a>第三步 定义模块表单</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/LargeApp/app/mod_auth/forms.py</span><br></pre></td></tr></table></figure>

<p>输入下述内容:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import Form and RecaptchaField (optional)</span></span><br><span class="line"><span class="keyword">from</span> flask.ext.wtf <span class="keyword">import</span> Form <span class="comment"># , RecaptchaField</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Import Form elements such as TextField and BooleanField (optional)</span></span><br><span class="line"><span class="keyword">from</span> wtforms <span class="keyword">import</span> TextField, PasswordField <span class="comment"># BooleanField</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Import Form validators</span></span><br><span class="line"><span class="keyword">from</span> wtforms.validators <span class="keyword">import</span> Required, Email, EqualTo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the login form (WTForms)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span>(<span class="params">Form</span>):</span></span><br><span class="line">    email    = TextField(<span class="string">&#x27;Email Address&#x27;</span>, [Email(),</span><br><span class="line">                Required(message=<span class="string">&#x27;Forgot your email address?&#x27;</span>)])</span><br><span class="line">    password = PasswordField(<span class="string">&#x27;Password&#x27;</span>, [</span><br><span class="line">                Required(message=<span class="string">&#x27;Must provide a password. ;-)&#x27;</span>)])</span><br></pre></td></tr></table></figure>

<p>保存并退出</p>
<h3 id="第四步-定义应用控制器-视图"><a href="#第四步-定义应用控制器-视图" class="headerlink" title="第四步 定义应用控制器(视图)"></a>第四步 定义应用控制器(视图)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/LargeApp/app/mod_auth/controllers.py</span><br></pre></td></tr></table></figure>

<p>输入下述内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import flask dependencies</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint, request, render_template, \</span><br><span class="line">                  flash, g, session, redirect, url_for</span><br><span class="line"></span><br><span class="line"><span class="comment"># Import password / encryption helper tools</span></span><br><span class="line"><span class="keyword">from</span> werkzeug <span class="keyword">import</span> check_password_hash, generate_password_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># Import the database object from the main app module</span></span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"><span class="comment"># Import module forms</span></span><br><span class="line"><span class="keyword">from</span> app.mod_auth.forms <span class="keyword">import</span> LoginForm</span><br><span class="line"></span><br><span class="line"><span class="comment"># Import module models (i.e. User)</span></span><br><span class="line"><span class="keyword">from</span> app.mod_auth.models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the blueprint: &#x27;auth&#x27;, set its url prefix: app.url/auth</span></span><br><span class="line">mod_auth = Blueprint(<span class="string">&#x27;auth&#x27;</span>, __name__, url_prefix=<span class="string">&#x27;/auth&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the route and accepted methods</span></span><br><span class="line"><span class="meta">@mod_auth.route(<span class="params"><span class="string">&#x27;/signin/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If sign in form is submitted</span></span><br><span class="line">    form = LoginForm(request.form)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Verify the sign in form</span></span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line"></span><br><span class="line">        user = User.query.filter_by(email=form.email.data).first()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">and</span> check_password_hash(user.password, form.password.data):</span><br><span class="line"></span><br><span class="line">            session[<span class="string">&#x27;user_id&#x27;</span>] = user.<span class="built_in">id</span></span><br><span class="line"></span><br><span class="line">            flash(<span class="string">&#x27;Welcome %s&#x27;</span> % user.name)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;auth.home&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        flash(<span class="string">&#x27;Wrong email or password&#x27;</span>, <span class="string">&#x27;error-message&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;auth/signin.html&quot;</span>, form=form)</span><br></pre></td></tr></table></figure>

<p>保存并退出</p>
<h3 id="第五步-在应用中创建-“app-init-py”"><a href="#第五步-在应用中创建-“app-init-py”" class="headerlink" title="第五步 在应用中创建 “app/init.py”"></a>第五步 在应用中创建 “app/init.py”</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/LargeApp/app/__init__.py</span><br></pre></td></tr></table></figure>

<p>输入以下内容:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Import flask and template operators</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"></span><br><span class="line"><span class="comment"># Import SQLAlchemy</span></span><br><span class="line"><span class="keyword">from</span> flask.ext.sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the WSGI application object</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configurations</span></span><br><span class="line">app.config.from_object(<span class="string">&#x27;config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the database object which is imported</span></span><br><span class="line"><span class="comment"># by modules and controllers</span></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample HTTP error handling</span></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">not_found</span>(<span class="params">error</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;404.html&#x27;</span>), <span class="number">404</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Import a module / component using its blueprint handler variable (mod_auth)</span></span><br><span class="line"><span class="keyword">from</span> app.mod_auth.controllers <span class="keyword">import</span> mod_auth <span class="keyword">as</span> auth_module</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register blueprint(s)</span></span><br><span class="line">app.register_blueprint(auth_module)</span><br><span class="line"><span class="comment"># app.register_blueprint(xyz_module)</span></span><br><span class="line"><span class="comment"># ..</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build the database:</span></span><br><span class="line"><span class="comment"># This will create the database file using SQLAlchemy</span></span><br><span class="line">db.create_all()</span><br></pre></td></tr></table></figure>

<p>保存并退出</p>
<h3 id="第六步-创建模板"><a href="#第六步-创建模板" class="headerlink" title="第六步 创建模板"></a>第六步 创建模板</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano ~/LargeApp/app/templates/auth/signin.html</span><br></pre></td></tr></table></figure>

<p>输入以下内容:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;% macro render_field(field, placeholder=None) %&#125;</span><br><span class="line">&#123;% if field.errors %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% elif field.flags.error %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">    &#123;% set css_class = &#x27;form-control &#x27; + kwargs.pop(&#x27;class&#x27;, &#x27;&#x27;) %&#125;</span><br><span class="line">    &#123;&#123; field(class=css_class, placeholder=placeholder, **kwargs) &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endmacro %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    &#123;% with errors = get_flashed_messages(category_filter=[&quot;error&quot;]) %&#125;</span><br><span class="line">    &#123;% if errors %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% for error in errors %&#125;</span><br><span class="line">    &#123;&#123; error &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    &#123;% endwith %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% if form.errors %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% for field, error in form.errors.items() %&#125;</span><br><span class="line">    &#123;% for e in error %&#125;</span><br><span class="line">    &#123;&#123; e &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">action</span>=<span class="string">&quot;.&quot;</span> <span class="attr">accept-charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">role</span>=<span class="string">&quot;form&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; form.csrf_token &#125;&#125;</span><br><span class="line">      &#123;&#123; render_field(form.email, placeholder=&quot;Your Email Address&quot;,</span><br><span class="line">                                  autofocus=&quot;&quot;) &#125;&#125;</span><br><span class="line">      &#123;&#123; render_field(form.password, placeholder=&quot;Password&quot;) &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;remember&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span> Remember Me</span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">role</span>=<span class="string">&quot;button&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>Forgot your password?<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;clearfix&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>保存并退出</p>
<h3 id="第七步-从网页浏览你定义的模块"><a href="#第七步-从网页浏览你定义的模块" class="headerlink" title="第七步 从网页浏览你定义的模块"></a>第七步 从网页浏览你定义的模块</h3><p>模块创建成功了，接下来就是查看我们定义的模板了</p>
<p>运行 <code>run.py</code> 文件启动开发环境服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/LargeApp</span><br><span class="line">env/bin/python run.py</span><br></pre></td></tr></table></figure>

<p>上述命令将会初始化一个开发环境服务器，端口为 8080.<br>通过 URL 去访问我们的模块</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://[your droplet&#x27;s IP]/auth/signin</span><br></pre></td></tr></table></figure>
<p>虽然您无法登录，但您可以通过输入一些示例数据或通过测试其验证器来查看它。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/04/10/How%20To%20Serve%20Flask%20Applications%20with%20uWSGI%20and%20Nginx%20on%20Ubuntu%2014.04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/04/10/How%20To%20Serve%20Flask%20Applications%20with%20uWSGI%20and%20Nginx%20on%20Ubuntu%2014.04/" class="post-title-link" itemprop="url">How To Serve Flask Applications with uWSGI and Nginx on Ubuntu 14.04</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-04-10 00:00:00" itemprop="dateCreated datePublished" datetime="2017-04-10T00:00:00+08:00">2017-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="部署过程中出现错误"><a href="#部署过程中出现错误" class="headerlink" title="部署过程中出现错误"></a>部署过程中出现错误</h1><blockquote>
<p>[emerg] 10255#0: bind() to 0.0.0.0:80 failed (98: Address already in use)</p>
</blockquote>
<p>解决办法,使用如下命令关闭占用80端口的程序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fuser -k 80/tcp</span><br></pre></td></tr></table></figure>

<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="安装相关的软件"><a href="#安装相关的软件" class="headerlink" title="安装相关的软件"></a>安装相关的软件</h2><p>使用如下命令行,完成相应的 <em>python-pip python-dev</em> 和 <em>ngnix</em> 安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install python-pip python-dev nginx</span><br></pre></td></tr></table></figure>

<h2 id="创建-Python的虚拟环境"><a href="#创建-Python的虚拟环境" class="headerlink" title="创建 Python的虚拟环境"></a>创建 Python的虚拟环境</h2><p>参考我的另一文章<a target="_blank" rel="noopener" href="http://www.leetao94.cn/2016/10/11/why-I-use-virtualenv/">为什么使用virtualenv</a></p>
<p>安装成功之后,然后创建为我们的flask项目创建一个目录，然后在该目录下创建虚拟环境,如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/myproject</span><br><span class="line">cd ~/myproject</span><br><span class="line">virtualenv myprojectenv</span><br></pre></td></tr></table></figure>

<p>关于 <em>virtuelenv</em> 相关使用这里不再讲述</p>
<h2 id="创建flask项目"><a href="#创建flask项目" class="headerlink" title="创建flask项目"></a>创建flask项目</h2><h3 id="安装-Flask-和-uWSGI"><a href="#安装-Flask-和-uWSGI" class="headerlink" title="安装 Flask 和 uWSGI"></a>安装 Flask 和 uWSGI</h3><p>使用 <em>pip</em> 安装 Falsk 和 uWSGI,这里我们不需要激活虚拟环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install uwsgi flask</span><br></pre></td></tr></table></figure>

<h3 id="创建应用"><a href="#创建应用" class="headerlink" title="创建应用"></a>创建应用</h3><p>这里作为演示,我们将会在一个文件中创建一个简单的应用.使用下面命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/myproject/myproject.py</span><br></pre></td></tr></table></figure>

<p>然后在文件中键入下述代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">application = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@application.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;h1 style=&#x27;color:blue&#x27;&gt;Hello There!&lt;/h1&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    application.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>保存并退出,然后我们通过命令行运行我们的应用了:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python myproject.py</span><br></pre></td></tr></table></figure>

<p>然后通过浏览器访问,终端输出的 IP 地址或者域名(xxxx:5000)，然后你可能会看见下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/d9e82fa4ly1fehvhoila8j205601ea9u.jpg"></p>
<h3 id="创建-WSGI-入口"><a href="#创建-WSGI-入口" class="headerlink" title="创建 WSGI 入口"></a>创建 WSGI 入口</h3><p>经过刚才验证,我们已经可以确认项目可以运行,接下来我们将创建一个文件，作为我们应用的入口.通过这个文件我们可以很好的与 uWSGI 进行交互.通过命令行创建 <em>wsgi.py</em> 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/myproject/wsgi.py</span><br></pre></td></tr></table></figure>

<p>这个文件十分简单,我们可以简单的将我们的 flask 应用实例引入进来，然后运行它</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wsgi.py</span></span><br><span class="line"><span class="keyword">from</span> myproject <span class="keyword">import</span> application</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    application.run()</span><br></pre></td></tr></table></figure>

<h2 id="配置-uWSGI"><a href="#配置-uWSGI" class="headerlink" title="配置 uWSGI"></a>配置 uWSGI</h2><p>我们的应用基本完成然后我们应用的入口也成功的创建了,接下来我们就需要开始 uWSGI 的配置了</p>
<h3 id="测试-uWSGI-的服务"><a href="#测试-uWSGI-的服务" class="headerlink" title="测试 uWSGI 的服务"></a>测试 uWSGI 的服务</h3><p>我们需要做的第一件事就是测试 uWSGI 能不能运行我们的应用.不需要太麻烦，我们只需要通过下述的命令就可以测试:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uwsgi --socket 0.0.0.0:8000 --protocol=http -w wsgi</span><br></pre></td></tr></table></figure>

<p>现在你可以通过浏览器访问你的应用,类似xxxx:8000，如果你看见和刚才一样的页面就说明的测试基本是成功的.如果在此之前你激活了你的虚拟环境,那么接下来记得退出它,接下来的操作都是需要在本地的 Python 环境下.</p>
<h3 id="创建-uWSGI-配置文件"><a href="#创建-uWSGI-配置文件" class="headerlink" title="创建 uWSGI 配置文件"></a>创建 uWSGI 配置文件</h3><p>同样是在之前的项目文件下创建 <em>myproject.ini</em> 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/myproject/myproject.ini</span><br></pre></td></tr></table></figure>

<p>然后在该文件中键入如下内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[uwsgi]</span><br><span class="line">module = wsgi</span><br><span class="line"></span><br><span class="line">master = true</span><br><span class="line">processes = 5</span><br><span class="line"></span><br><span class="line">socket = myproject.sock</span><br><span class="line">chmod-socket = 660</span><br><span class="line">vacuum = true</span><br><span class="line"></span><br><span class="line">die-on-term = true</span><br></pre></td></tr></table></figure>
<p>输入完成之后保存并退出.</p>
<h3 id="创建启动脚本"><a href="#创建启动脚本" class="headerlink" title="创建启动脚本"></a>创建启动脚本</h3><p>创建启动脚本的目的就是为了在服务运行的时候可以运行我们的 Flask 应用.我们需要在*/etc/init*目录下创建一个 <em>.conf</em>的文件,这里我们就以 <em>myproject.conf</em>为例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/init/myproject.conf</span><br></pre></td></tr></table></figure>

<p>然后键入如下内容:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">description &quot;uWSGI server instance configured to serve myproject&quot;</span><br><span class="line"></span><br><span class="line">start on runlevel [2345]</span><br><span class="line">stop on runlevel [!2345]</span><br><span class="line"></span><br><span class="line">setuid user</span><br><span class="line">setgid www-data</span><br><span class="line"></span><br><span class="line">env PATH=/home/user/myproject/myprojectenv/bin</span><br><span class="line">chdir /home/user/myproject</span><br><span class="line">exec uwsgi --ini myproject.ini</span><br></pre></td></tr></table></figure>
<p>添加完成后保存并退出,接下来我们就可以通过命令启动该进程了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo start myproject</span><br></pre></td></tr></table></figure>

<h2 id="配置-Nginx-反向代理"><a href="#配置-Nginx-反向代理" class="headerlink" title="配置 Nginx 反向代理"></a>配置 Nginx 反向代理</h2><p>我们的 uWSGI 应用现在已经被启动并运行了,在项目目录下等待着请求.我们还需要通过配置 Nginx 将 web 请求转发到该接口上.</p>
<h3 id="创建-Nginx-配置文件"><a href="#创建-Nginx-配置文件" class="headerlink" title="创建 Nginx 配置文件"></a>创建 Nginx 配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/nginx/sites-available/myproject</span><br></pre></td></tr></table></figure>

<p>然后键入如下命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name server_domain_or_IP;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        include uwsgi_params;</span><br><span class="line">        uwsgi_pass unix:/home/user/myproject/myproject.sock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加完成后保存并退出.为了保证我们的配置能够生效,我们需要将文件链接到 <em>sites-enabled</em> 目录下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /etc/nginx/sites-available/myproject /etc/nginx/sites-enabled</span><br></pre></td></tr></table></figure>

<p>我们可以通过下述命令测试我们创建的文件语法是否正确:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure>
<p>如果没有返回任何错误信息,我们可以重启 Nginx 重新加载我们的配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nginix restart</span><br></pre></td></tr></table></figure>

<p>现在你可以通过浏览器直接访问你的域名或者IP地址看到我们的应用了.</p>
<blockquote>
<p>参考地址:<a target="_blank" rel="noopener" href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-uwsgi-and-nginx-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-uwsgi-and-nginx-on-ubuntu-14-04</a></p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/03/28/Openlayers%E4%BB%BF%E9%93%BE%E5%AE%B6%E7%BD%91%E5%8A%A0%E8%BD%BD%E6%95%88%E6%9E%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/03/28/Openlayers%E4%BB%BF%E9%93%BE%E5%AE%B6%E7%BD%91%E5%8A%A0%E8%BD%BD%E6%95%88%E6%9E%9C/" class="post-title-link" itemprop="url">Openlayers仿链家网加载效果</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-03-28 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-28T00:00:00+08:00">2017-03-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="效果预览"><a href="#效果预览" class="headerlink" title="效果预览"></a>效果预览</h1><p>在上代码之前首先让我们看一下链家网的加载效果，也就是这次我们的模仿对象，效果如下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/d9e82fa4ly1fe2dmqh07hg20qk0gaqv6.gif"></p>
<p>下面是我们实现的效果:</p>
<p><img src="http://ww1.sinaimg.cn/large/d9e82fa4ly1fe2dq2tou6g20qk0gaqv7.gif"></p>
<h1 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h1><p>当 <em>Zoom</em> 改变的时候，根据圆的<strong>Radiu</strong> 和 <strong>Zoom</strong>，计算出适合当前地图的圆的半径，然后重新绘圆</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Gis展示<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;jslib/openlayer3/css/ol.css&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;jslib/jeasyui/themes/default/easyui.css&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;jslib/openlayer3/build/ol-debug.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;jslib/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;jslib/jeasyui/jquery.easyui.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;mapContainer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;subcontent&quot;</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;map&quot;</span> <span class="attr">class</span>=<span class="string">&quot;map&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: auto;height: auto&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> styles = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;Circle&#x27;</span>: <span class="keyword">new</span> ol.style.Style(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">color</span>: <span class="string">&#x27;rgba(57,172,106,0.9)&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">opacity</span>: <span class="string">&#x27;0.05&#x27;</span></span></span><br><span class="line"><span class="javascript">          &#125;),</span></span><br><span class="line"><span class="javascript">          <span class="attr">text</span>: <span class="keyword">new</span> ol.style.Text(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">font</span>: <span class="string">&#x27;14px sans-serif&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">text</span>:<span class="string">&#x27;Test\n\n Value \n\n Message&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">textAlign</span>:<span class="string">&#x27;center&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">rotateWithView</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">color</span>: <span class="string">&#x27;#FFFFFF&#x27;</span></span></span><br><span class="line"><span class="javascript">            &#125;),</span></span><br><span class="line"><span class="javascript">            <span class="attr">stroke</span>:<span class="keyword">new</span> ol.style.Stroke(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">color</span>:<span class="string">&#x27;#FFFFFF&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">width</span>: <span class="number">1</span></span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">          &#125;)</span></span><br><span class="line"><span class="javascript">          <span class="comment">// radius:100</span></span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> Selectstyles = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;Circle&#x27;</span>: <span class="keyword">new</span> ol.style.Style(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">color</span>: <span class="string">&#x27;rgba(228,57,60,0.9)&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">opacity</span>: <span class="string">&#x27;0.05&#x27;</span></span></span><br><span class="line"><span class="javascript">          &#125;),</span></span><br><span class="line"><span class="javascript">          <span class="attr">text</span>: <span class="keyword">new</span> ol.style.Text(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">font</span>: <span class="string">&#x27;14px sans-serif&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">text</span>:<span class="string">&#x27;Test\n\n Value \n\n Message&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="attr">textAlign</span>:<span class="string">&#x27;center&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            <span class="comment">// rotateWithView:true,</span></span></span><br><span class="line"><span class="javascript">            <span class="attr">fill</span>: <span class="keyword">new</span> ol.style.Fill(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">color</span>: <span class="string">&#x27;#FFFFFF&#x27;</span></span></span><br><span class="line"><span class="javascript">            &#125;),</span></span><br><span class="line"><span class="javascript">            <span class="attr">stroke</span>:<span class="keyword">new</span> ol.style.Stroke(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">color</span>:<span class="string">&#x27;#FFFFFF&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">width</span>: <span class="number">1</span></span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">          &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> styleFunction = <span class="function"><span class="keyword">function</span>(<span class="params">feature</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> styles[feature.getGeometry().getType()];</span></span><br><span class="line"><span class="javascript">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> selectStyleFunction = <span class="function"><span class="keyword">function</span>(<span class="params">feature</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> Selectstyles[feature.getGeometry().getType()];</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vectorSource = <span class="keyword">new</span> ol.source.Vector(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">features</span>: <span class="keyword">new</span> ol.Feature(<span class="keyword">new</span> ol.geom.Circle([<span class="number">5e6</span>, <span class="number">7e6</span>], <span class="number">1e6</span>))</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">      vectorSource.addFeature(<span class="keyword">new</span> ol.Feature(<span class="keyword">new</span> ol.geom.Circle([<span class="number">5e6</span>, <span class="number">7e6</span>], <span class="number">1e6</span>/<span class="built_in">Math</span>.pow(<span class="number">2</span>,-<span class="number">1</span>))));</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> vectorLayer = <span class="keyword">new</span> ol.layer.Vector(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">source</span>: vectorSource,</span></span><br><span class="line"><span class="javascript">        <span class="attr">style</span>: styleFunction</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">layers</span>: [</span></span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">source</span>: <span class="keyword">new</span> ol.source.OSM()</span></span><br><span class="line"><span class="javascript">          &#125;),</span></span><br><span class="line"><span class="javascript">          vectorLayer</span></span><br><span class="line"><span class="javascript">        ],</span></span><br><span class="line"><span class="javascript">        <span class="attr">target</span>: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">controls</span>: ol.control.defaults(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">attributionOptions</span>: <span class="comment">/** <span class="doctag">@type <span class="type">&#123;olx.control.AttributionOptions&#125;</span> </span>*/</span> (&#123;</span></span><br><span class="line"><span class="javascript">            <span class="attr">collapsible</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="javascript">          &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;),</span></span><br><span class="line"><span class="javascript">        <span class="attr">view</span>: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="attr">center</span>: [<span class="number">0</span>, <span class="number">0</span>],</span></span><br><span class="line"><span class="javascript">          <span class="attr">zoom</span>: <span class="number">2</span></span></span><br><span class="line"><span class="javascript">        &#125;)</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> view = map.getView();</span></span><br><span class="line"><span class="javascript">      view.on(<span class="string">&#x27;change:resolution&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> zoom = view.getZoom();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> Collection = map.getLayers();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> layers = Collection.getArray();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> vectorSource = layers[<span class="number">1</span>].getSource();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> features = vectorSource.getFeatures();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> len = features.length;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i&lt; len; i++) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> Circle = features[i].getGeometry();</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(zoom);</span></span><br><span class="line"><span class="javascript">                Circle.setRadius(<span class="number">1e6</span>/<span class="built_in">Math</span>.pow(<span class="number">2</span>,zoom-<span class="number">3</span>));</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> selectPointerMove = <span class="keyword">new</span> ol.interaction.Select(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">condition</span>: ol.events.condition.pointerMove</span></span><br><span class="line"><span class="javascript">      &#125;);</span></span><br><span class="line"><span class="javascript">      map.addInteraction(selectPointerMove);</span></span><br><span class="line"><span class="javascript">      selectPointerMove.on(<span class="string">&#x27;select&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">         <span class="keyword">var</span> ele = e;</span></span><br><span class="line"><span class="javascript">         <span class="keyword">var</span> select_len = e.selected.length;</span></span><br><span class="line"><span class="javascript">         <span class="keyword">var</span> unselect_len = e.deselected.length;</span></span><br><span class="line"><span class="javascript">         <span class="keyword">if</span> (select_len &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> featureArr = e.selected;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; featureArr.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">              featureArr[i].setStyle(selectStyleFunction(featureArr[i]));</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> Circle = featureArr[i].getGeometry();</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">         &#125;</span></span><br><span class="line"><span class="javascript">         <span class="keyword">if</span> (unselect_len &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> featureArr = e.deselected;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; featureArr.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                featureArr[i].setStyle(styleFunction(featureArr[i]));</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> Circle = featureArr[i].getGeometry();</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">         &#125;</span></span><br><span class="line"><span class="javascript">      &#125;)</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/03/20/CentOS7%E5%AE%89%E8%A3%85python-pip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/03/20/CentOS7%E5%AE%89%E8%A3%85python-pip/" class="post-title-link" itemprop="url">CentOS7安装python-pip</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-03-20 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-20T00:00:00+08:00">2017-03-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-04-17 20:16:04" itemprop="dateModified" datetime="2022-04-17T20:16:04+08:00">2022-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>Package epel-release.noarch 0:7-9 will be installed<br>–&gt; Finished Dependency Resolution</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 安装 python-pip</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">[root@localhost Desktop]# yum install python-pip</span><br></pre></td></tr></table></figure>

<p>安装完成之后,测试是否安装成功</p>
<h3 id="测试是否安装成功"><a href="#测试是否安装成功" class="headerlink" title="测试是否安装成功"></a>测试是否安装成功</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]# pip --version</span><br><span class="line">pip 8.1.2 from /usr/lib/python2.7/site-packages (python 2.7)</span><br></pre></td></tr></table></figure>

<h3 id="安装完成后-清理-cache"><a href="#安装完成后-清理-cache" class="headerlink" title="安装完成后,清理 cache"></a>安装完成后,清理 cache</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Desktop]# yum clean all</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Cleaning repos: base epel extras updates</span><br><span class="line">Cleaning up everything</span><br><span class="line">Cleaning up list of fastest mirrors</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leetao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"leetaoGoooo","repo":"leetaogoooo.github.io","client_id":"bf98ffa3f57b2591544e","client_secret":"cc5ffeff8863bb5c44ed10f024513dccfac14afa","admin_user":"leetaogoooo","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"e67aaed3dbf825a3ecde04ec379f081e"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
