<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"leetaogoooo.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Je pense, donc je suis">
<meta property="og:type" content="website">
<meta property="og:title" content="Leetao&#39;s Blog">
<meta property="og:url" content="https://leetaogoooo.github.io/page/13/">
<meta property="og:site_name" content="Leetao&#39;s Blog">
<meta property="og:description" content="Je pense, donc je suis">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Leetao">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://leetaogoooo.github.io/page/13/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/13/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Leetao's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Leetao's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Leetao's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Talk is cheap, show me the code</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leetao"
      src="/images/avatar.ico">
  <p class="site-author-name" itemprop="name">Leetao</p>
  <div class="site-description" itemprop="description">Je pense, donc je suis</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">193</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">74</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/leetaogoooo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;leetaogoooo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:leetao94cn@gmail.com" title="E-Mail → mailto:leetao94cn@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/LeetaoGoooo" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;LeetaoGoooo" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/leetaothinks" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;leetaothinks" rel="noopener" target="_blank"><i class="fa fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/leetaoGoooo" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;leetaoGoooo" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/11/16/python%E5%86%85%E7%BD%AE%E5%B8%B8%E9%87%8F(built-in%20constants)-NotImplemented/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/16/python%E5%86%85%E7%BD%AE%E5%B8%B8%E9%87%8F(built-in%20constants)-NotImplemented/" class="post-title-link" itemprop="url">python内置常量(built-in constants)-NotImplemented</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-16 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-16T00:00:00+08:00">2017-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>NotImplemented 的在标准库的定义如下:</p>
<blockquote>
<p>Special value which should be returned by the binary special methods (e.g. <em><strong>eq</strong>()</em> , <em><strong>lt</strong>()</em>, <em><strong>add</strong>()</em>, <em><strong>rsub</strong>()</em>, etc.) to indicate that the operation is not implemented with respect to the other type; may be returned by the in-place binary special methods (e.g. <em><strong>imul</strong>()</em>, <em><strong>iand</strong>()</em>, etc.) for the same purpose. Its truth value is true.</p>
</blockquote>
<p>翻译成中文的大概意思:NotImplemented 是一个可由内置函数(<em><strong>eq</strong>()</em> , <em><strong>lt</strong>()</em>, <em><strong>add</strong>()</em>, <em><strong>rsub</strong>()</em> 等等)返回的特殊值,用以表明该操作没有对另一种类型的实现.可能会被其他的特殊方法( <em><strong>imul</strong>()</em>, <em><strong>iand</strong>()</em> 等等)就近处理用以同样的目的,从而返回.它的实际值为True.最后一句话的真是含义如下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flj0q0b91oj30nf06z74z.jpg"></p>
<p>与 False,True,None 这几个内置常量不同的是 NotImplemented 对它赋值,并且不会产生 SyntaxError. 如下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flj12xyzkvj30nf0b20to.jpg"></p>
<h2 id="Notimplemented-和-Notimplementederror"><a href="#Notimplemented-和-Notimplementederror" class="headerlink" title="Notimplemented 和 Notimplementederror"></a>Notimplemented 和 Notimplementederror</h2><p>在关于 NotImplemented 的定义下面,官方还特意加了一条提示:</p>
<blockquote>
<p>NotImplementedError and NotImplemented are not interchangeable, even though they have similar names and purposes.</p>
</blockquote>
<h2 id="NotImplementedError"><a href="#NotImplementedError" class="headerlink" title="NotImplementedError"></a>NotImplementedError</h2><p>官方定义如下:</p>
<blockquote>
<p>This exception is derived from RuntimeError. In user defined base classes, abstract methods should raise this exception when they require derived classes to override the method, or while the class is being developed to indicate that the real implementation still needs to be added.</p>
</blockquote>
<p>翻译过来的意思是说:此异常从 RuntimeError 派生出来的.在用户定义的基类中，当抽象方法需要派生类覆盖方法时，或者在开发该类以指示仍然需要添加实际实现时，抽象方法应该引发此异常.</p>
<p>同样有一条提示:</p>
<blockquote>
<p>It should not be used to indicate that an operator or method is not meant to be supported at all – in that case either leave the operator / method undefined or, if a subclass, set it to None.</p>
</blockquote>
<p>大概意思是指 NotImplementedError 根本不应该被用来表示一个操作符或者方法不被支持的情况(对于一下 NotImplemented,but why?just see next).在这种情况下，要么保留操作符/方法未定义，要么将子类设置为无.</p>
<h2 id="Why-return-NotImplemented-instead-of-raising-NotImplementedError"><a href="#Why-return-NotImplemented-instead-of-raising-NotImplementedError" class="headerlink" title="Why return NotImplemented instead of raising NotImplementedError"></a>Why return NotImplemented instead of raising NotImplementedError</h2><p>前者是常量后者是异常,但是为什么在操作没有实现的时候,返回前者而不是后者呢?</p>
<p>在 Python 中对列表进行排序时，会经常间接使用类似 <em><strong>lt</strong>()</em> 这类比较运算的方法.有时 Python 的内部算法会选择别的方法来确定比较结果，或者直接选择一个默认的结果。如果抛出一个异常，则会打破排序运算，因此如果使用 NotImplemented 则不会抛出异常，这样 Python 可以尝试别的方法。</p>
<p>NotImplemented 在运行时发出信号，要求其他人满足操作. 在表达式 <code>a==b</code> 中，如果 <code><em>a.<strong><strong>eq</strong></strong>(B)</em></code>返回 <code>NotImplented</code>，那么 Python 将尝试 <code><em>b.<strong><strong>eq</strong></strong>(A)</em></code>.如果b知道的足够多，可以返回 <code>true</code> 或 <code>false</code>,那么表达式就可以成功. 如果没有，那么运行时将返回到内置行为(基于 <code>==</code> 和 <code>!=</code>的标识.</p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>我们通过实现上面提到的 <em><strong>eq</strong>()</em> 来实现上面提到的例子,来加深印象.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, A):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Comparing an A with an A&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> other.value == self.value</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, B):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Comparing an A with a B&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> other.value == self.value</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Could not compare A with the other class&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, B):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Comparing a B with another B&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> other.value == self.value</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Could not compare B with the other class&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br></pre></td></tr></table></figure>

<p>然后运行结果如下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flj22ol8a7j30nf0cst9j.jpg"></p>
<p>对于 <code>a == a</code> 和 <code>b == b </code>,显然结果如我们预期那样,因为我们实现已经定义好了自己比较自己的方法.重点在 <code> b == a</code>,我们并没有在 B 中定义 B 和 其他类比较的方法,因此打印出了 “Could not compare B with the other class”,然后程序接下来去调用了 <code><em>a.<strong><strong>eq</strong></strong>(B)</em></code>,一切如我们之前所说的那样.</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://docs.python.org/3.6/library/constants.html#NotImplemented">NotImplemented</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3.6/library/exceptions.html#NotImplementedError">exception NotImplementedError</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/878943/why-return-notimplemented-instead-of-raising-notimplementederror">Why return NotImplemented instead of raising NotImplementedError</a></p>
<p><a target="_blank" rel="noopener" href="http://python.jobbole.com/80913/">Python中内置的NotImplemented类型</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/11/13/%E5%9C%A8Ubuntu14.04%E4%B8%8A%E4%BD%BF%E7%94%A8Gunicorn%E5%92%8CNginx%E9%83%A8%E7%BD%B2Flask%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/13/%E5%9C%A8Ubuntu14.04%E4%B8%8A%E4%BD%BF%E7%94%A8Gunicorn%E5%92%8CNginx%E9%83%A8%E7%BD%B2Flask%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">在Ubuntu14.04上使用Gunicorn和Nginx部署Flask应用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-13 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-13T00:00:00+08:00">2017-11-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近闲来无事折腾了一下自己的个人公共号,通过 Flask 构建了几个简单的小功能然后部署到服务器上.网上关于部署的教程有很多,这里我就简单介绍一下我的部署步骤.</p>
<h1 id="部署的准备工作"><a href="#部署的准备工作" class="headerlink" title="部署的准备工作"></a>部署的准备工作</h1><p>更新并安装下述的包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install python-pip python-dev nginx</span><br></pre></td></tr></table></figure>

<h1 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h1><p>切到项目所以目录下,由于我使用的是 python 版本是 3.5.2 的,所以通过下述命令去创建虚拟环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m venv Env # Env 为创建的虚拟环境的名称</span><br></pre></td></tr></table></figure>

<p>然后激活环境安装相应的库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source Env/bin/activate</span><br><span class="line">pip install gunicorn # 这里省略了其他需要安装的包 </span><br></pre></td></tr></table></figure>

<h1 id="创建-WSGI-文件"><a href="#创建-WSGI-文件" class="headerlink" title="创建 WSGI 文件"></a>创建 WSGI 文件</h1><p>通过命令行在项目目录下创建 <code>wsgi.py</code> 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano wsgi.py # 原来用 vim,后来发现用 nano 也很爽</span><br></pre></td></tr></table></figure>

<p>这个文件内容其实很简单就是让程序运行起来:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wsgi.py</span></span><br><span class="line"><span class="keyword">from</span> httpbin <span class="keyword">import</span> create_app <span class="comment"># httpbin 项目目录</span></span><br><span class="line"></span><br><span class="line">application = create_app(<span class="string">&#x27;default&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    application.run()</span><br></pre></td></tr></table></figure>
<p>然后保存</p>
<h1 id="使用-Gunicorn-运行应用"><a href="#使用-Gunicorn-运行应用" class="headerlink" title="使用 Gunicorn 运行应用"></a>使用 Gunicorn 运行应用</h1><p>由于服务默认开发端口仅有80和443端口,对此我也懒得修改,直接将服务挂载到80端口进行测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn --bind 0.0.0.0:80 wsgi</span><br></pre></td></tr></table></figure>
<p>通过访问我应用的指定的api然后成功获得了数据,然后开始进行下一步</p>
<h1 id="创建一个启动脚本"><a href="#创建一个启动脚本" class="headerlink" title="创建一个启动脚本"></a>创建一个启动脚本</h1><p>这个脚本顾名思义允许 Ubuntu 自动启动 Gunicorn 从而挂载我的 Flask 应用.在 <code>/etc/init</code> 目录下创建以 <code>.conf</code> 结尾的文件:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/init/wechat.conf</span><br></pre></td></tr></table></figure>
<p>文件内容如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> wechat.conf</span></span><br><span class="line"></span><br><span class="line">description &quot;Gunicorn application server running wechat&quot;</span><br><span class="line"></span><br><span class="line">start on runlevel [2345]</span><br><span class="line">stop on runlevel [!2345]</span><br><span class="line"></span><br><span class="line">respawn</span><br><span class="line">setuid root # 我的是root用户,如果你是在其他用户下运行则将其他改为其他用户名称</span><br><span class="line">setgid www-data</span><br><span class="line"></span><br><span class="line">env PATH=/home/py/wechat/Env/bin # python 环境目录</span><br><span class="line">chdir /home/py/wechat</span><br><span class="line">exec gunicorn --workers 3 --bind unix:wechat.sock -m 007 wsgi</span><br></pre></td></tr></table></figure>

<p>保存退出,然后尝试运行你的脚本文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start wechat</span><br></pre></td></tr></table></figure>

<p>想要查看是否运行成功的话，可以使用下述命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep wechat</span><br></pre></td></tr></table></figure>
<p>如果你在输出的结果中看到相应的进程了就说明你的脚本运行成功了.然后就可以进行下一步</p>
<h1 id="配置-Nginx"><a href="#配置-Nginx" class="headerlink" title="配置 Nginx"></a>配置 Nginx</h1><p>在这里介绍了如何简单配置 Nginx,但是在实际应用中需要思考一下是否真的需要用到 Nginx,Nginx有很多功能,但是对于像这样简单的小应用,直接 Gunicorn 裸跑也是没毛病的,但是你说你一台服务器挂多个域名,避免 Gunicorn 独占 80 端口，用 Nginx 这个更没毛病.</p>
<p>在 <code>/etc/nginx/sites-available</code> 目录下创建项目配置文件 <code>wechat</code>,没必要将缺省文件删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/nginx/sites-available/wechat</span><br></pre></td></tr></table></figure>

<p>配置文件内容如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name server_domain_or_IP;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        include proxy_params;</span><br><span class="line">        proxy_pass http://unix:/home/py/wechat/wechat.sock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存退出,然后为了确保配置文件生效,将其链接到 <code>sites-enabled</code> 目录下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/nginx/sites-available/wechat /etc/nginx/sites-enabled</span><br></pre></td></tr></table></figure>

<p>测试一下配置文件是否有语法错误:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></table></figure>
<p>如果看见 succssful 的成功单词就说明配置文件没有任何问题,然后重启 nginx</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart </span><br></pre></td></tr></table></figure>
<p>大功告成~</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/11/06/%E5%81%8F%E5%87%BD%E6%95%B0-functools%E4%B9%8Bpartial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/06/%E5%81%8F%E5%87%BD%E6%95%B0-functools%E4%B9%8Bpartial/" class="post-title-link" itemprop="url">偏函数-functools之partial</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-06 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-06T00:00:00+08:00">2017-11-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前段时间在讲述 Flask-Login 的源码中遇见了一个函数 ——<code>partial</code>,这个函数来自于<code>functools</code>模块,这个模块定义为”The functools module is for higher-order functions: functions that act on or return other functions. In general, any callable object can be treated as a function for the purposes of this module”,翻译成中文的大概意思就是”functools 用于高阶函数：指那些作用于函数或者返回其他函数的函数。总的来说，这个模块的目标就是将任何可调用的对象都可以被视为函数。”</p>
<h1 id="functools-partial"><a href="#functools-partial" class="headerlink" title="functools.partial"></a>functools.partial</h1><p>返回一个新的部分对象,当被调用的时候,相当于原有的对象携带了默认的参数.如果在调用过程中传递了更多的参数,将会被追加到args.如果提供了其他的关键字参数,则会覆盖或者扩展关键字:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial</span>(<span class="params">func, *args, **keywords</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">newfunc</span>(<span class="params">*fargs, **fkeywords</span>):</span></span><br><span class="line">        newkeywords = keywords.copy()</span><br><span class="line">        newkeywords.update(fkeywords)</span><br><span class="line">        <span class="keyword">return</span> func(*(args + fargs), **newkeywords)</span><br><span class="line">    newfunc.func = func</span><br><span class="line">    newfunc.args = args</span><br><span class="line">    newfunc.keywords = keywords</span><br><span class="line">    <span class="keyword">return</span> newfunc</span><br></pre></td></tr></table></figure>

<p>当函数的参数个数太多，需要简化时，使用functools.partial可以创建一个新的函数，这个新函数可以固定住原函数的部分参数，从而在调用时更简单.</p>
<p> eg:</p>
<p> <code>int()</code>函数,可以将字符串转为整数,简单看一下它的函数使用说明:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">int</span>(<span class="params"><span class="built_in">object</span></span>)</span></span><br><span class="line"><span class="class">|  <span class="title">int</span>(<span class="params">x=<span class="number">0</span></span>) -&gt; integer</span></span><br><span class="line"><span class="class">|  <span class="built_in">int</span>(x, base=10) -&gt; integer</span></span><br><span class="line"><span class="class">|</span></span><br><span class="line"><span class="class">|  Convert a number <span class="keyword">or</span> string to an integer, <span class="keyword">or</span> <span class="keyword">return</span> 0 <span class="keyword">if</span> no arguments</span></span><br><span class="line"><span class="class">|  are given.  If x <span class="keyword">is</span> a number, <span class="keyword">return</span> x.__int__().  For floating point</span></span><br><span class="line"><span class="class">|  numbers, this truncates towards zero.</span></span><br><span class="line"><span class="class">|</span></span><br><span class="line"><span class="class">|  If x <span class="keyword">is</span> <span class="keyword">not</span> a number <span class="keyword">or</span> <span class="keyword">if</span> base <span class="keyword">is</span> given, then x must be a string,</span></span><br><span class="line"><span class="class">|  <span class="built_in">bytes</span>, <span class="keyword">or</span> <span class="built_in">bytearray</span> instance representing an integer literal <span class="keyword">in</span> the</span></span><br><span class="line"><span class="class">|  given base.  The literal can be preceded by &#x27;+&#x27; <span class="keyword">or</span> &#x27;-&#x27; <span class="keyword">and</span> be surrounded</span></span><br><span class="line"><span class="class">|  by whitespace.  The base defaults to 10.  Valid bases are 0 <span class="keyword">and</span> 2-36.</span></span><br><span class="line"><span class="class">|  Base 0 means to interpret the base <span class="keyword">from</span> the string <span class="keyword">as</span> an integer literal.</span></span><br><span class="line"><span class="class">|  &gt;&gt;&gt; <span class="built_in">int</span>(&#x27;0b100&#x27;, base=0)</span></span><br><span class="line"><span class="class">|  4</span></span><br></pre></td></tr></table></figure>
<p>从上述说明中我们可以看见,int还有一个额外的参数<code>base</code>,base 默认值为10,也就意味着默认情况下将字符串转化为十进制的数.如果我们需要转化成二进制怎么办?在不使用其他模块的情况下,只需要<code>int(x,base=2)</code>,那么如果是借助<code>partial</code>,该如何使用呢?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">&gt;&gt;&gt;int2 = partial(<span class="built_in">int</span>,base=<span class="number">2</span>) <span class="comment"># 这里是传递了关键字参数,即keywords</span></span><br><span class="line">&gt;&gt;&gt;int2(<span class="string">&#x27;1000&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">8</span></span><br><span class="line">&gt;&gt;&gt;str_3_int = partial(<span class="built_in">int</span>,<span class="string">&#x27;3&#x27;</span>) <span class="comment"># 传递了参数args</span></span><br><span class="line">&gt;&gt;&gt;str_3_int()</span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span> <span class="comment"># 不够清楚的话可以接着看下面的例子</span></span><br><span class="line">&gt;&gt;&gt;max_with_10 = partial(<span class="built_in">max</span>,<span class="number">10</span>)</span><br><span class="line">&gt;&gt;&gt;max_with_10(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">10</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/10/28/Flask-Login%E7%94%A8%E6%88%B7%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/10/28/Flask-Login%E7%94%A8%E6%88%B7%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">Flask-Login用户会话管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-28 00:00:00" itemprop="dateCreated datePublished" datetime="2017-10-28T00:00:00+08:00">2017-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>想必大家对 Flask-Login 这个 Flask 扩展肯定不会陌生,毕竟作为一个应用,用户登录之后,他们的认证状态是需要被记录下来的,浏览其他的页面也是需要使用这个状态的,但是这一过程是怎么发挥作用的呢?让我们从源码的层次上简单认识一下.</p>
<h1 id="Flask-Login-使用的准备"><a href="#Flask-Login-使用的准备" class="headerlink" title="Flask-Login 使用的准备"></a>Flask-Login 使用的准备</h1><p>使用 flask-login 的之前,我们必须要实现下述四个方法:<br><img src="http://ww1.sinaimg.cn/large/006wYWbGly1fkur7vprn0j30n804kmxd.jpg"><br>但是为什么要实现这个方法呢?别着急我们在下面会释疑.<br>除此之外我们还需要写下述的这样的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_user</span>(<span class="params">username</span>):</span></span><br><span class="line">    <span class="keyword">if</span> query_user(username) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        curr_user = User()</span><br><span class="line">        curr_user.<span class="built_in">id</span> = username</span><br><span class="line">        <span class="keyword">return</span> curr_user</span><br></pre></td></tr></table></figure>
<p>上面的为用户的回调函数接收字符串表示的唯一用户标识符,如果能找到该用户,则返回该用户对象否则返回None.但是<code>user_loader</code>究竟是什么?<br>源码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginManager</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">user_loader</span>(<span class="params">self, callback</span>):</span></span><br><span class="line">        self.user_callback = callback</span><br><span class="line">        <span class="keyword">return</span> callback</span><br></pre></td></tr></table></figure>
<p>似乎没什么作用呢?别着急,接着往下看,我们通过具体使用去理解源码</p>
<h1 id="login-user"><a href="#login-user" class="headerlink" title="login_user()"></a>login_user()</h1><p>但凡时候 Flask-Login 应该都用过 <code>login_user()</code>,所以让我们看看使用这个函数发生了什么.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_user</span>(<span class="params">user, remember=<span class="literal">False</span>, force=<span class="literal">False</span>, fresh=<span class="literal">True</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> force <span class="keyword">and</span> <span class="keyword">not</span> user.is_active: <span class="comment"># 最初必须实现的四个方法之一,在这里发挥作用,如果该用户不允许登录则直接返回False(黑名单etc)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    user_id = user.get_id() <span class="comment"># 修改</span></span><br><span class="line">    session[<span class="string">&#x27;user_id&#x27;</span>] = user_id</span><br><span class="line">    session[<span class="string">&#x27;_fresh&#x27;</span>] = fresh</span><br><span class="line">    session[<span class="string">&#x27;_id&#x27;</span>] = current_app.login_manager._session_identifier_generator() <span class="comment"># 根据客户端的User Agent和IP生成标识,strong模式下一旦用户标识检测失败,便会清空所有的session内容</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> remember:</span><br><span class="line">        session[<span class="string">&#x27;remember&#x27;</span>] = <span class="string">&#x27;set&#x27;</span></span><br><span class="line"></span><br><span class="line">    _request_ctx_stack.top.user = user</span><br><span class="line">    user_logged_in.send(current_app._get_current_object(), user=_get_user())</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>主要内容是将用户信息放入session中,并为改session生成标识符.</p>
<h1 id="login-required"><a href="#login-required" class="headerlink" title="@login_required"></a>@login_required</h1><p>我们通过 @login_required 去限制用户页面访问,这一过程是怎么实现的?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_required</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorated_view</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request.method <span class="keyword">in</span> EXEMPT_METHODS: // EXEMPT_METHODS = <span class="built_in">set</span>([<span class="string">&#x27;OPTIONS&#x27;</span>]) config.py 第 <span class="number">49</span> 行,通常该请求是获取服务器支持的HTTP请求方法</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">elif</span> current_app.login_manager._login_disabled: <span class="comment"># 如果 _login_disabled 被设置为 True,则装饰器将会被忽略,通常用在单元测试可以很方便的关闭认证</span></span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> current_user.is_authenticated: <span class="comment"># 判断用户是否登录</span></span><br><span class="line">            <span class="keyword">return</span> current_app.login_manager.unauthorized() <span class="comment"># 没有登录的情况下:1.如果注册了 LoginManager.unauthorized_handler 则这个时候调用这个函数 2. 向用户提示 LoginManager.login_message信息 3.有 login_view的情况下,跳转到login_view,没有则返回abort(401)</span></span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> decorated_view</span><br></pre></td></tr></table></figure>
<h1 id="unauthorized"><a href="#unauthorized" class="headerlink" title="unauthorized()"></a>unauthorized()</h1><p>在上述<code>@login.required</code>中我们说明了,<code>unauthorized()</code>在需要登录的情况下采取的行动,现在简单的看一下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unauthorized</span>(<span class="params">self</span>):</span></span><br><span class="line">    user_unauthorized.send(current_app._get_current_object())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.unauthorized_callback:</span><br><span class="line">        <span class="keyword">return</span> self.unauthorized_callback()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.blueprint <span class="keyword">in</span> self.blueprint_login_views:</span><br><span class="line">        login_view = self.blueprint_login_views[request.blueprint]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        login_view = self.login_view</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> login_view:</span><br><span class="line">        abort(<span class="number">401</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.login_message:</span><br><span class="line">        <span class="keyword">if</span> self.localize_callback <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            flash(self.localize_callback(self.login_message),</span><br><span class="line">                  category=self.login_message_category)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(self.login_message, category=self.login_message_category)</span><br><span class="line"></span><br><span class="line">    config = current_app.config</span><br><span class="line">    <span class="keyword">if</span> config.get(<span class="string">&#x27;USE_SESSION_FOR_NEXT&#x27;</span>, USE_SESSION_FOR_NEXT):</span><br><span class="line">        login_url = expand_login_view(login_view)</span><br><span class="line">        session[<span class="string">&#x27;next&#x27;</span>] = make_next_param(login_url, request.url)</span><br><span class="line">        redirect_url = make_login_url(login_view)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        redirect_url = make_login_url(login_view, next_url=request.url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(redirect_url)</span><br></pre></td></tr></table></figure>
<h1 id="current-user"><a href="#current-user" class="headerlink" title="current_user"></a>current_user</h1><p>在登录之后,我们在需要使用当前登录对象的时候,都会使用 <code>current_user</code>,那么它是怎么发挥作用的?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">current_user = LocalProxy(<span class="keyword">lambda</span>: _get_user()) // 当前用户的代理,这里重点关注 _get_user()</span><br><span class="line"></span><br><span class="line"><span class="comment"># _get_user()</span></span><br><span class="line"><span class="comment"># 调用 login_user() 之后显然 _request_ctx_stack.top 中存在 user,则直接返回 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_user</span>():</span></span><br><span class="line">    <span class="keyword">if</span> has_request_context() <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(_request_ctx_stack.top, <span class="string">&#x27;user&#x27;</span>):</span><br><span class="line">        current_app.login_manager._load_user()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">getattr</span>(_request_ctx_stack.top, <span class="string">&#x27;user&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 那么如果不存在,会发生什么? 调用 _loder_user()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># _loader_user()</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_load_user</span>(<span class="params">self</span>):</span></span><br><span class="line">        user_accessed.send(current_app._get_current_object())</span><br><span class="line"></span><br><span class="line">        config = current_app.config</span><br><span class="line">        <span class="keyword">if</span> config.get(<span class="string">&#x27;SESSION_PROTECTION&#x27;</span>, self.session_protection): // session 保护,可以取值为 <span class="literal">None</span>(禁用),basic(在 basic 模式下或会话是永久的，如果该标识未匹配，会话会简单地被标记为非活 跃的，且任何需要活跃登入的东西会强制用户重新验证，前提你已经使用了活跃登入机制),strong(在 strong 模式下的非永久会话，如果该标识未匹配，整个会话或者记住的令牌如果存在将会被删除)</span><br><span class="line">            deleted = self._session_protection()</span><br><span class="line">            <span class="keyword">if</span> deleted:</span><br><span class="line">                <span class="keyword">return</span> self.reload_user()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果 记住你的 cookie 存在,而 session 不存在,则会将 cookie 中的 user_id 赋值给 session</span></span><br><span class="line">        <span class="comment"># 但是如果这个时候处于登出的状态的话,会发生什么呢?</span></span><br><span class="line">        is_missing_user_id = <span class="string">&#x27;user_id&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session</span><br><span class="line">        <span class="keyword">if</span> is_missing_user_id:</span><br><span class="line">            cookie_name = config.get(<span class="string">&#x27;REMEMBER_COOKIE_NAME&#x27;</span>, COOKIE_NAME)</span><br><span class="line">            header_name = config.get(<span class="string">&#x27;AUTH_HEADER_NAME&#x27;</span>, AUTH_HEADER_NAME)</span><br><span class="line">            has_cookie = (cookie_name <span class="keyword">in</span> request.cookies <span class="keyword">and</span></span><br><span class="line">                          session.get(<span class="string">&#x27;remember&#x27;</span>) != <span class="string">&#x27;clear&#x27;</span>) // 登出的时候 has_cookie = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> has_cookie:</span><br><span class="line">                <span class="keyword">return</span> self._load_from_cookie(request.cookies[cookie_name])</span><br><span class="line">            <span class="keyword">elif</span> self.request_callback: //定义在 request_loader() 中, 正常情况下我们并不使用,仅当我们不想使用 cookie 的情况下登录用户才会考虑 request_loader 回调.</span><br><span class="line">                <span class="keyword">return</span> self._load_from_request(request)</span><br><span class="line">            <span class="keyword">elif</span> header_name <span class="keyword">in</span> request.headers: </span><br><span class="line">                <span class="keyword">return</span> self._load_from_header(request.headers[header_name]) <span class="comment"># 该函数调用链中的 header_loader() 已经被弃用</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.reload_user()</span><br></pre></td></tr></table></figure>

<h1 id="logout-user"><a href="#logout-user" class="headerlink" title="logout_user()"></a>logout_user()</h1><p>登录要验证账户密码什么的,显的比较复杂,但是登出就很简答了,你不需要传递任何参数,只需调用这个函数,那让我们看看这个函数发生了什么:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout_user</span>():</span></span><br><span class="line">    user = _get_user() <span class="comment"># 从_request_ctx_stack.top.user,session 或者 remember_me cookie 中获取</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;user_id&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        session.pop(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;_fresh&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        session.pop(<span class="string">&#x27;_fresh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    cookie_name = current_app.config.get(<span class="string">&#x27;REMEMBER_COOKIE_NAME&#x27;</span>, COOKIE_NAME)</span><br><span class="line">    <span class="keyword">if</span> cookie_name <span class="keyword">in</span> request.cookies:</span><br><span class="line">        session[<span class="string">&#x27;remember&#x27;</span>] = <span class="string">&#x27;clear&#x27;</span></span><br><span class="line"></span><br><span class="line">    user_logged_out.send(current_app._get_current_object(), user=user)</span><br><span class="line"></span><br><span class="line">    current_app.login_manager.reload_user() </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>该函数将session中的user相关信息全部清空,然后重新加载用户,正常逻辑下由于重新加载用户后如果当前页面需要登录才能访问的话,则会跳转到登录视图.</p>
<h1 id="fresh-login-required"><a href="#fresh-login-required" class="headerlink" title="fresh_login_required"></a>fresh_login_required</h1><p>当用户登入，他们的会话被标记成“新鲜的”，就是说在这个会话只中用户实际上登录过。当会话销毁用户使用“记住我”的 cookie 重新登入，会话被标记成“非新鲜的”。fresh_login_required 除了验证用户登录，也将确保他们的登录是“新鲜的”。如果不是“新鲜的”，它会把用户送到可以重输入验证条件的页面,主要用户修改个人信息的敏感操作. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fresh_login_required</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorated_view</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request.method <span class="keyword">in</span> EXEMPT_METHODS:</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">elif</span> current_app.login_manager._login_disabled:</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">            <span class="keyword">return</span> current_app.login_manager.unauthorized()</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> login_fresh(): // 获取session 中的 refresh 值</span><br><span class="line">            <span class="keyword">return</span> current_app.login_manager.needs_refresh() // <span class="number">1.</span>出现 LoginMange.needs_refress_message <span class="number">2.</span>跳转到 LoginManger.refresh_view,如果没有设置则会提示 <span class="number">401</span> 错误</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> decorated_view</span><br></pre></td></tr></table></figure>

<h1 id="confirm-login"><a href="#confirm-login" class="headerlink" title="confirm_login"></a>confirm_login</h1><p>将会话重新标记为”新鲜”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">confirm_login</span>():</span></span><br><span class="line">    session[<span class="string">&#x27;_fresh&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">    session[<span class="string">&#x27;_id&#x27;</span>] = current_app.login_manager._session_identifier_generator() // 重新生成会话<span class="built_in">id</span></span><br><span class="line">    user_login_confirmed.send(current_app._get_current_object())</span><br></pre></td></tr></table></figure>


<h1 id="reload-user"><a href="#reload-user" class="headerlink" title="reload_user()"></a>reload_user()</h1><p>接着 <code>logout_user()</code> 中调用 <code>reload_user()</code>.很显然这个函数的功能就是重新加载用户,具体实现让我们看下源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># logout_user() 中调用, user 使用默认参数为 None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reload_user</span>(<span class="params">self, user=<span class="literal">None</span></span>):</span></span><br><span class="line">        ctx = _request_ctx_stack.top // _request_ctx_stack 一个保存对象的栈,可以返回看 login_user() 源码的倒数第三行,登录的时候将 user 保存在 _request_ctx_stack.top.user 中</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>: </span><br><span class="line">            user_id = session.get(<span class="string">&#x27;user_id&#x27;</span>) // logout_user() 中 session 已经将 user_id 移除</span><br><span class="line">            <span class="keyword">if</span> user_id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                ctx.user = self.anonymous_user() //见下文</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> self.user_callback <span class="keyword">is</span> <span class="literal">None</span>: //这里解释了为什么我们需要定义 @login_manager.user_loader</span><br><span class="line">                    <span class="keyword">raise</span> Exception(</span><br><span class="line">                        <span class="string">&quot;No user_loader has been installed for this &quot;</span></span><br><span class="line">                        <span class="string">&quot;LoginManager. Add one with the &quot;</span></span><br><span class="line">                        <span class="string">&quot;&#x27;LoginManager.user_loader&#x27; decorator.&quot;</span>)</span><br><span class="line">                user = self.user_callback(user_id) // 这里我们最初定义的user_loader发挥作用,通过调用self.user_callback()获取用户</span><br><span class="line">                <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    ctx.user = self.anonymous_user()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    ctx.user = user</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ctx.user = user</span><br></pre></td></tr></table></figure>

<h1 id="anoymous-user"><a href="#anoymous-user" class="headerlink" title="anoymous_user"></a>anoymous_user</h1><p>源码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">self.anonymous_user = AnonymousUserMixin // 匿名类</span><br><span class="line"></span><br><span class="line"><span class="comment"># AnonymousUserMixin</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnonymousUserMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_authenticated</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_active</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_anonymous</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_id</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/10/19/Migrating%20from%20Flask-Script%20to%20the%20New%20Flask%20CLI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/10/19/Migrating%20from%20Flask-Script%20to%20the%20New%20Flask%20CLI/" class="post-title-link" itemprop="url">Migrating from Flask-Script to the New Flask CLI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-19 00:00:00" itemprop="dateCreated datePublished" datetime="2017-10-19T00:00:00+08:00">2017-10-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>原文:<a target="_blank" rel="noopener" href="https://blog.miguelgrinberg.com/post/migrating-from-flask-script-to-the-new-flask-cli">https://blog.miguelgrinberg.com/post/migrating-from-flask-script-to-the-new-flask-cli</a></p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1fknogoype5j30ci0810so.jpg"></p>
<p>在Falsk 0.11版本, Flask 基于 <a target="_blank" rel="noopener" href="http://click.pocoo.org/5/">Click</a> 引进了一个新的命令行功能,该功能包含了 <code>flask</code>命令. 在此之前 Flask 并没有提供任何关于构建命令行接口(CLIs)的支持,但是 <a target="_blank" rel="noopener" href="http://flask-script.readthedocs.io/en/latest/">Flask=Script</a>作为三方拓展提供了类似的功能.</p>
<p>在 Flask CLI发布超过一年的时间里,我仍然看见有许多项目基于 Flask-Script. 我猜测这是由于没有特别重要的原因促使人们迁移到 Flask CLI中，毕竟 Flask-Script 运转地很好,至少没什么毛病. 但是实际上,自从 2014 年开始 Flask-Script 就再也没有过官方发布版本并且看起来也没有再维护了.在本文中，我想向你展示如何将 Flasky 应用程序从 Flask-Script 迁移到 Click ，以便你可以了解两者的不同之处，并决定是否迁移应用程序.</p>
<h1 id="Flask-Script-有什么问题？"><a href="#Flask-Script-有什么问题？" class="headerlink" title="Flask-Script 有什么问题？"></a>Flask-Script 有什么问题？</h1><p>在我看来,Flask-Script 有个严重的缺陷.但有趣的是，这是一个由Flask reloader 中的老的设计问题直接引起的问题,如果你使用app.run()启动应用程序,而不使用Flask-Script,仍然会出现这个问题.</p>
<p>如果你在调试模式下启动应用程序，则会运行两个 Flask 进程. 第一个进程用来观察源文件的更改，第二个是实际的 Flask 服务器. 当任何源文件更改时，监视进程将杀死服务器进程,然后启动另一个进程,从而使用新的源文件.</p>
<p>当你无意中在某个源文件中引入语法错误时，会出现一个问题. 这个时候观察者进程并不知道,所以它仍然会杀死旧的服务器,并启动一个新的. 但是新服务器不会启动,因为 Python 在解析修改后的文件时会引发错误.当服务器进程在错误中退出时,观察者进程也会放弃并退出,从而迫使你在修复代码中的错误后重新启动整个进程.</p>
<p>当您使用新的 Flask Run 命令启动重新加载程序时,效果会好得多.在发送第一个请求之前,不会导入应用程序,此时,如果在导入源文件时发生错误,就会像处理运行时发生的错误一样进行处理.这意味着,如果启用了基于 Web 的调试器,将在那里报告错误.新的观察者进程也更智能，如果服务器进程死了也不会退出.相反,它将继续监视源文件,并尝试在进行更多更改后再次启动服务器.</p>
<h1 id="新的-Flask-CLI"><a href="#新的-Flask-CLI" class="headerlink" title="新的 Flask CLI"></a>新的 Flask CLI</h1><p>Flask CLI 比 Flask-Script 更好吗?让我们首先回顾一下所有 Flask 应用程序获得的默认命令，看看它们的性能如何.</p>
<p>当你安装Flask 0.11或更高版本时，您将在虚拟环境中安装一个flask命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(venv) $ flask</span><br><span class="line">Usage: flask [OPTIONS] COMMAND [ARGS]...</span><br><span class="line"></span><br><span class="line">  This shell command acts as general utility script for Flask applications.</span><br><span class="line"></span><br><span class="line">  It loads the application configured (through the FLASK_APP environment</span><br><span class="line">  variable) and then provides commands either provided by the application or</span><br><span class="line">  Flask itself.</span><br><span class="line"></span><br><span class="line">  The most useful commands are the &quot;run&quot; and &quot;shell&quot; command.</span><br><span class="line"></span><br><span class="line">  Example usage:</span><br><span class="line"></span><br><span class="line">    set FLASK_APP=hello.py</span><br><span class="line">    set FLASK_DEBUG=1</span><br><span class="line">    flask run</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --version  Show the flask version</span><br><span class="line">  --help     Show this message and exit.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  db     Perform database migrations.</span><br><span class="line">  run    Runs a development server.</span><br><span class="line">  shell  Runs a shell in the app context.</span><br></pre></td></tr></table></figure>

<p>使用 Flask-script 时，你必须创建一个驱动程序脚本，通常称为 <code>manage.py</code>. 查看上面的内容，可以看到<code>./manage.py</code> <code>runserver</code>映射到<code>flask run</code>, <code>./manage.py shell</code> 映射到<code>flask shell</code>没什么区别对吧？</p>
<p>这里其实有一个令人困扰的问题. manage.py和flask命令在发现Flask应用程序实例的方式上有所不同. 对于Flask-Script，应用程序作为参数直接或以应用程序工厂函数的形式提供给Manager类. 但是，新的FlaskCLI期望应用程序实例在flask_app环境变量中提供，通常将其设置为定义它的模块的文件名.  Flask将在该模块中查找应用程序或应用程序对象，并将其用作应用程序.</p>
<p>不幸的是,在新的 Flask CLI 中没有对应用程序工厂功能的直接支持.使用工厂函数需要遵循的方法是定义一个调用工厂函数来创建app对象的模块,然后在 <code>flask_app</code>中引用该模块.这在概念上类似于 <code>Django</code> 应用程序中的 <code>wsgi.py</code> 模块.</p>
<p>如果你希望为<a target="_blank" rel="noopener" href="https://github.com/miguelgrinberg/flasky">Flasky</a>支持新的 Flask CLI，可以编写一个flasky.py文件，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>注意，我从manage.py复制了这些行，一旦完全迁移到新的CLI，我们就不会使用这些行.</p>
<h1 id="“flask-run”-命令"><a href="#“flask-run”-命令" class="headerlink" title="“flask run” 命令"></a>“flask run” 命令</h1><p>添加<code>flasky.py</code>模块后，可以使用以下命令启动 Flask 开发服务器:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> FLASK_APP=flasky.py</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> flask run</span></span><br></pre></td></tr></table></figure>

<p>如果你使用的是 Windows，则 <code>FLASK_APP</code>环境变量的设置方式略有不同:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">set</span> FLASK_APP=flasky.py</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> flask run</span></span><br></pre></td></tr></table></figure>

<p><code>flask run</code>命令具有启用或禁用重新加载程序和调试器的选项,还可以设置 IP 地址和端口,以便服务器侦听客户端请求. 这些选项与 Flask-script 中的选项并不相同,但它们比较接近.你可以使用<code>flask run --help</code>看见所有可用的选项.</p>
<p>正如我敢肯定，大家都知道，大多数 Flask 的应用程序有这行代码在主脚本的底部:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>当你不使用任何 CLI 支持时,这就是你实际如何启动服务器的方法.如果你将此保留在脚本中并开始使用新的 CLI ,不会导致任何问题，但实际上并不需要它，因此你可以删除它.</p>
<h1 id="“flask-shell”-命令"><a href="#“flask-shell”-命令" class="headerlink" title="“flask shell” 命令"></a>“flask shell” 命令</h1><p><code>shell</code>命令基本上是相同的，但是在如何定义要自动导入到 shell 上下文中的其他符号方面有一点差异. 这是一个在处理应用程序时可以节省大量时间的特性.通常,你可以在 shell 的测试或调试会话中添加模型类,数据库实例和其他可能与之交互的对象.</p>
<p>对于 Flask-Script 来说, Flasky 应用有下述 shell 上下文的定义:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Follow=Follow, Role=Role,</span><br><span class="line">                Permission=Permission, Post=Post, Comment=Comment)</span><br><span class="line">manager.add_command(<span class="string">&quot;shell&quot;</span>, Shell(make_context=make_shell_context))</span><br></pre></td></tr></table></figure>

<p>正如你在上面看到的, <code>make_shell_text()</code>函数在定义 <code>shell</code> 选项的 <code>add_command</code> 调用中被引用. Flask-Script 在启动shell会话之前调用此函数，并在其中包含字典中返回的所有符号.</p>
<p>Flask CLI提供了相同的功能,使用装饰器来标识提供 shell 上下文项的函数(实际上,可以有多个函数)。为了具有与上面相同的功能，我扩展了<code>flasky.py</code>模块:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User, Follow, Role, Permission, Post, Comment</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.shell_context_processor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Follow=Follow, Role=Role,</span><br><span class="line">                Permission=Permission, Post=Post, Comment=Comment)</span><br></pre></td></tr></table></figure>

<p>因此,如你所见,该函数是相同的,但需要<code>@app.Shell_Context_Processor</code>装饰器，以便 Flask 知道它.</p>
<h1 id="来自-Flask-Extensions-的命令"><a href="#来自-Flask-Extensions-的命令" class="headerlink" title="来自 Flask Extensions 的命令"></a>来自 Flask Extensions 的命令</h1><p>Flask-Script 成功的一个重要原因是它允许其他 Flask 扩展添加自己的命令.实际上,我已经利用了这个功能在我的<a target="_blank" rel="noopener" href="https://github.com/miguelgrinberg/flask-migrate">Flask-Migrate</a>扩展.</p>
<p>那么,如何将这些命令迁移到Click CLI呢?不幸的是，你只能依赖扩展作者为你进行迁移.如果你使用的任何扩展,与 Flask-Script 协同工作,并且还没有更新到与Flask CLI协同工作的话,那么你将非常不幸,你将需要继续使用 Flask-Script.至少在与相关扩展交互时是这样.如果你使用 Flask-Migrate,你不必担心,因为我已经更新了它以支持 Click 和 Flask-Script CLIs,确保您正在使用最新版本.</p>
<p>特别是对于Flask-Migrate,<code>./manage.py db....</code>.在 Flask-script 版本中, Flask-Migrate 扩展是在<code>manage.py</code>中初始化的.对于 Flask CLI 版本,我们可以将其移到新的<code>flasky.py</code>模块，我相信你现在已经意识到它正在成为 Flask-Script 的<code>manage.py</code>的替代品.唯一的区别是它不是直接执行的脚本.下面是添加了Flask-Migrate集成的模块:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User, Follow, Role, Permission, Post, Comment</span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.shell_context_processor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Follow=Follow, Role=Role,</span><br><span class="line">                Permission=Permission, Post=Post, Comment=Comment)</span><br></pre></td></tr></table></figure>

<p>作为例子,你可以使用以下命令将 Flasky 数据库升级到最新的修订版本,但请记住,需要设置<code>FLASK_APP</code>才能使其工作:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> flask db upgrade</span></span><br></pre></td></tr></table></figure>

<h1 id="应用命令"><a href="#应用命令" class="headerlink" title="应用命令"></a>应用命令</h1><p>Flask-Script 的另一个不错的特性是，它允许您将自定义任务编写为函数,然后通过添加装饰器将其自动转换为 CLI 中的命令.在 Flasky 中,我使用这个特性添加了一些命令.例如,下面是我如何实现 Flask-script 的<code>./manage.py test</code>命令:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@manager.command</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">coverage=<span class="literal">False</span></span>):</span></span><br><span class="line">  <span class="string">&quot;&quot;&quot;Run the unit tests.&quot;&quot;&quot;</span></span><br><span class="line">  <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p><code>@manager.command</code>装饰器是将函数公开为 <code>test</code>命令所需的,它甚至可以检测到<code>coverage</code>参数,并将其添加为 –coverage 选项.</p>
<p>基于装饰器的命令实际上是 Click 的面包和黄油,所以这是可以毫无问题地迁移的.Flask CLI 的等效函数可以放在 <code>flasky.py</code>中,如下所示:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--coverage/--no-coverage&#x27;</span>, default=<span class="literal">False</span>, <span class="built_in">help</span>=<span class="string">&#x27;Enable code coverage&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">coverage</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Run the unit tests.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p><code>@app.cli.command()</code>装饰器为 Click 提供了一个接口.在Flask-script中,命令是在安装了应用程序上下文的情况下执行的,但是在使用 Flask CLI 的情况下,如果你不需要的话,你可以禁用它. 函数的实际代码不需要更改,但请注意,<code>--coverage</code>选项需要使用<code>@click.OptionDecorator</code>显式地给出,这与Flask-Script不同,后者的选项自动从函数参数列表派生.</p>
<p>另外两个在我的 Flasky 的应用程序中的自定义函数也可以采用相同的方法. <code>flasky.py</code>模块的完整实现如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User, Follow, Role, Permission, Post, Comment</span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.shell_context_processor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Follow=Follow, Role=Role,</span><br><span class="line">                Permission=Permission, Post=Post, Comment=Comment)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--coverage/--no-coverage&#x27;</span>, default=<span class="literal">False</span>, <span class="built_in">help</span>=<span class="string">&#x27;aaa&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">coverage=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="string">&quot;Test coverage&quot;</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--length&#x27;</span>, default=<span class="number">25</span>, <span class="built_in">help</span>=<span class="string">&#x27;Profile stack length&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--profile-dir&#x27;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&#x27;Profile directory&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">profile</span>(<span class="params">length, profile_dir</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Start the application under the code profiler.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deploy</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Run deployment tasks.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>在本文中，我向您展示了新 Flask CLI 提供的功能,如果你想迁移基于 Flak-Script 的应用程序,这些功能将非常有用.还有几件事你可以做,但我没有在这里写到.文档描述了如何创建自己的驱动程序脚本，类似于 flask-script 的<code>manage.py</code>,以防你不想使用<code>flask</code>命令.它还告诉你如何通过项目的<code>setup.py</code>文件中定义的”entry points”来注册命令,如果你在项目中使用它的话.如果你感兴趣,请务必查看<a target="_blank" rel="noopener" href="http://flask.pocoo.org/docs/0.12/cli/">CLI文档</a>以了解这些内容.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/10/12/Easyui%E7%9A%84datebox%E5%A7%8B%E7%BB%88%E6%98%BE%E7%A4%BA%E5%BD%93%E5%A4%A9%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/10/12/Easyui%E7%9A%84datebox%E5%A7%8B%E7%BB%88%E6%98%BE%E7%A4%BA%E5%BD%93%E5%A4%A9%E6%97%B6%E9%97%B4%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">Easyui的datebox始终显示当天时间问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-12 00:00:00" itemprop="dateCreated datePublished" datetime="2017-10-12T00:00:00+08:00">2017-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>之前项目中用上了easyui中的datebox,但是由于datebox 默认的时间格式 <code>m/d/y</code>，并不符合我的要求,于是参考手册将其时间格式修改为<code>y-m-d</code>.格式化的代码如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$.fn.datebox.defaults.formatter = <span class="function"><span class="keyword">function</span>(<span class="params">date</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y = date.getFullYear();</span><br><span class="line">    <span class="keyword">var</span> m = date.getMonth()+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> d = date.getDate();</span><br><span class="line">    <span class="keyword">return</span> y+<span class="string">&#x27;-&#x27;</span>+m+<span class="string">&#x27;-&#x27;</span>+d;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>格式是对了,但是出现了下面的问题:<br><img src="http://ww1.sinaimg.cn/large/006wYWbGly1fkf8jl8ahrg30bp06igq4.gif"><br>没错就是出现了,怎么选都显示当前时间的问题.<br>最后终于找到的解决方案,在重写格式的同时,还需要将<code>parser</code>重写一遍</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.fn.datebox.defaults.parser = <span class="function"><span class="keyword">function</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> t = <span class="built_in">Date</span>.parse(s);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">isNaN</span>(t))&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>(t);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>问题解决~~O(∩_∩)O</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/10/11/python%E6%93%8D%E4%BD%9Cmysql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/10/11/python%E6%93%8D%E4%BD%9Cmysql/" class="post-title-link" itemprop="url">python操作mysql</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-11 00:00:00" itemprop="dateCreated datePublished" datetime="2017-10-11T00:00:00+08:00">2017-10-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="环境的安装"><a href="#环境的安装" class="headerlink" title="环境的安装"></a>环境的安装</h1><h2 id="windows-下-mysql-python-的安装"><a href="#windows-下-mysql-python-的安装" class="headerlink" title="windows 下 mysql-python 的安装"></a>windows 下 mysql-python 的安装</h2><p>从官网下载对应版本的软件:<br>64位:<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1c1W9FXY">MySQL-python-1.2.3.win-amd64-py2.7.exe</a><br>32位:<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1jI9DeOQ">MySQL-python-1.2.5.win32-py2.7.exe</a><br>下载完成之后点击安装一路next就完成了,安装完成之后在命令行下进行简单的测试<br><img src="http://ww3.sinaimg.cn/large/d9e82fa4jw1f8okr3dogej20ht03hjro.jpg"><br>如果没有保存的话就说明 mysql-python 成功安装到本地了</p>
<h2 id="mysql-python的简单使用"><a href="#mysql-python的简单使用" class="headerlink" title="mysql-python的简单使用"></a>mysql-python的简单使用</h2><h3 id="创建一张测试表"><a href="#创建一张测试表" class="headerlink" title="创建一张测试表"></a>创建一张测试表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_user` (</span><br><span class="line">	`id` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">	`name` <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	`age` <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">COLLATE</span><span class="operator">=</span><span class="string">&#x27;utf8_general_ci&#x27;</span></span><br><span class="line">ENGINE<span class="operator">=</span>InnoDB</span><br><span class="line">AUTO_INCREMENT<span class="operator">=</span><span class="number">9</span>;</span><br></pre></td></tr></table></figure>
<p>在mysql下执行上述语句创建一张 user 表</p>
<h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">author:leetao</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line">        </span><br><span class="line">conn=MySQLdb.connect(host=<span class="string">&quot;localhost&quot;</span>,user=<span class="string">&quot;root&quot;</span>,passwd=<span class="string">&quot;&quot;</span>,db=<span class="string">&quot;test&quot;</span>,charset=<span class="string">&quot;utf8&quot;</span>)    </span><br><span class="line">cursor = conn.cursor()      </span><br><span class="line">         </span><br><span class="line">sql = <span class="string">&quot;insert into t_user(name,age) values(%s,%s)&quot;</span>     </span><br><span class="line">param = (<span class="string">&quot;leetao&quot;</span>,<span class="string">&#x27;22&#x27;</span>)      </span><br><span class="line">cursor.execute(sql,param)</span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line">conn.commit()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>执行完插入语句之后,让我们检测一下是否将数据插入到数据库中<br><img src="http://ww4.sinaimg.cn/large/d9e82fa4jw1f8olulb8irj20hy0440sy.jpg"><br>成功插入数据库,great!</p>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">author:leetao</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line">        </span><br><span class="line">conn=MySQLdb.connect(host=<span class="string">&quot;localhost&quot;</span>,user=<span class="string">&quot;root&quot;</span>,passwd=<span class="string">&quot;&quot;</span>,db=<span class="string">&quot;test&quot;</span>,charset=<span class="string">&quot;utf8&quot;</span>)    </span><br><span class="line">cursor = conn.cursor()      </span><br><span class="line">         </span><br><span class="line">sql = <span class="string">&quot;update t_user set name=%s where id = 1&quot;</span>     </span><br><span class="line">param = (<span class="string">&quot;lt&quot;</span>)      </span><br><span class="line">cursor.execute(sql,param) </span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line">conn.commit()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>同样的执行完脚本，然后查看修改是否发生效果<br><img src="http://ww1.sinaimg.cn/large/d9e82fa4jw1f8olz8fwbuj20hx03iwek.jpg"><br>修改成功,cool~~</p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">author:leetao</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line">        </span><br><span class="line">conn=MySQLdb.connect(host=<span class="string">&quot;localhost&quot;</span>,user=<span class="string">&quot;root&quot;</span>,passwd=<span class="string">&quot;&quot;</span>,db=<span class="string">&quot;test&quot;</span>,charset=<span class="string">&quot;utf8&quot;</span>)    </span><br><span class="line">cursor = conn.cursor()      </span><br><span class="line">         </span><br><span class="line">sql = <span class="string">&quot;select * from t_user where id = 1&quot;</span>     </span><br><span class="line">cursor.execute(sql)</span><br><span class="line"><span class="keyword">for</span> rows <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">        <span class="built_in">print</span> row</span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line">conn.commit()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>执行脚本,控制台成功输出如下结果:<br><img src="http://ww4.sinaimg.cn/large/d9e82fa4jw1f8om1nxqbbj20g101omwz.jpg"></p>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">author:leetao</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line">        </span><br><span class="line">conn=MySQLdb.connect(host=<span class="string">&quot;localhost&quot;</span>,user=<span class="string">&quot;root&quot;</span>,passwd=<span class="string">&quot;&quot;</span>,db=<span class="string">&quot;test&quot;</span>,charset=<span class="string">&quot;utf8&quot;</span>)    </span><br><span class="line">cursor = conn.cursor()   </span><br><span class="line">sql = <span class="string">&quot;delete from t_user where id = 1&quot;</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line">conn.commit()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>执行完删除后，数据库 t_user 表应该不存在任何数据了，通过 sql 语句验证一下结果<br><img src="http://ww2.sinaimg.cn/large/d9e82fa4jw1f8om5yvdaij20hv01tmx1.jpg"></p>
<p>如上就是关于 python 对mysql的所有操作</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/10/11/venv,%20pyvenv,%20pyenv,%20virtualenv,%20virtualenvwrapper,%20pipenv%20%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/10/11/venv,%20pyvenv,%20pyenv,%20virtualenv,%20virtualenvwrapper,%20pipenv%20%E4%B9%8B%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB/" class="post-title-link" itemprop="url">venv, pyvenv, pyenv, virtualenv, virtualenvwrapper, pipenv 之间的区别</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-11 00:00:00" itemprop="dateCreated datePublished" datetime="2017-10-11T00:00:00+08:00">2017-10-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>关于python的版本管理,库管理使用不少工具,现在对这些工具进行一下简单的总结.</p>
<h1 id="PyPI"><a href="#PyPI" class="headerlink" title="PyPI"></a>PyPI</h1><h2 id="virtualenv"><a href="#virtualenv" class="headerlink" title="virtualenv"></a>virtualenv</h2><p>virtualenv 是一个非常实用的三方包,可以为 Python 创建各自独立开的python库.具体用法可以参考我之前的文章<a target="_blank" rel="noopener" href="http://www.leetao94.cn/2016/10/11/why-I-use-virtualenv/">为什么使用virtualenv</a></p>
<h2 id="pyenv"><a href="#pyenv" class="headerlink" title="pyenv"></a>pyenv</h2><p>pyenv 是用来隔离开各种版本的 Python. 举个例子,比如你想在各个版本的Python中测试你的代码,你就需要一个方法去切换各种版本的Python. 通过使用 pyenv,激活你所需要的版本,它将<code><del>/.pyenv/shims</code>作为 Python 环境变量的前缀,这个路径下包含着一些可以 Python 命令文件(<code>python, pip</code>).这些不是Python附带命令的副本;它们是特殊的脚本，可以根据<code>PYENV_VERVE</code>环境变量,<code>.python-version</code>文件或者<code></del>/.pyenv/version</code>动态决定运行哪个版本的 Python.具体安装步骤的可以参考<a target="_blank" rel="noopener" href="https://github.com/pyenv/pyenv-installer">pyenv-installer</a></p>
<p>接下来的三个我都基本没有使用过</p>
<h2 id="pyenv-virtualenv"><a href="#pyenv-virtualenv" class="headerlink" title="pyenv-virtualenv"></a>pyenv-virtualenv</h2><p>pyenv-virtualenv 是由 pyenv 作者编写的一个插件,它可以使方便地同时使用 pyenv 和 virtualenv. 如果您使用Python3.3或更高版本，pyenv-virtualenv 将尝试运行 <strong>python -m venv</strong>(如果可用)，而不是运行<strong>virtualenv</strong>. 当然如果你不想使用这个比较方便的特性的话,你也可以同时使用 virtualenv 和 pyenv 而不用 pyenv-virtualenv.</p>
<h2 id="virtualenvwrapper"><a href="#virtualenvwrapper" class="headerlink" title="virtualenvwrapper"></a>virtualenvwrapper</h2><p>看它的名称不难猜到它是对 virtualenv 的进一步封装,事实上也是这样它是对 virtualenv 的一组扩展.它提供了 mkviralenv、lssitepackage等命令, 特别是 workon 可以用于在不同的 virtualenv 目录之间切换.</p>
<h2 id="pyenv-virtualenvwrapper"><a href="#pyenv-virtualenvwrapper" class="headerlink" title="pyenv-virtualenvwrapper"></a>pyenv-virtualenvwrapper</h2><p>pyenv-virtualenvwrapper 也是由 pyenv 编写的一个针对 pyenv 的插件,它可以方便地将虚拟包装程序集成到pyenv中.</p>
<h2 id="pipenv"><a href="#pipenv" class="headerlink" title="pipenv"></a>pipenv</h2><p>pipenv 是由 requests 作者编写的,旨在将管道文件、pip和vialenv合并为命令行上的一个命令.具体内容可以去项目主页浏览<a target="_blank" rel="noopener" href="https://github.com/kennethreitz/pipenv">pipenv</a></p>
<h1 id="Standard-library"><a href="#Standard-library" class="headerlink" title="Standard library"></a>Standard library</h1><h2 id="pyenv-1"><a href="#pyenv-1" class="headerlink" title="pyenv"></a>pyenv</h2><p>pyenv 是 Python3中的附带脚本,但是在 Python3.6中废弃 了,具体内容见<a target="_blank" rel="noopener" href="https://docs.python.org/dev/whatsnew/3.6.html#id8">What’s New In Python 3.6</a></p>
<h2 id="venv"><a href="#venv" class="headerlink" title="venv"></a>venv</h2><p>venv 是 Python3 中附带的一个包,你可以通过使用 <code>python -m venv</code>使用它,不过在有的发行版中将它分离成了一个单独的发行版包,如 Ubuntu/Debian 中的 python3-env. 它的用途与 virtualenv 类似，工作方式也非常相似，但它不需要复制Python二进制文件(Windows除外).</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ol>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/41573587/what-is-the-difference-between-venv-pyvenv-pyenv-virtualenv-virtualenvwrappe">https://stackoverflow.com/questions/41573587/what-is-the-difference-between-venv-pyvenv-pyenv-virtualenv-virtualenvwrappe</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/29950300/what-is-the-relationship-between-virtualenv-and-pyenv">https://stackoverflow.com/questions/29950300/what-is-the-relationship-between-virtualenv-and-pyenv</a></p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/09/23/electron-searchMovies/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/09/23/electron-searchMovies/" class="post-title-link" itemprop="url">electron-searchMovies</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-09-23 00:00:00" itemprop="dateCreated datePublished" datetime="2017-09-23T00:00:00+08:00">2017-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>之前学了electron,前段时间又学了一下vue,为了增加熟练度决定将两者结合做个有趣的东西.想来想去最后决定将原来用 PyQt 写的<a target="_blank" rel="noopener" href="https://github.com/lt94/MovieHeavens">MovieHeavens</a>重新写一遍,使用electron-vue构建的项目地址<a target="_blank" rel="noopener" href="https://github.com/lt94/electron-searchMovies">electron-searchMovies</a>,最后用<em>electron-packager</em>打包了成exe,在项目主页的releases可以找到打包后的安装程序.总结一下整个问题中遇见的几点问题以及解决办法.</p>
<h2 id="无法下载打包所需的工具"><a href="#无法下载打包所需的工具" class="headerlink" title="无法下载打包所需的工具"></a>无法下载打包所需的工具</h2><p>由于一些神奇的力量导致打包过程中下载必需的工具包失败</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>确定你需要工具包的名称,然后先手动将这些工具包下载下来,然后解压到对应的缓存目录中.各个系统对应的路径如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">macOS: ~/Library/Caches/electron-builder</span><br><span class="line">Linux: ~/.cache/electron-builder</span><br><span class="line">windows: %LOCALAPPDATA%\electron-builder\cache</span><br></pre></td></tr></table></figure>

<p>我的最终目录树如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── appimage-packages</span><br><span class="line">│   └── appimage-packages-28-08-17</span><br><span class="line">├── nsis</span><br><span class="line">│   └── nsis-3.0.1.13</span><br><span class="line">├── nsis-resources</span><br><span class="line">│   └── nsis-resources-3.3.0</span><br><span class="line">└── winCodeSign</span><br><span class="line">    └── winCodeSign-1.9.0</span><br></pre></td></tr></table></figure>

<h2 id="用-yarn-而不是-npm"><a href="#用-yarn-而不是-npm" class="headerlink" title="用 yarn 而不是 npm"></a>用 yarn 而不是 npm</h2><p>当解决了工具包的问题,仍然打包成功,但是应用没有任何内容只是一个空白页,后来在github<a target="_blank" rel="noopener" href="https://github.com/electron-userland/electron-builder/issues/1615">No contents only a blank page after build</a>看见建议用 <em>yarn</em> 而不是 <em>npm</em>.这里有一篇<a target="_blank" rel="noopener" href="https://www.sitepoint.com/yarn-vs-npm/">Yarn vs npm: Everything You Need to Know</a>的详细文章,正如官方文档说道的:yarn是为了弥补npm的一些缺陷而出现的.</p>
<h2 id="短暂的空白页"><a href="#短暂的空白页" class="headerlink" title="短暂的空白页"></a>短暂的空白页</h2><p>一切问题都解决了,再次将软件打包成 exe,似乎接下来就是体验胜利的果实了,但是事实上并不是这样,打包的第一个版本<a target="_blank" rel="noopener" href="https://github.com/lt94/electron-searchMovies/releases/download/0.0.0/search-movies.Setup.0.0.0.exe">Pre-release</a>,在打开软件最开始会出现短暂的空白页,显然这对用户不是一个很棒的体验,最后决定加了一个简单的加载动画,核心代码如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mainWindow.webContents.on(<span class="string">&#x27;did-finish-load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  mainWindow.show()</span><br><span class="line">  <span class="keyword">if</span> (loadingScreen) &#123;</span><br><span class="line">    <span class="keyword">let</span> loadingScreenBounds = loadingScreen.getBounds()</span><br><span class="line">    mainWindow.setBounds(loadingScreenBounds)</span><br><span class="line">    loadingScreen.close()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>完整代码自然就需要去<a target="_blank" rel="noopener" href="https://github.com/lt94/electron-searchMovies">electron-searchMovies</a>上查看了.这里遇见了一个新的问题.</p>
<h2 id="Cannot-Get-Route"><a href="#Cannot-Get-Route" class="headerlink" title="Cannot Get Route"></a>Cannot Get Route</h2><p>在解决上个问题的同时遇见了一个新的问题,加载动画页是通过路由映射的，我在 <em>src/routes.js</em> 中添加了如下的路由:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &#x27;/loading&#x27;,</span><br><span class="line">  name: &#x27;loading-page&#x27;,</span><br><span class="line">  component: require(&#x27;@/components/LoadingPage&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后让 <em>loadingScreen</em> 加载 <em><a target="_blank" rel="noopener" href="http://localhost:9080/loading">http://localhost:9080/loading</a></em> 但是却使用获得 <em>cannot get /loading</em> 的错误,后来最后查找资料下找到了解决方案,对于新的路由访问地址应该是<em><a target="_blank" rel="noopener" href="http://localhost:9080/#/new_route">http://localhost:9080/#/new_route</a></em>,打包后的访问地址应该是:<em>file://${__dirname}/index.html#new_route</em>,到此所有问题圆满解决.最后上一下软件的使用截图.</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1fjt9glqbn1g310r0imqv6.gif"><br>最后欢迎大家star Or fork~</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/09/19/Replace%20Words/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/09/19/Replace%20Words/" class="post-title-link" itemprop="url">Replace Words</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-09-19 00:00:00" itemprop="dateCreated datePublished" datetime="2017-09-19T00:00:00+08:00">2017-09-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-09 17:05:30" itemprop="dateModified" datetime="2022-07-09T17:05:30+08:00">2022-07-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>In English, we have a concept called <code>root</code>, which can be followed by some other words to form another longer word - let’s call this word <code>successor</code>. For example, the root <code>an</code>, followed by <code>other</code>, which can form another word <code>another</code>.</p>
<p>Now, given a dictionary consisting of many roots and a sentence. You need to replace all the <code>successor</code> in the sentence with the <code>root</code> forming it. If a <code>successor</code> has many <code>roots</code> can form it, replace it with the root with the shortest length.</p>
<p>You need to output the sentence after the replacement.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: dict = [&quot;cat&quot;, &quot;bat&quot;, &quot;rat&quot;]</span><br><span class="line">sentence = &quot;the cattle was rattled by the battery&quot;</span><br><span class="line">Output: &quot;the cat was rat by the bat&quot;</span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong></p>
<ol>
<li>The input will only have lower-case letters.</li>
<li>1 &lt;= dict words number &lt;= 1000</li>
<li>1 &lt;= sentence words number &lt;= 1000</li>
<li>1 &lt;= root length &lt;= 100</li>
<li>1 &lt;= sentence words length &lt;= 1000</li>
</ol>
<p><strong>Solution</strong></p>
<p>将字符串(sentence)拆分为数组(sentence_arr),然后遍历 dic,判断数组元素前导字符串是否包含dic中的元素,如果包含则替换</p>
<p>Python</p>
<p>Prefix-hash</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replaceWords</span>(<span class="params">self, <span class="built_in">dict</span>, sentence</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type dict: List[str]</span></span><br><span class="line"><span class="string">        :type sentence: str</span></span><br><span class="line"><span class="string">        :rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        res = []</span><br><span class="line">        sentence_arr = sentence.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sentence_arr)):</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">                <span class="keyword">if</span> sentence_arr[i].startswith(item):</span><br><span class="line">                    sentence_arr[i] = item</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot; &quot;</span>.join(sentence_arr)</span><br></pre></td></tr></table></figure>

<p>Trie</p>
<p>利用dict构建字典树,然后遍历 sentence 中的元素, 在 Trie 中搜索</p>
<p><a target="_blank" rel="noopener" href="https://discuss.leetcode.com/topic/96826/python-straightforward-with-explanation-prefix-hash-trie-solutions">参考代码1</a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replaceWords</span>(<span class="params">self, roots, sentence</span>):</span></span><br><span class="line">        _trie = <span class="keyword">lambda</span>: collections.defaultdict(_trie)</span><br><span class="line">        trie = _trie()</span><br><span class="line">        END = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> root <span class="keyword">in</span> roots:</span><br><span class="line">            cur = trie</span><br><span class="line">            <span class="keyword">for</span> letter <span class="keyword">in</span> root:</span><br><span class="line">                cur = cur[letter]</span><br><span class="line">            cur[END] = root</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">replace</span>(<span class="params">word</span>):</span></span><br><span class="line">            cur = trie</span><br><span class="line">            <span class="keyword">for</span> letter <span class="keyword">in</span> word:</span><br><span class="line">                <span class="keyword">if</span> letter <span class="keyword">not</span> <span class="keyword">in</span> cur: <span class="keyword">break</span></span><br><span class="line">                cur = cur[letter]</span><br><span class="line">                <span class="keyword">if</span> END <span class="keyword">in</span> cur:</span><br><span class="line">                    <span class="keyword">return</span> cur[END]</span><br><span class="line">            <span class="keyword">return</span> word</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(replace, sentence.split()))</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://discuss.leetcode.com/topic/96833/using-trie-python">参考代码2</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replaceWords</span>(<span class="params">self, roots, sentence</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :type dict: List[str]</span></span><br><span class="line"><span class="string">        :type sentence: str</span></span><br><span class="line"><span class="string">        :rtype: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">                self.word = <span class="literal">False</span></span><br><span class="line">                self.children = <span class="built_in">dict</span>()</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Trie</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">                self.root = TrieNode()</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">addWord</span>(<span class="params">self, word</span>):</span></span><br><span class="line">                <span class="keyword">if</span> word:</span><br><span class="line">                    cur = self.root</span><br><span class="line">                    <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">                        <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> cur.children:</span><br><span class="line">                            cur.children[c] = TrieNode()</span><br><span class="line">                        cur = cur.children[c]</span><br><span class="line">                    cur.word = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">getRoot</span>(<span class="params">self, word</span>):</span></span><br><span class="line">                ans = <span class="string">&quot;&quot;</span></span><br><span class="line">                cur = self.root</span><br><span class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> word:</span><br><span class="line">                    <span class="keyword">if</span> c <span class="keyword">in</span> cur.children:</span><br><span class="line">                        ans += c</span><br><span class="line">                        cur = cur.children[c]</span><br><span class="line">                        <span class="keyword">if</span> cur.word == <span class="literal">True</span>:  <span class="comment"># found smallest root!</span></span><br><span class="line">                            <span class="keyword">return</span> ans</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">return</span> word</span><br><span class="line"></span><br><span class="line">        trie = Trie()</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> roots:</span><br><span class="line">            trie.addWord(word)</span><br><span class="line"></span><br><span class="line">        ans = []</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> sentence.split():</span><br><span class="line">            ans.append(trie.getRoot(word))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>.join(ans)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leetao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  





  




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"leetaoGoooo","repo":"leetaogoooo.github.io","client_id":"bf98ffa3f57b2591544e","client_secret":"cc5ffeff8863bb5c44ed10f024513dccfac14afa","admin_user":"leetaogoooo","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"fc1212e4c6ef0ea216824014023be545"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
