<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"leetaogoooo.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Je pense, donc je suis">
<meta property="og:type" content="website">
<meta property="og:title" content="Leetao&#39;s Blog">
<meta property="og:url" content="https://leetaogoooo.github.io/page/13/">
<meta property="og:site_name" content="Leetao&#39;s Blog">
<meta property="og:description" content="Je pense, donc je suis">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Leetao">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://leetaogoooo.github.io/page/13/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/13/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Leetao's Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Leetao's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Leetao's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Talk is cheap, show me the code</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leetao"
      src="/images/avatar.ico">
  <p class="site-author-name" itemprop="name">Leetao</p>
  <div class="site-description" itemprop="description">Je pense, donc je suis</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">198</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/leetaogoooo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;leetaogoooo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:leetao94cn@gmail.com" title="E-Mail → mailto:leetao94cn@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/LeetaoGoooo" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;LeetaoGoooo" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://t.me/leetaothinks" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;leetaothinks" rel="noopener" target="_blank"><i class="fa fa-telegram fa-fw"></i>Telegram</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/leetaoGoooo" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;leetaoGoooo" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2018/01/14/HTTP%20%E7%8A%B6%E6%80%81%E7%A0%81%20302,303,307/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2018/01/14/HTTP%20%E7%8A%B6%E6%80%81%E7%A0%81%20302,303,307/" class="post-title-link" itemprop="url">HTTP 状态码 302,303,307</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-01-14 00:00:00" itemprop="dateCreated datePublished" datetime="2018-01-14T00:00:00+08:00">2018-01-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近一直在看《HTTP The Definitive Guide》,对此大家可能有点陌生，但是一提它的中文名称那就是耳熟能详了,它的中文书名是《http权威指南》.在看到HTTP Messages这一章Status Code这一节,发现状态码302、303、307这三个很相似,然后对此进行了对比,特此记录.</p>
<h2 id="302-Found"><a href="#302-Found" class="headerlink" title="302 Found"></a>302 Found</h2><blockquote>
<p>This is an example of industry practice contradicting the standard. The HTTP/1.0 specification (RFC 1945) required the client to perform a temporary redirect (the original describing phrase was “Moved Temporarily”, but popular browsers implemented 302 with the functionality of a 303 See Other.Therefore, HTTP/1.1 added status codes 303 and 307 to distinguish between the two behaviours. However, some Web applications and frameworks use the 302 status code as if it were the 303 ——[1]</p>
</blockquote>
<p>在看下维基百科的定义:</p>
<blockquote>
<p>The HTTP response status code 302 Found is a common way of performing URL redirection.<br>An HTTP response with this status code will additionally provide a URL in the header field location. The user agent (e.g. a web browser) is invited by a response with this code to make a second, otherwise identical, request to the new URL specified in the location field. The HTTP/1.0 specification (RFC 1945) initially defined this code, and gives it the description phrase “Moved Temporarily”.<br>Many web browsers implemented this code in a manner that violated this standard, changing the request type of the new request to GET, regardless of the type employed in the original request (e.g. POST).For this reason, HTTP/1.1 (RFC 2616) added the new status codes 303 and 307 to disambiguate between the two behaviours, with 303 mandating the change of request type to GET, and 307 preserving the request type as originally sent. Despite the greater clarity provided by this disambiguation, the 302 code is still employed in web frameworks to preserve compatibility with browsers that do not implement the HTTP/1.1 specification.<br>As a consequence, the update of RFC 2616 changes the definition to allow user agents to rewrite POST to GET ——[2]</p>
</blockquote>
<p>结合上面两个我们大致可以总结出这样一些结论:</p>
<p>在 RFC 1945 中初次定义状态码302,并将其描述位”Moved Temporarily”(暂时移动).预期关于302的使用应该如下,当一个http的response状态码为302的时候,其响应头肯定回包含一个可选的URL(如下图).客户端预期需要根据该URL进行二次请求.正常情况下客户端的请求方式应该与之前保持一致,但是许多Web浏览器并没有遵守这个规定，而是不管原始请求使用何种类型，都将新请求的请求类型变为GET.由于这个原因,在HTTP/1.1 (RFC 2616)添加 303 和 307 这两个状态码,其中 303强制将请求类型改变为GET，307保留原始发送的请求类型. 而302则用来维持与尚未实现HTTP/1.1规范的浏览器的兼容性.</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1fng94l5z7bj30fr09z3ym.jpg"></p>
<h2 id="303-See-Other-since-HTTP-1-1"><a href="#303-See-Other-since-HTTP-1-1" class="headerlink" title="303 See Other (since HTTP/1.1)"></a>303 See Other (since HTTP/1.1)</h2><blockquote>
<p>The response to the request can be found under another URI using the GET method. When received in response to a POST (or PUT/DELETE), the client should presume that the server has received the data and should issue a new GET request to the given URI.</p>
</blockquote>
<p>对于303我们从上面就可以得知,二次请求的方式一定为GET,如果第一次请求为其他类型的话,我们默认认为它已经接受到了数据.该状态码可以用来相应任何方式的HTTP请求.</p>
<p>它主要用于允许POST操作的输出将客户端重定向到选定的资源，因为这样做提供了与POST响应相对应的信息，并且该表单可以独立于原始请求单独标识、书签和缓存,个人理解是正常情况下我们在一个页面进行了post操作,然后得到服务器响应在当前页面获取到相应数据,显然这种情况下页面是无法保存书签和缓存的,一旦我们重新访问这个页面，之前的数据还是需要我们重新请求的，303则是将响应的内容重新定向到一个新的页面,并且下次访问该页面的时候响应的数据还是仍然存在的，比如消息确认页面或上传进度页面.</p>
<p>对于303响应GET方式的请求,我个人是有点困惑的.RFC7321表述内容如下:</p>
<blockquote>
<p>A 303 response to a GET request indicates that the origin server does not have a representation of the target resource that can be transferred by the server over HTTP.  However, the Location field value refers to a resource that is descriptive of the target resource, such that making a retrieval request on that other resource might result in a representation that is useful to recipients without implying that it represents the original target resource.  Note that answers to the questions of what can be represented, what representations are adequate, and what might be a useful description are outside the scope of HTTP. ——[3]</p>
</blockquote>
<p>直观的翻译大意如下:<br>对GET请求的303响应表明，源服务器不具有可由服务器通过HTTP传输的目标资源的表示形式。但是，Location字段值是指描述目标资源的资源，因此，对该其他资源发出检索请求可能会导致对收件人有用的表示，而不会暗示它代表原始目标资源。</p>
<p>我的理解是对于GET方式返回303代表,其目标资源并不能很好的借由服务器通过HTTP协议很好的展示出来.响应头中的Location的值指的是一种资源,用来是描述目标资源的.对该资源请求可能获取到对客户端有用的信息.</p>
<h2 id="307-Temporary-Redirect-since-HTTP-1-1"><a href="#307-Temporary-Redirect-since-HTTP-1-1" class="headerlink" title="307 Temporary Redirect (since HTTP/1.1)"></a>307 Temporary Redirect (since HTTP/1.1)</h2><blockquote>
<p>In this case, the request should be repeated with another URI; however, future requests should still use the original URI. In contrast to how 302 was historically implemented, the request method is not allowed to be changed when reissuing the original request. For example, a POST request should be repeated using another POST request</p>
</blockquote>
<p>307就相对毕竟简单些,如果返回的状态码为307,则表明使用head中location的URI进行再一次的请求,但是以后的请求仍然使用原来的URI.与以往实现302的方式不同，在重新发出原始请求时，不允许更改请求方法。例如，应该使用另一个POST请求重复POST请求.</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p>[1] <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#3xx_Redirection">3xx_Redirection</a></p>
<p>[2] <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/HTTP_302">HTTP_302</a></p>
<p>[3] <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7231#section-6.4.4">303 See Other</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/12/26/axios%E4%B8%AD%E4%BD%BF%E7%94%A8application-x-www-form-urlencoded/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/26/axios%E4%B8%AD%E4%BD%BF%E7%94%A8application-x-www-form-urlencoded/" class="post-title-link" itemprop="url">axios中使用application-x-www-form-urlencoded</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-26 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-26T00:00:00+08:00">2017-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>这几天用go写了一个api接口，用postman测试的时候,数据返回都正常的,然后用 axios 请求的时候,服务器始终接收不到前台发来的的参数,感觉问题可能出现在请求头,然后打开chrome开发者工具,查看一下请求详情</p>
<h2 id="axios-请求的详情"><a href="#axios-请求的详情" class="headerlink" title="axios 请求的详情"></a>axios 请求的详情</h2><p>Request-Headers 的 <strong>Content-Type</strong> 是 <strong>application/json;charset=UTF-8</strong>,Request Payload格式为</p>
<blockquote>
<p>{param1: “value1”, params: “value2”}</p>
</blockquote>
<h2 id="postman-请求的详情"><a href="#postman-请求的详情" class="headerlink" title="postman 请求的详情"></a>postman 请求的详情</h2><p>Request-Headers 的 <strong>Content-Type</strong> 是 <strong>application/x-www-form-urlencoded</strong>,URL encode 为</p>
<blockquote>
<p>param1=value1&amp;param2=value2</p>
</blockquote>
<p>对比了一下很明显问题就出在这里,接下来该怎么解决问题</p>
<h2 id="问题的解决"><a href="#问题的解决" class="headerlink" title="问题的解决"></a>问题的解决</h2><h3 id="使用-URLSearchParams"><a href="#使用-URLSearchParams" class="headerlink" title="使用 URLSearchParams"></a>使用 URLSearchParams</h3><p>此方法不推荐,兼容性不太好,见下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1fmudwfsis1j31h30jz76f.jpg"></p>
<p>使用示例代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> params = <span class="keyword">new</span> URLSearchParams();</span><br><span class="line">params.append(<span class="string">&#x27;param1&#x27;</span>, <span class="string">&#x27;value1&#x27;</span>);</span><br><span class="line">params.append(<span class="string">&#x27;param2&#x27;</span>, <span class="string">&#x27;value2&#x27;</span>);</span><br><span class="line">axios.post(<span class="string">&#x27;/foo&#x27;</span>, params);</span><br></pre></td></tr></table></figure>

<h3 id="使用-qs-库"><a href="#使用-qs-库" class="headerlink" title="使用 qs 库"></a>使用 qs 库</h3><p>使用示例代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">&#x27;qs&#x27;</span>);</span><br><span class="line">axios.post(<span class="string">&#x27;/foo&#x27;</span>, qs.stringify(&#123; <span class="string">&#x27;bar&#x27;</span>: <span class="number">123</span> &#125;));</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/12/19/windows%E4%B8%8B%20Go%E7%9A%84%E5%AE%89%E8%A3%85%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/19/windows%E4%B8%8B%20Go%E7%9A%84%E5%AE%89%E8%A3%85%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/" class="post-title-link" itemprop="url">windows下 Go的安装的注意事项</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-19 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-19T00:00:00+08:00">2017-12-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="安装-git-for-windows"><a href="#安装-git-for-windows" class="headerlink" title="安装 git for windows"></a>安装 <strong>git for windows</strong></h3><p>想要使用 <code>go get</code>.需要先安装好 git</p>
<h3 id="设置-GOPATH"><a href="#设置-GOPATH" class="headerlink" title="设置 GOPATH"></a>设置 <strong>GOPATH</strong></h3><p>使用<code>go get</code>安装的相关包将会保存在改目录下，为了使得安装的相关包立马生效，可以事先在 <strong>GOPATH</strong> 所在目录新建三个文件，分别为 <strong>bin,pkg,src</strong></p>
<h3 id="GOPATH-和-GOROOT-路径不能相同"><a href="#GOPATH-和-GOROOT-路径不能相同" class="headerlink" title="GOPATH 和 GOROOT 路径不能相同"></a><strong>GOPATH</strong> 和 <strong>GOROOT</strong> 路径不能相同</h3><p>两者路径相同的话，使用<code>go get</code> 安装会提示相关错误信息</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/12/04/wtforms%20%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/12/04/wtforms%20%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">wtforms 使用的一些问题总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-04 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-04T00:00:00+08:00">2017-12-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h1><blockquote>
<p>Q1.  用IntegerField来限制form只能用数字 但是发现它只能接受1以上 不能接受0 如何设置</p>
</blockquote>
<p>A1:添加代码<code>validators=[InputRequired()]</code>  </p>
<blockquote>
<p>Q2. 让 IntegerField 的输入框只允许输入数字,即选渲染后的输入框类型为 number</p>
</blockquote>
<p>A2: 添加代码<code>widget=NumberInput()</code>, 引入 <code>from wtforms.widgets.html5 import NumberInput</code>,默认的 widget 为 TextInput(),见链接<a target="_blank" rel="noopener" href="https://github.com/wtforms/wtforms/blob/551bb29ba9ee74e8b4113d08b9b22c5c7df8b9b1/wtforms/fields/core.py#L572">[1]</a></p>
<blockquote>
<p>Q3. 如何在一个页面中使用两个Form</p>
</blockquote>
<p>A3: 确保两个form中的字段不相同,因为渲染之后字段名即为 id,判断语句应如下,其他方法可参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18290142/multiple-forms-in-a-single-page-using-flask-and-wtforms">[2]</a>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> form1.validate_on_sumite() <span class="keyword">and</span> form1.submite1.data():</span><br><span class="line">    ... </span><br><span class="line"><span class="keyword">elif</span> form2.validate_on_submit() <span class="keyword">and</span> form2.submit2.date():</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Q4. 添加 placeholder</p>
</blockquote>
<p>A4: 添加代码 <code>render_kw=&#123;'placeholder': "placeholder"&#125;</code></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://github.com/wtforms/wtforms/blob/551bb29ba9ee74e8b4113d08b9b22c5c7df8b9b1/wtforms/fields/core.py">[1]wtforms-fields-core.py</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18290142/multiple-forms-in-a-single-page-using-flask-and-wtforms">[2]Multiple forms in a single page using flask and WTForms</a><br><a target="_blank" rel="noopener" href="http://wtforms.readthedocs.io/en/latest/widgets.html">[3]widgets</a><br><a target="_blank" rel="noopener" href="http://wtforms.simplecodes.com/docs/0.6.1/fields.html">[4]fields</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/11/25/HP%20EliteDesk%20800%20G3%20%20SFF%20%E5%8F%B0%E5%BC%8F%E6%9C%BA%20%E4%BD%BF%E7%94%A8%20%20BiosConfigUtility%20%E9%85%8D%E7%BD%AE%20Bios/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/25/HP%20EliteDesk%20800%20G3%20%20SFF%20%E5%8F%B0%E5%BC%8F%E6%9C%BA%20%E4%BD%BF%E7%94%A8%20%20BiosConfigUtility%20%E9%85%8D%E7%BD%AE%20Bios/" class="post-title-link" itemprop="url">HP EliteDesk 800 G3  SFF 台式机 使用  BiosConfigUtility 配置 Bios</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-25 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-25T00:00:00+08:00">2017-11-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在windows下装个docker真是不容易,到最后一步,没有办法开启VTx. 其实很简单,前提如果是可以进入bios的情况下. 不知道怎么会是我的台式机(HP EliteDesk 800 G3  SFF )始终无法进入 bios,开机按 F10 会有声音但是没有任何画面,显示屏没有任何画面,我以为是连接显示器的接口问题,从集显接口换了蓝色的独显接口,但是还是没有任何作用.至到我找到了 BiosConfigUtility 这个 HP 官网的软件.从官网下载软件并安装.安装完成之后进入安装完成界面,如下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flthwedk3uj30od07274o.jpg"></p>
<p>然后打开命令行以管理员的身份运行,切换到该目录下,执行下述命令:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flthyrgh8mj30xi083dge.jpg"></p>
<p>你会发现在当前目录下你多了一个 “config64.xml” 的文件,如果你是 32 位的系统,使用不带有 64 后缀的命令,然后使用编辑器打开该 xml,注意以管理员的身份打开该编辑器,否则待会你无法保存这个文件,当然如果你将这个文件保存到非系统盘路径下则不需要.然后找到有关虚拟支持的设置:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flti2pjaedj30z50ostba.jpg"></p>
<p>编辑完成保存之后,在执行如下命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BiosConfigUtility64 /set:&quot;config64.xml&quot;</span><br></pre></td></tr></table></figure>

<p>如果控制台输出内容大意为没有错误发生,则说明你设置成功了！然后重启,docker 终于可以正常运行了！！！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/11/16/python%E5%86%85%E7%BD%AE%E5%B8%B8%E9%87%8F(built-in%20constants)-NotImplemented/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/16/python%E5%86%85%E7%BD%AE%E5%B8%B8%E9%87%8F(built-in%20constants)-NotImplemented/" class="post-title-link" itemprop="url">python内置常量(built-in constants)-NotImplemented</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-16 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-16T00:00:00+08:00">2017-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>NotImplemented 的在标准库的定义如下:</p>
<blockquote>
<p>Special value which should be returned by the binary special methods (e.g. <em><strong>eq</strong>()</em> , <em><strong>lt</strong>()</em>, <em><strong>add</strong>()</em>, <em><strong>rsub</strong>()</em>, etc.) to indicate that the operation is not implemented with respect to the other type; may be returned by the in-place binary special methods (e.g. <em><strong>imul</strong>()</em>, <em><strong>iand</strong>()</em>, etc.) for the same purpose. Its truth value is true.</p>
</blockquote>
<p>翻译成中文的大概意思:NotImplemented 是一个可由内置函数(<em><strong>eq</strong>()</em> , <em><strong>lt</strong>()</em>, <em><strong>add</strong>()</em>, <em><strong>rsub</strong>()</em> 等等)返回的特殊值,用以表明该操作没有对另一种类型的实现.可能会被其他的特殊方法( <em><strong>imul</strong>()</em>, <em><strong>iand</strong>()</em> 等等)就近处理用以同样的目的,从而返回.它的实际值为True.最后一句话的真是含义如下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flj0q0b91oj30nf06z74z.jpg"></p>
<p>与 False,True,None 这几个内置常量不同的是 NotImplemented 对它赋值,并且不会产生 SyntaxError. 如下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flj12xyzkvj30nf0b20to.jpg"></p>
<h2 id="Notimplemented-和-Notimplementederror"><a href="#Notimplemented-和-Notimplementederror" class="headerlink" title="Notimplemented 和 Notimplementederror"></a>Notimplemented 和 Notimplementederror</h2><p>在关于 NotImplemented 的定义下面,官方还特意加了一条提示:</p>
<blockquote>
<p>NotImplementedError and NotImplemented are not interchangeable, even though they have similar names and purposes.</p>
</blockquote>
<h2 id="NotImplementedError"><a href="#NotImplementedError" class="headerlink" title="NotImplementedError"></a>NotImplementedError</h2><p>官方定义如下:</p>
<blockquote>
<p>This exception is derived from RuntimeError. In user defined base classes, abstract methods should raise this exception when they require derived classes to override the method, or while the class is being developed to indicate that the real implementation still needs to be added.</p>
</blockquote>
<p>翻译过来的意思是说:此异常从 RuntimeError 派生出来的.在用户定义的基类中，当抽象方法需要派生类覆盖方法时，或者在开发该类以指示仍然需要添加实际实现时，抽象方法应该引发此异常.</p>
<p>同样有一条提示:</p>
<blockquote>
<p>It should not be used to indicate that an operator or method is not meant to be supported at all – in that case either leave the operator / method undefined or, if a subclass, set it to None.</p>
</blockquote>
<p>大概意思是指 NotImplementedError 根本不应该被用来表示一个操作符或者方法不被支持的情况(对于一下 NotImplemented,but why?just see next).在这种情况下，要么保留操作符/方法未定义，要么将子类设置为无.</p>
<h2 id="Why-return-NotImplemented-instead-of-raising-NotImplementedError"><a href="#Why-return-NotImplemented-instead-of-raising-NotImplementedError" class="headerlink" title="Why return NotImplemented instead of raising NotImplementedError"></a>Why return NotImplemented instead of raising NotImplementedError</h2><p>前者是常量后者是异常,但是为什么在操作没有实现的时候,返回前者而不是后者呢?</p>
<p>在 Python 中对列表进行排序时，会经常间接使用类似 <em><strong>lt</strong>()</em> 这类比较运算的方法.有时 Python 的内部算法会选择别的方法来确定比较结果，或者直接选择一个默认的结果。如果抛出一个异常，则会打破排序运算，因此如果使用 NotImplemented 则不会抛出异常，这样 Python 可以尝试别的方法。</p>
<p>NotImplemented 在运行时发出信号，要求其他人满足操作. 在表达式 <code>a==b</code> 中，如果 <code><em>a.<strong><strong>eq</strong></strong>(B)</em></code>返回 <code>NotImplented</code>，那么 Python 将尝试 <code><em>b.<strong><strong>eq</strong></strong>(A)</em></code>.如果b知道的足够多，可以返回 <code>true</code> 或 <code>false</code>,那么表达式就可以成功. 如果没有，那么运行时将返回到内置行为(基于 <code>==</code> 和 <code>!=</code>的标识.</p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>我们通过实现上面提到的 <em><strong>eq</strong>()</em> 来实现上面提到的例子,来加深印象.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># example.py</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, A):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Comparing an A with an A&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> other.value == self.value</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, B):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Comparing an A with a B&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> other.value == self.value</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Could not compare A with the other class&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, B):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Comparing a B with another B&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> other.value == self.value</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Could not compare B with the other class&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br></pre></td></tr></table></figure>

<p>然后运行结果如下图:</p>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1flj22ol8a7j30nf0cst9j.jpg"></p>
<p>对于 <code>a == a</code> 和 <code>b == b </code>,显然结果如我们预期那样,因为我们实现已经定义好了自己比较自己的方法.重点在 <code> b == a</code>,我们并没有在 B 中定义 B 和 其他类比较的方法,因此打印出了 “Could not compare B with the other class”,然后程序接下来去调用了 <code><em>a.<strong><strong>eq</strong></strong>(B)</em></code>,一切如我们之前所说的那样.</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://docs.python.org/3.6/library/constants.html#NotImplemented">NotImplemented</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3.6/library/exceptions.html#NotImplementedError">exception NotImplementedError</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/878943/why-return-notimplemented-instead-of-raising-notimplementederror">Why return NotImplemented instead of raising NotImplementedError</a></p>
<p><a target="_blank" rel="noopener" href="http://python.jobbole.com/80913/">Python中内置的NotImplemented类型</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/11/13/%E5%9C%A8Ubuntu14.04%E4%B8%8A%E4%BD%BF%E7%94%A8Gunicorn%E5%92%8CNginx%E9%83%A8%E7%BD%B2Flask%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/13/%E5%9C%A8Ubuntu14.04%E4%B8%8A%E4%BD%BF%E7%94%A8Gunicorn%E5%92%8CNginx%E9%83%A8%E7%BD%B2Flask%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">在Ubuntu14.04上使用Gunicorn和Nginx部署Flask应用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-13 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-13T00:00:00+08:00">2017-11-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近闲来无事折腾了一下自己的个人公共号,通过 Flask 构建了几个简单的小功能然后部署到服务器上.网上关于部署的教程有很多,这里我就简单介绍一下我的部署步骤.</p>
<h1 id="部署的准备工作"><a href="#部署的准备工作" class="headerlink" title="部署的准备工作"></a>部署的准备工作</h1><p>更新并安装下述的包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install python-pip python-dev nginx</span><br></pre></td></tr></table></figure>

<h1 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h1><p>切到项目所以目录下,由于我使用的是 python 版本是 3.5.2 的,所以通过下述命令去创建虚拟环境</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m venv Env # Env 为创建的虚拟环境的名称</span><br></pre></td></tr></table></figure>

<p>然后激活环境安装相应的库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source Env/bin/activate</span><br><span class="line">pip install gunicorn # 这里省略了其他需要安装的包 </span><br></pre></td></tr></table></figure>

<h1 id="创建-WSGI-文件"><a href="#创建-WSGI-文件" class="headerlink" title="创建 WSGI 文件"></a>创建 WSGI 文件</h1><p>通过命令行在项目目录下创建 <code>wsgi.py</code> 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano wsgi.py # 原来用 vim,后来发现用 nano 也很爽</span><br></pre></td></tr></table></figure>

<p>这个文件内容其实很简单就是让程序运行起来:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wsgi.py</span></span><br><span class="line"><span class="keyword">from</span> httpbin <span class="keyword">import</span> create_app <span class="comment"># httpbin 项目目录</span></span><br><span class="line"></span><br><span class="line">application = create_app(<span class="string">&#x27;default&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    application.run()</span><br></pre></td></tr></table></figure>
<p>然后保存</p>
<h1 id="使用-Gunicorn-运行应用"><a href="#使用-Gunicorn-运行应用" class="headerlink" title="使用 Gunicorn 运行应用"></a>使用 Gunicorn 运行应用</h1><p>由于服务默认开发端口仅有80和443端口,对此我也懒得修改,直接将服务挂载到80端口进行测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn --bind 0.0.0.0:80 wsgi</span><br></pre></td></tr></table></figure>
<p>通过访问我应用的指定的api然后成功获得了数据,然后开始进行下一步</p>
<h1 id="创建一个启动脚本"><a href="#创建一个启动脚本" class="headerlink" title="创建一个启动脚本"></a>创建一个启动脚本</h1><p>这个脚本顾名思义允许 Ubuntu 自动启动 Gunicorn 从而挂载我的 Flask 应用.在 <code>/etc/init</code> 目录下创建以 <code>.conf</code> 结尾的文件:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/init/wechat.conf</span><br></pre></td></tr></table></figure>
<p>文件内容如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> wechat.conf</span></span><br><span class="line"></span><br><span class="line">description &quot;Gunicorn application server running wechat&quot;</span><br><span class="line"></span><br><span class="line">start on runlevel [2345]</span><br><span class="line">stop on runlevel [!2345]</span><br><span class="line"></span><br><span class="line">respawn</span><br><span class="line">setuid root # 我的是root用户,如果你是在其他用户下运行则将其他改为其他用户名称</span><br><span class="line">setgid www-data</span><br><span class="line"></span><br><span class="line">env PATH=/home/py/wechat/Env/bin # python 环境目录</span><br><span class="line">chdir /home/py/wechat</span><br><span class="line">exec gunicorn --workers 3 --bind unix:wechat.sock -m 007 wsgi</span><br></pre></td></tr></table></figure>

<p>保存退出,然后尝试运行你的脚本文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start wechat</span><br></pre></td></tr></table></figure>

<p>想要查看是否运行成功的话，可以使用下述命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep wechat</span><br></pre></td></tr></table></figure>
<p>如果你在输出的结果中看到相应的进程了就说明你的脚本运行成功了.然后就可以进行下一步</p>
<h1 id="配置-Nginx"><a href="#配置-Nginx" class="headerlink" title="配置 Nginx"></a>配置 Nginx</h1><p>在这里介绍了如何简单配置 Nginx,但是在实际应用中需要思考一下是否真的需要用到 Nginx,Nginx有很多功能,但是对于像这样简单的小应用,直接 Gunicorn 裸跑也是没毛病的,但是你说你一台服务器挂多个域名,避免 Gunicorn 独占 80 端口，用 Nginx 这个更没毛病.</p>
<p>在 <code>/etc/nginx/sites-available</code> 目录下创建项目配置文件 <code>wechat</code>,没必要将缺省文件删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/nginx/sites-available/wechat</span><br></pre></td></tr></table></figure>

<p>配置文件内容如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name server_domain_or_IP;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        include proxy_params;</span><br><span class="line">        proxy_pass http://unix:/home/py/wechat/wechat.sock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>保存退出,然后为了确保配置文件生效,将其链接到 <code>sites-enabled</code> 目录下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/nginx/sites-available/wechat /etc/nginx/sites-enabled</span><br></pre></td></tr></table></figure>

<p>测试一下配置文件是否有语法错误:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br></pre></td></tr></table></figure>
<p>如果看见 succssful 的成功单词就说明配置文件没有任何问题,然后重启 nginx</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart </span><br></pre></td></tr></table></figure>
<p>大功告成~</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/11/06/%E5%81%8F%E5%87%BD%E6%95%B0-functools%E4%B9%8Bpartial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/11/06/%E5%81%8F%E5%87%BD%E6%95%B0-functools%E4%B9%8Bpartial/" class="post-title-link" itemprop="url">偏函数-functools之partial</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-06 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-06T00:00:00+08:00">2017-11-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>前段时间在讲述 Flask-Login 的源码中遇见了一个函数 ——<code>partial</code>,这个函数来自于<code>functools</code>模块,这个模块定义为”The functools module is for higher-order functions: functions that act on or return other functions. In general, any callable object can be treated as a function for the purposes of this module”,翻译成中文的大概意思就是”functools 用于高阶函数：指那些作用于函数或者返回其他函数的函数。总的来说，这个模块的目标就是将任何可调用的对象都可以被视为函数。”</p>
<h1 id="functools-partial"><a href="#functools-partial" class="headerlink" title="functools.partial"></a>functools.partial</h1><p>返回一个新的部分对象,当被调用的时候,相当于原有的对象携带了默认的参数.如果在调用过程中传递了更多的参数,将会被追加到args.如果提供了其他的关键字参数,则会覆盖或者扩展关键字:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial</span>(<span class="params">func, *args, **keywords</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">newfunc</span>(<span class="params">*fargs, **fkeywords</span>):</span></span><br><span class="line">        newkeywords = keywords.copy()</span><br><span class="line">        newkeywords.update(fkeywords)</span><br><span class="line">        <span class="keyword">return</span> func(*(args + fargs), **newkeywords)</span><br><span class="line">    newfunc.func = func</span><br><span class="line">    newfunc.args = args</span><br><span class="line">    newfunc.keywords = keywords</span><br><span class="line">    <span class="keyword">return</span> newfunc</span><br></pre></td></tr></table></figure>

<p>当函数的参数个数太多，需要简化时，使用functools.partial可以创建一个新的函数，这个新函数可以固定住原函数的部分参数，从而在调用时更简单.</p>
<p> eg:</p>
<p> <code>int()</code>函数,可以将字符串转为整数,简单看一下它的函数使用说明:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">int</span>(<span class="params"><span class="built_in">object</span></span>)</span></span><br><span class="line"><span class="class">|  <span class="title">int</span>(<span class="params">x=<span class="number">0</span></span>) -&gt; integer</span></span><br><span class="line"><span class="class">|  <span class="built_in">int</span>(x, base=10) -&gt; integer</span></span><br><span class="line"><span class="class">|</span></span><br><span class="line"><span class="class">|  Convert a number <span class="keyword">or</span> string to an integer, <span class="keyword">or</span> <span class="keyword">return</span> 0 <span class="keyword">if</span> no arguments</span></span><br><span class="line"><span class="class">|  are given.  If x <span class="keyword">is</span> a number, <span class="keyword">return</span> x.__int__().  For floating point</span></span><br><span class="line"><span class="class">|  numbers, this truncates towards zero.</span></span><br><span class="line"><span class="class">|</span></span><br><span class="line"><span class="class">|  If x <span class="keyword">is</span> <span class="keyword">not</span> a number <span class="keyword">or</span> <span class="keyword">if</span> base <span class="keyword">is</span> given, then x must be a string,</span></span><br><span class="line"><span class="class">|  <span class="built_in">bytes</span>, <span class="keyword">or</span> <span class="built_in">bytearray</span> instance representing an integer literal <span class="keyword">in</span> the</span></span><br><span class="line"><span class="class">|  given base.  The literal can be preceded by &#x27;+&#x27; <span class="keyword">or</span> &#x27;-&#x27; <span class="keyword">and</span> be surrounded</span></span><br><span class="line"><span class="class">|  by whitespace.  The base defaults to 10.  Valid bases are 0 <span class="keyword">and</span> 2-36.</span></span><br><span class="line"><span class="class">|  Base 0 means to interpret the base <span class="keyword">from</span> the string <span class="keyword">as</span> an integer literal.</span></span><br><span class="line"><span class="class">|  &gt;&gt;&gt; <span class="built_in">int</span>(&#x27;0b100&#x27;, base=0)</span></span><br><span class="line"><span class="class">|  4</span></span><br></pre></td></tr></table></figure>
<p>从上述说明中我们可以看见,int还有一个额外的参数<code>base</code>,base 默认值为10,也就意味着默认情况下将字符串转化为十进制的数.如果我们需要转化成二进制怎么办?在不使用其他模块的情况下,只需要<code>int(x,base=2)</code>,那么如果是借助<code>partial</code>,该如何使用呢?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line">&gt;&gt;&gt;int2 = partial(<span class="built_in">int</span>,base=<span class="number">2</span>) <span class="comment"># 这里是传递了关键字参数,即keywords</span></span><br><span class="line">&gt;&gt;&gt;int2(<span class="string">&#x27;1000&#x27;</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">8</span></span><br><span class="line">&gt;&gt;&gt;str_3_int = partial(<span class="built_in">int</span>,<span class="string">&#x27;3&#x27;</span>) <span class="comment"># 传递了参数args</span></span><br><span class="line">&gt;&gt;&gt;str_3_int()</span><br><span class="line">&gt;&gt;&gt;<span class="number">3</span> <span class="comment"># 不够清楚的话可以接着看下面的例子</span></span><br><span class="line">&gt;&gt;&gt;max_with_10 = partial(<span class="built_in">max</span>,<span class="number">10</span>)</span><br><span class="line">&gt;&gt;&gt;max_with_10(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">&gt;&gt;&gt;<span class="number">10</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/10/28/Flask-Login%E7%94%A8%E6%88%B7%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/10/28/Flask-Login%E7%94%A8%E6%88%B7%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">Flask-Login用户会话管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-28 00:00:00" itemprop="dateCreated datePublished" datetime="2017-10-28T00:00:00+08:00">2017-10-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>想必大家对 Flask-Login 这个 Flask 扩展肯定不会陌生,毕竟作为一个应用,用户登录之后,他们的认证状态是需要被记录下来的,浏览其他的页面也是需要使用这个状态的,但是这一过程是怎么发挥作用的呢?让我们从源码的层次上简单认识一下.</p>
<h1 id="Flask-Login-使用的准备"><a href="#Flask-Login-使用的准备" class="headerlink" title="Flask-Login 使用的准备"></a>Flask-Login 使用的准备</h1><p>使用 flask-login 的之前,我们必须要实现下述四个方法:<br><img src="http://ww1.sinaimg.cn/large/006wYWbGly1fkur7vprn0j30n804kmxd.jpg"><br>但是为什么要实现这个方法呢?别着急我们在下面会释疑.<br>除此之外我们还需要写下述的这样的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_user</span>(<span class="params">username</span>):</span></span><br><span class="line">    <span class="keyword">if</span> query_user(username) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        curr_user = User()</span><br><span class="line">        curr_user.<span class="built_in">id</span> = username</span><br><span class="line">        <span class="keyword">return</span> curr_user</span><br></pre></td></tr></table></figure>
<p>上面的为用户的回调函数接收字符串表示的唯一用户标识符,如果能找到该用户,则返回该用户对象否则返回None.但是<code>user_loader</code>究竟是什么?<br>源码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginManager</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">user_loader</span>(<span class="params">self, callback</span>):</span></span><br><span class="line">        self.user_callback = callback</span><br><span class="line">        <span class="keyword">return</span> callback</span><br></pre></td></tr></table></figure>
<p>似乎没什么作用呢?别着急,接着往下看,我们通过具体使用去理解源码</p>
<h1 id="login-user"><a href="#login-user" class="headerlink" title="login_user()"></a>login_user()</h1><p>但凡时候 Flask-Login 应该都用过 <code>login_user()</code>,所以让我们看看使用这个函数发生了什么.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_user</span>(<span class="params">user, remember=<span class="literal">False</span>, force=<span class="literal">False</span>, fresh=<span class="literal">True</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> force <span class="keyword">and</span> <span class="keyword">not</span> user.is_active: <span class="comment"># 最初必须实现的四个方法之一,在这里发挥作用,如果该用户不允许登录则直接返回False(黑名单etc)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    user_id = user.get_id() <span class="comment"># 修改</span></span><br><span class="line">    session[<span class="string">&#x27;user_id&#x27;</span>] = user_id</span><br><span class="line">    session[<span class="string">&#x27;_fresh&#x27;</span>] = fresh</span><br><span class="line">    session[<span class="string">&#x27;_id&#x27;</span>] = current_app.login_manager._session_identifier_generator() <span class="comment"># 根据客户端的User Agent和IP生成标识,strong模式下一旦用户标识检测失败,便会清空所有的session内容</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> remember:</span><br><span class="line">        session[<span class="string">&#x27;remember&#x27;</span>] = <span class="string">&#x27;set&#x27;</span></span><br><span class="line"></span><br><span class="line">    _request_ctx_stack.top.user = user</span><br><span class="line">    user_logged_in.send(current_app._get_current_object(), user=_get_user())</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>主要内容是将用户信息放入session中,并为改session生成标识符.</p>
<h1 id="login-required"><a href="#login-required" class="headerlink" title="@login_required"></a>@login_required</h1><p>我们通过 @login_required 去限制用户页面访问,这一过程是怎么实现的?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_required</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorated_view</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request.method <span class="keyword">in</span> EXEMPT_METHODS: // EXEMPT_METHODS = <span class="built_in">set</span>([<span class="string">&#x27;OPTIONS&#x27;</span>]) config.py 第 <span class="number">49</span> 行,通常该请求是获取服务器支持的HTTP请求方法</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">elif</span> current_app.login_manager._login_disabled: <span class="comment"># 如果 _login_disabled 被设置为 True,则装饰器将会被忽略,通常用在单元测试可以很方便的关闭认证</span></span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> current_user.is_authenticated: <span class="comment"># 判断用户是否登录</span></span><br><span class="line">            <span class="keyword">return</span> current_app.login_manager.unauthorized() <span class="comment"># 没有登录的情况下:1.如果注册了 LoginManager.unauthorized_handler 则这个时候调用这个函数 2. 向用户提示 LoginManager.login_message信息 3.有 login_view的情况下,跳转到login_view,没有则返回abort(401)</span></span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> decorated_view</span><br></pre></td></tr></table></figure>
<h1 id="unauthorized"><a href="#unauthorized" class="headerlink" title="unauthorized()"></a>unauthorized()</h1><p>在上述<code>@login.required</code>中我们说明了,<code>unauthorized()</code>在需要登录的情况下采取的行动,现在简单的看一下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unauthorized</span>(<span class="params">self</span>):</span></span><br><span class="line">    user_unauthorized.send(current_app._get_current_object())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.unauthorized_callback:</span><br><span class="line">        <span class="keyword">return</span> self.unauthorized_callback()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.blueprint <span class="keyword">in</span> self.blueprint_login_views:</span><br><span class="line">        login_view = self.blueprint_login_views[request.blueprint]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        login_view = self.login_view</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> login_view:</span><br><span class="line">        abort(<span class="number">401</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.login_message:</span><br><span class="line">        <span class="keyword">if</span> self.localize_callback <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            flash(self.localize_callback(self.login_message),</span><br><span class="line">                  category=self.login_message_category)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flash(self.login_message, category=self.login_message_category)</span><br><span class="line"></span><br><span class="line">    config = current_app.config</span><br><span class="line">    <span class="keyword">if</span> config.get(<span class="string">&#x27;USE_SESSION_FOR_NEXT&#x27;</span>, USE_SESSION_FOR_NEXT):</span><br><span class="line">        login_url = expand_login_view(login_view)</span><br><span class="line">        session[<span class="string">&#x27;next&#x27;</span>] = make_next_param(login_url, request.url)</span><br><span class="line">        redirect_url = make_login_url(login_view)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        redirect_url = make_login_url(login_view, next_url=request.url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(redirect_url)</span><br></pre></td></tr></table></figure>
<h1 id="current-user"><a href="#current-user" class="headerlink" title="current_user"></a>current_user</h1><p>在登录之后,我们在需要使用当前登录对象的时候,都会使用 <code>current_user</code>,那么它是怎么发挥作用的?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">current_user = LocalProxy(<span class="keyword">lambda</span>: _get_user()) // 当前用户的代理,这里重点关注 _get_user()</span><br><span class="line"></span><br><span class="line"><span class="comment"># _get_user()</span></span><br><span class="line"><span class="comment"># 调用 login_user() 之后显然 _request_ctx_stack.top 中存在 user,则直接返回 </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_user</span>():</span></span><br><span class="line">    <span class="keyword">if</span> has_request_context() <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(_request_ctx_stack.top, <span class="string">&#x27;user&#x27;</span>):</span><br><span class="line">        current_app.login_manager._load_user()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">getattr</span>(_request_ctx_stack.top, <span class="string">&#x27;user&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 那么如果不存在,会发生什么? 调用 _loder_user()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># _loader_user()</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_load_user</span>(<span class="params">self</span>):</span></span><br><span class="line">        user_accessed.send(current_app._get_current_object())</span><br><span class="line"></span><br><span class="line">        config = current_app.config</span><br><span class="line">        <span class="keyword">if</span> config.get(<span class="string">&#x27;SESSION_PROTECTION&#x27;</span>, self.session_protection): // session 保护,可以取值为 <span class="literal">None</span>(禁用),basic(在 basic 模式下或会话是永久的，如果该标识未匹配，会话会简单地被标记为非活 跃的，且任何需要活跃登入的东西会强制用户重新验证，前提你已经使用了活跃登入机制),strong(在 strong 模式下的非永久会话，如果该标识未匹配，整个会话或者记住的令牌如果存在将会被删除)</span><br><span class="line">            deleted = self._session_protection()</span><br><span class="line">            <span class="keyword">if</span> deleted:</span><br><span class="line">                <span class="keyword">return</span> self.reload_user()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果 记住你的 cookie 存在,而 session 不存在,则会将 cookie 中的 user_id 赋值给 session</span></span><br><span class="line">        <span class="comment"># 但是如果这个时候处于登出的状态的话,会发生什么呢?</span></span><br><span class="line">        is_missing_user_id = <span class="string">&#x27;user_id&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session</span><br><span class="line">        <span class="keyword">if</span> is_missing_user_id:</span><br><span class="line">            cookie_name = config.get(<span class="string">&#x27;REMEMBER_COOKIE_NAME&#x27;</span>, COOKIE_NAME)</span><br><span class="line">            header_name = config.get(<span class="string">&#x27;AUTH_HEADER_NAME&#x27;</span>, AUTH_HEADER_NAME)</span><br><span class="line">            has_cookie = (cookie_name <span class="keyword">in</span> request.cookies <span class="keyword">and</span></span><br><span class="line">                          session.get(<span class="string">&#x27;remember&#x27;</span>) != <span class="string">&#x27;clear&#x27;</span>) // 登出的时候 has_cookie = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> has_cookie:</span><br><span class="line">                <span class="keyword">return</span> self._load_from_cookie(request.cookies[cookie_name])</span><br><span class="line">            <span class="keyword">elif</span> self.request_callback: //定义在 request_loader() 中, 正常情况下我们并不使用,仅当我们不想使用 cookie 的情况下登录用户才会考虑 request_loader 回调.</span><br><span class="line">                <span class="keyword">return</span> self._load_from_request(request)</span><br><span class="line">            <span class="keyword">elif</span> header_name <span class="keyword">in</span> request.headers: </span><br><span class="line">                <span class="keyword">return</span> self._load_from_header(request.headers[header_name]) <span class="comment"># 该函数调用链中的 header_loader() 已经被弃用</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.reload_user()</span><br></pre></td></tr></table></figure>

<h1 id="logout-user"><a href="#logout-user" class="headerlink" title="logout_user()"></a>logout_user()</h1><p>登录要验证账户密码什么的,显的比较复杂,但是登出就很简答了,你不需要传递任何参数,只需调用这个函数,那让我们看看这个函数发生了什么:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout_user</span>():</span></span><br><span class="line">    user = _get_user() <span class="comment"># 从_request_ctx_stack.top.user,session 或者 remember_me cookie 中获取</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;user_id&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        session.pop(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;_fresh&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        session.pop(<span class="string">&#x27;_fresh&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    cookie_name = current_app.config.get(<span class="string">&#x27;REMEMBER_COOKIE_NAME&#x27;</span>, COOKIE_NAME)</span><br><span class="line">    <span class="keyword">if</span> cookie_name <span class="keyword">in</span> request.cookies:</span><br><span class="line">        session[<span class="string">&#x27;remember&#x27;</span>] = <span class="string">&#x27;clear&#x27;</span></span><br><span class="line"></span><br><span class="line">    user_logged_out.send(current_app._get_current_object(), user=user)</span><br><span class="line"></span><br><span class="line">    current_app.login_manager.reload_user() </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>该函数将session中的user相关信息全部清空,然后重新加载用户,正常逻辑下由于重新加载用户后如果当前页面需要登录才能访问的话,则会跳转到登录视图.</p>
<h1 id="fresh-login-required"><a href="#fresh-login-required" class="headerlink" title="fresh_login_required"></a>fresh_login_required</h1><p>当用户登入，他们的会话被标记成“新鲜的”，就是说在这个会话只中用户实际上登录过。当会话销毁用户使用“记住我”的 cookie 重新登入，会话被标记成“非新鲜的”。fresh_login_required 除了验证用户登录，也将确保他们的登录是“新鲜的”。如果不是“新鲜的”，它会把用户送到可以重输入验证条件的页面,主要用户修改个人信息的敏感操作. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fresh_login_required</span>(<span class="params">func</span>):</span></span><br><span class="line"><span class="meta">    @wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorated_view</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request.method <span class="keyword">in</span> EXEMPT_METHODS:</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">elif</span> current_app.login_manager._login_disabled:</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">            <span class="keyword">return</span> current_app.login_manager.unauthorized()</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> login_fresh(): // 获取session 中的 refresh 值</span><br><span class="line">            <span class="keyword">return</span> current_app.login_manager.needs_refresh() // <span class="number">1.</span>出现 LoginMange.needs_refress_message <span class="number">2.</span>跳转到 LoginManger.refresh_view,如果没有设置则会提示 <span class="number">401</span> 错误</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> decorated_view</span><br></pre></td></tr></table></figure>

<h1 id="confirm-login"><a href="#confirm-login" class="headerlink" title="confirm_login"></a>confirm_login</h1><p>将会话重新标记为”新鲜”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">confirm_login</span>():</span></span><br><span class="line">    session[<span class="string">&#x27;_fresh&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">    session[<span class="string">&#x27;_id&#x27;</span>] = current_app.login_manager._session_identifier_generator() // 重新生成会话<span class="built_in">id</span></span><br><span class="line">    user_login_confirmed.send(current_app._get_current_object())</span><br></pre></td></tr></table></figure>


<h1 id="reload-user"><a href="#reload-user" class="headerlink" title="reload_user()"></a>reload_user()</h1><p>接着 <code>logout_user()</code> 中调用 <code>reload_user()</code>.很显然这个函数的功能就是重新加载用户,具体实现让我们看下源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># logout_user() 中调用, user 使用默认参数为 None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reload_user</span>(<span class="params">self, user=<span class="literal">None</span></span>):</span></span><br><span class="line">        ctx = _request_ctx_stack.top // _request_ctx_stack 一个保存对象的栈,可以返回看 login_user() 源码的倒数第三行,登录的时候将 user 保存在 _request_ctx_stack.top.user 中</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>: </span><br><span class="line">            user_id = session.get(<span class="string">&#x27;user_id&#x27;</span>) // logout_user() 中 session 已经将 user_id 移除</span><br><span class="line">            <span class="keyword">if</span> user_id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                ctx.user = self.anonymous_user() //见下文</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> self.user_callback <span class="keyword">is</span> <span class="literal">None</span>: //这里解释了为什么我们需要定义 @login_manager.user_loader</span><br><span class="line">                    <span class="keyword">raise</span> Exception(</span><br><span class="line">                        <span class="string">&quot;No user_loader has been installed for this &quot;</span></span><br><span class="line">                        <span class="string">&quot;LoginManager. Add one with the &quot;</span></span><br><span class="line">                        <span class="string">&quot;&#x27;LoginManager.user_loader&#x27; decorator.&quot;</span>)</span><br><span class="line">                user = self.user_callback(user_id) // 这里我们最初定义的user_loader发挥作用,通过调用self.user_callback()获取用户</span><br><span class="line">                <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    ctx.user = self.anonymous_user()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    ctx.user = user</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ctx.user = user</span><br></pre></td></tr></table></figure>

<h1 id="anoymous-user"><a href="#anoymous-user" class="headerlink" title="anoymous_user"></a>anoymous_user</h1><p>源码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">self.anonymous_user = AnonymousUserMixin // 匿名类</span><br><span class="line"></span><br><span class="line"><span class="comment"># AnonymousUserMixin</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnonymousUserMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_authenticated</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_active</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_anonymous</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_id</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span></span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://leetaogoooo.github.io/2017/10/19/Migrating%20from%20Flask-Script%20to%20the%20New%20Flask%20CLI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.ico">
      <meta itemprop="name" content="Leetao">
      <meta itemprop="description" content="Je pense, donc je suis">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leetao's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2017/10/19/Migrating%20from%20Flask-Script%20to%20the%20New%20Flask%20CLI/" class="post-title-link" itemprop="url">Migrating from Flask-Script to the New Flask CLI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-10-19 00:00:00" itemprop="dateCreated datePublished" datetime="2017-10-19T00:00:00+08:00">2017-10-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-12 20:39:23" itemprop="dateModified" datetime="2022-11-12T20:39:23+08:00">2022-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>原文:<a target="_blank" rel="noopener" href="https://blog.miguelgrinberg.com/post/migrating-from-flask-script-to-the-new-flask-cli">https://blog.miguelgrinberg.com/post/migrating-from-flask-script-to-the-new-flask-cli</a></p>
</blockquote>
<p><img src="http://ww1.sinaimg.cn/large/006wYWbGly1fknogoype5j30ci0810so.jpg"></p>
<p>在Falsk 0.11版本, Flask 基于 <a target="_blank" rel="noopener" href="http://click.pocoo.org/5/">Click</a> 引进了一个新的命令行功能,该功能包含了 <code>flask</code>命令. 在此之前 Flask 并没有提供任何关于构建命令行接口(CLIs)的支持,但是 <a target="_blank" rel="noopener" href="http://flask-script.readthedocs.io/en/latest/">Flask=Script</a>作为三方拓展提供了类似的功能.</p>
<p>在 Flask CLI发布超过一年的时间里,我仍然看见有许多项目基于 Flask-Script. 我猜测这是由于没有特别重要的原因促使人们迁移到 Flask CLI中，毕竟 Flask-Script 运转地很好,至少没什么毛病. 但是实际上,自从 2014 年开始 Flask-Script 就再也没有过官方发布版本并且看起来也没有再维护了.在本文中，我想向你展示如何将 Flasky 应用程序从 Flask-Script 迁移到 Click ，以便你可以了解两者的不同之处，并决定是否迁移应用程序.</p>
<h1 id="Flask-Script-有什么问题？"><a href="#Flask-Script-有什么问题？" class="headerlink" title="Flask-Script 有什么问题？"></a>Flask-Script 有什么问题？</h1><p>在我看来,Flask-Script 有个严重的缺陷.但有趣的是，这是一个由Flask reloader 中的老的设计问题直接引起的问题,如果你使用app.run()启动应用程序,而不使用Flask-Script,仍然会出现这个问题.</p>
<p>如果你在调试模式下启动应用程序，则会运行两个 Flask 进程. 第一个进程用来观察源文件的更改，第二个是实际的 Flask 服务器. 当任何源文件更改时，监视进程将杀死服务器进程,然后启动另一个进程,从而使用新的源文件.</p>
<p>当你无意中在某个源文件中引入语法错误时，会出现一个问题. 这个时候观察者进程并不知道,所以它仍然会杀死旧的服务器,并启动一个新的. 但是新服务器不会启动,因为 Python 在解析修改后的文件时会引发错误.当服务器进程在错误中退出时,观察者进程也会放弃并退出,从而迫使你在修复代码中的错误后重新启动整个进程.</p>
<p>当您使用新的 Flask Run 命令启动重新加载程序时,效果会好得多.在发送第一个请求之前,不会导入应用程序,此时,如果在导入源文件时发生错误,就会像处理运行时发生的错误一样进行处理.这意味着,如果启用了基于 Web 的调试器,将在那里报告错误.新的观察者进程也更智能，如果服务器进程死了也不会退出.相反,它将继续监视源文件,并尝试在进行更多更改后再次启动服务器.</p>
<h1 id="新的-Flask-CLI"><a href="#新的-Flask-CLI" class="headerlink" title="新的 Flask CLI"></a>新的 Flask CLI</h1><p>Flask CLI 比 Flask-Script 更好吗?让我们首先回顾一下所有 Flask 应用程序获得的默认命令，看看它们的性能如何.</p>
<p>当你安装Flask 0.11或更高版本时，您将在虚拟环境中安装一个flask命令:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(venv) $ flask</span><br><span class="line">Usage: flask [OPTIONS] COMMAND [ARGS]...</span><br><span class="line"></span><br><span class="line">  This shell command acts as general utility script for Flask applications.</span><br><span class="line"></span><br><span class="line">  It loads the application configured (through the FLASK_APP environment</span><br><span class="line">  variable) and then provides commands either provided by the application or</span><br><span class="line">  Flask itself.</span><br><span class="line"></span><br><span class="line">  The most useful commands are the &quot;run&quot; and &quot;shell&quot; command.</span><br><span class="line"></span><br><span class="line">  Example usage:</span><br><span class="line"></span><br><span class="line">    set FLASK_APP=hello.py</span><br><span class="line">    set FLASK_DEBUG=1</span><br><span class="line">    flask run</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --version  Show the flask version</span><br><span class="line">  --help     Show this message and exit.</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  db     Perform database migrations.</span><br><span class="line">  run    Runs a development server.</span><br><span class="line">  shell  Runs a shell in the app context.</span><br></pre></td></tr></table></figure>

<p>使用 Flask-script 时，你必须创建一个驱动程序脚本，通常称为 <code>manage.py</code>. 查看上面的内容，可以看到<code>./manage.py</code> <code>runserver</code>映射到<code>flask run</code>, <code>./manage.py shell</code> 映射到<code>flask shell</code>没什么区别对吧？</p>
<p>这里其实有一个令人困扰的问题. manage.py和flask命令在发现Flask应用程序实例的方式上有所不同. 对于Flask-Script，应用程序作为参数直接或以应用程序工厂函数的形式提供给Manager类. 但是，新的FlaskCLI期望应用程序实例在flask_app环境变量中提供，通常将其设置为定义它的模块的文件名.  Flask将在该模块中查找应用程序或应用程序对象，并将其用作应用程序.</p>
<p>不幸的是,在新的 Flask CLI 中没有对应用程序工厂功能的直接支持.使用工厂函数需要遵循的方法是定义一个调用工厂函数来创建app对象的模块,然后在 <code>flask_app</code>中引用该模块.这在概念上类似于 <code>Django</code> 应用程序中的 <code>wsgi.py</code> 模块.</p>
<p>如果你希望为<a target="_blank" rel="noopener" href="https://github.com/miguelgrinberg/flasky">Flasky</a>支持新的 Flask CLI，可以编写一个flasky.py文件，如下所示：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>注意，我从manage.py复制了这些行，一旦完全迁移到新的CLI，我们就不会使用这些行.</p>
<h1 id="“flask-run”-命令"><a href="#“flask-run”-命令" class="headerlink" title="“flask run” 命令"></a>“flask run” 命令</h1><p>添加<code>flasky.py</code>模块后，可以使用以下命令启动 Flask 开发服务器:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> FLASK_APP=flasky.py</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> flask run</span></span><br></pre></td></tr></table></figure>

<p>如果你使用的是 Windows，则 <code>FLASK_APP</code>环境变量的设置方式略有不同:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">set</span> FLASK_APP=flasky.py</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> flask run</span></span><br></pre></td></tr></table></figure>

<p><code>flask run</code>命令具有启用或禁用重新加载程序和调试器的选项,还可以设置 IP 地址和端口,以便服务器侦听客户端请求. 这些选项与 Flask-script 中的选项并不相同,但它们比较接近.你可以使用<code>flask run --help</code>看见所有可用的选项.</p>
<p>正如我敢肯定，大家都知道，大多数 Flask 的应用程序有这行代码在主脚本的底部:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>当你不使用任何 CLI 支持时,这就是你实际如何启动服务器的方法.如果你将此保留在脚本中并开始使用新的 CLI ,不会导致任何问题，但实际上并不需要它，因此你可以删除它.</p>
<h1 id="“flask-shell”-命令"><a href="#“flask-shell”-命令" class="headerlink" title="“flask shell” 命令"></a>“flask shell” 命令</h1><p><code>shell</code>命令基本上是相同的，但是在如何定义要自动导入到 shell 上下文中的其他符号方面有一点差异. 这是一个在处理应用程序时可以节省大量时间的特性.通常,你可以在 shell 的测试或调试会话中添加模型类,数据库实例和其他可能与之交互的对象.</p>
<p>对于 Flask-Script 来说, Flasky 应用有下述 shell 上下文的定义:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Follow=Follow, Role=Role,</span><br><span class="line">                Permission=Permission, Post=Post, Comment=Comment)</span><br><span class="line">manager.add_command(<span class="string">&quot;shell&quot;</span>, Shell(make_context=make_shell_context))</span><br></pre></td></tr></table></figure>

<p>正如你在上面看到的, <code>make_shell_text()</code>函数在定义 <code>shell</code> 选项的 <code>add_command</code> 调用中被引用. Flask-Script 在启动shell会话之前调用此函数，并在其中包含字典中返回的所有符号.</p>
<p>Flask CLI提供了相同的功能,使用装饰器来标识提供 shell 上下文项的函数(实际上,可以有多个函数)。为了具有与上面相同的功能，我扩展了<code>flasky.py</code>模块:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User, Follow, Role, Permission, Post, Comment</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.shell_context_processor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Follow=Follow, Role=Role,</span><br><span class="line">                Permission=Permission, Post=Post, Comment=Comment)</span><br></pre></td></tr></table></figure>

<p>因此,如你所见,该函数是相同的,但需要<code>@app.Shell_Context_Processor</code>装饰器，以便 Flask 知道它.</p>
<h1 id="来自-Flask-Extensions-的命令"><a href="#来自-Flask-Extensions-的命令" class="headerlink" title="来自 Flask Extensions 的命令"></a>来自 Flask Extensions 的命令</h1><p>Flask-Script 成功的一个重要原因是它允许其他 Flask 扩展添加自己的命令.实际上,我已经利用了这个功能在我的<a target="_blank" rel="noopener" href="https://github.com/miguelgrinberg/flask-migrate">Flask-Migrate</a>扩展.</p>
<p>那么,如何将这些命令迁移到Click CLI呢?不幸的是，你只能依赖扩展作者为你进行迁移.如果你使用的任何扩展,与 Flask-Script 协同工作,并且还没有更新到与Flask CLI协同工作的话,那么你将非常不幸,你将需要继续使用 Flask-Script.至少在与相关扩展交互时是这样.如果你使用 Flask-Migrate,你不必担心,因为我已经更新了它以支持 Click 和 Flask-Script CLIs,确保您正在使用最新版本.</p>
<p>特别是对于Flask-Migrate,<code>./manage.py db....</code>.在 Flask-script 版本中, Flask-Migrate 扩展是在<code>manage.py</code>中初始化的.对于 Flask CLI 版本,我们可以将其移到新的<code>flasky.py</code>模块，我相信你现在已经意识到它正在成为 Flask-Script 的<code>manage.py</code>的替代品.唯一的区别是它不是直接执行的脚本.下面是添加了Flask-Migrate集成的模块:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User, Follow, Role, Permission, Post, Comment</span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.shell_context_processor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Follow=Follow, Role=Role,</span><br><span class="line">                Permission=Permission, Post=Post, Comment=Comment)</span><br></pre></td></tr></table></figure>

<p>作为例子,你可以使用以下命令将 Flasky 数据库升级到最新的修订版本,但请记住,需要设置<code>FLASK_APP</code>才能使其工作:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> flask db upgrade</span></span><br></pre></td></tr></table></figure>

<h1 id="应用命令"><a href="#应用命令" class="headerlink" title="应用命令"></a>应用命令</h1><p>Flask-Script 的另一个不错的特性是，它允许您将自定义任务编写为函数,然后通过添加装饰器将其自动转换为 CLI 中的命令.在 Flasky 中,我使用这个特性添加了一些命令.例如,下面是我如何实现 Flask-script 的<code>./manage.py test</code>命令:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@manager.command</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">coverage=<span class="literal">False</span></span>):</span></span><br><span class="line">  <span class="string">&quot;&quot;&quot;Run the unit tests.&quot;&quot;&quot;</span></span><br><span class="line">  <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p><code>@manager.command</code>装饰器是将函数公开为 <code>test</code>命令所需的,它甚至可以检测到<code>coverage</code>参数,并将其添加为 –coverage 选项.</p>
<p>基于装饰器的命令实际上是 Click 的面包和黄油,所以这是可以毫无问题地迁移的.Flask CLI 的等效函数可以放在 <code>flasky.py</code>中,如下所示:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--coverage/--no-coverage&#x27;</span>, default=<span class="literal">False</span>, <span class="built_in">help</span>=<span class="string">&#x27;Enable code coverage&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">coverage</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Run the unit tests.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p><code>@app.cli.command()</code>装饰器为 Click 提供了一个接口.在Flask-script中,命令是在安装了应用程序上下文的情况下执行的,但是在使用 Flask CLI 的情况下,如果你不需要的话,你可以禁用它. 函数的实际代码不需要更改,但请注意,<code>--coverage</code>选项需要使用<code>@click.OptionDecorator</code>显式地给出,这与Flask-Script不同,后者的选项自动从函数参数列表派生.</p>
<p>另外两个在我的 Flasky 的应用程序中的自定义函数也可以采用相同的方法. <code>flasky.py</code>模块的完整实现如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app, db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> User, Follow, Role, Permission, Post, Comment</span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate</span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line">app = create_app(os.getenv(<span class="string">&#x27;FLASK_CONFIG&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;default&#x27;</span>)</span><br><span class="line">migrate = Migrate(app, db)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.shell_context_processor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_shell_context</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(app=app, db=db, User=User, Follow=Follow, Role=Role,</span><br><span class="line">                Permission=Permission, Post=Post, Comment=Comment)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--coverage/--no-coverage&#x27;</span>, default=<span class="literal">False</span>, <span class="built_in">help</span>=<span class="string">&#x27;aaa&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">coverage=<span class="literal">False</span></span>):</span></span><br><span class="line">    <span class="string">&quot;Test coverage&quot;</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--length&#x27;</span>, default=<span class="number">25</span>, <span class="built_in">help</span>=<span class="string">&#x27;Profile stack length&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@click.option(<span class="params"><span class="string">&#x27;--profile-dir&#x27;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&#x27;Profile directory&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">profile</span>(<span class="params">length, profile_dir</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Start the application under the code profiler.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.cli.command()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deploy</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Run deployment tasks.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<p>在本文中，我向您展示了新 Flask CLI 提供的功能,如果你想迁移基于 Flak-Script 的应用程序,这些功能将非常有用.还有几件事你可以做,但我没有在这里写到.文档描述了如何创建自己的驱动程序脚本，类似于 flask-script 的<code>manage.py</code>,以防你不想使用<code>flask</code>命令.它还告诉你如何通过项目的<code>setup.py</code>文件中定义的”entry points”来注册命令,如果你在项目中使用它的话.如果你感兴趣,请务必查看<a target="_blank" rel="noopener" href="http://flask.pocoo.org/docs/0.12/cli/">CLI文档</a>以了解这些内容.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leetao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  





  




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"leetaoGoooo","repo":"leetaogoooo.github.io","client_id":"bf98ffa3f57b2591544e","client_secret":"cc5ffeff8863bb5c44ed10f024513dccfac14afa","admin_user":"leetaogoooo","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":null,"js":{"url":"https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"fc1212e4c6ef0ea216824014023be545"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
